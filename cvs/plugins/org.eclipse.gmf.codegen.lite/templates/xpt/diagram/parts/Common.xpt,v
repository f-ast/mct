head	1.8;
access;
symbols
	v20080910-1520:1.8
	v20080722-1827:1.8
	v20080716-1642:1.8
	R2_1_maintenance:1.8.0.2
	Root_R2_1_maintenance:1.8
	R2_1_0:1.8
	v20080507-1326:1.8
	v20080501-1739:1.7
	v20080425-1959:1.7
	v20080322-0000:1.7
	v20071108-0000:1.7
	v20071003-0000:1.6
	v20070921-0000:1.5
	v20070915-0000:1.5
	v20070903-0000:1.6
	v20070809-0000:1.5
	R2_0_maintenance:1.5.0.2
	R2_0:1.5
	R4_20:1.5
	v20070621-0000:1.5
	RC3_20:1.5
	v20070614-1400:1.5
	v20070608-1300:1.5
	v20070601-1400:1.5
	v20070525-1500:1.5
	v20070520-1200:1.5
	v20070518-1300:1.4
	v20070504-1000:1.3
	v20070427-0600:1.3
	v20070420-1000:1.2
	v20070413-1300:1.2
	v20070405-1100:1.2;
locks; strict;
comment	@# @;


1.8
date	2008.05.07.13.55.37;	author atikhomirov;	state Exp;
branches;
next	1.7;
commitid	388c4821b4d44567;

1.7
date	2007.10.31.17.16.43;	author bblajer;	state Exp;
branches;
next	1.6;
commitid	79fa4728b8794567;

1.6
date	2007.07.04.13.22.26;	author bblajer;	state Exp;
branches;
next	1.5;
commitid	405d468b9f0f4567;

1.5
date	2007.05.18.21.17.25;	author atikhomirov;	state Exp;
branches;
next	1.4;
commitid	25e5464e17e24567;

1.4
date	2007.05.04.14.08.44;	author bblajer;	state Exp;
branches;
next	1.3;
commitid	464d463b3e6a4567;

1.3
date	2007.04.24.14.16.48;	author bblajer;	state Exp;
branches;
next	1.2;
commitid	4264462e114e4567;

1.2
date	2007.04.05.09.28.42;	author bblajer;	state Exp;
branches;
next	1.1;
commitid	7aeb4614c14a4567;

1.1
date	2007.04.04.11.04.48;	author bblajer;	state Exp;
branches;
next	;
commitid	18c54613864d4567;


desc
@@


1.8
log
@[228913] updated ValueExpression use in GMFGen to better accomodate codegen needs (items 1,2,3)
@
text
@/*
 * Copyright (c) 2007 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    bblajer (Borland) - initial API and implementation
 */

«IMPORT "http://www.eclipse.org/gmf/2008/GenModel"»
«IMPORT "http://www.eclipse.org/emf/2002/Ecore"»
«IMPORT "http://www.eclipse.org/emf/2002/GenModel"»
«EXTENSION xpt::diagram::parts::Common»
«EXTENSION xpt::diagram::Helper»

«DEFINE visualIDConstant FOR gmfgen::GenCommonBase-»
	«EXPAND xpt::Common::generatedMemberComment»
	public static final int VISUAL_ID = «visualID»;
«ENDDEFINE»

«DEFINE modelIDConstant FOR gmfgen::GenDiagram-»
	«EXPAND xpt::Common::generatedMemberComment»
	public static String MODEL_ID = "«editorGen.modelID»";	«EXPAND xpt::Common::nonNLS»
«ENDDEFINE»

«DEFINE registerModel FOR gmfgen::GenCommonBase-»
	«EXPAND xpt::Common::generatedMemberComment»
	protected void registerModel() {
		super.registerModel();
		org.eclipse.gmf.runtime.notation.View view = (org.eclipse.gmf.runtime.notation.View) getModel();
		if (view != null && view.isSetElement() && view.getElement() != null) {
			getViewer().getEditPartRegistry().put(view.getElement(), this);	
		}
	}

	«EXPAND xpt::Common::generatedMemberComment»
	protected void unregisterModel() {
		super.unregisterModel();
		org.eclipse.gmf.runtime.notation.View view = (org.eclipse.gmf.runtime.notation.View) getModel();
		if (view != null && view.isSetElement() && view.getElement() != null && getViewer().getEditPartRegistry().get(view.getElement()) == this) {
			getViewer().getEditPartRegistry().remove(view.getElement());
		}
	}
«ENDDEFINE»

«DEFINE getAdapter FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public Object getAdapter(Class key) {
	«EXPAND snapToAdapter-»
	«EXPAND xpt::diagram::parts::TreeEditPart::getAdapterClause-»
	«EXPAND externalChildPositionTrackerAdapter-»
	«EXPAND getAdapterAdditions-»
	return super.getAdapter(key);
}
«ENDDEFINE»

«DEFINE getAdapterAdditions FOR gmfgen::GenCommonBase»«ENDDEFINE»

«DEFINE snapToAdapter FOR gmfgen::GenCommonBase»«ENDDEFINE»

«DEFINE snapToAdapter FOR gmfgen::GenContainerBase-»
«IF needsXYLayout()-»
if (org.eclipse.gef.SnapToHelper.class == key) {
	return new org.eclipse.gef.SnapToGrid(this);
}
«ENDIF-»
«ENDDEFINE»

«DEFINE externalChildPositionTrackerAdapter FOR gmfgen::GenCommonBase-»
«ENDDEFINE»

«DEFINE externalChildPositionTrackerAdapter FOR gmfgen::GenChildSideAffixedNode-»
if (org.eclipse.gmf.runtime.lite.figures.ExternalChildPositionTracker.class == key) {
	return getPositionTracker();
}
«ENDDEFINE»

«DEFINE externalChildPositionTracker FOR gmfgen::GenCommonBase-»
«ENDDEFINE»

«DEFINE externalChildPositionTracker FOR gmfgen::GenChildSideAffixedNode-»
«EXPAND xpt::Common::generatedMemberComment»
private org.eclipse.gmf.runtime.lite.figures.ExternalChildPositionTracker myPositionTracker;

«EXPAND xpt::Common::generatedMemberComment»
public org.eclipse.gmf.runtime.lite.figures.ExternalChildPositionTracker getPositionTracker() {
	if (myPositionTracker == null) {
		myPositionTracker = new org.eclipse.gmf.runtime.lite.figures.ExternalChildPositionTracker(this);
	}
	return myPositionTracker;
}
«ENDDEFINE»

«DEFINE behaviour FOR gmfgen::GenCommonBase»«EXPAND behaviour FOREACH behaviour»«ENDDEFINE»

«DEFINE behaviour FOR gmfgen::Behaviour»«ENDDEFINE»

«DEFINE behaviour FOR gmfgen::SharedBehaviour»«EXPAND behaviour FOR delegate»«ENDDEFINE»

«DEFINE behaviour FOR gmfgen::CustomBehaviour»
installEditPolicy(«key», new «getEditPolicyQualifiedClassName()»()); «IF key.startsWith('\"') && key.endsWith('\"')»«EXPAND xpt::Common::nonNLS»«ENDIF»
«ENDDEFINE»

«DEFINE behaviour FOR gmfgen::OpenDiagramBehaviour-»
	installEditPolicy(org.eclipse.gmf.runtime.lite.edit.policies.EditPolicyRoles.OPEN_ROLE,
		new «getEditPolicyQualifiedClassName()»());
«ENDDEFINE»

«DEFINE viewmap FOR gmfgen::Viewmap»«ENDDEFINE»

«DEFINE viewmap FOR gmfgen::InnerClassViewmap-»
«classBody-»
«EXPAND mapModeWorkaround-»
«ENDDEFINE»

«DEFINE mapModeWorkaround FOR gmfgen::InnerClassViewmap-»
«IF classBody.matches(".*[DL]Pto[LD]P.*")-»
«EXPAND xpt::Common::generatedClassComment»
private static class MapModeWorkaround {
	«EXPAND xpt::Common::generatedMemberComment»
	public int DPtoLP(int dp) {
		return dp;
	}
	«EXPAND xpt::Common::generatedMemberComment»
	public int LPtoDP(int lp) {
		return lp;
	}
	«EXPAND xpt::Common::generatedMemberComment»
	public static MapModeWorkaround INSTANCE = new MapModeWorkaround();
}

«EXPAND xpt::Common::generatedMemberComment»
private MapModeWorkaround getMapMode() {
	return MapModeWorkaround.INSTANCE;
}
«ENDIF-»
«ENDDEFINE»

«DEFINE declareViewCode FOR gmfgen::GenCommonBase»«EXPAND declareViewCode("org.eclipse.gmf.runtime.notation.Node")»«ENDDEFINE»
«DEFINE declareViewCode FOR gmfgen::GenDiagram»«EXPAND declareViewCode("org.eclipse.gmf.runtime.notation.Diagram")»«ENDDEFINE»
«DEFINE declareViewCode FOR gmfgen::GenLink»«EXPAND declareViewCode("org.eclipse.gmf.runtime.notation.Edge")»«ENDDEFINE»

«DEFINE declareViewCode(String expectedModelType) FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public «expectedModelType» «EXPAND getViewCode» {
	return («expectedModelType») getModel();
}
«ENDDEFINE»

«DEFINE contentPane FOR gmfgen::GenChildContainer-»
«EXPAND xpt::Common::generatedMemberComment»
protected org.eclipse.draw2d.IFigure contentPane;

«EXPAND xpt::Common::generatedMemberComment»
public org.eclipse.draw2d.IFigure getContentPane() {
	if (contentPane == null) {
		return super.getContentPane();
	}
	return contentPane;
}
«ENDDEFINE»

«DEFINE ctors FOR gmfgen::GenCommonBase»«EXPAND ctors("org.eclipse.gmf.runtime.notation.Node")»«ENDDEFINE»
«DEFINE ctors FOR gmfgen::GenLink»«EXPAND ctors("org.eclipse.gmf.runtime.notation.Edge")»«ENDDEFINE»

«DEFINE ctors(String expectedModelType) FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public «editPartClassName»(org.eclipse.gmf.runtime.notation.View model) {
	assert model instanceof «expectedModelType»;
	setModel(model);
}
«ENDDEFINE»

«DEFINE ctors FOR gmfgen::GenDiagram-»
«EXPAND xpt::Common::generatedMemberComment»
public «editPartClassName»(org.eclipse.gmf.runtime.notation.Diagram model) {
	setModel(model);
}
«ENDDEFINE»

«DEFINE ctors FOR gmfgen::GenLinkLabel-»
«EXPAND invokeSuperCtor-»
«ENDDEFINE»

«DEFINE ctors FOR gmfgen::GenExternalNodeLabel-»
«EXPAND invokeSuperCtor-»
«ENDDEFINE»

«DEFINE invokeSuperCtor FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public «editPartClassName»(org.eclipse.gmf.runtime.notation.View model) {
	super(model);
}
«ENDDEFINE»

«DEFINE getViewCode FOR gmfgen::GenCommonBase»getDiagramNode()«ENDDEFINE»

«DEFINE getViewCode FOR gmfgen::GenDiagram»getDiagram()«ENDDEFINE»

«DEFINE getViewCode FOR gmfgen::GenLink»getDiagramEdge()«ENDDEFINE»

«DEFINE getDiagramCode FOR gmfgen::GenCommonBase»«EXPAND getViewCode».getDiagram()«ENDDEFINE»

«DEFINE getDiagramCode FOR gmfgen::GenDiagram»«EXPAND getViewCode»«ENDDEFINE»

«DEFINE getDiagramElementCode FOR gmfgen::GenCommonBase»«EXPAND getDiagramCode».getElement()«ENDDEFINE»

«DEFINE getModelChildren FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelChildren() {
	return «EXPAND getViewCode».getVisibleChildren();
}
«ENDDEFINE»

«DEFINE getModelSourceConnections FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelSourceConnections() {
	return «EXPAND getViewCode».getSourceEdges();
}
«ENDDEFINE»

«DEFINE getModelTargetConnections FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelTargetConnections() {
	return «EXPAND getViewCode».getTargetEdges();
}
«ENDDEFINE»

«DEFINE getModelChildren FOR gmfgen::GenChildLabelNode-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelChildren() {
	return java.util.Collections.EMPTY_LIST;
}
«ENDDEFINE»

«DEFINE getModelSourceConnections FOR gmfgen::GenChildLabelNode-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelSourceConnections() {
	return java.util.Collections.EMPTY_LIST;
}
«ENDDEFINE»

«DEFINE getModelTargetConnections FOR gmfgen::GenChildLabelNode-»
«EXPAND xpt::Common::generatedMemberComment»
protected java.util.List getModelTargetConnections() {
	return java.util.Collections.EMPTY_LIST;
}
«ENDDEFINE»

«DEFINE notSelectable FOR gmfgen::GenCommonBase-»
«IF !isSelectable()-»
«EXPAND xpt::Common::generatedMemberComment»
public boolean isSelectable() {
	return false;
}
«ENDIF-»
«ENDDEFINE»

«DEFINE getTransactionalUpdateManager FOR gmfgen::GenCommonBase-»
«IF needsTransactionalUpdateManager()-»
«EXPAND xpt::Common::generatedMemberComment»
private org.eclipse.gmf.runtime.lite.edit.parts.update.TransactionalUpdateManager getTransactionalUpdateManager() {
	return (org.eclipse.gmf.runtime.lite.edit.parts.update.TransactionalUpdateManager) getViewer().getProperty(org.eclipse.gmf.runtime.lite.edit.parts.update.TransactionalUpdateManager.class.getName());
}
«ENDIF-»
«ENDDEFINE»

«DEFINE activate FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public void activate() {
	super.activate();
	«EXPAND activateAdditions-»
}
«ENDDEFINE»

«DEFINE deactivate FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public void deactivate() {
	«EXPAND deactivateAdditions-»
	super.deactivate();
}
«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenCommonBase»«ENDDEFINE»
«DEFINE deactivateAdditions FOR gmfgen::GenCommonBase»«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenContainerBase-»
«EXPAND activateRefreshers-»
«ENDDEFINE»

«DEFINE deactivateAdditions FOR gmfgen::GenContainerBase-»
«EXPAND deactivateRefreshers-»
«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenDiagram-»
«EXPAND activateRefreshers-»
getTransactionalUpdateManager().install(org.eclipse.emf.transaction.util.TransactionUtil.getEditingDomain(«EXPAND getViewCode»));
«ENDDEFINE»

«DEFINE deactivateAdditions FOR gmfgen::GenDiagram-»
getTransactionalUpdateManager().uninstall();
«EXPAND deactivateRefreshers-»
«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenChildLabelNode-»
addExternalRefresher(getLabelRefresher());
«EXPAND activateRefreshers-»
«ENDDEFINE»

«DEFINE deactivateAdditions FOR gmfgen::GenChildLabelNode-»
«EXPAND deactivateRefreshers-»
removeExternalRefresher(getLabelRefresher());
«ENDDEFINE»

«DEFINE activateRefreshers FOR gmfgen::GenContainerBase-»
«EXPAND xpt::diagram::parts::domainModelRefresher::activate-»
«EXPAND xpt::diagram::parts::NotationModelRefresher::installClause-»
«EXPAND xpt::diagram::parts::LinkNotationModelRefresher::installClause-»
«ENDDEFINE»

«DEFINE deactivateRefreshers FOR gmfgen::GenContainerBase-»
«EXPAND xpt::diagram::parts::LinkNotationModelRefresher::uninstallClause-»
«EXPAND xpt::diagram::parts::NotationModelRefresher::uninstallClause-»
«EXPAND xpt::diagram::parts::domainModelRefresher::deactivate-»
«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenLabel-»
«EXPAND xpt::diagram::parts::LabelController::activateAdditions-»
«ENDDEFINE»

«DEFINE deactivateAdditions FOR gmfgen::GenLabel-»
«EXPAND xpt::diagram::parts::LabelController::deactivateAdditions-»
«ENDDEFINE»

«DEFINE activateAdditions FOR gmfgen::GenLink-»
«EXPAND xpt::diagram::parts::domainModelRefresher::activate-»
«EXPAND xpt::diagram::parts::LinkNotationModelRefresher::installClause-»
«ENDDEFINE»

«DEFINE deactivateAdditions FOR gmfgen::GenLink-»
«EXPAND xpt::diagram::parts::LinkNotationModelRefresher::uninstallClause-»
«EXPAND xpt::diagram::parts::domainModelRefresher::deactivate-»
«ENDDEFINE»

@


1.7
log
@[208264]: [lite]: Implement border items
[208270]: [lite]: Feedback for element creation should show exactly where the element will be created
Move external label when a deep ancestor is moved;
NodeEditPart.xpt: add variation point to createEditPolicies;
AddNodeCommand.xpt: do not generate unused attribute
@
text
@d13 1
a13 1
«IMPORT "http://www.eclipse.org/gmf/2006/GenModel"»
@


1.6
log
@Eliminated Jet templates in lite version;
i18n in lite RT;
For generated classes whose names are not directly modifiable via gmfgen file, consistent className/qualifiedClassName template is exposed (and used throughout the generation process, including the Generator);
Link labels and external node labels are not selectable, but movable;
Inner elements are not selectable with marquee tool;
Fixed copyright statements throughout the lite RT.
@
text
@d54 1
d72 25
@


1.5
log
@switching to nsURI format which uses year to denote model version (same way EMF does)
@
text
@d158 4
d163 4
@


1.4
log
@1. Links to links;
2. Exception from TreeEditPartViewer (in the outline) while closing the diagram editor (because unregister is not called, only deactivate) fixed;
3. instead of rerouting a link to an end that does not support it, remove the link
@
text
@d13 1
a13 1
«IMPORT "http://www.eclipse.org/gmf/2005/GenModel/2.0"»
@


1.3
log
@CanonicalStyle is taken into account while refreshing notational model to reflect changes in underlying domain model;
Update is now centralized and transactional;
Changes to visibility are dispatched to the parent of the affected view as well (was: only to the view itself);
Save options are not reused, for easy modification of the generated code;
Side-affixed children are not considered direct children;
Empty edit-patterns are treated the same way as null patterns (view pattern is used instead).
@
text
@d306 1
d310 1
@


1.2
log
@java.lang.AssertionError in generated link edit parts fixed
@
text
@d228 9
a264 3
if (!«EXPAND getViewCode».eAdapters().contains(getUpdateManager())) {
	«EXPAND getViewCode».eAdapters().add(getUpdateManager());
}
d266 1
d270 1
a271 1
«EXPAND getViewCode».eAdapters().remove(getUpdateManager());
@


1.1
log
@[176696]: InitDiagramContents: do not create notational edges to and from child label nodes;
Rewrite editpart templates in xpt;
Unify what is refreshed for each edit part type;
Preparation for side-affixed elements.
@
text
@d146 1
a146 1
	assert model instanceof org.eclipse.gmf.runtime.notation.Node;
@

