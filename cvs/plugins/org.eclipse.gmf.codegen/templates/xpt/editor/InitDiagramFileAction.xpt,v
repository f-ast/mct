head	1.10;
access;
symbols
	v20081022-1925:1.10
	v20081015-1925:1.10
	v20081008-1925:1.9
	v20081001-1925:1.9
	v20080930-1130:1.9
	v20080926-1245:1.9
	v20080924-1925:1.9
	v20080917-1925:1.9
	v20080911-1728:1.9
	v20080910-1520:1.9
	v20080903-1520:1.9
	v20080827-1520:1.9
	v20080813-1520:1.9
	v20080806-1520:1.9
	v20080722-1827:1.9
	v20080718-1731:1.9
	v20080716-1600:1.9
	v20080716-1642:1.9
	R2_1_maintenance:1.9.0.2
	Root_R2_1_maintenance:1.9
	R2_1_0:1.9
	v20080610-1132:1.9
	v20080603-1553:1.9
	v20080528-1052:1.9
	v20080521:1.9
	v20080516-1543:1.9
	v20080516-1143:1.9
	v20080512-1200:1.9
	v20080508-2000:1.9
	v20080507-1326:1.9
	v20080503-1740:1.8
	v20080501-1739:1.8
	v20080425-1959:1.8
	v20080417-1610:1.8
	v20080411-0411:1.8
	v20080404-1111:1.8
	v20080322-0000:1.8
	v20080222-1200:1.8
	v20080215-1500:1.8
	v20080207-0207:1.8
	v20071222-1111:1.8
	v20071214-1111:1.8
	v20071130-1111:1.8
	v20071124-0000:1.8
	v20071112-0000:1.8
	v20071108-0000:1.8
	v20071003-0000:1.8
	v20070928-0000:1.8
	v20070921-0000:1.8
	v20070915-0000:1.8
	v20070903-0000:1.8
	v20070809-0000:1.8
	R2_0_maintenance:1.8.0.2
	R2_0:1.8
	R4_20:1.8
	v20070621-0000:1.8
	RC3_20:1.8
	v20070614-1400:1.8
	v20070608-1300:1.8
	v20070605-1400:1.8
	v20070601-1400:1.8
	v20070525-1500:1.8
	v20070520-1200:1.8
	v20070518-1300:1.7
	v20070504-1000:1.6
	v20070427-0600:1.6
	v20070420-1000:1.6
	v20070413-1300:1.6
	v20070405-1100:1.5
	v20070403-1500:1.4
	v20070330-1300:1.4
	v20060330-1300:1.4
	v20070322-1100:1.3;
locks; strict;
comment	@# @;
expand	@k@;


1.10
date	2008.10.14.12.53.48;	author atikhomirov;	state Exp;
branches;
next	1.9;
commitid	2e35d48f496534567;

1.9
date	2008.05.07.13.56.00;	author atikhomirov;	state Exp;
branches;
next	1.8;
commitid	39124821b4de4567;

1.8
date	2007.05.18.21.17.18;	author atikhomirov;	state Exp;
branches;
next	1.7;
commitid	2591464e17d14567;

1.7
date	2007.05.15.19.19.22;	author ashatalin;	state Exp;
branches;
next	1.6;
commitid	43d3464a07b84567;

1.6
date	2007.04.06.15.34.21;	author atikhomirov;	state Exp;
branches;
next	1.5;
commitid	33134616687b4567;

1.5
date	2007.04.04.11.18.20;	author bblajer;	state Exp;
branches;
next	1.4;
commitid	2664461389794567;

1.4
date	2007.03.28.08.49.38;	author dstadnik;	state Exp;
branches;
next	1.3;
commitid	2240460a2c174567;

1.3
date	2007.03.16.16.40.13;	author dstadnik;	state Exp;
branches;
next	1.2;
commitid	5ac345fac86b4567;

1.2
date	2007.03.16.15.03.51;	author dstadnik;	state Exp;
branches;
next	1.1;
commitid	23bb45fab1d74567;

1.1
date	2007.03.16.14.45.34;	author dstadnik;	state Exp;
branches;
next	;
commitid	2a5045faad8d4567;


desc
@@


1.10
log
@[174961] Menu actions - refactor LoadResource and CreateShortcut actions to use generic genmodel action infrastructure
@
text
@/*
 * Copyright (c) 2007, 2008 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Alexander Shatalin (Borland) - initial API and implementation
 *    Dmitry Stadnik (Borland) - rewritten in xpand
 */

«IMPORT "http://www.eclipse.org/gmf/2008/GenModel"»
«IMPORT "http://www.eclipse.org/emf/2002/Ecore"»

«EXTENSION xpt::editor::Utils»

«DEFINE InitDiagramFileAction(gmfgen::GenEditorGenerator editorGen) FOR gmfgen::InitDiagramAction-»
«EXPAND xpt::Common::copyright FOR editorGen-»
«EXPAND xpt::Common::packageStatement FOR qualifiedClassName»

«EXPAND xpt::Common::generatedClassComment»
public class «qualifiedClassName.split('\\.').last()»
	«IF editorGen.application == null-»
implements org.eclipse.ui.IObjectActionDelegate {

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.ui.IWorkbenchPart targetPart;

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.emf.common.util.URI domainModelURI;

	«EXPAND xpt::Common::generatedMemberComment»
	public void setActivePart(org.eclipse.jface.action.IAction action, org.eclipse.ui.IWorkbenchPart targetPart) {
		this.targetPart = targetPart;
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void selectionChanged(org.eclipse.jface.action.IAction action, org.eclipse.jface.viewers.ISelection selection) {
		domainModelURI = null;
		action.setEnabled(false);
		if (selection instanceof org.eclipse.jface.viewers.IStructuredSelection == false || selection.isEmpty()) {
			return;
		}
		org.eclipse.core.resources.IFile file =
			(org.eclipse.core.resources.IFile) ((org.eclipse.jface.viewers.IStructuredSelection) selection).getFirstElement();
		domainModelURI = org.eclipse.emf.common.util.URI.createPlatformResourceURI(file.getFullPath().toString(), true);
		action.setEnabled(true);
	}

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.swt.widgets.Shell getShell() {
		return targetPart.getSite().getShell();
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void run(org.eclipse.jface.action.IAction action) {
		org.eclipse.emf.transaction.TransactionalEditingDomain editingDomain =
			org.eclipse.gmf.runtime.emf.core.GMFEditingDomainFactory.INSTANCE.createEditingDomain();
		«IF editorGen.sameFileForDiagramAndModel-»
		org.eclipse.emf.ecore.resource.ResourceSet resourceSet = new org.eclipse.emf.ecore.resource.impl.ResourceSetImpl();
		«ELSE-»
		org.eclipse.emf.ecore.resource.ResourceSet resourceSet = editingDomain.getResourceSet();
		«ENDIF-»
		org.eclipse.emf.ecore.EObject diagramRoot = null;
		try {
			org.eclipse.emf.ecore.resource.Resource resource = resourceSet.getResource(domainModelURI, true);
			diagramRoot = (org.eclipse.emf.ecore.EObject) resource.getContents().get(0);
		} catch (org.eclipse.emf.common.util.WrappedException ex) {
			«editorGen.plugin.getActivatorQualifiedClassName()».getInstance().logError(
				"Unable to load resource: " + domainModelURI, ex);«EXPAND xpt::Common::nonNLS»
		}
		if (diagramRoot == null) {
			org.eclipse.jface.dialogs.MessageDialog.openError(getShell(), 
                «EXPAND xpt::Externalizer::accessorCall(i18nKeyForInitDiagramFileResourceErrorDialog().titleKey()) FOR editorGen»,
                «EXPAND xpt::Externalizer::accessorCall(i18nKeyForInitDiagramFileResourceErrorDialog().messageKey()) FOR editorGen»);
			return;
		}
		org.eclipse.jface.wizard.Wizard wizard = new «editorGen.diagram.getNewDiagramFileWizardQualifiedClassName()»(domainModelURI, diagramRoot, editingDomain);
		wizard.setWindowTitle(org.eclipse.osgi.util.NLS.bind(
				    «EXPAND xpt::Externalizer::accessorCall(i18nKeyForInitDiagramFileWizardTitle()) FOR editorGen»,
				    «EXPAND xpt::editor::VisualIDRegistry::modelID FOR editorGen.diagram»));
		«editorGen.diagram.getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile");«EXPAND xpt::Common::nonNLS»
	}
	«ELSE-»
implements org.eclipse.ui.IWorkbenchWindowActionDelegate {

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.ui.IWorkbenchWindow window;

	«EXPAND xpt::Common::generatedMemberComment»
	public void init(org.eclipse.ui.IWorkbenchWindow window) {
		this.window = window;
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void dispose() {
		window = null;
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void selectionChanged(org.eclipse.jface.action.IAction action, org.eclipse.jface.viewers.ISelection selection) {
	}

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.swt.widgets.Shell getShell() {
		return window.getShell();
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void run(org.eclipse.jface.action.IAction action) {
		org.eclipse.emf.transaction.TransactionalEditingDomain editingDomain =
			org.eclipse.gmf.runtime.emf.core.GMFEditingDomainFactory.INSTANCE.createEditingDomain();
		org.eclipse.emf.ecore.resource.Resource resource =
				«editorGen.diagram.getDiagramEditorUtilQualifiedClassName()».openModel(getShell(), 
					«EXPAND xpt::Externalizer::accessorCall(i18nKeyForInitDiagramOpenFileDialogTitle()) FOR editorGen», editingDomain);
		if (resource == null || resource.getContents().isEmpty()) {
			return;
		}
		org.eclipse.emf.ecore.EObject diagramRoot = (org.eclipse.emf.ecore.EObject) resource.getContents().get(0);
		org.eclipse.jface.wizard.Wizard wizard = new «editorGen.diagram.getNewDiagramFileWizardQualifiedClassName()»(resource.getURI(), diagramRoot, editingDomain);
		wizard.setWindowTitle(org.eclipse.osgi.util.NLS.bind(
				    «EXPAND xpt::Externalizer::accessorCall(i18nKeyForInitDiagramFileWizardTitle()) FOR editorGen»,
				    «EXPAND xpt::editor::VisualIDRegistry::modelID FOR editorGen.diagram»));
		«editorGen.diagram.getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile");«EXPAND xpt::Common::nonNLS»
	}
	«ENDIF-»
}
«ENDDEFINE»

«DEFINE i18nAccessors FOR gmfgen::GenDiagram-»
«EXPAND xpt::Externalizer::accessorField(i18nKeyForInitDiagramFileResourceErrorDialog().titleKey())-»
«EXPAND xpt::Externalizer::accessorField(i18nKeyForInitDiagramFileResourceErrorDialog().messageKey())-»
«EXPAND xpt::Externalizer::accessorField(i18nKeyForInitDiagramFileWizardTitle())-»
«EXPAND xpt::Externalizer::accessorField(i18nKeyForInitDiagramOpenFileDialogTitle())-»
«ENDDEFINE»

«DEFINE i18nValues FOR gmfgen::GenDiagram-»
«EXPAND xpt::Externalizer::messageEntry(i18nKeyForInitDiagramFileResourceErrorDialog().titleKey(), "Error")-»
«EXPAND xpt::Externalizer::messageEntry(i18nKeyForInitDiagramFileResourceErrorDialog().messageKey(), "Model file loading failed")-»
«EXPAND xpt::Externalizer::messageEntry(i18nKeyForInitDiagramFileWizardTitle(), "Initialize new {0} diagram file")-»
«EXPAND xpt::Externalizer::messageEntry(i18nKeyForInitDiagramOpenFileDialogTitle(), "Select domain model")-»
«ENDDEFINE»
@


1.9
log
@[228913] updated ValueExpression use in GMFGen to better accomodate codegen needs (items 1,2,3)
@
text
@d2 1
a2 1
 * Copyright (c) 2007 Borland Software Corporation
d19 1
a19 5
«DEFINE className FOR gmfgen::GenDiagram»«initDiagramFileActionClassName»«ENDDEFINE»

«DEFINE qualifiedClassName FOR gmfgen::GenDiagram»«editorGen.editor.packageName».«EXPAND className»«ENDDEFINE»

«DEFINE InitDiagramFileAction FOR gmfgen::GenDiagram-»
d21 1
a21 1
package «editorGen.editor.packageName»;
d24 1
a24 1
public class «EXPAND className»
d72 1
a72 1
				"Unable to load resource: " + domainModelURI, ex); «EXPAND xpt::Common::nonNLS»
d80 1
a80 1
		org.eclipse.jface.wizard.Wizard wizard = new «getNewDiagramFileWizardQualifiedClassName()»(domainModelURI, diagramRoot, editingDomain);
d83 2
a84 2
				    «EXPAND xpt::editor::VisualIDRegistry::modelID»));
		«getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile"); «EXPAND xpt::Common::nonNLS»
d116 1
a116 1
				«getDiagramEditorUtilQualifiedClassName()».openModel(getShell(), 
d122 1
a122 1
		org.eclipse.jface.wizard.Wizard wizard = new «getNewDiagramFileWizardQualifiedClassName()»(resource.getURI(), diagramRoot, editingDomain);
d125 2
a126 2
				    «EXPAND xpt::editor::VisualIDRegistry::modelID»));
		«getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile"); «EXPAND xpt::Common::nonNLS»
@


1.8
log
@switching to nsURI format which uses year to denote model version (same way EMF does)
@
text
@d14 1
a14 1
«IMPORT "http://www.eclipse.org/gmf/2006/GenModel"»
@


1.7
log
@Replacing static method calls with templates.
@
text
@d14 1
a14 1
«IMPORT "http://www.eclipse.org/gmf/2005/GenModel/2.0"»
@


1.6
log
@[139733] akarjakina - i18n support
@
text
@d87 1
a87 1
				    «getEditPartQualifiedClassName()».MODEL_ID));
d129 1
a129 1
				    «getEditPartQualifiedClassName()».MODEL_ID));
@


1.5
log
@User should be able to configure whether NON-NLS markers are shown or not
@
text
@d17 2
d76 1
a76 1
				"Unable to load resource: " + domainModelURI, ex);
d79 3
a81 1
			org.eclipse.jface.dialogs.MessageDialog.openError(getShell(), "Error", "Model file loading failed");
d85 3
a87 1
		wizard.setWindowTitle("Initialize new " + «getEditPartQualifiedClassName()».MODEL_ID + " diagram file");
d120 2
a121 1
				«getDiagramEditorUtilQualifiedClassName()».openModel(getShell(), "Select domain model", editingDomain);
d127 3
a129 1
		wizard.setWindowTitle("Initialize new " + «getEditPartQualifiedClassName()».MODEL_ID + " diagram file");
d135 14
@


1.4
log
@[168660] Support shortcuts in RCP applications
@
text
@d82 1
a82 1
		«getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile"); //$NON-NLS-1$
d121 1
a121 1
		«getDiagramEditorUtilQualifiedClassName()».runWizard(getShell(), wizard, "InitDiagramFile"); //$NON-NLS-1$
@


1.3
log
@[168661] Support init fiagram in RCP
@
text
@a41 26
	private org.eclipse.swt.widgets.Shell getShell() {
		return targetPart.getSite().getShell();
	}
	«ELSE-»
implements org.eclipse.ui.IWorkbenchWindowActionDelegate {

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.ui.IWorkbenchWindow window;

	«EXPAND xpt::Common::generatedMemberComment»
	public void init(org.eclipse.ui.IWorkbenchWindow window) {
		this.window = window;
	}

	«EXPAND xpt::Common::generatedMemberComment»
	public void dispose() {
		window = null;
	}

	«EXPAND xpt::Common::generatedMemberComment»
	private org.eclipse.swt.widgets.Shell getShell() {
		return window.getShell();
	}
	«ENDIF-»

	«EXPAND xpt::Common::generatedMemberComment»
a42 1
		«IF editorGen.application == null-»
d52 5
a56 1
		«ENDIF-»
a60 12
		«IF null != editorGen.application-»
		org.eclipse.swt.widgets.FileDialog fileDialog = new org.eclipse.swt.widgets.FileDialog(getShell(), org.eclipse.swt.SWT.OPEN);
		fileDialog.open();
		String fileName = fileDialog.getFileName();
		if (fileName == null || fileName.length() == 0) {
			return;
		}
		if (fileDialog.getFilterPath() != null) {
			fileName = fileDialog.getFilterPath() + java.io.File.separator + fileName;
		}
		org.eclipse.emf.common.util.URI domainModelURI = org.eclipse.emf.common.util.URI.createFileURI(fileName);
		«ENDIF-»
a80 9
        org.eclipse.jface.dialogs.IDialogSettings pluginDialogSettings =
        	«editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getDialogSettings();
        org.eclipse.jface.dialogs.IDialogSettings initDiagramFileSettings =
        	pluginDialogSettings.getSection("InitDiagramFile"); //$NON-NLS-1$
        if (initDiagramFileSettings == null) {
        	initDiagramFileSettings = pluginDialogSettings.addNewSection("InitDiagramFile"); //$NON-NLS-1$
        }
        wizard.setDialogSettings(initDiagramFileSettings);
		wizard.setForcePreviousAndNextButtons(false);
d82 11
a92 4
        org.eclipse.jface.wizard.WizardDialog dialog = new org.eclipse.jface.wizard.WizardDialog(getShell(), wizard);
        dialog.create();
        dialog.getShell().setSize(Math.max(500, dialog.getShell().getSize().x), 500);
        dialog.open();
d94 30
@


1.2
log
@generate for RCP
@
text
@d84 12
a95 1
		«IF editorGen.application == null-»
d115 1
a115 6
		«ENDIF-»
		org.eclipse.jface.wizard.Wizard wizard = new «getNewDiagramFileWizardQualifiedClassName()»(
		«IF editorGen.application == null-»
		domainModelURI, diagramRoot, editingDomain
		«ENDIF-»
		);
@


1.1
log
@rewrite init diagram file action in xpand
@
text
@d26 3
a28 1
public class «EXPAND className» implements org.eclipse.ui.IObjectActionDelegate {
d42 26
d69 1
d75 2
a76 1
		org.eclipse.core.resources.IFile file = (org.eclipse.core.resources.IFile) ((org.eclipse.jface.viewers.IStructuredSelection) selection).getFirstElement();
d79 1
d84 3
a86 1
		org.eclipse.emf.transaction.TransactionalEditingDomain editingDomain = org.eclipse.gmf.runtime.emf.core.GMFEditingDomainFactory.INSTANCE.createEditingDomain();
d97 2
a98 1
			«editorGen.plugin.getActivatorQualifiedClassName()».getInstance().logError("Unable to load resource: " + domainModelURI, ex);
d101 1
a101 1
			org.eclipse.jface.dialogs.MessageDialog.openError(targetPart.getSite().getShell(), "Error", "Model file loading failed");
d104 10
a113 3
		org.eclipse.jface.wizard.Wizard wizard = new «getNewDiagramFileWizardQualifiedClassName()»(domainModelURI, diagramRoot, editingDomain);
        org.eclipse.jface.dialogs.IDialogSettings pluginDialogSettings = «editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getDialogSettings();
        org.eclipse.jface.dialogs.IDialogSettings initDiagramFileSettings = pluginDialogSettings.getSection("InitDiagramFile"); //$NON-NLS-1$
d120 1
a120 1
        org.eclipse.jface.wizard.WizardDialog dialog = new org.eclipse.jface.wizard.WizardDialog(targetPart.getSite().getShell(), wizard);
@

