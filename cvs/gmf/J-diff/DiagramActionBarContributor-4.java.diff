15,16d14
< import org.eclipse.ui.IActionBars;
< 
24a23,26
> import org.eclipse.ui.IActionBars;
> import org.eclipse.ui.PlatformUI;
> import org.eclipse.ui.activities.ActivityManagerEvent;
> import org.eclipse.ui.activities.IActivityManagerListener;
27c29
<  * @author melaasar
---
>  * @author melaasar, cmahoney
34a37,57
> 	/**
> 	 * Listens for activity/capability events.
> 	 * 
> 	 * @author cmahoney
> 	 */
> 	class ActivityManagerListener
> 		implements IActivityManagerListener {
> 
> 		public void activityManagerChanged(
> 				ActivityManagerEvent activityManagerEvent) {
> 			if (activityManagerEvent.haveEnabledActivityIdsChanged()) {
> 				updateActionBars();
> 			}
> 		}
> 	}
> 	
> 	/**
> 	 * The activity listener.
> 	 */
> 	private ActivityManagerListener activityManagerListener;
> 	
65a89,92
> 		
> 		activityManagerListener = new ActivityManagerListener();
> 		PlatformUI.getWorkbench().getActivitySupport().getActivityManager()
> 			.addActivityManagerListener(activityManagerListener);
73a101,107
> 		
> 		if (activityManagerListener != null) {
> 			PlatformUI.getWorkbench().getActivitySupport().getActivityManager()
> 				.removeActivityManagerListener(activityManagerListener);
> 		}
> 		activityManagerListener = null;
> 		
104a139,151
> 	/**
> 	 * Updates the actionbars to show/hide contribution items as applicable.
> 	 */
> 	private void updateActionBars() {
> 
> 		// get the new contributions
> 		ContributionItemService.getInstance().updateActionBars(getActionBars(),
> 			descriptor);
> 		
> 		// refresh the UI
> 		getActionBars().updateActionBars();
> 	}
> 
