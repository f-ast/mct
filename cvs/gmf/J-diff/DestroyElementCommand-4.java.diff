2c2
<  * Copyright (c) 2005 IBM Corporation and others.
---
>  * Copyright (c) 2005, 2006 IBM Corporation and others.
14,15c14,15
< import java.util.Collection;
< 
---
> import org.eclipse.core.commands.ExecutionException;
> import org.eclipse.core.runtime.IAdaptable;
18,19d17
< import org.eclipse.emf.ecore.EReference;
< 
20a19
> import org.eclipse.gmf.runtime.emf.core.util.EMFCoreUtil;
48,50c47,48
< 	protected CommandResult doExecute(IProgressMonitor progressMonitor) {
< 
< 		EReference reference = getElementToDestroy().eContainmentFeature();
---
> 	protected CommandResult doExecuteWithResult(IProgressMonitor monitor, IAdaptable info)
> 	    throws ExecutionException {
52,57c50,51
< 		if (reference.isMany()) {
< 			((Collection) getElementToEdit().eGet(reference))
< 				.remove(getElementToDestroy());
< 			
< 		} else {
< 			getElementToEdit().eSet(reference, null);
---
> 		if (getElementToDestroy().eResource() != null) {
> 			EMFCoreUtil.destroy(getElementToDestroy());
59c53
< 		return newOKCommandResult();
---
> 		return CommandResult.newOKCommandResult();
70,75c64
< 	/*
< 	 * (non-Javadoc)
< 	 * 
< 	 * @see org.eclipse.gmf.runtime.emf.commands.core.internal.commands.EditElementCommand#isExecutable()
< 	 */
< 	public boolean isExecutable() {
---
> 	public boolean canExecute() {
