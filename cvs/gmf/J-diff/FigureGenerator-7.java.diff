27a28,29
> import org.eclipse.gmf.gmfgraph.util.FigureQualifiedNameSwitch;
> import org.eclipse.gmf.gmfgraph.util.GMFGraphSwitch;
40,46c42,47
< import org.eclipse.gmf.internal.graphdef.codegen.DispatcherImpl;
< import org.eclipse.gmf.internal.graphdef.codegen.HierarchyKeyMap;
< import org.eclipse.gmf.internal.graphdef.codegen.KeyChain;
< import org.eclipse.gmf.internal.graphdef.codegen.KeyMap;
< import org.eclipse.gmf.internal.graphdef.codegen.StaticTemplateRegistry;
< import org.eclipse.gmf.internal.graphdef.codegen.TemplateRegistry;
< import org.eclipse.gmf.internal.graphdef.codegen.YAEmitterFactory;
---
> import org.eclipse.gmf.internal.codegen.dispatch.EmitterFactory;
> import org.eclipse.gmf.internal.codegen.dispatch.HierarchyKeyMap;
> import org.eclipse.gmf.internal.codegen.dispatch.KeyChain;
> import org.eclipse.gmf.internal.codegen.dispatch.KeyMap;
> import org.eclipse.gmf.internal.codegen.dispatch.StaticTemplateRegistry;
> import org.eclipse.gmf.internal.codegen.dispatch.TemplateRegistry;
55,56c56,57
< 	private Dispatcher myTopDispatcher;
< 	private Dispatcher myInnerDispatcher;
---
> 	private GraphDefDispatcher myTopDispatcher;
> 	private GraphDefDispatcher myInnerDispatcher;
59c60
< 		this(null);
---
> 		this(null, new NullImportAssistant(), new FigureQualifiedNameSwitch());
62c63
< 	public FigureGenerator(String aPackageName) {
---
> 	public FigureGenerator(String aPackageName, ImportAssistant importManager, GMFGraphSwitch figureNameSwitch) {
84,87c85,88
< 		YAEmitterFactory topFactory = new YAEmitterFactory(thisBundle.getEntry("/"), fillTopLevel(), true, variables, true);
< 		myTopDispatcher = new DispatcherImpl(topFactory, keyMap);
< 		YAEmitterFactory innerFactory = new YAEmitterFactory(thisBundle.getEntry("/"), fillAttrs(), true, variables, true);
< 		myInnerDispatcher = new DispatcherImpl(innerFactory, keyMap);
---
> 		EmitterFactory topFactory = new EmitterFactory(thisBundle.getEntry("/"), fillTopLevel(), true, variables, true);
> 		myTopDispatcher = new GraphDefDispatcher(topFactory, keyMap, importManager, figureNameSwitch);
> 		EmitterFactory innerFactory = new EmitterFactory(thisBundle.getEntry("/"), fillAttrs(), true, variables, true);
> 		myInnerDispatcher = new GraphDefDispatcher(innerFactory, keyMap, importManager, figureNameSwitch);
131,134d131
< 		return go(fig, new NullImportAssistant());
< 	}
< 
< 	public String go(Figure fig, ImportAssistant importManager) {
136c133,134
< 		res = myTopDispatcher.dispatch(fig, new Object[] {fig, importManager, myInnerDispatcher});
---
> 		Object args = new Object[] {fig, myTopDispatcher.getImportManager(), myTopDispatcher.getFQNSwitch(), myInnerDispatcher};
> 		res = myTopDispatcher.dispatch(fig, args);
