34d33
< 
36,44c35,41
< import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.internal.domain.MSLEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.internal.plugin.MSLDebugOptions;
< import org.eclipse.gmf.runtime.emf.core.internal.plugin.MSLPlugin;
< import org.eclipse.gmf.runtime.emf.core.internal.resources.MSLResource;
< import org.eclipse.gmf.runtime.emf.core.internal.resources.MSLSave;
< import org.eclipse.gmf.runtime.emf.core.internal.util.MSLConstants;
< import org.eclipse.gmf.runtime.emf.core.internal.util.MSLUtil;
< import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
---
> import org.eclipse.gmf.runtime.emf.core.internal.plugin.EMFCoreDebugOptions;
> import org.eclipse.gmf.runtime.emf.core.internal.plugin.EMFCorePlugin;
> import org.eclipse.gmf.runtime.emf.core.internal.resources.GMFResource;
> import org.eclipse.gmf.runtime.emf.core.internal.resources.GMFSave;
> import org.eclipse.gmf.runtime.emf.core.internal.util.EMFCoreConstants;
> import org.eclipse.gmf.runtime.emf.core.internal.util.Util;
> import org.eclipse.gmf.runtime.emf.core.util.EMFCoreUtil;
107c104
< 				if (((MSLConstants.PLATFORM_SCHEME.equals(anUri.scheme())) && (MSLConstants.PLATFORM_SCHEME
---
> 				if (((EMFCoreConstants.PLATFORM_SCHEME.equals(anUri.scheme())) && (EMFCoreConstants.PLATFORM_SCHEME
123,124c120,128
< 				EObject eObj = MSLUtil.resolve((MSLEditingDomain)MEditingDomain.getEditingDomain(xmlResource),
< 					obj, true);
---
> 				EObject eObj = obj;
> 				
> 				if (obj.eIsProxy()) {
> 					eObj = EcoreUtil.resolve(obj, xmlResource);
> 					if (eObj == null) {
> 						eObj = null;
> 					}
> 				}
> 				
141,142c145,146
< 				if (otherResource instanceof MSLResource) {
< 					String qName = EObjectUtil.getQName(obj, true);
---
> 				if (otherResource instanceof GMFResource) {
> 					String qName = EMFCoreUtil.getQualifiedName(obj, true);
146,147c150,151
< 						buffer.append(MSLConstants.FRAGMENT_SEPARATOR);
< 						buffer.append(MSLUtil.encodeQName(qName));
---
> 						buffer.append(EMFCoreConstants.FRAGMENT_SEPARATOR);
> 						buffer.append(Util.encodeQualifiedName(qName));
171,172c175,176
< 		Trace.throwing(MSLPlugin.getDefault(),
< 			MSLDebugOptions.EXCEPTIONS_THROWING, getClass(), methodName, ex);
---
> 		Trace.throwing(EMFCorePlugin.getDefault(),
> 			EMFCoreDebugOptions.EXCEPTIONS_THROWING, getClass(), methodName, ex);
191c195
< 		return new MSLSave(createXMLHelper()) {
---
> 		return new GMFSave(createXMLHelper()) {
321,322c325,326
< 			getEObjectToIDMap().put(eObject, EObjectUtil.getID(eObject));
< 			getIDToEObjectMap().put(EObjectUtil.getID(eObject), eObject);
---
> 			getEObjectToIDMap().put(eObject, xmlResource.getID(eObject));
> 			getIDToEObjectMap().put(xmlResource.getID(eObject), eObject);
