13a14,22
> import java.util.ArrayList;
> import java.util.Collection;
> import java.util.Iterator;
> import java.util.List;
> import java.util.Map;
> 
> import org.eclipse.core.runtime.IAdaptable;
> import org.eclipse.core.runtime.IProgressMonitor;
> import org.eclipse.gef.EditPart;
14a24,25
> import org.eclipse.gef.RequestConstants;
> import org.eclipse.gef.requests.CreateRequest;
17a29
> import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramGraphicalViewer;
20a33
> import org.eclipse.gmf.runtime.notation.View;
21a35,36
> import org.eclipse.jface.viewers.StructuredSelection;
> import org.eclipse.swt.widgets.Display;
94,95c109,122
< 	/* (non-Javadoc)
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction#updateTargetRequest()
---
> 	protected void updateTargetRequest() {
> 		super.updateTargetRequest();
> 
> 		CreateViewRequest req = (CreateViewRequest) getTargetRequest();
> 		req.setLocation(getMouseLocation());
> 	}
>     
>     protected void doRun(IProgressMonitor progressMonitor) {
>         super.doRun(progressMonitor);
>         selectAddedObject();
>     }
>     
>     /**
>      * Selects the newly added shape view(s) by default.
97,104c124,160
< //	protected void updateTargetRequest() {
< //		super.updateTargetRequest();
< //
< //		Point p = Point.SINGLETON.getCopy();
< //		MapMode.translateToDP(p);
< //		CreateViewRequest req = (CreateViewRequest)getTargetRequest();
< //		req.setLocation(p);
< //	}
---
>     protected void selectAddedObject() {
>         Object result = ((CreateRequest) getTargetRequest()).getNewObject();
>         if (!(result instanceof Collection)) {
>             return;
>         }
>         final List editparts = new ArrayList(1);
> 
>         IDiagramGraphicalViewer viewer = getDiagramGraphicalViewer();
>         if (viewer == null) {
>             return;
>         }
> 
>         Map editpartRegistry = viewer.getEditPartRegistry();
>         for (Iterator iter = ((Collection) result).iterator(); iter.hasNext();) {
>             Object viewAdaptable = iter.next();
>             if (viewAdaptable instanceof IAdaptable) {
>                 Object editPart = editpartRegistry
>                     .get(((IAdaptable) viewAdaptable).getAdapter(View.class));
>                 if (editPart != null)
>                     editparts.add(editPart);
>             }
>         }
> 
>         if (!editparts.isEmpty()) {
>             viewer.setSelection(new StructuredSelection(editparts));
> 
>             // automatically put the first shape into edit-mode
>             Display.getCurrent().asyncExec(new Runnable() {
> 
>                 public void run() {
>                     EditPart editPart = (EditPart) editparts.get(0);
>                     editPart.performRequest(new Request(
>                         RequestConstants.REQ_DIRECT_EDIT));
>                 }
>             });
>         }
>     }
