23a24
> import org.eclipse.draw2d.XYLayout;
25a27
> import org.eclipse.gef.GraphicalEditPart;
33a36
> import org.eclipse.gmf.runtime.diagram.ui.editparts.CompartmentEditPart;
34a38
> import org.eclipse.gmf.runtime.diagram.ui.editparts.GroupEditPart;
36a41
> import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.IEditableEditPart;
337a343,396
>     protected boolean calculateEnabled() {
>         
>         List operationSet = getOperationSet();
>         
>         //arrange all, always enable
>         if( isArrangeAll() && !operationSet.isEmpty()){
>             return true;
>         }
> 
>         EditPart parentEP = getSelectionParent(operationSet);
>         
>         // bugzilla 156733: disable this action if the parent or selected edit parts are not editable
>         if ((parentEP instanceof IEditableEditPart)
>                 && !((IEditableEditPart) parentEP)
>                         .isEditModeEnabled()) {
>             return false;
>         }
>         
>         for (Iterator i = operationSet.iterator(); i.hasNext();) {
>             Object next = i.next();
>             if ((next instanceof IEditableEditPart)
>                     && !((IEditableEditPart) next)
>                             .isEditModeEnabled()) {
>                 return false;
>             }
>         }
>         
>         //arrange selection
>         if (operationSet.size() >= 2) {
>             if (parentEP instanceof GraphicalEditPart) {
>                 GraphicalEditPart parent = (GraphicalEditPart)parentEP;
>                 if ((parent != null) &&(parent.getContentPane().getLayoutManager() instanceof XYLayout))
>                     return true;
>             }
>         } else if (operationSet.size() == 1) {
>             if (operationSet.get(0) instanceof GroupEditPart) {
>                 return true;
>             }
>             else {
>                 EditPart host = (EditPart) operationSet.get(0);
>                 for (Iterator iterator = host.getChildren().iterator(); iterator
>                     .hasNext();) {
>                     Object childEP = iterator.next();
>                     if (childEP instanceof CompartmentEditPart
>                         && ((CompartmentEditPart) childEP).getContentPane()
>                             .getLayoutManager() instanceof XYLayout) {
>                         return true;
>                     }
>                 }
>             }
>         }
>         return false;
>     }
> 
