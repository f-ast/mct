21a22
> import java.util.Set;
43a45
> import org.eclipse.gmf.runtime.emf.type.core.internal.requests.RequestCacheEntries;
147a150,151
> 
> 	
148a153
>     
307c312
< 
---
> 		IEditHelperAdvice[] advices = null;
309c314,324
< 		return ElementTypeRegistry.getInstance().getEditHelperAdvice(
---
> 		Map cacheMaps = (Map) req
> 			.getParameter(RequestCacheEntries.Cache_Maps);
> 		if (cacheMaps != null) {
> 			Map contextMap = (Map) cacheMaps.get(editHelperContext);
> 			if (contextMap != null) {
> 				advices = (IEditHelperAdvice[]) contextMap.get(RequestCacheEntries.EditHelper_Advice);
> 			}			
> 		}		
> 		
> 		if (advices == null) {			
> 			advices = ElementTypeRegistry.getInstance().getEditHelperAdvice(
311a327,328
> 		return advices;
> 	}
322d338
< 		
324,325c340
< 				req.getEditingDomain(),
< 				req.getLabel()) {
---
> 			req.getEditingDomain(), req.getLabel()) {
332c347
< 				CommandResult result = super.getCommandResult();
---
> 				CommandResult _result = super.getCommandResult();
334c349
< 				IStatus status = result.getStatus();
---
> 				IStatus status = (_result == null) ? null : _result.getStatus();
336c351
< 				if (status.getSeverity() == IStatus.OK) {
---
> 				if (status != null && status.getSeverity() == IStatus.OK) {
339c354
< 					Object returnValue = result.getReturnValue();
---
> 					Object returnValue = _result.getReturnValue();
351c366
< 					result = new CommandResult(status, returnObject);
---
> 					_result = new CommandResult(status, returnObject);
354c369
< 				return result;
---
> 				return _result;
361d375
< 		
633a648,649
> 	
> 	
645c661,662
< 	protected ICommand getDestroyElementWithDependentsCommand(DestroyElementRequest req) {
---
> 	protected ICommand getDestroyElementWithDependentsCommand(
> 			DestroyElementRequest req) {
648,649c665,666
< 		EObject initial = (EObject) req.getParameter(
< 				DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER);
---
> 		EObject initial = (EObject) req
> 			.getParameter(DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER);
654,655c671,672
< 					DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER,
< 					req.getElementToDestroy());
---
> 				DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER, req
> 					.getElementToDestroy());
660,661c677,678
< 		DestroyDependentsRequest ddr = (DestroyDependentsRequest) req.getParameter(
< 				DestroyElementRequest.DESTROY_DEPENDENTS_REQUEST_PARAMETER);
---
> 		DestroyDependentsRequest ddr = (DestroyDependentsRequest) req
> 			.getParameter(DestroyElementRequest.DESTROY_DEPENDENTS_REQUEST_PARAMETER);
665,668c682,683
< 			ddr = new DestroyDependentsRequest(
< 				req.getEditingDomain(),
< 				req.getElementToDestroy(),
< 				req.isConfirmationRequired());
---
> 			ddr = new DestroyDependentsRequest(req.getEditingDomain(), req
> 				.getElementToDestroy(), req.isConfirmationRequired());
673c688,689
< 			req.setParameter(
---
> 			req
> 				.setParameter(
680c696,707
< 		IElementType typeToDestroy = ElementTypeRegistry.getInstance().getElementType(
---
> 		IElementType typeToDestroy = null;
> 		Map cacheMaps = (Map) req.getParameter(RequestCacheEntries.Cache_Maps);
> 		if (cacheMaps != null) {
> 			Map map = (Map) cacheMaps.get(req.getElementToDestroy());
> 			if (map != null) {
> 				typeToDestroy = (IElementType) map
> 					.get(RequestCacheEntries.Element_Type);
> 			}
> 		}
> 
> 		if (typeToDestroy == null) {
> 			typeToDestroy = ElementTypeRegistry.getInstance().getElementType(
681a709
> 		}
711c739,753
< 		IElementType parentType = ElementTypeRegistry.getInstance().getElementType(
---
> 		
> 		IElementType parentType = null;	
> 		
> 		Map cacheMaps = (Map) req
> 			.getParameter(RequestCacheEntries.Cache_Maps);
> 		Set checkedElement = null;
> 		if (cacheMaps != null) {
> 			checkedElement = (Set) cacheMaps
> 			.get(RequestCacheEntries.Checked_Elements);
> 			checkedElement.add(parent);
> 			Map parentMap = (Map) cacheMaps.get(parent);
> 			parentType = (IElementType) parentMap
> 				.get(RequestCacheEntries.Element_Type);			
> 		} else {
> 			parentType = ElementTypeRegistry.getInstance().getElementType(
712a755
> 		}
722,723c765,766
< 				//    is (transitively) a dependent, then don't destroy it again
< 				if ((ddr == null) || !ddr.getDependentElementsToDestroy().contains(next)) {
---
> 				// is (transitively) a dependent, then don't destroy it again .
> 				if ((ddr == null) || ((checkedElement != null) && checkedElement.add(next)) || (!ddr.getDependentElementsToDestroy().contains(next))) {
