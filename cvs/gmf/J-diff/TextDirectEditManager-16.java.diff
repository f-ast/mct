54a55
> import org.eclipse.swt.graphics.Image;
505c506,507
<     	WrapLabel fig = ((TextCompartmentEditPart)this.getEditPart()).getLabel();
---
>         IFigure fig = getEditPart().getFigure();
> 
512a515
> 
528c531,552
< 		if (!(getEditPart() instanceof TextCompartmentEditPart)) {
---
>         Rectangle iconBounds;
>         Image icon;
>         int textPlacement;
>         String subStringText;
>         String text;
> 
>         IFigure fig = getEditPart().getFigure();
>         if (fig instanceof WrapLabel) {
>             WrapLabel label = (WrapLabel) fig;
>             iconBounds = label.getIconBounds().getCopy();
>             icon = label.getIcon();
>             textPlacement = label.getTextPlacement();
>             subStringText = label.getSubStringText();
>             text = label.getText();
>         } else if (fig instanceof Label) {
>             Label label = (Label) fig;
>             iconBounds = label.getIconBounds().getCopy();
>             icon = label.getIcon();
>             textPlacement = label.getTextPlacement();
>             subStringText = label.getSubStringText();
>             text = label.getText();
>         } else {
533d556
< 		WrapLabel fig = ((TextCompartmentEditPart)this.getEditPart()).getLabel();
548d570
< 		Rectangle iconBounds = fig.getIconBounds().getCopy();
555c577
< 		if (fig.getIcon() != null && fig.getTextPlacement() == PositionConstants.EAST) 
---
>         if (icon != null && textPlacement == PositionConstants.EAST) 
566c588
< 		StringTokenizer tokenizer = new StringTokenizer(fig.getSubStringText(), "\n"); //$NON-NLS-1$
---
>         StringTokenizer tokenizer = new StringTokenizer(subStringText, "\n"); //$NON-NLS-1$
574c596
< 				String newLineCheck = fig.getText().substring(charCount,charCount+1); 
---
>                 String newLineCheck = text.substring(charCount,charCount+1); 
