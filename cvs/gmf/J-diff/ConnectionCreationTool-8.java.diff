27d26
< import org.eclipse.gef.editparts.AbstractConnectionEditPart;
32a32,33
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IPrimaryEditPart;
> import org.eclipse.gmf.runtime.diagram.ui.editparts.ShapeEditPart;
205a207
>         final EditPart[] primaryEP = new EditPart[1];
211c213,214
< 				if (editPart instanceof AbstractConnectionEditPart) {
---
> 
>                 if (editPart instanceof IPrimaryEditPart) {
214,215c217,221
< 				// if (editPart != null)
< 				// editparts.add(editPart);
---
>                 
>                 // Priority is to put a shape into direct edit mode.
>                 if (editPart instanceof ShapeEditPart) {
>                     primaryEP[0] = (ShapeEditPart) editPart;
>                 }
226c232,234
< 					EditPart editPart = (EditPart) editparts.get(0);
---
>                     if (primaryEP[0] == null) {
>                         primaryEP[0] = (EditPart) editparts.get(0);
>                     }
231,232c239,240
< 					if (editPart.isActive()) {
< 						editPart.performRequest(new Request(
---
> 					if (primaryEP[0].isActive()) {
>                         primaryEP[0].performRequest(new Request(
