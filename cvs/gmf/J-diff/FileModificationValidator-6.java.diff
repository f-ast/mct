14,15d13
< import java.text.MessageFormat;
< 
23a22
> import org.eclipse.osgi.util.NLS;
24a24
> import org.eclipse.swt.widgets.Shell;
71,73c71,75
< 		final boolean result[] = new boolean[] {false};
< 
< 		PlatformUI.getWorkbench().getDisplay().syncExec(new Runnable() {
---
> 		Shell shell = null;
> 		if (PlatformUI.getWorkbench().getActiveWorkbenchWindow() != null && Display.getCurrent() != null) {
> 			shell = PlatformUI.getWorkbench().getActiveWorkbenchWindow()
> 				.getShell();
> 		}
75,79c77,78
< 			public void run() {
< 				IStatus status = ResourcesPlugin.getWorkspace().validateEdit(
< 					files,
< 					PlatformUI.getWorkbench().getActiveWorkbenchWindow()
< 						.getShell());
---
> 		final IStatus status = ResourcesPlugin.getWorkspace().validateEdit(
> 			files, shell);
81c80
< 					result[0] = true;
---
> 			return true;
82a82
> 			PlatformUI.getWorkbench().getDisplay().asyncExec(new Runnable() {
83a84
> 				public void run() {
88,89c89,90
< 							MessageFormat
< 								.format(
---
> 							NLS
> 								.bind(
91,104c92,96
< 									new Object[] {modificationReason}),
< 							MessageFormat
< 								.format(
< 									CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part1,
< 									new Object[] {modificationReason})
< 								+ "\n\n" //$NON-NLS-1$
< 								+ CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part2
< 								+ "\n" //$NON-NLS-1$
< 								+ MessageFormat
< 									.format(
< 										CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part3,
< 										new Object[] {status.getMessage()}));
< 					result[0] = false;
< 				}
---
> 									modificationReason),
> 							NLS
> 								.bind(
> 									CommonUIMessages.FileModificationValidator_EditProblemDialogMessage,
> 									modificationReason, status.getMessage()));
107c99,100
< 		return result[0];
---
> 			return false;
> 		}
143c136,137
< 					Display.getCurrent().getActiveShell(),
---
> 					PlatformUI.getWorkbench().getActiveWorkbenchWindow()
> 						.getShell(),
145,152c139,142
< 					CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part1
< 						+ "\n\n" //$NON-NLS-1$
< 						+ CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part2
< 						+ "\n" //$NON-NLS-1$
< 						+ MessageFormat
< 							.format(
< 								CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part3,
< 								new Object[] {status.getMessage()}));
---
> 					NLS
> 						.bind(
> 							CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage,
> 							status.getMessage()));
166,167c156,157
< 			String message = MessageFormat
< 				.format(
---
> 			String message = NLS
> 				.bind(
169c159
< 					new Object[] {file.getFullPath().toString()});
---
> 					file.getFullPath().toString());
