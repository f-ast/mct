27a28
> import org.eclipse.emf.ecore.EStructuralFeature;
28a30
> import org.eclipse.emf.ecore.EStructuralFeature.Setting;
204c206
< 		if ((features != null) && (features.length != 0)) {
---
> 		Collection settings  = crossReferenceAdapter.getInverseReferences(eObject);
206,219c208,227
< 			Collection referencers = new ArrayList();
< 
< 			for (int i = 0, count = features.length; i < count; i++) {
< 
< 				EReference feature = features[i];
< 
< 				Iterator j = crossReferenceAdapter.getInverseReferencers(eObject,
< 						feature, null).iterator();
< 
< 				while (j.hasNext()) {
< 
< 					EObject referencer = (EObject) j.next();
< 
< 					referencers.add(referencer);
---
> 		if (settings.isEmpty() == false) {
> 			ArrayList referencers = new ArrayList();
> 			int count;
> 			if ((features != null) && ((count = features.length) != 0)) {				
> 				Iterator it = settings.iterator();
> 				while (it.hasNext()) {
> 					Setting setting = (Setting) it.next();
> 					EStructuralFeature feature = setting
> 					.getEStructuralFeature();
> 					for(int i = 0; i< count;++i){
> 						if (feature == features[i]) {
> 							referencers.add(setting.getEObject());
> 							break;
> 						}						
> 					}					
> 				}
> 			} else {
> 				Iterator it = settings.iterator();
> 				while (it.hasNext()) {
> 					referencers.add(((Setting) it.next()).getEObject());
222d229
< 
224,226c231,232
< 
< 		} else
< 			return crossReferenceAdapter.getInverseReferencers(eObject, null, null);
---
> 		}
> 		return Collections.EMPTY_LIST;
545c551,555
< 				return res.getID(proxy);
---
>                 String id =  res.getID(proxy);
>                 // if the object had no ID then the best we can do is to return the URI Fragment
>                 if (id ==null || id.length() ==0){
>                     return res.getURIFragment(proxy);
>                 }
