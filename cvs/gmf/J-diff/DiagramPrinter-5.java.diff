21,30d20
< import org.eclipse.jface.preference.IPreferenceStore;
< import org.eclipse.jface.resource.JFaceResources;
< import org.eclipse.jface.util.Assert;
< import org.eclipse.swt.graphics.Font;
< import org.eclipse.swt.graphics.FontData;
< import org.eclipse.swt.graphics.GC;
< import org.eclipse.swt.graphics.Point;
< import org.eclipse.swt.printing.Printer;
< import org.eclipse.swt.widgets.Display;
< 
39c29,30
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
---
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapModeUtil;
40a32,40
> import org.eclipse.jface.preference.IPreferenceStore;
> import org.eclipse.jface.resource.JFaceResources;
> import org.eclipse.jface.util.Assert;
> import org.eclipse.swt.graphics.Font;
> import org.eclipse.swt.graphics.FontData;
> import org.eclipse.swt.graphics.GC;
> import org.eclipse.swt.graphics.Point;
> import org.eclipse.swt.printing.Printer;
> import org.eclipse.swt.widgets.Display;
86a87
> 	private IMapMode mm;
93a95
> 	 * @param mm <code>IMapMode</code> to do the coordinate mapping
95c97
< 	public DiagramPrinter(PreferencesHint preferencesHint) {
---
> 	public DiagramPrinter(PreferencesHint preferencesHint, IMapMode mm) {
97a100,119
> 		this.mm = mm;
> 	}
> 	
> 	/**
> 	 * Creates a new instance. The following variables must be initialized
> 	 * before calling <code>run()</code>:
> 	 * <li><code>printer</code></li>
> 	 * <li><code>display_dpi</code></li>
> 	 * <li><code>diagrams</code></li>
> 	 * @param mm <code>IMapMode</code> to do the coordinate mapping
> 	 */
> 	public DiagramPrinter(PreferencesHint preferencesHint) {
> 		this(preferencesHint, MapModeUtil.getMapMode());
> 	}
> 	
> 	/**
> 	 * @return <code>IMapMode</code> to do the coordinate mapping
> 	 */
> 	protected IMapMode getMapMode() {
> 		return mm;
238c260
< 			offsetX = (int) (MapMode
---
> 			offsetX = (int) (getMapMode()
240c262
< 			offsetY = (int) (MapMode
---
> 			offsetY = (int) (getMapMode()
337c359
< 				+ (width - MapMode.DPtoLP(gc_.textExtent(headerOrFooter).x))
---
> 				+ (width - getMapMode().DPtoLP(gc_.textExtent(headerOrFooter).x))
346c368
< 				+ (width - MapMode.DPtoLP(gc_.textExtent(headerOrFooter).x))
---
> 				+ (width - getMapMode().DPtoLP(gc_.textExtent(headerOrFooter).x))
516c538
< 			true));
---
> 			true), getMapMode());
