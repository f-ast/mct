23a24
> import org.eclipse.emf.ecore.resource.Resource;
295,297c296,298
< 	protected EObject getSuitableParentUsingAncestry(String preferredTypeName) {
< 		EObject suitableParent = getSuitableParentUsingAncestry(
< 			getParentEObject(), preferredTypeName, true);
---
> 	protected PasteTarget getSuitableParentUsingAncestry(String preferredTypeName) {
> 		PasteTarget suitableParent = getSuitableParentUsingAncestry(
> 			getParentTarget(), preferredTypeName, true);
299c300
< 			suitableParent = getSuitableParentUsingAncestry(getParentEObject(),
---
> 			suitableParent = getSuitableParentUsingAncestry(getParentTarget(),
305,306c306,307
< 	private EObject getSuitableParentUsingAncestry(
< 		EObject potentialParentObject, String preferredTypeName,
---
> 	private PasteTarget getSuitableParentUsingAncestry(
> 			PasteTarget potentialParent, String preferredTypeName,
308c309
< 		EObject suitableParent = checkPotentialParent(potentialParentObject,
---
> 		PasteTarget suitableParent = checkPotentialParent(potentialParent,
309a311,312
> 		if (suitableParent == null && !potentialParent.isResource()) {
> 			EObject potentialParentObject = (EObject)potentialParent.getObject();
313c316
< 			suitableParent = checkPotentialParent(potentialParentObject,
---
> 				suitableParent = checkPotentialParent(new PasteTarget(potentialParentObject),
315a319
> 		}
344,345c348,350
< 						if (ClipboardSupportUtil.isChild(getParentEObject(),
< 							mergeTarget)) {
---
> 						if ((getParentTarget().isResource() &&
> 								getParentTarget().getObject() == mergeTarget.eResource()) ||
> 								ClipboardSupportUtil.isChild(getParentEObject(), mergeTarget)) {
464c469
< 			EObject possibleParent = getSuitableParentUsingAncestry(getLoadedDirectContainerEObject()
---
> 			PasteTarget possibleParent = getSuitableParentUsingAncestry(getLoadedDirectContainerEObject()
491a497,505
> 	 * Gets the target object into which we are pasting a child.
> 	 * 
> 	 * @return the parent (target) object of the paste operation
> 	 */
> 	public PasteTarget getParentTarget() {
> 		return getParentPasteProcess().getPasteTarget();
> 	}
> 
> 	/**
562c576
< 			element = doPasteInto(getParentEObject());
---
> 			element = doPasteInto(getParentTarget());
581c595
< 					EObject possibleParent = getSuitableParentUsingAncestry(getChildObjectInfo().containerClass);
---
> 					PasteTarget possibleParent = getSuitableParentUsingAncestry(getChildObjectInfo().containerClass);
615a630,647
> 	 * Pastes my child object into the specified object.
> 	 * 
> 	 * @param pasteTarget the object to paste into
> 	 * @return the newly pasted object, or <code>null</code> if the paste did
> 	 *     not succeed
> 	 */
> 	protected EObject doPasteInto(PasteTarget pasteTarget) {
> 		if (pasteTarget != null) {
> 			if (pasteTarget.isResource()) {
> 				return doPasteInto((Resource)pasteTarget.getObject());
> 			} else {
> 				return doPasteInto((EObject)pasteTarget.getObject());
> 			}
> 		}
> 		return null;
> 	}
> 
> 	/**
649a682,702
> 	 * Pastes my child object into the specified resource
> 	 * 
> 	 * @param pasteIntoResource the resource to paste into
> 	 * @return the newly pasted object, or <code>null</code> if the paste did
> 	 *     not succeed
> 	 */
> 	protected EObject doPasteInto(Resource pasteIntoResource) {
> 		EObject childElement = null;
> 		if (handleCollision(null, pasteIntoResource.getContents(),
> 				getEObject(), getChildObjectInfo())) {
> 			childElement = ClipboardSupportUtil.appendEObject(
> 				pasteIntoResource, getEObject());
> 		} else if (getPastedElement() != null) {
> 			// our pasted element was already assigned by a merge action
> 			childElement = getPastedElement();
> 		}
> 
> 		return childElement;
> 	}
> 
> 	/**
707c760
< 	private EObject checkPotentialParent(EObject potentialParentObject,
---
> 	private PasteTarget checkPotentialParent(PasteTarget potentialParent,
710c763,769
< 		if ((potentialParentObject instanceof EAnnotation) == false) {
---
> 		if ((potentialParent.getObject() instanceof EAnnotation) == false) {
> 			if (potentialParent.isResource()) {
> 				if (preferredTypeName == null || strictMatch == false) {
> 					return potentialParent;
> 				}
> 			} else {
> 				EObject potentialParentObject = (EObject)potentialParent.getObject();
713c772
< 				return potentialParentObject;
---
> 					return potentialParent;
716c775,776
< 				return potentialParentObject;
---
> 					return potentialParent;
> 				}
784a845,848
> 						if (reference == null) {
> 							// paste target is the resouce
> 							ClipboardSupportUtil.destroyEObjectInResource(object);
> 						} else {
786a851
> 						}
1099a1165,1166
> 		if (!getParentTarget().isResource()) {
> 			// we now know that the target is an EObject
1105a1173
> 		}
