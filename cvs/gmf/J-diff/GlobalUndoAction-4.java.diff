101d100
<         if (context != null) {
104a104
> 			delegate = null;
107,108c107,111
<             delegate = new UndoActionHandler(getWorkbenchPart().getSite(),
<                 context);
---
> 		if (context != null) {
> 			IWorkbenchPart part = getWorkbenchPart();
> 
> 			if (part != null) {
> 				delegate = new UndoActionHandler(part.getSite(), context);
110a114,115
> 			}
> 		}
114,116c119,120
<             firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled),
<                 Boolean.valueOf(enabled));
<         }
---
> 		firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled), Boolean
> 				.valueOf(enabled));
258,260c262,264
<     public final void setUndoContext(IUndoContext undoContext) {
<         this.undoContext = undoContext;
<         initializeWithContext(undoContext);
---
> 	public final void setUndoContext(IUndoContext context) {
> 		this.undoContext = context;
> 		initializeWithContext(context);
288a293,306
> 
> 	/**
> 	 * Disposes my delegate.
> 	 */
> 	public void dispose() {
> 
> 		if (delegate != null) {
> 			delegate.removePropertyChangeListener(getDelegateListener());
> 			delegate.dispose();
> 			delegate = null;
> 		}
> 
> 		super.dispose();
> 	}
