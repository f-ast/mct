15d14
< import java.util.Iterator;
19,22d17
< import org.eclipse.core.resources.IWorkspace;
< import org.eclipse.core.runtime.IPath;
< import org.eclipse.core.runtime.IStatus;
< import org.eclipse.core.runtime.Status;
26d20
< import org.eclipse.emf.common.util.UniqueEList;
28d21
< import org.eclipse.emf.ecore.EObject;
38d30
< import org.eclipse.gmf.internal.bridge.ui.Plugin;
45d36
< import org.eclipse.gmf.tooldef.GMFToolFactory;
48d38
< import org.eclipse.jface.dialogs.IMessageProvider;
53c43,44
< public class WizardInput {
---
> public abstract class WizardInput {
> 
58,60d48
< 	private EPackage myDomainModel;
< 	private Canvas myCanvas;
< 	private ToolRegistry myRegistry;
64c52
< 	private IFile myResultFile = null;
---
> 	private IFile myResultFile;
66,72d53
< 	private String initialECoreFile = null;
< 	private String initialGraphFile = null;
< 	private String initialToolFile = null;
< 	private boolean myIsBlankToolDef = false;
< 
< 	public WizardInput() {
< 	}
82d62
< 
99,102c79
< 	public void setDomainModel(EPackage aPackage) {
< 		checkUnload(myDomainModel);
< 		myDomainModel = aPackage;
< 	}
---
> 	public abstract EPackage getDomainModel();
104,107c81
< 	public void setGraphDef(Canvas canvas) {
< 		checkUnload(myCanvas);
< 		myCanvas = canvas;
< 	}
---
> 	public abstract Canvas getCanvasDef();
109,141c83
< 	public Canvas getCanvasDef() {
< 		return myCanvas;
< 	}
< 
< 	public boolean isNewBlankToolDef() {
< 		return myIsBlankToolDef;
< 	}
< 
< 	@SuppressWarnings("unchecked")
< 	public URI createBlankToolDef() {
< 		checkUnload(myRegistry);
< 		myRegistry = null;
< 		IPath toolDefFile = getMappingFile().getFullPath().removeFileExtension().addFileExtension(TOOLDEF_FILE_EXT);
< 		String baseName = getMappingFile().getFullPath().removeFileExtension().lastSegment();
< 		int i = 1;
< 		final IWorkspace wr = getMappingFile().getProject().getWorkspace(); 
< 		while (wr.getRoot().findMember(toolDefFile) != null) {
< 			toolDefFile = toolDefFile.removeLastSegments(1).append(baseName + i).addFileExtension(TOOLDEF_FILE_EXT);
< 			i++;
< 		}
< 		URI toolDefURI = URI.createPlatformResourceURI(toolDefFile.toString());
< 		myRegistry = GMFToolFactory.eINSTANCE.createToolRegistry();
< 		myRegistry.setPalette(GMFToolFactory.eINSTANCE.createPalette());
< 		getResourceSet().createResource(toolDefURI).getContents().add(myRegistry);
< 		myIsBlankToolDef  = true;
< 		return toolDefURI;
< 	}
< 
< 	public void setToolDef(ToolRegistry registry) {
< 		checkUnload(myRegistry);
< 		myRegistry = registry;
< 		myIsBlankToolDef = false;
< 	}
---
> 	public abstract ToolRegistry getToolDef();
143,145c85
< 	public ToolRegistry getToolDef() {
< 		return myRegistry;
< 	}
---
> 	public abstract boolean isNewBlankToolDef();
164a105,106
> 			CanvasMapping cm = GMFMapFactory.eINSTANCE.createCanvasMapping();
> 			mapInstance.setDiagram(cm);
169,207d110
< 	/**
< 	 * @return status with code field set to constant from IMessageProvider
< 	 */
< 	public IStatus isReady2Go() {
< 		if (myDomainModel != null && myCanvas != null && myRegistry != null) {
< 			return Status.OK_STATUS;
< 		}
< 		if (myDomainModel == null) {
< 			return new Status(Status.WARNING, Plugin.getPluginID(), IMessageProvider.WARNING, Messages.inputNeedDomain, null);
< 		}
< 		if (myCanvas == null) {
< 			return new Status(Status.WARNING, Plugin.getPluginID(), IMessageProvider.WARNING, Messages.inputNeedCanvas, null);
< 		} else {
< 			return new Status(Status.WARNING, Plugin.getPluginID(), IMessageProvider.WARNING, Messages.inputNeedToolDef, null);
< 		}
< 	}
< 
< 	private void checkUnload(EObject eobj) {
< 		if (eobj == null) {
< 			return;
< 		}
< 		if (eobj.eResource().getResourceSet() == getResourceSet() && eobj.eResource().isLoaded()) {
< 			eobj.eResource().unload();
< 		}
< 	}
< 	public List/*<EClass>*/ getCanvasElementCandidates() {
< 		UniqueEList rv = new UniqueEList();
< 		for (Iterator it = myDomainModel.getEClassifiers().iterator(); it.hasNext();) {
< 			Object next = it.next();
< 			if (next instanceof EClass) {
< 				EClass eClass = (EClass) next;
< 				if (!eClass.isAbstract() && !eClass.isInterface() && !eClass.getEAllContainments().isEmpty()) {
< 					rv.add(eClass);
< 				}
< 			}
< 		}
< 		return rv;
< 	}
< 
209,217c112,114
< 		assert eClass.getEPackage() == myDomainModel;
< 		CanvasMapping cm;
< 		if (getMapping().getDiagram() == null) {
< 			cm =  GMFMapFactory.eINSTANCE.createCanvasMapping();
< 			cm.setDiagramCanvas(myCanvas);
< 			// +palette/gmfgraph.canvas
< 		} else {
< 			cm = getMapping().getDiagram();
< 		}
---
> 		assert eClass.getEPackage() == getDomainModel();
> 		CanvasMapping cm = getMapping().getDiagram();
> 		cm.setDiagramCanvas(getCanvasDef());
220d116
< 		getMapping().setDiagram(cm);
243,266d138
< 	
< 	public String getInitialECoreFile() {
< 		return initialECoreFile;
< 	}
< 
< 	public void setInitialECoreFile(String initialECoreFile) {
< 		this.initialECoreFile = initialECoreFile;
< 	}
< 
< 	public String getInitialGraphFile() {
< 		return initialGraphFile;
< 	}
< 
< 	public void setInitialGraphFile(String initialGraphFile) {
< 		this.initialGraphFile = initialGraphFile;
< 	}
< 
< 	public String getInitialToolFile() {
< 		return initialToolFile;
< 	}
< 
< 	public void setInitialToolFile(String initialToolFile) {
< 		this.initialToolFile = initialToolFile;
< 	}
