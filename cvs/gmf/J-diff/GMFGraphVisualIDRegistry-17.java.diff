130c130,143
< 		if (domainElement == null || !CanvasEditPart.MODEL_ID.equals(org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry.getModelID(containerView))) {
---
> 		if (domainElement == null) {
> 			return -1;
> 		}
> 		String containerModelID = org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry.getModelID(containerView);
> 		if (!CanvasEditPart.MODEL_ID.equals(containerModelID) && !"GMFGraph".equals(containerModelID)) { //$NON-NLS-1$
> 			return -1;
> 		}
> 		int containerVisualID;
> 		if (CanvasEditPart.MODEL_ID.equals(containerModelID)) {
> 			containerVisualID = org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry.getVisualID(containerView);
> 		} else {
> 			if (containerView instanceof Diagram) {
> 				containerVisualID = CanvasEditPart.VISUAL_ID;
> 			} else {
133c146,147
< 		switch (org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry.getVisualID(containerView)) {
---
> 		}
> 		switch (containerVisualID) {
