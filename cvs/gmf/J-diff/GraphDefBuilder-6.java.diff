2c2
<  * Copyright (c) 2006 Eclipse.org
---
>  * Copyright (c) 2006, 2007 Borland Software Corporation
21a22
> import org.eclipse.gmf.gmfgraph.ChildAccess;
26c27
< import org.eclipse.gmf.gmfgraph.Figure;
---
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
33a35
> import org.eclipse.gmf.gmfgraph.RealFigure;
47c49
< 	protected GMFGraphFactory gmfGraphFactory = GMFGraphPackage.eINSTANCE.getGMFGraphFactory();
---
> 	protected final GMFGraphFactory gmfGraphFactory = GMFGraphPackage.eINSTANCE.getGMFGraphFactory();
49c51
< 	protected NamesDispenser namesDispenser = new IncrementalNamesDispenser();
---
> 	protected final NamesDispenser namesDispenser = new IncrementalNamesDispenser();
163d164
< 	@SuppressWarnings("unchecked")
168d168
< 		fGallery.getFigures().add(figure);
170c170,171
< 		node.setFigure(figure);
---
> 		node.setFigure(newDescriptor(figure.getName(), figure));
> 		fGallery.getDescriptors().add(node.getFigure());
176d176
< 	@SuppressWarnings("unchecked")
181d180
< 		fGallery.getFigures().add(figure);
183c182,183
< 		link.setFigure(figure);
---
> 		link.setFigure(newDescriptor(figure.getName(), figure));
> 		fGallery.getDescriptors().add(link.getFigure());
189d188
< 	@SuppressWarnings("unchecked")
197d195
< 		fGallery.getFigures().add(figure);
200c198,199
< 		link.setFigure(figure);
---
> 		link.setFigure(newDescriptor(figure.getName(), figure));
> 		fGallery.getDescriptors().add(link.getFigure());
206d204
< 	@SuppressWarnings("unchecked")
215,216c213,214
< 		assert parent.getFigure() instanceof Figure : "We are creators of this gmfgraph; there should be no figure accessors"; //$NON-NLS-1$
< 		((Figure) parent.getFigure()).getChildren().add(figure);
---
> 		assert parent.getFigure().getActualFigure() instanceof RealFigure : "We are creators of this gmfgraph; there should be nothing but figure"; //$NON-NLS-1$
> 		((RealFigure) parent.getFigure().getActualFigure()).getChildren().add(figure);
218c216,217
< 		label.setFigure(figure);
---
> 		label.setFigure(parent.getFigure());
> 		label.setAccessor(newAccess(parent.getFigure(), figure));
222a222,234
> 
> 	private static FigureDescriptor newDescriptor(String name, RealFigure fig) {
> 		FigureDescriptor fd = GMFGraphFactory.eINSTANCE.createFigureDescriptor();
> 		fd.setActualFigure(fig);
> 		fd.setName(name);
> 		return fd;
> 	}
> 	private static ChildAccess newAccess(FigureDescriptor fd, RealFigure child) {
> 		ChildAccess ca = GMFGraphFactory.eINSTANCE.createChildAccess();
> 		ca.setFigure(child);
> 		fd.getAccessors().add(ca);
> 		return ca;
> 	}
