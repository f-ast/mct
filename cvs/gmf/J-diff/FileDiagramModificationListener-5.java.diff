2c2
<  * Copyright (c) 2005 IBM Corporation and others.
---
>  * Copyright (c) 2005, 2006 IBM Corporation and others.
17d16
< import org.eclipse.emf.transaction.DemultiplexingListener;
19,20d17
< import org.eclipse.emf.transaction.ResourceSetListener;
< import org.eclipse.emf.transaction.TransactionalEditingDomain;
36c33,37
< 	private ResourceSetListener diagramSavedListener = null;
---
> 	private NotificationFilter diagramResourceModifiedFilter;
> 	
> 	private FileDocumentProvider documentProvider;
> 	
> 	private IFileEditorInput input;
53a55,56
> 		this.documentProvider = documentProvider;
> 		this.input = input;
55c58
< 		final Diagram diagram = document.getDiagram();
---
> 		Diagram diagram = document.getDiagram();
57c60
< 		NotificationFilter diagramResourceModifiedFilter = NotificationFilter
---
> 		diagramResourceModifiedFilter = NotificationFilter
63a67
> 	}
65,67c69,72
< 		if (diagramSavedListener == null) {
< 			diagramSavedListener = new DemultiplexingListener(
< 				diagramResourceModifiedFilter) {
---
> 	public boolean isAdapterForType(Object type) {
> 		return type == FileDiagramModificationListener.class
> 			|| super.isAdapterForType(type);
> 	}
69,70c74,76
< 				protected void handleNotification(TransactionalEditingDomain domain,
< 						Notification notification) {
---
> 	public void notifyChanged(Notification notification) {
> 		super.notifyChanged(notification);
> 		if (diagramResourceModifiedFilter.matches(notification)) {
73c79
< 					if (diagram != null
---
> 			if (getDiagramDocument().getDiagram() != null
89c95
< 									document.setContent(document.getContent(),
---
> 							getDiagramDocument().setContent(getDiagramDocument().getContent(),
102d107
< 			};
105,124d109
< 
< 	/*
< 	 * (non-Javadoc)
< 	 * 
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.DiagramModificationListener#startListening()
< 	 */
< 	public void startListening() {
< 		super.startListening();
< 		getEditingDomain().addResourceSetListener(diagramSavedListener);
< 	}
< 
< 	/* (non-Javadoc)
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.DiagramModificationListener#stopListening()
< 	 */
< 	public void stopListening() {
< 		getEditingDomain().removeResourceSetListener(diagramSavedListener);
< 		super.stopListening();
< 	}
< 
< }
