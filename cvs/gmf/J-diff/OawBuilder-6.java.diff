30a31
> import org.eclipse.core.runtime.SubProgressMonitor;
44c45
< 	private static boolean firstBuild = true; // XXX odd
---
> 	private boolean firstBuild = true; // XXX odd
45a47
> 	private WorkspaceModelRegistry modelRegistry;
55,58d56
< 	private static boolean isFileOfInterest(IFile file) {
< 		return XpandResource.TEMPLATE_EXTENSION.equals(file.getFileExtension()) || XtendResource.FILE_EXTENSION.equals(file.getFileExtension());
< 	}
< 
61d58
< 		// TODO Auto-generated method stub
63a61,64
> 		Activator.registerResourceManager(getProject(), resourceManager);
> 		firstBuild = true;
> 		modelRegistry = new WorkspaceModelRegistry();
> 		Activator.registerModelSource(modelRegistry);
70d70
< 				System.err.println("First build, kind:" + kind + " and is FULLBUILD:" + (kind == FULL_BUILD));
110c110
< 			if (XpandResource.TEMPLATE_EXTENSION.equals(resource.getFileExtension())) {
---
> 			if (isXpand(resource)) {
115c115
< 			} else if (XtendResource.FILE_EXTENSION.equals(resource.getFileExtension())) {
---
> 			} else if (isXtend(resource)) {
131d130
< 
138c137,140
< 		getProject().accept(new XpandResourceVisitor(monitor));
---
> 		monitor.beginTask(null, 2);
> 		getProject().accept(new XpandResourceVisitor(new SubProgressMonitor(monitor, 1)));
> 		modelRegistry.build(getProject(), new SubProgressMonitor(monitor, 1));
> 		monitor.done();
142c144,147
< 		delta.accept(new XpandResourceVisitor(monitor));
---
> 		monitor.beginTask(null, 2);
> 		delta.accept(new XpandResourceVisitor(new SubProgressMonitor(monitor, 1)));
> 		modelRegistry.build(getProject(), delta, new SubProgressMonitor(monitor, 1));
> 		monitor.done();
158a164,175
> 	private static boolean isXtend(final IFile resource) {
> 		return XtendResource.FILE_EXTENSION.equals(resource.getFileExtension());
> 	}
> 
> 	private static boolean isXpand(final IFile resource) {
> 		return XpandResource.TEMPLATE_EXTENSION.equals(resource.getFileExtension());
> 	}
> 
> 	private static boolean isFileOfInterest(IFile file) {
> 		return isXpand(file) || isXtend(file);
> 	}
> 
160c177
< 		private IProgressMonitor monitor;
---
> 		private final IProgressMonitor monitor;
