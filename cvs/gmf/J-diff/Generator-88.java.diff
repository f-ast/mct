15a16
> import java.lang.reflect.InvocationTargetException;
32d32
< import org.eclipse.emf.codegen.jet.JETException;
59c59,61
< import org.eclipse.gmf.common.codegen.GeneratorBase;
---
> import org.eclipse.gmf.internal.common.codegen.GeneratorBase;
> import org.eclipse.gmf.internal.common.codegen.ImportUtil;
> import org.eclipse.gmf.internal.common.codegen.JETEmitterAdapter;
239c241
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
250c252
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
268c270
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
277c279
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
288c290
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
297c299
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
306c308
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
315c317
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
324c326
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
333c335
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
342c344
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
351c353
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
360c362
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
369c371
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
380c382
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
389c391
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
398c400
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
407c409
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
416c418
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
425c427
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
434c436
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
443c445
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
452c454
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
461c463
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
470c472
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
481c483
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
490c492
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
499c501
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
508c510
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
517c519
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
526c528
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
535c537
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
544c546
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
552c554
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
560c562
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
568c570
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
576c578
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
584c586
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
592c594
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
600c602
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
608c610
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
618c620
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
627c629
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
636c638
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
645c647
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
656c658
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
664c666
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
675c677
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
684c686
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
693c695
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
702c704
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
711c713
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
720c722
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
730c732
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
742c744
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
751c753
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
763c765
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
772c774
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
782c784
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
791c793
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
800c802
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
809c811
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
821c823
< 		doGenerateJavaClass(
---
> 		internalGenerateJavaClass(
839c841
< 					doGenerateJavaClass(
---
> 					internalGenerateJavaClass(
851c853
< 		doGenerateFile(myEmitters.getPluginXmlEmitter(), new Path("plugin.xml"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getPluginXmlEmitter(), new Path("plugin.xml"), new Object[] { myDiagram.getEditorGen().getPlugin() });
855c857
< 		doGenerateFile(myEmitters.getPluginPropertiesEmitter(), new Path("plugin.properties"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getPluginPropertiesEmitter(), new Path("plugin.properties"), new Object[] { myDiagram.getEditorGen().getPlugin() });
859c861
< 		doGenerateFile(myEmitters.getOptionsFileEmitter(), new Path(".options"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getOptionsFileEmitter(), new Path(".options"), new Object[] { myDiagram.getEditorGen().getPlugin()  });
863c865
< 		doGenerateFile(myEmitters.getBundleManifestEmitter(), new Path("META-INF/MANIFEST.MF"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getBundleManifestEmitter(), new Path("META-INF/MANIFEST.MF"), new Object[] { myDiagram.getEditorGen().getPlugin() });
867c869
< 		doGenerateFile(myEmitters.getBuildPropertiesEmitter(), new Path("build.properties"), myDiagram);
---
> 		doGenerateFile(myEmitters.getBuildPropertiesEmitter(), new Path("build.properties"), new Object[] { myDiagram });
874c876
< 			pm.beginTask(iconPath.lastSegment(), 3);
---
> 			pm.beginTask(iconPath.lastSegment(), 4);
878c880
< 			byte[] contents = myEmitters.getShortcutImageEmitter().generateGif();
---
> 			byte[] contents = myEmitters.getShortcutImageEmitter().generate(new SubProgressMonitor(pm, 1), null);
889,890c891,892
< 		} catch (JETException ex) {
< 			handleException(ex.getStatus());
---
> 		} catch (InvocationTargetException ex) {
> 			handleException(ex.getCause());
897a900,907
> 	/**
> 	 * Passes initialized ImportManager as second template argument
> 	 */
> 	private void internalGenerateJavaClass(JETEmitter emitter, String packageName, String className, Object argument) throws InterruptedException {
> 		ImportUtil importUtil = new ImportUtil(packageName, className);
> 		doGenerateJavaClass(new JETEmitterAdapter(emitter), packageName, className, new Object[] {new Object[] {argument, importUtil}});
> 	}
> 
