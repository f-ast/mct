318,319c318,319
< 			pm.beginTask(null, 5);
< 			String genText = emitter.generate(new SubProgressMonitor(pm, 1), input);
---
> 			pm.beginTask(null, 6);
> 			String genText = emitter.generate(new SubProgressMonitor(pm, 2), input);
324,326d323
< 				genText = mergeJavaCode(oldContents, genText, new SubProgressMonitor(pm, 1));
< 				genText = formatCode(genText);
< 				if (!genText.equals(oldContents)) { // compare text with fqns; works for jet templates
334,336c331,334
< 					String newContents = formatCode(cu.getSource());
< 					if (!newContents.equals(oldContents)) { // compare text with organized imports; works for xpand templates
< 						cu.getBuffer().setContents(newContents);
---
> 				genText = mergeJavaCode(oldContents, cu.getSource(), new SubProgressMonitor(pm, 1));
> 				genText = formatCode(genText);
> 				if (!genText.equals(oldContents)) {
> 					cu.getBuffer().setContents(genText);
338a337
> 					cu.getBuffer().close(); // discard changes
342,344d340
< 					pm.worked(2);
< 				}
< 			} else {
