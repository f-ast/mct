5a6,7
> import java.io.InputStreamReader;
> import java.io.Reader;
183c185
< 	 * Generate ordinary file. No merge is performed at the moment.
---
> 	 * Generate ordinary file.
204c206
< 			// FIXME merge!
---
> 			String oldText = null;
206c208,215
< 				if (!contains(f, new ByteArrayInputStream(genText.getBytes(charset)))) {
---
> 				oldText = getFileContents(f);
> 			}
> 			if (oldText != null) {
> 				TextMerger merger = TextMerger.getForFile(f.getName());
> 				if (merger != null) {
> 					genText = merger.process(oldText, genText);
> 				}
> 				if (!oldText.equals(genText)) {
227a237,259
> 	private static String getFileContents(IFile file) {
> 		StringBuffer contents = new StringBuffer();
> 		char[] buffer = new char[1024];
> 		int count;
> 		try {
> 			Reader in = new InputStreamReader(file.getContents(true), file.getCharset());
> 			try {
> 				while ((count = in.read(buffer)) > 0) {
> 					contents.append(buffer, 0, count);
> 				}
> 			} finally {
> 				in.close();
> 			}
> 		} catch (CoreException ce) {
> 			ce.printStackTrace();
> 			return null;
> 		} catch (IOException ioe) {
> 			ioe.printStackTrace();
> 			return null;
> 		}
> 		return contents.toString();
> 	}
> 
