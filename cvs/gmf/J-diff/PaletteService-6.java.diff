14d13
< import java.util.ArrayList;
25,27d23
< import org.eclipse.jface.util.Assert;
< import org.eclipse.ui.IEditorPart;
< 
43a40,41
> import org.eclipse.jface.util.Assert;
> import org.eclipse.ui.IEditorPart;
268c266
< 		HashMap existingEntries = new HashMap();
---
> 		HashMap existingEntryIds = new HashMap();
272c270
< 			existingEntries.put(entry.getId(), entry);
---
> 			existingEntryIds.put(entry.getId(), entry);
275,276c273,274
< 		List updatedChildren = new ArrayList(newContainer.getChildren().size());
< 
---
> 		int lastExistingEntryIndex = 0;
> 		// cycle through the new entries
281,284c279,288
< 			Object existingEntry = existingEntries.get(newEntry.getId());
< 			if (existingEntry != null) {
< 				// keep the existing entry
< 				updatedChildren.add(existingEntry);
---
> 			PaletteEntry existingEntry = (PaletteEntry) existingEntryIds
> 				.get(newEntry.getId());
> 			if (existingEntry != null) { // is already in existing container
> 				// update the index
> 				lastExistingEntryIndex = existingContainer.getChildren()
> 					.indexOf(existingEntry);
> 
> 				// remove the entry that was just updated from the map
> 				existingEntryIds.remove(existingEntry.getId());
> 
293,296c297,299
< 			} else {
< 				// add new entries that did not
< 				// previously exist
< 				updatedChildren.add(newEntry);
---
> 			} else { // this is a new entry that did not previously exist
> 				existingContainer.add(++lastExistingEntryIndex, newEntry);
> 			}
298a302,306
> 		// remove existing entries that were not found in the new container
> 		for (Iterator iter = existingEntryIds.values().iterator(); iter
> 			.hasNext();) {
> 			PaletteEntry entry = (PaletteEntry) iter.next();
> 			existingContainer.remove(entry);
300c308
< 		existingContainer.setChildren(updatedChildren);
---
> 
