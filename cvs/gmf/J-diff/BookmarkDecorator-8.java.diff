50a51
> import org.eclipse.ui.PlatformUI;
204,209d204
< 			try {
< 				TransactionUtil.getEditingDomain(
< 					getDecoratorTarget().getAdapter(View.class)).runExclusive(
< 					new Runnable() {
< 
< 					public void run() {
214,228c209
< 							Iterator iter = list.iterator();
< 							while (iter.hasNext()) {
< 								IDecorator decorator = (IDecorator)iter.next();
< 								if ( decorator != null ) {
< 									decorator.refresh();
< 								}
< 							}
< 						}
< 					}
< 				});
< 			} catch (Exception e) {
< 				Trace.catching(DiagramProvidersPlugin.getInstance(),
< 					DiagramActionsDebugOptions.EXCEPTIONS_CATCHING, getClass(),
< 					"handleMarkerDeleted()", //$NON-NLS-1$
< 					e);
---
>                 refreshDecorators(list);
243d223
< 			try {
244a225,246
>             String elementId = marker.getAttribute(
>                 IBookmark.ELEMENT_ID, StringStatics.BLANK);
>             List list = elementId != null ? (List)mapOfIdsToDecorators.get(elementId) : null;
>             
>             if ( list != null && !list.isEmpty() ) {
>                 refreshDecorators(list);
>             }
> 		}
>         
>         /**
>          * Refreshes decorators asynchronously on the UI thread (required
>          * because GEF can only be used on the UI thread) so that getting a read
>          * transaction won't contribute to deadlock while the workspace is
>          * locked.
>          * 
>          * @param decorators
>          *            the decorators to be refreshed
>          */
>         private void refreshDecorators(final List decorators) {
>             PlatformUI.getWorkbench().getDisplay().asyncExec(new Runnable() {
>                 public void run() {
>                     try {
250,254c252
< 						String elementId = marker.getAttribute(
< 							IBookmark.ELEMENT_ID, StringStatics.BLANK);
< 						List list = elementId != null ? (List)mapOfIdsToDecorators.get(elementId) : null;
< 						if ( list != null && !list.isEmpty() ) {
< 							Iterator iter = list.iterator();
---
>                                 Iterator iter = decorators.iterator();
262d259
< 					}
267c264
< 					"handleMarkerChanged()", //$NON-NLS-1$
---
>                             "refreshDecorators()", //$NON-NLS-1$
270a268,269
>             });
>         }
