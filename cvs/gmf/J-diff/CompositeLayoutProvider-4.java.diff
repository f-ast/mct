33a34
> import org.eclipse.gmf.runtime.diagram.ui.editparts.CompartmentEditPart;
38a40
> import org.eclipse.gmf.runtime.draw2d.ui.internal.graph.AdvancedSubGraph;
40a43,45
> import org.eclipse.gmf.runtime.notation.LayoutConstraint;
> import org.eclipse.gmf.runtime.notation.Size;
> import org.eclipse.gmf.runtime.notation.View;
75a81
>                     AdvancedSubGraph subGraph = null;
77c83
<                         n = new Subgraph(ep, rootGraph);
---
>                         subGraph = new AdvancedSubGraph(ep, rootGraph);
79c85,90
<                         n = new Subgraph(ep);
---
>                         subGraph = new AdvancedSubGraph(ep);
>                     subGraph.setAutoSize(isAutoSizeOn(subGraph,ep));
>                     if (gep instanceof CompartmentEditPart){
>                         subGraph.setHasBufferedZone(true);
>                     }
>                     n = subGraph;
100a112,132
>     private boolean isAutoSizeOn(AdvancedSubGraph subGraph, IGraphicalEditPart gEP) {
>         if (gEP instanceof CompartmentEditPart && subGraph.getParent() instanceof AdvancedSubGraph){
>             if (((AdvancedSubGraph)subGraph.getParent()).isAutoSize())
>                 return true;
>         }else {
>             View notationView = gEP.getNotationView();
>             if (notationView !=null && notationView instanceof org.eclipse.gmf.runtime.notation.Node){
>                 org.eclipse.gmf.runtime.notation.Node node = (org.eclipse.gmf.runtime.notation.Node)notationView;
>                 LayoutConstraint contraint = node.getLayoutConstraint();
>                 if (contraint instanceof Size){
>                     Size size = (Size)contraint;
>                     if (size.getHeight() != -1 || size.getWidth()!=-1){
>                         return false;
>                     }
>                     return true;
>                 }
>             }
>         }
>         return false;
>     }
> 
