24d23
< import org.eclipse.core.resources.ResourcesPlugin;
27d25
< import org.eclipse.core.runtime.Path;
28a27,29
> import org.eclipse.emf.ecore.xmi.XMLResource;
> import org.eclipse.emf.transaction.util.TransactionUtil;
> import org.eclipse.emf.workspace.util.WorkspaceSynchronizer;
36d36
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
47,49d46
< import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
< import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
208c205,207
< 				MEditingDomainGetter.getMEditingDomain(getDecoratorTarget()).runAsRead(new MRunnable() {
---
> 				TransactionUtil.getEditingDomain(
> 					getDecoratorTarget().getAdapter(View.class)).runExclusive(
> 					new Runnable() {
210c209
< 					public Object run() {
---
> 					public void run() {
223d221
< 						return null;
247c245,247
< 				MEditingDomainGetter.getMEditingDomain(getDecoratorTarget()).runAsRead(new MRunnable() {
---
> 				TransactionUtil.getEditingDomain(
> 					getDecoratorTarget().getAdapter(View.class)).runExclusive(
> 					new Runnable() {
249c249
< 					public Object run() {
---
> 					public void run() {
262d261
< 						return null;
301,302c300,303
< 			MEditingDomainGetter.getMEditingDomain(decoratorTarget).runAsRead(
< 				new MRunnable() {
---
> 			final View view = (View) getDecoratorTarget().getAdapter(View.class);
> 			TransactionUtil.getEditingDomain(view).runExclusive(new Runnable() {
> 
> 				public void run() {
304,309d304
< 					/*
< 					 * @see java.lang.Runnable#run()
< 					 */
< 					public Object run() {
< 						View view = (View) BookmarkDecorator.this
< 							.getDecoratorTarget().getAdapter(View.class);
313d307
< 						return null;
361c355
< 		String elementId = EObjectUtil.getID(view);
---
> 		String elementId = ((XMLResource) view.eResource()).getID(view);
399,405c393
< 			MEditingDomain editingDomain = MEditingDomainGetter.getMEditingDomain(model);
< 			String filePath = editingDomain.getResourceFileName(model);
< 			if (filePath != null && filePath.length() != 0) {
< 				return ResourcesPlugin.getWorkspace().getRoot()
< 					.getFileForLocation(
< 						new Path(editingDomain.getResourceFileName(model)));
< 			}
---
>            return WorkspaceSynchronizer.getFile(model);
419c407
< 		IFile file = EObjectUtil.getFile(diagramView);
---
> 		IFile file = WorkspaceSynchronizer.getFile(diagramView.eResource());
