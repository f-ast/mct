2c2
<  * Copyright (c) 2002, 2004 IBM Corporation and others.
---
>  * Copyright (c) 2002, 2006 IBM Corporation and others.
21d20
< import org.eclipse.gmf.runtime.common.core.command.CompositeCommand;
33a33
> import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeTransactionalCommand;
126a127,132
> 		if ((request instanceof DestroyRequest)  && (getHost() instanceof ConnectionEditPart)
> 				&& !((ConnectionEditPart) getHost()).isSemanticConnection()) {
> 			// no semantic meaning to the connection being destroyed
> 			return null;
> 		}
> 		
147,149c153,155
< 				ICommand ic = new DeleteCommand(((IGraphicalEditPart) getHost()).getEditingDomain(),
< 					(View)getHost().getModel());
< 				CompositeCommand cc = new CompositeCommand(semanticCommand
---
> 				TransactionalEditingDomain domain = ((IGraphicalEditPart) getHost()).getEditingDomain();
> 				ICommand ic = new DeleteCommand(domain, (View)getHost().getModel());
> 				CompositeTransactionalCommand cc = new CompositeTransactionalCommand(domain, semanticCommand
150a157
> 				cc.setTransactionNestingEnabled(true);
341,342c348,357
< 		EditPart sourceEditPart = request.getConnectionEditPart().getSource();
< 		EditPart targetEditPart = request.getConnectionEditPart().getTarget();
---
> 		org.eclipse.gef.ConnectionEditPart connectionEP = (request).getConnectionEditPart();
> 		
> 		if (connectionEP instanceof ConnectionEditPart) {
> 			if (!((ConnectionEditPart) connectionEP).isSemanticConnection()) {
> 				return null;
> 			}
> 		}
> 
> 		EditPart sourceEditPart = connectionEP.getSource();
> 		EditPart targetEditPart = connectionEP.getTarget();
372,373c387,396
< 		EditPart sourceEditPart = request.getConnectionEditPart().getSource();
< 		EditPart targetEditPart = request.getConnectionEditPart().getTarget();
---
> 		org.eclipse.gef.ConnectionEditPart connectionEP = (request).getConnectionEditPart();
> 		
> 		if (connectionEP instanceof ConnectionEditPart) {
> 			if (!((ConnectionEditPart) connectionEP).isSemanticConnection()) {
> 				return null;
> 			}
> 		}
> 
> 		EditPart sourceEditPart = connectionEP.getSource();
> 		EditPart targetEditPart = connectionEP.getTarget();
