14,15d13
< 
< import org.eclipse.emf.common.util.URI;
17d14
< 
19d15
< 
22d17
< 
24d18
< 
26d19
< 
28d20
< 
30,31d21
< 
< import org.eclipse.jface.dialogs.IDialogSettings;
33d22
< 
36,37d24
< import org.eclipse.jface.viewers.StructuredSelection;
< 
39,40c26
< import org.eclipse.jface.wizard.WizardDialog;
< 
---
> import org.eclipse.swt.widgets.Shell;
52c38
< 	private IWorkbenchPart myPart;
---
> 	private IWorkbenchPart targetPart;
57,62c43
< 	private IFile mySelectedModelFile;
< 
< 	/**
< 	 * @generated
< 	 */
< 	private IStructuredSelection mySelection;
---
> 	private org.eclipse.emf.common.util.URI domainModelURI;
68c49
< 		myPart = targetPart;
---
> 		this.targetPart = targetPart;
75,76c56
< 		mySelectedModelFile = null;
< 		mySelection = StructuredSelection.EMPTY;
---
> 		domainModelURI = null;
81,82c61,62
< 		mySelection = (IStructuredSelection) selection;
< 		mySelectedModelFile = (IFile) ((IStructuredSelection) selection).getFirstElement();
---
> 		IFile file = (IFile) ((IStructuredSelection) selection).getFirstElement();
> 		domainModelURI = org.eclipse.emf.common.util.URI.createPlatformResourceURI(file.getFullPath().toString(), true);
88a69,75
> 	private Shell getShell() {
> 		return targetPart.getSite().getShell();
> 	}
> 
> 	/**
> 	 * @generated
> 	 */
94c81
< 			Resource resource = resourceSet.getResource(URI.createPlatformResourceURI(mySelectedModelFile.getFullPath().toString(), true), true);
---
> 			Resource resource = resourceSet.getResource(domainModelURI, true);
97c84
< 			GMFGraphDiagramEditorPlugin.getInstance().logError("Unable to load resource: " + mySelectedModelFile.getFullPath().toString(), ex); //$NON-NLS-1$
---
> 			GMFGraphDiagramEditorPlugin.getInstance().logError("Unable to load resource: " + domainModelURI, ex);
100c87
< 			MessageDialog.openError(myPart.getSite().getShell(), "Error", "Model file loading failed");
---
> 			MessageDialog.openError(getShell(), "Error", "Model file loading failed");
103,110c90
< 		Wizard wizard = new GMFGraphNewDiagramFileWizard(mySelectedModelFile, myPart.getSite().getPage(), mySelection, diagramRoot, editingDomain);
< 		IDialogSettings pluginDialogSettings = GMFGraphDiagramEditorPlugin.getInstance().getDialogSettings();
< 		IDialogSettings initDiagramFileSettings = pluginDialogSettings.getSection("InisDiagramFile"); //$NON-NLS-1$
< 		if (initDiagramFileSettings == null) {
< 			initDiagramFileSettings = pluginDialogSettings.addNewSection("InisDiagramFile"); //$NON-NLS-1$
< 		}
< 		wizard.setDialogSettings(initDiagramFileSettings);
< 		wizard.setForcePreviousAndNextButtons(false);
---
> 		Wizard wizard = new GMFGraphNewDiagramFileWizard(domainModelURI, diagramRoot, editingDomain);
112,116c92
< 
< 		WizardDialog dialog = new WizardDialog(myPart.getSite().getShell(), wizard);
< 		dialog.create();
< 		dialog.getShell().setSize(Math.max(500, dialog.getShell().getSize().x), 500);
< 		dialog.open();
---
> 		GMFGraphDiagramEditorUtil.runWizard(getShell(), wizard, "InitDiagramFile"); //$NON-NLS-1$
118d93
< 
