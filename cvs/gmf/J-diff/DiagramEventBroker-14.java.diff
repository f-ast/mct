233a234
>         Set elementsInPersistQueue = new HashSet();
244c245
<                 Command cmd = handleTransactionAboutToCommitEvent(notification);
---
>                 Command cmd = handleTransactionAboutToCommitEvent(notification,elementsInPersistQueue);
249a251
>         elementsInPersistQueue.clear();
261d262
< 
266d266
< 
321c321
<     private Command fireTransactionAboutToCommit(Notification event) {
---
>     private Command fireTransactionAboutToCommit(Notification event,Set elementsInPersistQueue) {
325c325
<         preparePersistCommand(event,cc);
---
>         preparePersistCommand(event,cc,elementsInPersistQueue);
350c350
<     private void preparePersistCommand(Notification event, CompoundCommand cc) {
---
>     private void preparePersistCommand(Notification event, CompoundCommand cc, Set elementsInPersistQueue) {
357c357
<             if (elementToPersist != null
---
>             if (elementToPersist != null && !elementsInPersistQueue.contains(elementToPersist)
362a363
>                     elementsInPersistQueue.add(elementToPersist);
621a623
>      * @p
623c625
<     private Command handleTransactionAboutToCommitEvent(Notification event) {
---
>     private Command handleTransactionAboutToCommitEvent(Notification event, Set elementsInPersistQueue) {
626c628
<             return fireTransactionAboutToCommit(event);
---
>             return fireTransactionAboutToCommit(event,elementsInPersistQueue);
636a639
>      * 
