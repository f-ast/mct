2c2
<  * Copyright (c) 2002, 2003 IBM Corporation and others.
---
>  * Copyright (c) 2002, 2006 IBM Corporation and others.
32a33
> import org.eclipse.gmf.runtime.common.core.util.Log;
87a89,91
> 			
> 			logResourceErrorsAndWarnings(resource);
> 						
91a96,108
> 	private static void logResourceErrorsAndWarnings(Resource resource) {
> 		for (Iterator iter = resource.getErrors().iterator(); iter.hasNext();) {
> 			Resource.Diagnostic diagnostic = (Resource.Diagnostic) iter.next();
> 			Log.error(EditorPlugin.getInstance(), EditorStatusCodes.ERROR, diagnostic.getMessage());				
> 		}
> 
> 		for (Iterator iter = resource.getWarnings().iterator(); iter.hasNext();) {
> 			Resource.Diagnostic diagnostic = (Resource.Diagnostic) iter.next();
> 			Log.warning(EditorPlugin.getInstance(), EditorStatusCodes.WARNING, diagnostic.getMessage());				
> 		}
> 	}
> 
> 	
102,106c119,128
<             
< 			String storagePath = fStorage.getFullPath().toString();
<  
< 			Resource resource = editingDomain.getResourceSet().getResource(
< 				URI.createPlatformResourceURI(storagePath, true), true);
---
>             String storageName = fStorage.getName();
>             URI uri = URI.createPlatformResourceURI(storageName);
>             Resource resource = editingDomain.getResourceSet().getResource(uri,false);
>             if (resource == null) {
>                 resource = editingDomain.getResourceSet().createResource(uri);
>             }
>             if (!resource.isLoaded()) {
>                 resource.load(fStorage.getContents(), loadOptions);
>             }
> 			logResourceErrorsAndWarnings(resource);
141c163
< 					Throwable causeError = e.getWrappedException();
---
> 					Throwable causeError = e.getCause();
149,150c171,172
< 						Exception exc = ((Resource.IOWrappedException) causeError)
< 							.getWrappedException();
---
> 						Exception exc = (Exception)((Resource.IOWrappedException) causeError)
> 							.getCause();
173c195
< 						throw new CoreException(new Status(IStatus.ERROR, EditorPlugin.getPluginId(), EditorStatusCodes.ERROR, UNABLE_TO_LOAD_DIAGRAM, causeError));
---
>                         throw e;
195,196c217,223
< 			} else
< 				thrownExcp = new CoreException(new Status(IStatus.ERROR, EditorPlugin.getPluginId(), EditorStatusCodes.ERROR, e.getMessage(), e));
---
>             } else {
>                 String exceptionMessage = e.getLocalizedMessage();
>                 thrownExcp = new CoreException(new Status(IStatus.ERROR,
>                     EditorPlugin.getPluginId(), EditorStatusCodes.ERROR,
>                     exceptionMessage != null ? exceptionMessage
>                         : "load(IFile, boolean)", e)); //$NON-NLS-1$
>             }
227a255,256
> 		
> 		logResourceErrorsAndWarnings(notationModel);
248d276
< 
