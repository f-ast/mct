2c2
<  * Copyright (c) 2005 IBM Corporation and others.
---
>  * Copyright (c) 2005, 2006 IBM Corporation and others.
21a22
> import org.eclipse.gef.palette.PaletteGroup;
22a24
> import org.eclipse.gef.palette.PaletteRoot;
57,64d58
< 	// /**
< 	// * Creates a new instance.
< 	// */
< 	// public DiagramPopupBarEditPolicy() {
< 	// super();
< 	// this.setIsDisplayAtMouseHoverLocation(true);
< 	// }
< 
143,144c137,146
< 		PaletteContainer palContainer = theLastTool.getParent();
< 		fillWithPaletteToolsInContainer(palContainer);
---
>         // Find the palette group or drawer containing the last active tool.
>         PaletteContainer container = theLastTool.getParent();
>         while (!(container instanceof PaletteDrawer)
>             && !(container instanceof PaletteGroup)
>             && !(container instanceof PaletteRoot)
>             && container.getParent() != null) {
>             container = container.getParent();
>         }
>         
> 		fillWithPaletteToolsInContainer(container);
182c184
< 						// RATLC00524208: fix for the pallete stack optimzation
---
> 						// add all the entries from a palette stack as well
