14,17c14,16
< import java.util.Collections;
< import java.util.List;
< 
< import org.eclipse.gef.EditPart;
---
> import org.eclipse.emf.ecore.ENamedElement;
> import org.eclipse.emf.ecore.EStructuralFeature;
> import org.eclipse.gef.Request;
18a18
> import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
20c20,21
< import org.eclipse.gmf.runtime.diagram.ui.editparts.TopGraphicEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
> import org.eclipse.gmf.runtime.diagram.ui.requests.ChangeChildPropertyValueRequest;
57,66c58,62
< 	/**
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction#getTargetEdiParts(org.eclipse.gef.EditPart)
< 	 */
< 	protected List getTargetEdiParts(EditPart editpart) {
< 		EditPart targetEP = null;
< 		if (editpart instanceof TopGraphicEditPart) {
< 			final TopGraphicEditPart topEP = (TopGraphicEditPart) editpart;
< 			targetEP = (EditPart) MEditingDomainGetter.getMEditingDomain((View)editpart.getModel()).runAsRead( new MRunnable() {
< 				public Object run() { 
< 					return topEP.getChildBySemanticHint(
---
> 	
> 	protected Request createTargetRequest() {
> 		return new ChangeChildPropertyValueRequest(
> 			getPropertyName(),
> 			getPropertyId(),
67a64
> 		
69,74c66
< 			});
< 		}
< 		return (targetEP == null)
< 			? Collections.EMPTY_LIST
< 			: Collections.singletonList(targetEP);
< 	}
---
> 
84a77,99
> 	
> 	/* (non-Javadoc)
> 	 * @see org.eclipse.gmf.runtime.diagram.ui.actions.internal.PropertyChangeAction#getPropertyValue(org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart, java.lang.String)
> 	 */
> 	protected Object getPropertyValue(
> 		final IGraphicalEditPart editPart,
> 		final String thePropertyId) {
> 		return MEditingDomainGetter.getMEditingDomain((View)editPart.getModel()).runAsRead( new MRunnable() {
> 			public Object run() {
> 				ENamedElement element = MetaModelUtil.getElement(thePropertyId);
> 				if (element instanceof EStructuralFeature){
> 					View view  = editPart.getNotationView();
> 					if (view !=null){
> 						View childView = ViewUtil.getChildBySemanticHint(view,getCompartmentSemanticHint());
> 						if (childView!=null){
> 							return ViewUtil.getStructuralFeatureValue(childView,(EStructuralFeature)element);
> 						}
> 					}
> 				}
> 				return null;
> 			}
> 		});
> 	}
