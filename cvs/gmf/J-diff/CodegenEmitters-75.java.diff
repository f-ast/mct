22a23
> import org.eclipse.core.runtime.NullProgressMonitor;
132a134,135
> 	private static final String PATH_SEPARATOR = "::"; //$NON-NLS-1$
> 
648c651,655
< 		return new XpandTextEmitter(myResourceManager, "xpt::diagram::preferences::PreferenceInitializer::PreferenceInitializer"); //$NON-NLS-1$
---
> 		return getPrimaryEmitter("xpt::diagram::preferences::PreferenceInitializer"); //$NON-NLS-1$
> 	}
> 
> 	public String getPreferenceInitializerName(Object... input) throws UnexpectedBehaviourException {
> 		return getQualifiedClassName("xpt::diagram::preferences::PreferenceInitializer", input); //$NON-NLS-1$
714a722,761
>     /**
>      * Returns emitter for the primary definition in the specified template.
>      * Primary definition has the same name as template file.
>      */
> 	private TextEmitter getPrimaryEmitter(String templateName) throws UnexpectedBehaviourException {
> 		String[] parts = templateName.split(PATH_SEPARATOR);
> 		String definition = templateName + PATH_SEPARATOR + parts[parts.length-1];
> 		return new XpandTextEmitter(myResourceManager, definition);
> 	}
> 
>     /**
>      * Returns emitter for qualified class name definition in the specified template.
>      * Definition should be named 'qualifiedClassName'.
>      */
> 	private TextEmitter getQualifiedClassNameEmitter(String templateName) throws UnexpectedBehaviourException {
> 		String definition = templateName + PATH_SEPARATOR + "qualifiedClassName"; //$NON-NLS-1$
> 		return new XpandTextEmitter(myResourceManager, definition);
> 	}
> 
> 	/**
> 	 * Returns text generated by emitter.
> 	 */
> 	private String getText(TextEmitter emitter, Object... input) throws UnexpectedBehaviourException {
> 		try {
> 			return emitter.generate(new NullProgressMonitor(), input).trim();
> 		} catch (InterruptedException ie) {
> 			return null;
> 		} catch (InvocationTargetException ite) {
> 			throw new UnexpectedBehaviourException(ite.getCause());
> 		}
> 	}
> 
> 	/**
> 	 * Returns qualified class name defined in template.
> 	 */
> 	private String getQualifiedClassName(String templateName, Object... input) throws UnexpectedBehaviourException {
> 		TextEmitter emitter = getQualifiedClassNameEmitter(templateName);
> 		return getText(emitter, input);
> 	}
> 
