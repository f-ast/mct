13d12
< import org.eclipse.emf.codegen.ecore.genmodel.GenModel;
30d28
< import org.eclipse.gmf.codegen.gmfgen.GenAuditContainer;
34a33
> import org.eclipse.gmf.codegen.gmfgen.GenEditorGenerator;
36d34
< import org.eclipse.gmf.codegen.gmfgen.GenPlugin;
42a41
> import org.eclipse.gmf.common.codegen.ImportAssistant;
96c95
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getDomainMetaModel <em>Domain Meta Model</em>}</li>
---
>  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getEditorGen <em>Editor Gen</em>}</li>
102d100
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getAudits <em>Audits</em>}</li>
104d101
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPlugin <em>Plugin</em>}</li>
975,984d971
< 	 * The cached value of the '{@link #getDomainMetaModel() <em>Domain Meta Model</em>}' reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getDomainMetaModel()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenPackage domainMetaModel = null;
< 
< 	/**
1035,1044d1021
< 	 * The cached value of the '{@link #getAudits() <em>Audits</em>}' containment reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getAudits()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenAuditContainer audits = null;
< 
< 	/**
1055,1064d1031
< 	 * The cached value of the '{@link #getPlugin() <em>Plugin</em>}' containment reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPlugin()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenPlugin plugin = null;
< 
< 	/**
1138,1175d1104
< 	public GenPackage getDomainMetaModel() {
< 		if (domainMetaModel != null && domainMetaModel.eIsProxy()) {
< 			InternalEObject oldDomainMetaModel = (InternalEObject)domainMetaModel;
< 			domainMetaModel = (GenPackage)eResolveProxy(oldDomainMetaModel);
< 			if (domainMetaModel != oldDomainMetaModel) {
< 				if (eNotificationRequired())
< 					eNotify(new ENotificationImpl(this, Notification.RESOLVE, GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL, oldDomainMetaModel, domainMetaModel));
< 			}
< 		}
< 		return domainMetaModel;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public GenPackage basicGetDomainMetaModel() {
< 		return domainMetaModel;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setDomainMetaModel(GenPackage newDomainMetaModel) {
< 		GenPackage oldDomainMetaModel = domainMetaModel;
< 		domainMetaModel = newDomainMetaModel;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL, oldDomainMetaModel, domainMetaModel));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1262,1304d1190
< 	public GenAuditContainer getAudits() {
< 		return audits;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public NotificationChain basicSetAudits(GenAuditContainer newAudits, NotificationChain msgs) {
< 		GenAuditContainer oldAudits = audits;
< 		audits = newAudits;
< 		if (eNotificationRequired()) {
< 			ENotificationImpl notification = new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__AUDITS, oldAudits, newAudits);
< 			if (msgs == null) msgs = notification; else msgs.add(notification);
< 		}
< 		return msgs;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setAudits(GenAuditContainer newAudits) {
< 		if (newAudits != audits) {
< 			NotificationChain msgs = null;
< 			if (audits != null)
< 				msgs = ((InternalEObject)audits).eInverseRemove(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__AUDITS, null, msgs);
< 			if (newAudits != null)
< 				msgs = ((InternalEObject)newAudits).eInverseAdd(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__AUDITS, null, msgs);
< 			msgs = basicSetAudits(newAudits, msgs);
< 			if (msgs != null) msgs.dispatch();
< 		}
< 		else if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__AUDITS, newAudits, newAudits));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1348,1390d1233
< 	public GenPlugin getPlugin() {
< 		return plugin;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public NotificationChain basicSetPlugin(GenPlugin newPlugin, NotificationChain msgs) {
< 		GenPlugin oldPlugin = plugin;
< 		plugin = newPlugin;
< 		if (eNotificationRequired()) {
< 			ENotificationImpl notification = new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, oldPlugin, newPlugin);
< 			if (msgs == null) msgs = notification; else msgs.add(notification);
< 		}
< 		return msgs;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setPlugin(GenPlugin newPlugin) {
< 		if (newPlugin != plugin) {
< 			NotificationChain msgs = null;
< 			if (plugin != null)
< 				msgs = ((InternalEObject)plugin).eInverseRemove(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
< 			if (newPlugin != null)
< 				msgs = ((InternalEObject)newPlugin).eInverseAdd(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
< 			msgs = basicSetPlugin(newPlugin, msgs);
< 			if (msgs != null) msgs.dispatch();
< 		}
< 		else if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, newPlugin, newPlugin));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1474d1316
< 		String prefix;
1476c1318
< 			prefix = getDomainDiagramElement().getName();
---
> 			return  getDomainDiagramElement().getName();
1478,1480c1320
< 			char[] v = getDomainMetaModel().getEcorePackage().getName().toCharArray();
< 			v[0] = Character.toUpperCase(v[0]);
< 			prefix = new String(v);
---
> 			return getEditorGen().getDomainGenModel().getModelName();
1482c1322
< 		return prefix;
---
> 		// XXX NPE in gmfgen editor when neither domainGenModel nor domainDiagramElement has been set?
1752a1593,1602
> 	public GenEditorGenerator getEditorGen() {
> 		if (eContainerFeatureID != GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN) return null;
> 		return (GenEditorGenerator)eContainer();
> 	}
> 
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
> 	 * @generated
> 	 */
2166c2016
< 			return getEMFGenModel().getModelName().toLowerCase() + "_diagram";
---
> 			return getEditorGen().getDomainGenModel().getModelName().toLowerCase() + "_diagram";
2702,2710d2551
< 	public GenModel getEMFGenModel() {
< 		return getDomainMetaModel().getGenModel();
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated NOT
< 	 */
2841a2683,2686
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				if (eInternalContainer() != null)
> 					msgs = eBasicRemoveFromContainer(msgs);
> 				return eBasicSetContainer(otherEnd, GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN, msgs);
2854,2857d2698
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				if (plugin != null)
< 					msgs = ((InternalEObject)plugin).eInverseRemove(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__PLUGIN, null, msgs);
< 				return basicSetPlugin((GenPlugin)otherEnd, msgs);
2868a2710,2711
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				return eBasicSetContainer(null, GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN, msgs);
2877,2878d2719
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				return basicSetAudits(null, msgs);
2881,2882d2721
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return basicSetPlugin(null, msgs);
2891a2731,2743
> 	public NotificationChain eBasicRemoveFromContainerFeature(NotificationChain msgs) {
> 		switch (eContainerFeatureID) {
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				return eInternalContainer().eInverseRemove(this, GMFGenPackage.GEN_EDITOR_GENERATOR__DIAGRAM, GenEditorGenerator.class, msgs);
> 		}
> 		return super.eBasicRemoveFromContainerFeature(msgs);
> 	}
> 
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
> 	 * @generated
> 	 */
2984,2986c2836,2837
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				if (resolve) return getDomainMetaModel();
< 				return basicGetDomainMetaModel();
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				return getEditorGen();
2998,2999d2848
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				return getAudits();
3002,3003d2850
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return getPlugin();
3157,3159d3003
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				setDomainMetaModel((GenPackage)newValue);
< 				return;
3179,3181d3022
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				setAudits((GenAuditContainer)newValue);
< 				return;
3185,3187d3025
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				setPlugin((GenPlugin)newValue);
< 				return;
3340,3342d3177
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				setDomainMetaModel((GenPackage)null);
< 				return;
3358,3360d3192
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				setAudits((GenAuditContainer)null);
< 				return;
3364,3366d3195
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				setPlugin((GenPlugin)null);
< 				return;
3474,3475c3303,3304
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				return domainMetaModel != null;
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				return getEditorGen() != null;
3486,3487d3314
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				return audits != null;
3490,3491d3316
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return plugin != null;
4096,4097c3921,3923
< 		String prefix = CodeGenUtil.safeName(getDomainMetaModel().getPackageName());
< 		String basePackage = getDomainMetaModel().getBasePackage();
---
> 		GenPackage primaryPackage = (GenPackage) getEditorGen().getDomainGenModel().getGenPackages().get(0);
> 		String prefix = CodeGenUtil.safeName(primaryPackage.getPackageName());
> 		String basePackage = primaryPackage.getBasePackage();
4105c3931
< 		String name = CodeGenUtil.validJavaIdentifier(getEMFGenModel().getModelName());
---
> 		String name = CodeGenUtil.validJavaIdentifier(getEditorGen().getDomainGenModel().getModelName());
4110a3937,3940
> 
> 	public String getMetaPackageName(ImportAssistant importManager) {
> 		return importManager.getImportedName(getDomainDiagramElement().getGenPackage().getQualifiedPackageInterfaceName());
> 	}
