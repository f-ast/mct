30,31d29
< import org.eclipse.gef.GraphicalViewer;
< import org.eclipse.gef.RootEditPart;
34a33
> import org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory;
36d34
< import org.eclipse.gmf.runtime.diagram.ui.editparts.IDiagramPreferenceSupport;
39,41d36
< import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramCommandStack;
< import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramEditDomain;
< import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramGraphicalViewer;
46d40
< import org.eclipse.gmf.runtime.diagram.ui.services.editpart.EditPartService;
82,104c76,77
<         GraphicalViewer viewer = new DiagramGraphicalViewer();
<         viewer.createControl(shell);
< 
<         DiagramEditDomain editDomain = new DiagramEditDomain(null);
<         editDomain.setCommandStack(new DiagramCommandStack(editDomain));
< 
<         viewer.setEditDomain(editDomain);
< 
<         RootEditPart rootEP = EditPartService.getInstance().createRootEditPart(
<             diagram);
<         if (rootEP instanceof IDiagramPreferenceSupport) {
<             ((IDiagramPreferenceSupport) rootEP)
<                 .setPreferencesHint(preferencesHint);
<         }
<         viewer.setRootEditPart(rootEP);
< 
<         viewer.setEditPartFactory(EditPartService.getInstance());
< 
<         viewer.setContents(diagram);
<         viewer.flush();
< 
<         Assert.isTrue(viewer.getContents() instanceof DiagramEditPart);
<         return (DiagramEditPart) viewer.getContents();
---
>         return OffscreenEditPartFactory.getInstance().createDiagramEditPart(
>             diagram, shell, preferencesHint);
