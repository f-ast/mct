193a194,200
> 			int diagramLinkVisualID = GMFGraphVisualIDRegistry.getVisualID(nextDiagramLink);
> 			if (diagramLinkVisualID == -1) {
> 				if (nextDiagramLink.getSource() != null && nextDiagramLink.getTarget() != null) {
> 					linksIterator.remove();
> 				}
> 				continue;
> 			}
197d203
< 			int diagramLinkVisualID = GMFGraphVisualIDRegistry.getVisualID(nextDiagramLink);
214a221,223
> 		if (!CanvasEditPart.MODEL_ID.equals(GMFGraphVisualIDRegistry.getModelID(view))) {
> 			return Collections.EMPTY_LIST;
> 		}
218c227
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
219a229,232
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
223c236
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
224a238,241
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
228c245
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
229a247,250
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
233c254
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
234a256,259
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
238c263
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
239a265,268
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
243c272
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
244a274,277
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
248c281
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
249a283,286
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
253c290
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
254a292,295
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
258c299
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
259a301,304
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
263c308
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
264a310,313
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
268c317
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
269a319,322
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
273c326
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
274a328,331
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
278c335
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
279a337,340
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
283c344
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
284a346,349
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
288c353
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
289a355,358
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
293c362
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
294a364,367
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
298c371
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
299a373,376
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
303c380
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
304a382,385
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
308c389
< 			domain2NotationMap.put(view.getElement(), view);
---
> 			if (!domain2NotationMap.containsKey(view.getElement())) {
309a391,394
> 			}
> 			if (!domain2NotationMap.containsKey(view.getElement()) || view.getEAnnotation("Shortcut") == null) { //$NON-NLS-1$
> 				domain2NotationMap.put(view.getElement(), view);
> 			}
