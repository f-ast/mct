17,18d16
< import org.eclipse.core.resources.ResourcesPlugin;
< import org.eclipse.core.runtime.Path;
20,23c18,21
< import org.eclipse.jface.resource.ImageDescriptor;
< import org.eclipse.jface.util.Assert;
< import org.eclipse.ui.IPersistableElement;
< 
---
> import org.eclipse.emf.transaction.RunnableWithResult;
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
> import org.eclipse.emf.transaction.util.TransactionUtil;
> import org.eclipse.emf.workspace.util.WorkspaceSynchronizer;
25d22
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
28,30c25
< import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
< import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
---
> import org.eclipse.gmf.runtime.emf.core.util.EMFCoreUtil;
31a27,29
> import org.eclipse.jface.resource.ImageDescriptor;
> import org.eclipse.jface.util.Assert;
> import org.eclipse.ui.IPersistableElement;
81d78
< 		final String[] name = new String[1];
83,86c80,84
< 			MEditingDomainGetter.getMEditingDomain(getDiagram()).runAsRead(new MRunnable() {
< 				public Object run() {
< 					name[0] = EObjectUtil.getQName(getDiagram(), false);
< 					return null;
---
> 			return (String) TransactionUtil.getEditingDomain(getDiagram())
> 				.runExclusive(new RunnableWithResult.Impl() {
> 
> 					public void run() {
> 						setResult(EMFCoreUtil.getQualifiedName(getDiagram(), false));
96c94
< 			name[0] = null;
---
> 			return null;
98d95
< 		return name[0];
106d102
< 		final String[] name = new String[1];
108,111c104,108
< 			MEditingDomainGetter.getMEditingDomain(getDiagram()).runAsRead(new MRunnable() {
< 				public Object run() {
< 					name[0] = EObjectUtil.getName(getDiagram()); //((IElement) getDiagram()).getFullyQualifiedName(false);
< 					return null;
---
> 			return (String) TransactionUtil.getEditingDomain(getDiagram())
> 				.runExclusive(new RunnableWithResult.Impl() {
> 
> 					public void run() {
> 						setResult(EMFCoreUtil.getName(getDiagram()));
121c118
< 			name[0] = null;
---
> 			return null;
123d119
< 		return name[0];
190d185
< 		final IFile[] file = new IFile[1];
192,193c187,188
< 			final MEditingDomain editingDomain = MEditingDomainGetter.getMEditingDomain(getDiagram());
< 			editingDomain.runAsRead(new MRunnable() {
---
> 			final TransactionalEditingDomain editingDomain = TransactionUtil.getEditingDomain(getDiagram());
> 			return (IFile) editingDomain.runExclusive(new RunnableWithResult.Impl() {
195c190
< 				public Object run() {
---
> 				public void run() {
197,204c192,194
< 					String path = editingDomain.getResourceFileName(model);
< 					file[0] = model != null && path != null
< 						&& path.length() != 0 ? ResourcesPlugin.getWorkspace()
< 						.getRoot().getFileForLocation(
< 							new Path(path))
< 						: null;
< 
< 					return null;
---
> 						setResult(model != null ? WorkspaceSynchronizer
> 							.getFile(model)
> 							: null);
211c201
< 			file[0] = null;
---
> 			return null;
213d202
< 		return file[0];
