16c16
< import java.util.Iterator;
---
> import java.util.HashMap;
17a18
> import java.util.Map;
26a28
> import org.eclipse.gmf.runtime.emf.type.core.internal.requests.RequestCacheEntries;
70a73,77
> 		Map cacheMaps = (Map) request
> 			.getParameter(RequestCacheEntries.Cache_Maps);
> 		if (cacheMaps != null) {
> 			return (List) cacheMaps.get(RequestCacheEntries.Affected_Files);
> 		}
74,79c81,84
<         
<         if (elements != null) {
<             
<             for (Iterator i = elements.iterator(); i.hasNext();) {
<                 Resource resource = ((EObject) i.next()).eResource();
<                 
---
> 		int size;
> 		if (elements != null && ((size = elements.size()) > 0)) {
> 			if (size == 1) {
> 				Resource resource = ((EObject) elements.get(0)).eResource();
82d86
<                     
86a91,106
> 			} else {
> 				Map resourcesToFileMap = new HashMap();
> 				for (int i = 0; i < size; ++i) {
> 					Resource resource = ((EObject) elements.get(i)).eResource();
> 					if (resource != null) {
> 						Object file = resourcesToFileMap.get(resource);
> 						//if it is in the Map, then it is in the List already as well
> 						if (file == null) {
> 							file = WorkspaceSynchronizer.getFile(resource);
> 							if (file != null) {
> 								resourcesToFileMap.put(resource, file);
> 								result.add(file);
> 							}
> 						}
> 					}
> 				}
