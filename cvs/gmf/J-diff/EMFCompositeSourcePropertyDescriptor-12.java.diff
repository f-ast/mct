20a21
> import org.eclipse.emf.common.ui.celleditor.ExtendedDialogCellEditor;
29a31
> import org.eclipse.emf.edit.ui.celleditor.FeatureEditorDialog;
40a43
> import org.eclipse.swt.widgets.Control;
195c198
<             final Collection choiceOfValues = getChoiceOfValues();
---
>             final List choiceOfValues = getChoiceOfValues();
198,200c201
< 
<             	// TODO We need to properly handle unspecified multiplicities on the structural feature
<                 if (feature.isMany()) {
---
>             	if (getItemDescriptor().isMany(getObject())) {
209,210c210,212
<                     if (valid)
<                         result = createComboBoxCellEditor(composite);
---
>                     if (valid) {
>                     	result = createDialogCellEditor(composite, feature, choiceOfValues);
> 					}
220,222c222,223
<                     	// TODO We need to properly handle unspecified multiplicities on the structural feature
<                         if (feature.isMany()) {
<                             result = createComboBoxCellEditor(composite);
---
>                         if (getItemDescriptor().isMany(getObject())) {
>                         	result = createDialogCellEditor(composite, feature, choiceOfValues);
359a361,389
>     /**
> 	 * Creates a dialog cell editor for editing multivalued features.
> 	 * 
> 	 * @param composite
> 	 *            the composite to contain the new cell editor
> 	 * @param feature
> 	 *            the feature being edited
> 	 * @param choiceOfValues
> 	 *            the possible values for that feature
> 	 * @return the new cell editor
> 	 */
>     protected CellEditor createDialogCellEditor(Composite composite,
> 			final EStructuralFeature feature, final List choiceOfValues) {
>     	
> 		return new ExtendedDialogCellEditor(composite, getEditLabelProvider()) {
> 			protected Object openDialogBox(Control cellEditorWindow) {
> 				FeatureEditorDialog dialog = new FeatureEditorDialog(
> 						cellEditorWindow.getShell(), getLabelProvider(),
> 						getObject(), feature.getEType(),
> 						(List) ((IItemPropertySource) itemPropertyDescriptor
> 								.getPropertyValue(object))
> 								.getEditableValue(object), getDisplayName(),
> 						choiceOfValues);
> 				dialog.open();
> 				return dialog.getResult();
> 			}
> 		};
> 	}
> 
453a484,487
>         if (value instanceof IItemPropertySource) {
>             return (IItemPropertySource) value;
>         }
>         
