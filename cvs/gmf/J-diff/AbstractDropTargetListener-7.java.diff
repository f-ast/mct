2c2
<  * Copyright (c) 2002, 2005 IBM Corporation and others.
---
>  * Copyright (c) 2002, 2006 IBM Corporation and others.
19a20,21
> import org.eclipse.core.commands.ExecutionException;
> import org.eclipse.core.commands.operations.IOperationHistory;
30d31
< import org.eclipse.gmf.runtime.common.core.command.CommandManager;
236,237c237,238
< 		final CommandManager manager = (CommandManager) getContext()
< 			.getActivePart().getAdapter(CommandManager.class);
---
> 		final IOperationHistory manager = (IOperationHistory) getContext()
> 			.getActivePart().getAdapter(IOperationHistory.class);
258c259,271
< 					manager.execute(command, new NullProgressMonitor());
---
>                     try {
>                         manager.execute(command, new NullProgressMonitor(),
>                             null);
>                     } catch (ExecutionException e) {
>                         Trace
>                             .catching(
>                                 CommonUIServicesDNDPlugin.getDefault(),
>                                 CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                                 getClass(), "drop", e); //$NON-NLS-1$
>                         Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                             CommonUIServicesDNDStatusCodes.SERVICE_FAILURE,
>                             "drop", e); //$NON-NLS-1$
>                     }
263c276,284
< 			manager.execute(command, new NullProgressMonitor());
---
>             try {
>                 manager.execute(command, new NullProgressMonitor(), null);
>             } catch (ExecutionException e) {
>                 Trace.catching(CommonUIServicesDNDPlugin.getDefault(),
>                     CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                     getClass(), "drop", e); //$NON-NLS-1$
>                 Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                     CommonUIServicesDNDStatusCodes.SERVICE_FAILURE, "drop", e); //$NON-NLS-1$
>             }
406,408c427,429
< 		/* Get the command manager */
< 		final CommandManager manager = (CommandManager) getContext()
< 			.getActivePart().getAdapter(CommandManager.class);
---
> 		/* Get the operation history */
> 		final IOperationHistory manager = (IOperationHistory) getContext()
> 			.getActivePart().getAdapter(IOperationHistory.class);
413c434,450
< 				manager.execute(command, monitor);
---
>                 try {
>                     manager.execute(command, monitor, null);
>                     
>                 } catch (ExecutionException e) {
>                     Trace.catching(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                         getClass(), "drop", e); //$NON-NLS-1$
>                     Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDStatusCodes.SERVICE_FAILURE, "drop", e); //$NON-NLS-1$
>                     
>                     RuntimeException re = new RuntimeException(e);
> 
>                     Trace.throwing(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDDebugOptions.EXCEPTIONS_THROWING,
>                         getClass(), "runCommandInProgressMonitorDialog", re); //$NON-NLS-1$
>                     throw re;
>                 }
