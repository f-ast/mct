14,15c14,15
< import org.eclipse.draw2d.ScalableFreeformLayeredPane;
< import org.eclipse.jface.preference.IPreferenceStore;
---
> import java.util.List;
> import java.util.ListIterator;
16a17,20
> import org.eclipse.draw2d.Graphics;
> import org.eclipse.draw2d.IFigure;
> import org.eclipse.draw2d.Layer;
> import org.eclipse.draw2d.geometry.Rectangle;
19c23,30
< import org.eclipse.gmf.runtime.draw2d.ui.render.internal.graphics.RenderedScalableFreeformLayeredPane;
---
> import org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.MapModeGraphics;
> import org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.ScalableFreeformLayeredPane;
> import org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.ScaledGraphics;
> import org.eclipse.gmf.runtime.draw2d.ui.render.figures.ScalableImageFigure;
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.graphics.RenderedMapModeGraphics;
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.graphics.RenderedScaledGraphics;
> import org.eclipse.gmf.runtime.gef.ui.internal.editparts.AnimatedZoomListener;
> import org.eclipse.jface.preference.IPreferenceStore;
29a41,111
> 	static protected class DiagramRenderedScalableFreeformLayeredPane
> 		extends DiagramScalableFreeformLayeredPane implements AnimatedZoomListener {
> 
> 		private boolean animatedZoomOn;
> 
> 		/*
> 		 * (non-Javadoc)
> 		 * 
> 		 * @see org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.ScalableFreeformLayeredPane#createScaledGraphics(org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.MapModeGraphics)
> 		 */
> 		protected ScaledGraphics createScaledGraphics(MapModeGraphics gMM) {
> 			if (animatedZoomOn) {
> 				return new ScaledGraphics(gMM);
> 			}
> 
> 			return new RenderedScaledGraphics(gMM);
> 		}
> 
> 		/*
> 		 * (non-Javadoc)
> 		 * 
> 		 * @see org.eclipse.gmf.runtime.draw2d.ui.internal.graphics.ScalableFreeformLayeredPane#createMapModeGraphics(org.eclipse.draw2d.Graphics)
> 		 */
> 		protected MapModeGraphics createMapModeGraphics(Graphics graphics) {
> 			MapModeGraphics gMM = new RenderedMapModeGraphics(graphics);
> 			return gMM;
> 		}
> 
> 		/*
> 		 * (non-Javadoc)
> 		 * 
> 		 * @see org.eclipse.gmf.runtime.gef.ui.internal.editparts.AnimatedZoomListener#animatedZoomEnded()
> 		 */
> 		public void animatedZoomEnded() {
> 			animatedZoomOn = false;
> 			
> 			// only repaint ScalableImageFigures
> 			Layer primaryLayer = getLayer(PRINTABLE_LAYERS);
> 			if (primaryLayer != null)
> 				paintScalableImageFigures(primaryLayer.getChildren());
> 		}
> 
> 		private void paintScalableImageFigures(List figures) {
> 			ListIterator iter = figures.listIterator();
> 			Rectangle absbounds = getBounds().getCopy();
> 			translateToAbsolute(absbounds);
> 			
> 			while (iter.hasNext()) {
> 				IFigure fig = (IFigure)iter.next();
> 				if (fig instanceof ScalableImageFigure) {
> 					Rectangle absfigbounds = fig.getBounds().getCopy();
> 					fig.translateToAbsolute(absfigbounds);
> 					if (absbounds.intersects(absfigbounds))
> 						fig.repaint();
> 				}
> 				else {
> 					paintScalableImageFigures(fig.getChildren());
> 				}
> 			}
> 		}
> 		
> 		/*
> 		 * (non-Javadoc)
> 		 * 
> 		 * @see org.eclipse.gmf.runtime.gef.ui.internal.editparts.AnimatedZoomListener#animatedZoomStarted()
> 		 */
> 		public void animatedZoomStarted() {
> 			animatedZoomOn = true;
> 		}
> 	}
> 
34,35c116,117
< 	protected ScalableFreeformLayeredPane createScalableFreeformLayeredPane() {
< 		setLayers(new RenderedScalableFreeformLayeredPane());
---
> 	protected org.eclipse.draw2d.ScalableFreeformLayeredPane createScalableFreeformLayeredPane() {
> 		setLayers(new DiagramRenderedScalableFreeformLayeredPane());
43,48c125,130
< 		IPreferenceStore preferenceStore =
< 			(IPreferenceStore) getPreferencesHint().getPreferenceStore();
< 		boolean antiAlias = preferenceStore.getBoolean(
< 			IPreferenceConstants.PREF_ENABLE_ANTIALIAS);
< 		if (getLayers() instanceof RenderedScalableFreeformLayeredPane)
< 			((RenderedScalableFreeformLayeredPane) getLayers()).setAntiAlias(antiAlias);
---
> 		IPreferenceStore preferenceStore = (IPreferenceStore) getPreferencesHint()
> 			.getPreferenceStore();
> 		boolean antiAlias = preferenceStore
> 			.getBoolean(IPreferenceConstants.PREF_ENABLE_ANTIALIAS);
> 		if (getLayers() instanceof ScalableFreeformLayeredPane)
> 			((ScalableFreeformLayeredPane) getLayers()).setAntiAlias(antiAlias);
50,52d131
< 
< 	
< 	
