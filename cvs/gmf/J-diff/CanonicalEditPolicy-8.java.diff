15,16d14
< import java.beans.PropertyChangeEvent;
< import java.beans.PropertyChangeListener;
31a30
> import org.eclipse.emf.common.notify.Notification;
46c45,46
< import org.eclipse.gmf.runtime.diagram.core.listener.NotificationEvent;
---
> import org.eclipse.gmf.runtime.diagram.core.listener.NotificationListener;
> import org.eclipse.gmf.runtime.diagram.core.listener.NotificationUtil;
56a57
> import org.eclipse.gmf.runtime.emf.core.edit.MRunOption;
88c89
< implements PropertyChangeListener {
---
> implements NotificationListener {
482c483,485
< 		MEditingDomainGetter.getMEditingDomain((View)getHost().getModel()).runAsUnchecked( new MRunnable() {
---
> 		int options = MRunOption.UNCHECKED /*| MRunOption.SILENT*/;
> 		MEditingDomainGetter.getMEditingDomain((View)getHost().getModel()).runWithOptions(new MRunnable() {
> 		//MEditingDomainGetter.getMEditingDomain((View)getHost().getModel()).runAsUnchecked( new MRunnable() {
487c490,491
< 		});
---
> 		},options);
> 		//getHost().refresh();
719c723
< 		PropertyChangeListener listener,
---
> 		NotificationListener listener,
730c734
< 				PresentationListener.getInstance().addPropertyChangeListener(element,listener);
---
> 				PresentationListener.getInstance().addNotificationListener(element,listener);
751c755
< 		PropertyChangeListener listener,
---
> 		NotificationListener listener,
763c767
< 				PresentationListener.getInstance().addPropertyChangeListener(element,feature,listener);
---
> 				PresentationListener.getInstance().addNotificationListener(element,feature,listener);
782,783c786,787
< 			PresentationListener.getInstance().removePropertyChangeListener(
< 				(EObject)objects[0],(EStructuralFeature)objects[1],(PropertyChangeListener) objects[2]);
---
> 			PresentationListener.getInstance().removeNotificationListener(
> 				(EObject)objects[0],(EStructuralFeature)objects[1],(NotificationListener) objects[2]);
785,786c789,790
< 			PresentationListener.getInstance().removePropertyChangeListener(
< 					(EObject)objects[0],(PropertyChangeListener) objects[1]);
---
> 			PresentationListener.getInstance().removeNotificationListener(
> 					(EObject)objects[0],(NotificationListener) objects[1]);
794,797c798,800
< 	public final void propertyChange(PropertyChangeEvent event) {
< 		if ( isHostStillValid() && event instanceof NotificationEvent ) {
< 			NotificationEvent ne = (NotificationEvent)event;
< 			EObject element = ne.getElement();
---
> 	public final void notifyChanged(Notification notification) {
> 		if ( isHostStillValid()) {
> 			Object element = notification.getNotifier();
802c805
< 			handleNotificationEvent(ne);
---
> 			handleNotificationEvent(notification);
822,823c825
< 	protected void handleSemanticEvent(NotificationEvent event) {
< 		if ( shouldHandleSemanticEvent(event) ) {
---
> 	protected void handleSemanticEvent(Notification event) {
826d827
< 	}
837,838c838,839
< 	protected boolean shouldHandleSemanticEvent(NotificationEvent event) {
< 		return event.isElementAddedToSlot() || event.isElementRemovedFromSlot();
---
> 	protected boolean shouldHandleSemanticEvent(Notification event) {
> 		return NotificationUtil.isElementAddedToSlot(event) || NotificationUtil.isElementRemovedFromSlot(event);
847c848
< 	protected void handleNotificationEvent(NotificationEvent event) {
---
> 	protected void handleNotificationEvent(Notification event) {
878c879
< 	protected boolean shouldHandleNotificationEvent( NotificationEvent event) {
---
> 	protected boolean shouldHandleNotificationEvent(Notification event) {
886,889c887,891
< 	  EObject element = event.getElement();
< 	  return (!(element instanceof View) 
< 	         && (event.isElementAddedToSlot() 
< 	            || event.isElementRemovedFromSlot()));
---
> 	  Object element = event.getNotifier();
> 	  return (element instanceof EObject 
> 			  && !(element instanceof View) 
> 	         && (NotificationUtil.isElementAddedToSlot(event) 
> 	            || NotificationUtil.isElementRemovedFromSlot(event)));
