40,41d39
< import org.eclipse.emf.transaction.impl.InternalTransaction;
< import org.eclipse.emf.transaction.impl.InternalTransactionalEditingDomain;
43a42
> import org.eclipse.gef.EditPartViewer;
66a66
> import org.eclipse.gmf.runtime.diagram.ui.internal.parts.NotificationForEditPartsListener;
68a69
> import org.eclipse.gmf.runtime.diagram.ui.util.EditPartUtil;
100c101
< implements NotificationListener {
---
> implements NotificationForEditPartsListener {
489c490
<             !isWriteTransactionInProgress())
---
>             !EditPartUtil.isWriteTransactionInProgress((IGraphicalEditPart)getHost(), false))
1181,1185c1182,1184
<     /**
<      * Checks if the current active transaction is a Write transaction or not
<      * unprotected transaction are not considered write transaction
<      * 
<      * @return true if the current active transaction is a write transaction 
---
> 	/* 
> 	 * (non-Javadoc)
> 	 * @see org.eclipse.gmf.runtime.diagram.ui.internal.parts.NotificationForEditPartsListener#getViewer()
1187,1201c1186,1187
<     private boolean isWriteTransactionInProgress() {
<         TransactionalEditingDomain theEditingDomain = ((IGraphicalEditPart) getHost())
<             .getEditingDomain();
<         if (theEditingDomain instanceof InternalTransactionalEditingDomain){
<             InternalTransactionalEditingDomain internalEditingDomain = 
<                 (InternalTransactionalEditingDomain)theEditingDomain;
<             InternalTransaction transaction = internalEditingDomain.getActiveTransaction();
<             if (transaction!=null && !transaction.isReadOnly()){
<                 Object unprotectedMode = transaction.getOptions().get(Transaction.OPTION_UNPROTECTED); 
<                 if (unprotectedMode == null ||
<                     unprotectedMode == Boolean.FALSE)
<                 return true;
<             }
<         }
<         return false;
---
> 	final public EditPartViewer getViewer() {
> 		return getHost().getViewer();
1202a1189,1190
>     
>     
