13a14,16
> import java.lang.reflect.InvocationTargetException;
> 
> import org.eclipse.core.runtime.IProgressMonitor;
15c18
< import org.eclipse.emf.codegen.jet.JETException;
---
> import org.eclipse.gmf.common.UnexpectedBehaviourException;
69a73
> import org.eclipse.gmf.internal.common.codegen.TextEmitter;
76,77c80
< public class FigureGenerator {
< 	private final String packageName;
---
> public class FigureGenerator implements TextEmitter {
81,82c84,85
< 	public FigureGenerator(String aPackageName, ImportAssistant importManager, FigureQualifiedNameSwitch figureNameSwitch) {
< 		this(aPackageName, importManager, figureNameSwitch, new MapModeCodeGenStrategy.RuntimeUnspecifiedMapMode());
---
> 	public FigureGenerator(FigureQualifiedNameSwitch figureNameSwitch) {
> 		this(figureNameSwitch, new MapModeCodeGenStrategy.RuntimeUnspecifiedMapMode());
85,86c88
< 	public FigureGenerator(String aPackageName, ImportAssistant importManager, FigureQualifiedNameSwitch figureNameSwitch, MapModeCodeGenStrategy mapModeStrategy) {
< 		packageName = aPackageName;
---
> 	public FigureGenerator(FigureQualifiedNameSwitch figureNameSwitch, MapModeCodeGenStrategy mapModeStrategy) {
110c112
< 		myTopDispatcher = new GraphDefDispatcher(topFactory, keyMap, importManager, figureNameSwitch, mapModeStrategy);
---
> 		myTopDispatcher = new GraphDefDispatcher(topFactory, keyMap, figureNameSwitch, mapModeStrategy);
112,119c114
< 		myInnerDispatcher = new GraphDefDispatcher(innerFactory, keyMap, importManager, figureNameSwitch, mapModeStrategy);
< 	}
< 
< 	/**
< 	 * @return possibly <code>null</code>
< 	 */
< 	public String getPackageStatement() {
< 		return packageName;
---
> 		myInnerDispatcher = new GraphDefDispatcher(innerFactory, keyMap, figureNameSwitch, mapModeStrategy);
176c171,178
< 	public String go(Figure fig) throws JETException {
---
> 	public String generate(IProgressMonitor monitor, Object[] arguments) throws InterruptedException, InvocationTargetException, UnexpectedBehaviourException {
> 		if (arguments == null || arguments.length != 2 || false == arguments[0] instanceof Figure || false == arguments[1] instanceof ImportAssistant) {
> 			throw new UnexpectedBehaviourException("Single Figure expected as argument: " + arguments);
> 		}
> 		return go((Figure) arguments[0], (ImportAssistant) arguments[1]);
> 	}
> 
> 	public String go(Figure fig, ImportAssistant importManager) {
178c180,182
< 		Object args = new Object[] {fig, myTopDispatcher.getImportManager(), myTopDispatcher.getFQNSwitch(), myInnerDispatcher};
---
> 		myTopDispatcher.setImportManager(importManager);
> 		myInnerDispatcher.setImportManager(importManager);
> 		Object args = new Object[] {fig, importManager, myTopDispatcher.getFQNSwitch(), myInnerDispatcher};
183c187
< 		return packageName == null ? res : "package " + packageName + ";\n" + res;
---
> 		return res;
