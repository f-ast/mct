20a21
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
33a35
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
42c44
< import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeModelCommand;
---
> import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeTransactionalCommand;
76c78
< 	 			new SetBoundsCommand(
---
> 	 			new SetBoundsCommand(((ShapeEditPart) child).getEditingDomain(),
93a96,99
> 
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost())
>             .getEditingDomain();
>         
102c108
< 				ChangeGuideCommand cgm = new ChangeGuideCommand(view, true);
---
> 				ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain, view, true);
117c123
< 					ChangeGuideCommand cgm = new ChangeGuideCommand(view, true);
---
> 					ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain, view, true);
129c135
< 				ChangeGuideCommand cgm = new ChangeGuideCommand(view, false);
---
> 				ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain, view, false);
140c146
< 					ChangeGuideCommand cgm = new ChangeGuideCommand(view, false);
---
> 					ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain, view, false);
150c156
< 			ChangeGuideCommand cgm = new ChangeGuideCommand(view, true);
---
> 			ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain, view, true);
162c168
< 			cgm = new ChangeGuideCommand(view, false);
---
> 			cgm = new ChangeGuideCommand(editingDomain, view, false);
191a198,200
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost())
>             .getEditingDomain();
>         
193c202
<  			new SetBoundsCommand(
---
>  			new SetBoundsCommand(editingDomain,
226c235,240
< 		CompositeModelCommand cc = new CompositeModelCommand(DiagramUIMessages.AddCommand_Label);
---
> 
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost())
>             .getEditingDomain();
> 
> 		CompositeTransactionalCommand cc = new CompositeTransactionalCommand(
>             editingDomain, DiagramUIMessages.AddCommand_Label);
236c250
< 			cc.compose(new SetBoundsCommand(
---
> 			cc.compose(new SetBoundsCommand(editingDomain, 
242c256
< 		if( cc.unwrap() == null )
---
> 		if( cc.reduce() == null )
246c260
< 			new EtoolsProxyCommand(cc.unwrap()));
---
> 			new EtoolsProxyCommand(cc.reduce()));
355a370,372
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost())
>             .getEditingDomain();
> 
369,370c386,387
< 				ChangeGuideCommand cgm = new ChangeGuideCommand(editPartViewer,
< 					desc, true);
---
> 				ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain,
>                     editPartViewer, desc, true);
390,391c407,408
< 				ChangeGuideCommand cgm = new ChangeGuideCommand(editPartViewer,
< 					desc, false);
---
> 				ChangeGuideCommand cgm = new ChangeGuideCommand(editingDomain,
>                     editPartViewer, desc, false);
