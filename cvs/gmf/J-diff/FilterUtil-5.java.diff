108c108,112
< 		return sort(getChildReferencesOf(childReferences, mapping.getParentNode()));
---
> 		return sort(getChildrenOf(childReferences, mapping.getParentNode(), false));
> 	}
> 	
> 	public static Collection filterByNodeMapping(Collection compartments, ChildReference childReference) {
> 		return getChildrenOf(compartments, childReference.getParentNode(), true);
215c219
< 	private static Collection getChildReferencesOf(Collection childReferences, NodeMapping parentNode) {
---
> 	private static Collection getChildrenOf(Collection elements, EObject container, boolean addNull) {
217,220c221,224
< 		for (Iterator it = childReferences.iterator(); it.hasNext();) {
< 			ChildReference nextChildReference = (ChildReference) it.next();
< 			if (nextChildReference != null && nextChildReference.getParentNode() == parentNode) {
< 				result.add(nextChildReference);
---
> 		for (Iterator it = elements.iterator(); it.hasNext();) {
> 			EObject nextEObject = (EObject) it.next();
> 			if (nextEObject == null ? addNull : nextEObject.eContainer() == container) {
> 				result.add(nextEObject);
