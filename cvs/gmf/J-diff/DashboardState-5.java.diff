14a15
> import org.eclipse.core.runtime.IStatus;
16c17,19
< import org.eclipse.ui.IMemento;
---
> import org.eclipse.gmf.internal.bridge.ui.dashboard.Plugin;
> import org.osgi.service.prefs.BackingStoreException;
> import org.osgi.service.prefs.Preferences;
48a52,53
> 	private Preferences prefs;
> 
52,55c57,64
< 	public DashboardState(IMemento memento) {
< 		if (memento != null) {
< 			read(memento);
< 		}
---
> 	public DashboardState(Preferences prefs) {
> 		this.prefs = prefs;
> 		dm = read(DM_KEY);
> 		dgm = read(DGM_KEY);
> 		gdm = read(GDM_KEY);
> 		tdm = read(TDM_KEY);
> 		mm = read(MM_KEY);
> 		gm = read(GM_KEY);
83a93
> 		write(DM_KEY, dm);
87a98
> 		write(DGM_KEY, dgm);
91a103
> 		write(GDM_KEY, gdm);
95a108
> 		write(TDM_KEY, tdm);
99a113
> 		write(MM_KEY, mm);
103a118
> 		write(GM_KEY, gm);
107a123
> 		write(DM_KEY, dm);
111a128
> 		write(DGM_KEY, dgm);
115a133
> 		write(GDM_KEY, gdm);
119a138
> 		write(TDM_KEY, tdm);
123a143
> 		write(MM_KEY, mm);
127a148
> 		write(GM_KEY, gm);
164,170c185,187
< 	private void read(IMemento memento) {
< 		dm = read(memento, DM_KEY);
< 		dgm = read(memento, DGM_KEY);
< 		gdm = read(memento, GDM_KEY);
< 		tdm = read(memento, TDM_KEY);
< 		mm = read(memento, MM_KEY);
< 		gm = read(memento, GM_KEY);
---
> 	private URI read(String key) {
> 		if (prefs == null) {
> 			return null;
172,174c189
< 
< 	private static URI read(IMemento memento, String key) {
< 		String s = memento.getString(key);
---
> 		String s = prefs.get(key, null);
180a196,197
> 			IStatus status = Plugin.createError("Invalid URI", e);
> 			Plugin.getDefault().getLog().log(status);
185,194c202
< 	public void write(IMemento memento) {
< 		write(memento, DM_KEY, dm);
< 		write(memento, DGM_KEY, dgm);
< 		write(memento, GDM_KEY, gdm);
< 		write(memento, TDM_KEY, tdm);
< 		write(memento, MM_KEY, mm);
< 		write(memento, GM_KEY, gm);
< 	}
< 
< 	private static void write(IMemento memento, String key, URI uri) {
---
> 	private void write(String key, URI uri) {
199c207,213
< 		memento.putString(key, s);
---
> 		prefs.put(key, s);
> 		try {
> 			prefs.flush();
> 		} catch (BackingStoreException e) {
> 			IStatus status = Plugin.createError("Unable to update state", e);
> 			Plugin.getDefault().getLog().log(status);
> 		}
