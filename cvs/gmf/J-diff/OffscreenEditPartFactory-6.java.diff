14,17c14
< import org.eclipse.gef.GraphicalViewer;
< import org.eclipse.jface.util.Assert;
< import org.eclipse.swt.widgets.Shell;
< 
---
> import org.eclipse.gef.RootEditPart;
18a16
> import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramRootEditPart;
23a22,24
> import org.eclipse.jface.preference.IPreferenceStore;
> import org.eclipse.jface.util.Assert;
> import org.eclipse.swt.widgets.Shell;
55c56
< 		GraphicalViewer customViewer = new DiagramGraphicalViewer();
---
> 		DiagramGraphicalViewer customViewer = new DiagramGraphicalViewer();
64,65c65,75
< 		customViewer.setRootEditPart(EditPartService.getInstance()
< 			.createRootEditPart(diagram));
---
> 		// hook in preferences
> 		RootEditPart rep = EditPartService.getInstance()
> 		.createRootEditPart(diagram);
> 		if (rep instanceof DiagramRootEditPart) {
> 			DiagramRootEditPart drep = (DiagramRootEditPart)rep;
> 			IPreferenceStore fPreferences = (IPreferenceStore) drep.getPreferencesHint().getPreferenceStore();
> 
> 			customViewer.hookWorkspacePreferenceStore(fPreferences);
> 		}
> 		
> 		customViewer.setRootEditPart(rep);
72a83
> 		
