28a29
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.AbstractRenderedImage;
54,59c55,64
< 	 * @param fill the <code>Color</code> of the fill that could instrumented into image formats that
< 	 * support dynamic color replacement.  Typically, this would replace colors in the image which are "white"
< 	 * i.e. RGB(255,255,255)
< 	 * @param outline the <code>Color</code> of the outline that could instrumented into image formats that
< 	 * support dynamic color replacement.  Typically, this would replace colors in the image which are "black"
< 	 * i.e. RGB(0,0,0)
---
> 	 * @param fill
> 	 *            the <code>Color</code> of the fill that could instrumented
> 	 *            into image formats that support dynamic color replacement.
> 	 *            Typically, this would replace colors in the image which are
> 	 *            "white" i.e. RGB(255,255,255)
> 	 * @param outline
> 	 *            the <code>Color</code> of the outline that could
> 	 *            instrumented into image formats that support dynamic color
> 	 *            replacement. Typically, this would replace colors in the image
> 	 *            which are "black" i.e. RGB(0,0,0)
61,62c66,68
< 	 *            <code>boolean</code> <code>true</code> if aspect ratio of original vector file is
< 	 *            maintained, <code>false</code> otherwise
---
> 	 *            <code>boolean</code> <code>true</code> if aspect ratio of
> 	 *            original vector file is maintained, <code>false</code>
> 	 *            otherwise
64,67c70,74
< 	 * 			  <code>boolean</code> <code>true</code> if the image is to be rendered using anti-aliasing
< 	 * 			 (removing "jaggies" producing smoother lines), <code>false</code> otherwise
< 	 * @return <code>RenderInfo</code> object that contains information about the rendered
< 	 *         image.
---
> 	 *            <code>boolean</code> <code>true</code> if the image is to
> 	 *            be rendered using anti-aliasing (removing "jaggies" producing
> 	 *            smoother lines), <code>false</code> otherwise
> 	 * @return <code>RenderInfo</code> object that contains information about
> 	 *         the rendered image.
89,90c96,97
< 	 * instance of the immutable class <code>RenderedImage</code>. This method is used to read
< 	 * svg images from JARs.
---
> 	 * instance of the immutable class <code>RenderedImage</code>. This
> 	 * method is used to read svg images from JARs.
94c101,102
< 	 * @return <code>RenderedImage</code> instance with the size dimensions requested.
---
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.
102,103c110,111
< 	 * instance of the immutable class <code>RenderedImage</code>. This method is used to read
< 	 * svg images from JARs.
---
> 	 * instance of the immutable class <code>RenderedImage</code>. This
> 	 * method is used to read svg images from JARs.
111c119,120
< 	 * @return <code>RenderedImage</code> instance with the size dimensions requested.
---
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.
140c149,150
< 	 * @return <code>RenderedImage</code> instance with the size dimensions requested.
---
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.
153,155c163,167
< 	 * 			  <code>RenderInfo</code> object containing information about the size and general data
< 	 *            regarding how the image will be rendered.
< 	 * @return <code>RenderedImage</code> instance with the size dimensions requested.
---
> 	 *            <code>RenderInfo</code> object containing information about
> 	 *            the size and general data regarding how the image will be
> 	 *            rendered.
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.
181,182c193,196
< 	 *            <code>byte[]</code> array containing an cached SVG image file.
< 	 * @return the <code>RenderedImage</code> that encapsulates the contents of the given byte buffer.
---
> 	 *            <code>byte[]</code> array containing an cached SVG image
> 	 *            file.
> 	 * @return the <code>RenderedImage</code> that encapsulates the contents
> 	 *         of the given byte buffer.
188a203,233
> 	 * Returns a related instance of the given <code>RenderedImage</code> that
> 	 * is based on the same byte stream or file info but instrumented for the
> 	 * passed in <code>RenderInfo</code> object
> 	 * 
> 	 * @param image
> 	 *            <code>RenderedImage</code> that is used as a base to
> 	 *            retrieve the related instance.
> 	 * @param info
> 	 *            <code>RenderInfo</code> object containing information about the size 
> 	 *            and general data regarding how the image will be rendered.
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.  May return <code>null</code> if no related instance
> 	 *         can be found or if the original buffer cannot be retrieved.
> 	 */
> 	static public RenderedImage getRelatedInstance(RenderedImage image, RenderInfo info) {
> 		if (image instanceof AbstractRenderedImage) {
> 			RenderedImageKey oldKey = ((AbstractRenderedImage)image).getKey();
> 			RenderedImageKey key = new RenderedImageKey(oldKey.getChecksum(), info, oldKey.getExtraData());
> 			WeakReference ref = (WeakReference)instanceMap.get(key);
> 			if (ref != null) {
> 				return (RenderedImage)ref.get();
> 			}
> 			else {
> 				return autodetectImage(((AbstractRenderedImage)image).getBuffer(), key);
> 			}
> 		}
> 		
> 		return null;
> 	}
> 	
> 	/**
197c242,243
< 	 * @return <code>RenderedImage</code> instance with the size dimensions requested.
---
> 	 * @return <code>RenderedImage</code> instance with the size dimensions
> 	 *         requested.
205c251
< 		final RenderedImageKey key = new RenderedImageKey(checksum.getValue(), info);
---
> 		final RenderedImageKey key = new RenderedImageKey(checksum.getValue(), info, null);
209a256,263
> 		else
> 			image = autodetectImage(buffer, key);
> 	
> 		return image;
> 	}
> 
> 	private static RenderedImage autodetectImage(byte[] buffer, final RenderedImageKey key) {
> 		RenderedImage image = null;
211d264
< 		if (image == null) {
235c288
< 			if (image != null)
---
> 		if (image != null) {
