27a28
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapModeUtil;
31,32d31
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
< 
97c96
< 	private static class IconInfo {
---
> 	private class IconInfo {
142,143c141,143
< 				org.eclipse.swt.graphics.Rectangle bounds = img.getBounds();
< 				return new Dimension(MapMode.DPtoLP(bounds.width), MapMode.DPtoLP(bounds.height));
---
> 				org.eclipse.swt.graphics.Rectangle imgBounds = img.getBounds();
> 				return new Dimension(MapModeUtil.getMapMode(WrapLabel.this).DPtoLP(imgBounds.width), 
> 									MapModeUtil.getMapMode(WrapLabel.this).DPtoLP(imgBounds.height));
481c481
< 		return MapMode.DPtoLP(3);
---
> 		return MapModeUtil.getMapMode(this).DPtoLP(3);
545c545
< 		int fontHeight = MapMode.DPtoLP(FigureUtilities.getFontMetrics(f).getHeight());
---
> 		int fontHeight = MapModeUtil.getMapMode(this).DPtoLP(FigureUtilities.getFontMetrics(f).getHeight());
600c600
< 			int fontHeight = MapMode.DPtoLP(FigureUtilities.getFontMetrics(f).getHeight());
---
> 			int fontHeight = MapModeUtil.getMapMode(this).DPtoLP(FigureUtilities.getFontMetrics(f).getHeight());
803c803
< 		int fontHeight = MapMode.DPtoLP(FigureUtilities.getFontMetrics(f)
---
> 		int fontHeight = MapModeUtil.getMapMode(this).DPtoLP(FigureUtilities.getFontMetrics(f)
811c811
< 			int offset = MapMode.DPtoLP(2); // 2 is the leading area for default English
---
> 			int offset = MapModeUtil.getMapMode(this).DPtoLP(2); // 2 is the leading area for default English
832c832,833
< 			if (getTextExtents(token, f).width + x <= clipRect.getTopRight().x) {
---
> 			
> 			if (tokenWidth + x <= clipRect.getTopRight().x) {
834c835
< 				newClipRect.width += getTextExtents(token.substring(token.length() - 1), f).width / 2;
---
> 				newClipRect.width += (tokenWidth / token.length()) / 2;
1258c1259,1260
< 			.expand(new Insets(MapMode.DPtoLP(2), MapMode.DPtoLP(2), 0, 0));
---
> 			.expand(new Insets(MapModeUtil.getMapMode(this).DPtoLP(2), 
> 							MapModeUtil.getMapMode(this).DPtoLP(2), 0, 0));
1272c1274
< 	private static int getLineWrapPosition(String s, Font f, int w) {
---
> 	private int getLineWrapPosition(String s, Font f, int w) {
1306c1308
< 	private static int getLargestSubstringConfinedTo(String s, Font f, int w) {
---
> 	private int getLargestSubstringConfinedTo(String s, Font f, int w) {
1308c1310
< 		float avg = MapMode.DPtoLP(FigureUtilities.getFontMetrics(f)
---
> 		float avg = MapModeUtil.getMapMode(this).DPtoLP(FigureUtilities.getFontMetrics(f)
1342c1344
< 	private static Dimension getTextExtents(String s, Font f) {
---
> 	private Dimension getTextExtents(String s, Font f) {
1344c1346,1347
< 		return new Dimension(MapMode.DPtoLP(d.width), MapMode.DPtoLP(d.height));
---
> 		return new Dimension(MapModeUtil.getMapMode(this).DPtoLP(d.width), 
> 							MapModeUtil.getMapMode(this).DPtoLP(d.height));
