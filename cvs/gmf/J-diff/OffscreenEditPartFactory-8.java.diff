16a17
> import org.eclipse.gmf.runtime.diagram.core.preferences.PreferencesHint;
18c19
< import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramRootEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IDiagramPreferenceSupport;
57c58,77
< 		Shell shell = new Shell();
---
>         return createDiagramEditPart(diagram, new Shell(), null);
> 	}
>     
>     /**
>      * Creates a <code>DiagramEditPart</code> given the <code>Diagram</code>
>      * without opening an editor.
>      * 
>      * @param diagram
>      *            the <code>Diagram</code>
>      * @param shell
>      *            the shell
>      * @param preferencesHint
>      *            the preferences hint to be used when creating the diagram; if
>      *            null, the preferences hint from the root editpart will be
>      *            used.
>      * @return the new populated <code>DiagramEditPart</code>
>      */
>      public DiagramEditPart createDiagramEditPart(
>         Diagram diagram, Shell shell, PreferencesHint preferencesHint) {     
>         
68,74c88,100
< 		RootEditPart rep = EditPartService.getInstance()
< 		.createRootEditPart(diagram);
< 		if (rep instanceof DiagramRootEditPart) {
< 			DiagramRootEditPart drep = (DiagramRootEditPart)rep;
< 			IPreferenceStore fPreferences = (IPreferenceStore) drep.getPreferencesHint().getPreferenceStore();
< 
< 			customViewer.hookWorkspacePreferenceStore(fPreferences);
---
>         RootEditPart rootEP = EditPartService.getInstance().createRootEditPart(
>             diagram);
>         if (rootEP instanceof IDiagramPreferenceSupport) {
>             if (preferencesHint == null) {
>                 preferencesHint = ((IDiagramPreferenceSupport) rootEP)
>                     .getPreferencesHint();
>             } else {
>                 ((IDiagramPreferenceSupport) rootEP)
>                     .setPreferencesHint(preferencesHint);
>             }
>             customViewer
>                 .hookWorkspacePreferenceStore((IPreferenceStore) preferencesHint
>                     .getPreferenceStore());
77c103
< 		customViewer.setRootEditPart(rep);
---
>         customViewer.setRootEditPart(rootEP);
86d111
< 		
89a115
> 
90a117
> 
