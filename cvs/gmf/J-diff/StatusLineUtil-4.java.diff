2c2
<  * Copyright (c) 2004 IBM Corporation and others.
---
>  * Copyright (c) 2004, 2006 IBM Corporation and others.
14a15
> import org.eclipse.swt.widgets.Display;
18a20
> import org.eclipse.ui.PlatformUI;
26a29
> 
32c35,38
< 	 * Outputs an error message to the part's status line
---
>      * Outputs an error message to the part's status line. Does nothing if the
>      * status line manager cannot be determined from the <code>part</code>.
>      * <P>
>      * Can be invoked from a non-UI thread.
34,35c40,43
< 	 * @param part the part
< 	 * @param errorMessage the error message
---
>      * @param part
>      *            the part
>      * @param errorMessage
>      *            the error message
37,39c45,55
< 	public static void outputErrorMessage(IWorkbenchPart part, String errorMessage) {
< 		if (part instanceof IViewPart) {
< 			IViewPart viewPart = (IViewPart) part;
---
>     public static void outputErrorMessage(IWorkbenchPart part,
>             final String errorMessage) {
> 
>         final IStatusLineManager statusLineManager = getStatusLineManager(part);
> 
>         if (statusLineManager == null) {
>             // can't find the status line manager
>             return;
>         }
> 
>         final Display workbenchDisplay = PlatformUI.getWorkbench().getDisplay();
41,42c57,62
< 			IStatusLineManager statusLineManager =
< 				viewPart.getViewSite().getActionBars().getStatusLineManager();
---
>         if (workbenchDisplay.getThread() == Thread.currentThread()) {
>             // we're already on the UI thread
>             statusLineManager.setErrorMessage(errorMessage);
>         } else {
>             // we're not on the UI thread
>             workbenchDisplay.asyncExec(new Runnable() {
43a64
>                 public void run() {
44a66,78
>                 }
>             });
>         }
>     }
> 
>     private static IStatusLineManager getStatusLineManager(IWorkbenchPart part) {
> 
>         IStatusLineManager result = null;
> 
>         if (part instanceof IViewPart) {
>             IViewPart viewPart = (IViewPart) part;
>             result = viewPart.getViewSite().getActionBars()
>                 .getStatusLineManager();
49,55c83,84
< 			IEditorActionBarContributor contributor =
< 				editorPart.getEditorSite().getActionBarContributor();
< 			if (contributor instanceof EditorActionBarContributor) {
< 				IStatusLineManager statusLineManager =
< 					((EditorActionBarContributor) contributor)
< 						.getActionBars()
< 						.getStatusLineManager();
---
>             IEditorActionBarContributor contributor = editorPart
>                 .getEditorSite().getActionBarContributor();
57c86,88
< 				statusLineManager.setMessage(errorMessage);
---
>             if (contributor instanceof EditorActionBarContributor) {
>                 result = ((EditorActionBarContributor) contributor)
>                     .getActionBars().getStatusLineManager();
59a91
>         return result;
