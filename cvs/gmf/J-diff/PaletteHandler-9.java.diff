2c2
<  * Copyright (c) 2006 Borland Software Corporation
---
>  * Copyright (c) 2006, 2007 Borland Software Corporation
13a14
> import java.util.ArrayList;
15d15
< import java.util.Iterator;
24,25d23
< import org.eclipse.emf.common.util.BasicEList;
< import org.eclipse.emf.common.util.EList;
86d83
< 	@SuppressWarnings("unchecked")
92,97c89,94
< 		List groupItems = new ToolSwitch(myToolHistory).toGroupItems(palette.getTools());
< 		EList topLevelTools = new BasicEList();
< 		for (Iterator it = groupItems.iterator(); it.hasNext(); ) {
< 			ToolGroupItem next = (ToolGroupItem) it.next();
< 			if (false == next instanceof ToolGroup) {
< 				it.remove();
---
> 		ArrayList<ToolGroup> groups = new ArrayList<ToolGroup>(palette.getTools().size());
> 		ArrayList<ToolGroupItem> topLevelTools = new ArrayList<ToolGroupItem>(palette.getTools().size());
> 		for (ToolGroupItem next : new ToolSwitch(myToolHistory).toGroupItems(palette.getTools())) {
> 			if (next instanceof ToolGroup) {
> 				groups.add((ToolGroup) next);
> 			} else {
109c106
< 		getGenPalette().getGroups().addAll(groupItems);
---
> 		getGenPalette().getGroups().addAll(groups);
122d118
< 	@SuppressWarnings("unchecked")
133d128
< 	@SuppressWarnings("unchecked")
171d165
< 	@SuppressWarnings("unchecked")
212c206
< 	private static class ToolSwitch extends GMFToolSwitch {
---
> 	private static class ToolSwitch extends GMFToolSwitch<ToolGroupItem> {
224c218
< 				ToolGroupItem value = (ToolGroupItem) doSwitch(next);
---
> 				ToolGroupItem value = doSwitch(next);
235c229
< 		public Object casePaletteSeparator(PaletteSeparator object) {
---
> 		public ToolGroupItem casePaletteSeparator(PaletteSeparator object) {
239c233
< 		public Object caseCreationTool(CreationTool tool) {
---
> 		public ToolGroupItem caseCreationTool(CreationTool tool) {
245c239
< 		public Object caseStandardTool(StandardTool standardTool) {
---
> 		public ToolGroupItem caseStandardTool(StandardTool standardTool) {
265c259
< 		public Object caseGenericTool(GenericTool tool) {
---
> 		public ToolGroupItem caseGenericTool(GenericTool tool) {
276,277c270
< 		@SuppressWarnings("unchecked")
< 		public Object caseToolGroup(org.eclipse.gmf.tooldef.ToolGroup toolGroup) {
---
> 		public ToolGroupItem caseToolGroup(org.eclipse.gmf.tooldef.ToolGroup toolGroup) {
