2c2
<  * Copyright (c) 2004, 2007 IBM Corporation and others.
---
>  * Copyright (c) 2004, 2008 IBM Corporation and others.
23d22
< import org.eclipse.gmf.runtime.diagram.ui.commands.ICommandProxy;
24a24
> import org.eclipse.gmf.runtime.diagram.ui.commands.ICommandProxy;
35a36
>  * as well as using context menu "Delete from model"
43a45,48
> 	/**
> 	 * used to distinguish context menu calls from keyboard calls (the only difference is in calculating enablement) 
> 	 */
> 	private boolean calledFromContextMenu;
51a57
> 		calledFromContextMenu = false;
59a66
> 		calledFromContextMenu = false;
62d68
< 	
64,65c70,71
< 	 *  Return the semantic request to destroy the element
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction#createTargetRequest()
---
> 	 * Creates a <code>PromptingDeleteFromModelAction</code> with a default label.
> 	 * @param workbenchPage The page this action will be associated with.
67,79c73,75
< 	protected Request createTargetRequest() {
< 		
< 		boolean shouldPrompt = ((IPreferenceStore) getPreferencesHint()
< 			.getPreferenceStore())
< 			.getBoolean(IPreferenceConstants.PREF_PROMPT_ON_DEL_FROM_MODEL);
<         
< 		TransactionalEditingDomain editingDomain = getEditingDomain();
<         if (editingDomain != null) {
<             DestroyElementRequest destroyRequest = new DestroyElementRequest(
<                 editingDomain, shouldPrompt);
<             return new EditCommandRequestWrapper(destroyRequest);
<         }
<         return null;
---
> 	public PromptingDeleteFromModelAction(IWorkbenchPage workbenchPage, boolean fromContextMenu) {
> 		super(workbenchPage);
> 		calledFromContextMenu = fromContextMenu;
82,83c78,82
< 	
< 	/* (non-Javadoc)
---
> 	/**
> 	 * Calculates enablement of this action. 
> 	 * 
> 	 * @return <code>true</code> if call is made via keyboard, or from context menu and action should be enabled,
> 	 *         <code>false</code> otherwise
86a86,90
> 		if (calledFromContextMenu) {
> 			// Need to calculate enablement.
> 			return super.calculateEnabled();
> 		} else {
> 			// for calls from keyboard, always return true for performance reasons
88a93
> 	}
91c96,98
< 	/* (non-Javadoc)
---
> 	/** First gets the delete command, where target request is modified to include the information about
> 	 * whether confirmation prompt should be issued. Then it runs the obtained command.
> 	 * 
95c102,108
< 		setTargetRequest(null);
---
> 		Request req = getTargetRequest();
> 		boolean showInformationDialog = ((IPreferenceStore) getPreferencesHint()
> 					.getPreferenceStore())
> 					.getBoolean(IPreferenceConstants.PREF_PROMPT_ON_DEL_FROM_MODEL);
> 		DestroyElementRequest targetRequest = (DestroyElementRequest)((EditCommandRequestWrapper)req).getEditCommandRequest();		
> 		targetRequest.setConfirm(showInformationDialog);
> 
110a124,136
> 	/**
> 	 *  Return the semantic request to destroy the element
> 	 * @see org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction#createTargetRequest()
> 	 */
> 	protected Request createTargetRequest() {		
> 		TransactionalEditingDomain editingDomain = getEditingDomain();
>         if (editingDomain != null) {
>             DestroyElementRequest destroyRequest = new DestroyElementRequest(
>                 editingDomain, false);
>             return new EditCommandRequestWrapper(destroyRequest);
>         }
>         return null;
> 	}
