22d21
< import org.eclipse.gmf.common.codegen.ImportAssistant;
23a23
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
36,37d35
< 	private static final String VAR_OUTPUT_METHODS = "outputAdditionalMethods";
< 	private static final String VAR_PACKAGE_STMT = "packageStatement";
41d38
< 	private static final String SLOT_METHODS = "additionalMethods";
47,50d43
< 	private Variable packageStatement;
< 
< 	private StringBuilder additionalMethods;
< 
54a48,49
> 	private String packageStatement;
> 
61,62c56,57
< 	public FigureGenerator(String runtimeToken, boolean asInnerClass) {
< 		this(runtimeToken, MapModeCodeGenStrategy.DYNAMIC, "getMapMode().", asInnerClass);
---
> 	public FigureGenerator(String runtimeToken, String packageStmt, boolean asInnerClass) {
> 		this(runtimeToken, packageStmt, MapModeCodeGenStrategy.DYNAMIC, "getMapMode().", asInnerClass);
65,66c60,61
< 	public FigureGenerator(String runtimeToken, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass) {
< 		this(runtimeToken, mapModeStrategy, mapModeAccessor, asInnerClass, null);
---
> 	public FigureGenerator(String runtimeToken, String packageStmt, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass) {
> 		this(runtimeToken, packageStmt, mapModeStrategy, mapModeAccessor, asInnerClass, null);
69c64
< 	public FigureGenerator(String runtimeToken, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass, URL[] dynamicTemplates) {
---
> 	public FigureGenerator(String runtimeToken, String packageStmt, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass, URL[] dynamicTemplates) {
70a66
> 		this.packageStatement = packageStmt;
83,90d78
< 		packageStatement = new Variable(VAR_PACKAGE_STMT, "");
< 		globals.add(packageStatement);
< 		additionalMethods = new StringBuilder();
< 		globals.add(new Variable(VAR_OUTPUT_METHODS, "") {
< 			public Object getValue() {
< 				return additionalMethods.toString();
< 			}
< 		});
99d86
< 		slots.put(SLOT_METHODS, additionalMethods);
107c94,98
< 	public String go(Figure figure, ImportAssistant importAssistant) {
---
> 	public String getPackageName() {
> 		return packageStatement;
> 	}
> 
> 	public String fqnSwitch(Figure figure) {
109d99
< 		additionalMethods.setLength(0);
111,116c101,117
< 		StringBuffer ss = new StringBuffer();
< 		importAssistant.emitPackageStatement(ss);
< 		packageStatement.setValue(ss.toString());
< 		xpandFacade.evaluate("top::Figure::FigureClass", figure, new Object[] {myIsInnerClassCode});
< 		final String resultString = result.toString();
< 		return resultString;
---
> 		xpandFacade.evaluate("Runtime::fqn", figure, null);
> 		return result.toString();
> 	}
> 	
> 	/**
> 	 * @param packageStmt can be null if asInnerClass was true
> 	 * @param figure
> 	 */
> 	public String go(FigureDescriptor figure) {
> 		result.setLength(0);
> 		additionalFields.setLength(0);
> 		if (myIsInnerClassCode) {
> 			xpandFacade.evaluate("top::Descriptor::Inner", figure, null);
> 		} else {
> 			xpandFacade.evaluate("top::Descriptor::Top", figure, new Object[] { packageStatement });
> 		}
> 		return result.toString();
120,121c121,122
< 		if (arguments == null || arguments.length != 2 || false == arguments[0] instanceof Figure || false == arguments[1] instanceof ImportAssistant) {
< 			throw new UnexpectedBehaviourException("(Figure, ImportAssistant) expected as arguments, not " + arguments);
---
> 		if (arguments == null || arguments.length != 1 || false == arguments[0] instanceof FigureDescriptor) {
> 			throw new UnexpectedBehaviourException("(FigureDescriptor) expected as arguments, not " + arguments);
123c124
< 		return go((Figure) arguments[0], (ImportAssistant) arguments[1]);
---
> 		return go((FigureDescriptor) arguments[0]);
