12d11
< 
15a15
> import org.eclipse.draw2d.geometry.Dimension;
17,18d16
< import org.eclipse.swt.graphics.Image;
< 
19a18
> import org.eclipse.gmf.runtime.draw2d.ui.internal.mapmode.DiagramMapModeUtil;
21d19
< import org.eclipse.gmf.runtime.draw2d.ui.render.RenderInfo;
24c22,23
< 
---
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.RenderHelper;
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.RenderingListener;
32c31,44
< 	extends MapModeGraphics implements DrawableRenderedImage {
---
> 	extends MapModeGraphics
> 	implements DrawableRenderedImage {
> 
> 	boolean allowDelayRender = false;
> 	Dimension maximumRenderSize = null;
> 
> 	/*
> 	 * (non-Javadoc)
> 	 * 
> 	 * @see org.eclipse.gmf.runtime.draw2d.ui.render.internal.DrawableRenderedImage#allowDelayRender()
> 	 */
> 	public boolean shouldAllowDelayRender() {
> 		return allowDelayRender;
> 	}
36,37c48,52
< 	 * @param g <code>Graphics</code> element to delegate render to
< 	 * @param mm <code>IMapMode</code> to retrieve the scale factor from.
---
> 	 * 
> 	 * @param g
> 	 *            <code>Graphics</code> element to delegate render to
> 	 * @param mm
> 	 *            <code>IMapMode</code> to retrieve the scale factor from.
39a55,68
> 		this(g, mm, false, null);
> 	}
> 
> 	/**
> 	 * Constructor
> 	 * 
> 	 * @param g
> 	 *            <code>Graphics</code> element to delegate render to
> 	 * @param mm
> 	 *            <code>IMapMode</code> to retrieve the scale factor from.
> 	 * @param allowDelayRender
> 	 */
> 	public RenderedMapModeGraphics(Graphics g, IMapMode mm,
> 			boolean allowDelayRender, Dimension maximumRenderSize) {
40a70,71
> 		this.allowDelayRender = allowDelayRender;
> 		this.maximumRenderSize = maximumRenderSize;
45c76,79
< 	 * @see org.eclipse.gmf.runtime.draw2d.ui.render.internal.DrawableRenderedImage#drawRenderedImage(org.eclipse.gmf.runtime.draw2d.ui.render.RenderedImage, int, int, int, int)
---
> 	 * 
> 	 * @see org.eclipse.gmf.runtime.draw2d.ui.render.internal.DrawableRenderedImage#drawRenderedImage(org.eclipse.gmf.runtime.draw2d.ui.render.RenderedImage,
> 	 *      org.eclipse.draw2d.geometry.Rectangle,
> 	 *      org.eclipse.gmf.runtime.draw2d.ui.render.RenderingListener)
47,64c81,85
< 	public RenderedImage drawRenderedImage(RenderedImage srcImage, int x, int y, int width, int height) {
< 		if (getGraphics() instanceof DrawableRenderedImage) {
< 			Rectangle r = zoomRect(x, y, width, height);
< 			return ((DrawableRenderedImage)getGraphics()).drawRenderedImage(srcImage, r.x, r.y, r.width, r.height);
< 		}
< 		else {
< 			Rectangle r = zoomRect(x, y, width, height);
< 			RenderInfo info = srcImage.getRenderInfo();
< 			info.setValues(r.width, r.height, 
< 							info.getFillColor(), info.getOutlineColor(), 
< 							info.shouldMaintainAspectRatio(), info.shouldAntiAlias());
< 			
< 			RenderedImage img = srcImage.getNewRenderedImage(info);
< 			
< 			Image swtImg = img.getSWTImage();
< 			if (swtImg!=null)
< 				getGraphics().drawImage(swtImg, r.x, r.y + r.height - swtImg.getBounds().height);
< 			return img;
---
> 	public RenderedImage drawRenderedImage(RenderedImage srcImage,
> 			Rectangle rect, RenderingListener listener) {
> 		return RenderHelper.getInstance(
> 			DiagramMapModeUtil.getScale(getMapMode()), true, shouldAllowDelayRender(), getMaximumRenderSize()).drawRenderedImage(getGraphics(),
> 			srcImage, rect, listener);
65a87,93
> 	
> 	/* (non-Javadoc)
> 	 * @see org.eclipse.gmf.runtime.draw2d.ui.render.internal.DrawableRenderedImage#getMaximumRenderSize()
> 	 */
> 	public Dimension getMaximumRenderSize() {
> 		// TODO Auto-generated method stub
> 		return maximumRenderSize;
