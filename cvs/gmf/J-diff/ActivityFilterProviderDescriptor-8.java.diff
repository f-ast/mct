17,21c17
< import org.eclipse.ui.IPluginContribution;
< import org.eclipse.ui.PlatformUI;
< import org.eclipse.ui.activities.IIdentifier;
< import org.eclipse.ui.activities.IWorkbenchActivitySupport;
< import org.eclipse.ui.activities.WorkbenchActivityHelper;
---
> import org.eclipse.gmf.runtime.common.ui.util.ActivityUtil;
45,47c41,45
< 		if (getElement().isValid())
< 			return areActivitiesEnabled();
< 		return true;
---
>         if (getElement().isValid()) {
>             return ActivityUtil
>                 .isEnabled(getElement().getDeclaringExtension()
>                     .getSimpleIdentifier(), getElement().getContributor()
>                     .getName());
49,58d46
< 
< 	/**
< 	 * Checks if there are activities that have been matched to the plug-in in
< 	 * which the provider has been contributed and if those activities are
< 	 * enabled.
< 	 * 
< 	 * @return true if matching activities are enabled
< 	 */
< 	private boolean areActivitiesEnabled() {
< 		if (!WorkbenchActivityHelper.isFiltering())
60,78d47
< 
< 		IWorkbenchActivitySupport workbenchActivitySupport = PlatformUI
< 			.getWorkbench().getActivitySupport();
< 		IIdentifier id = workbenchActivitySupport.getActivityManager()
< 			.getIdentifier(
< 				WorkbenchActivityHelper
< 					.createUnifiedId(new IPluginContribution() {
< 
< 						public String getLocalId() {
< 							return getElement().getDeclaringExtension()
< 								.getSimpleIdentifier();
< 						}
< 
< 						public String getPluginId() {
< 							return getElement().getContributor().getName();
< 						}
< 					}));
< 		if (id != null && !id.isEnabled()) {
< 			return false;
81,82d49
< 		return true;
< 	}
