2c2
<  * Copyright (c) 2005, 2006 IBM Corporation and others.
---
>  * Copyright (c) 2005, 2008 IBM Corporation and others.
13a14,17
> import org.eclipse.core.runtime.IProgressMonitor;
> import org.eclipse.core.runtime.IStatus;
> import org.eclipse.core.runtime.Status;
> import org.eclipse.core.runtime.jobs.Job;
26d29
< import org.eclipse.swt.widgets.Display;
30a34
> import org.eclipse.ui.progress.UIJob;
42,43c46,47
< 	 * The <code>Runnable</code> used when a timer is started to show the
< 	 * diagram assistant after a certain amount of time has passed.
---
> 	 * The <code>Job</code> used to show the diagram assistant after a certain
> 	 * amount of time has passed.
45,46c49,50
< 	private class ShowDiagramAssistantRunnable
< 		implements Runnable {
---
> 	private class ShowDiagramAssistantJob
> 		extends UIJob {
48c52
< 		/** the mouse location when the timer was started */
---
> 		/** the mouse location when the job was created */
51a56,63
>          * Creates a new instance.
>          */
>         protected ShowDiagramAssistantJob() {
>             super("Show Diagram Assistant"); //$NON-NLS-1$
>             setSystem(true);
>         }
> 
> 		/**
66,67c78,80
< 		public void run() {
< 			if (originalMouseLocation != null && originalMouseLocation.equals(getMouseLocation())) {
---
> 		public IStatus runInUIThread(IProgressMonitor monitor) {
> 			if (originalMouseLocation != null
> 				&& originalMouseLocation.equals(getMouseLocation())) {
72a86,97
> 
>                     // Cancel the hide diagram assistant job for this host if it
>                     // is waiting to run.
>                     hideDiagramAssistantJob.cancel();
> 
>                     // Schedule any hide diagram assistant jobs on other
>                     // editparts to run immediately to avoid duplicate diagram
>                     // assistants showing.
>                     if (getDiagramAssistantID() != null) {
>                         Job.getJobManager().wakeUp(getDiagramAssistantID());
>                     }
> 
75a101
> 			return Status.OK_STATUS;
80,81c106,107
< 	 * The <code>Runnable</code> used when a timer is started to hide the
< 	 * diagram assistant after a certain amount of time has passed.
---
> 	 * The <code>Job</code> used to hide the diagram assistant after a certain
> 	 * amount of time has passed.
83,84c109,115
< 	private class HideDiagramAssistantRunnable implements Runnable
< 	{
---
> 	private class HideDiagramAssistantJob
>         extends UIJob {
> 
>         protected HideDiagramAssistantJob() {
>             super("Hide Diagram Assistant"); //$NON-NLS-1$
>             setSystem(true);
>         }
90c121
< 		public void run() {
---
> 		public IStatus runInUIThread(IProgressMonitor monitor) {
94a126,130
> 			return Status.OK_STATUS;
> 		}
> 
>         public boolean belongsTo(Object family) {
>             return family == getDiagramAssistantID();
151,152c187,189
< 	private ShowDiagramAssistantRunnable showDiagramAssistantRunnable = new ShowDiagramAssistantRunnable();
< 	private HideDiagramAssistantRunnable hideDiagramAssistantRunnable = new HideDiagramAssistantRunnable();
---
> 	private ShowDiagramAssistantJob showDiagramAssistantJob = new ShowDiagramAssistantJob();
> 
> 	private HideDiagramAssistantJob hideDiagramAssistantJob = new HideDiagramAssistantJob();
293,294c330,334
< 		showDiagramAssistantRunnable.setOriginalMouseLocation(getMouseLocation());
< 		Display.getCurrent().timerExec(delay,showDiagramAssistantRunnable);
---
> 		if (delay >= 0) {
>             showDiagramAssistantJob.setOriginalMouseLocation(getMouseLocation());
>             showDiagramAssistantJob.cancel();
>             showDiagramAssistantJob.schedule(delay);
> 		}
304,305c344,346
< 		if (isDiagramAssistantShowing()) {
< 			Display.getCurrent().timerExec(delay, hideDiagramAssistantRunnable);
---
> 		if (isDiagramAssistantShowing() && delay >= 0) {
>             hideDiagramAssistantJob.cancel();
>             hideDiagramAssistantJob.schedule(delay);
459a501,514
> 	/**
>      * Gets an ID string used to identify the diagram assistant classification.
>      * This ID should be the same string for all instances of a particular type
>      * of diagram assistant. One use of this ID is to avoid having multiple
>      * diagram assistants of the same type showing at the same time on different
>      * editparts. A good ID string would be the class's name (e.g.
>      * ConnectionHandleEditPolicy.class.getName()).
>      * 
>      * @return a unique string for a diagram assistant type or null
>      */
>     protected String getDiagramAssistantID() {
>         return null;
>     }
> 
