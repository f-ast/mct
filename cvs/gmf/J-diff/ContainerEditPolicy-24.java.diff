34d33
< import org.eclipse.gef.commands.UnexecutableCommand;
35a35
> import org.eclipse.gef.commands.UnexecutableCommand;
61d60
< import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.IEditableEditPart;
62a62
> import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.IEditableEditPart;
70d69
< import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramWorkbenchPart;
87,88d85
< import org.eclipse.ui.IWorkbenchPart;
< import org.eclipse.ui.PlatformUI;
325,331c322,327
< 		
< 		IWorkbenchPart activePart = PlatformUI.getWorkbench().getActiveWorkbenchWindow().getActivePage().getActivePart();
< 		if (activePart != null){
< 		     IDiagramWorkbenchPart editor = (IDiagramWorkbenchPart) activePart;
< 		     if (editor != null){
< 		    	   DiagramGraphicalViewer viewer = (DiagramGraphicalViewer) editor.getDiagramGraphicalViewer();
< 		           IPreferenceStore preferenceStore = viewer.getWorkspaceViewerPreferenceStore();	
---
>         //retrieves the preference store from the first edit part
>         IGraphicalEditPart firstEditPart = (IGraphicalEditPart)editparts.get(0);
>         if (firstEditPart.getViewer() instanceof DiagramGraphicalViewer){           
>              IPreferenceStore preferenceStore = ((DiagramGraphicalViewer)firstEditPart.getViewer())
>             .getWorkspaceViewerPreferenceStore();
>              if (preferenceStore != null){
