14d13
< import java.lang.ref.SoftReference;
17d15
< import java.util.HashMap;
20d17
< import java.util.Map;
24d20
< import org.eclipse.emf.common.util.URI;
58,59d53
< 	private static Map/*<URI, SoftReference>*/ myCachedURI2EmitterMap = new HashMap();
< 
60a55,59
> 		this(genModel, Activator.getInstance().getEmitters(genModel));
> 	}
> 
> 	public Generator(GenEditorGenerator genModel, CodegenEmitters emitters) {
> 		assert genModel != null && emitters != null;
63,75c62
< 		URI resourceURI = myEditorGen.eResource().getURI();
< 		if (myEditorGen.isDynamicTemplates()) {
< 			myCachedURI2EmitterMap.remove(resourceURI);
< 		}
< 		CodegenEmitters old = myCachedURI2EmitterMap.containsKey(resourceURI) ? (CodegenEmitters) ((SoftReference) myCachedURI2EmitterMap.get(resourceURI)).get() : null;
< 		if (old == null) {
< 			myEmitters = new CodegenEmitters(!myEditorGen.isDynamicTemplates(), myEditorGen.getTemplateDirectory());
< 			if (!myEditorGen.isDynamicTemplates()) {
< 				myCachedURI2EmitterMap.put(resourceURI, new SoftReference(myEmitters));
< 			}
< 		} else {
< 			myEmitters = old;
< 		}
---
> 		myEmitters = emitters;
