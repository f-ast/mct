100d99
<         if (context != null) {
103a103
> 			delegate = null;
106c106,111
<             delegate = new RedoActionHandler(getWorkbenchPart().getSite(), context);
---
> 		if (context != null) {
> 			IWorkbenchPart part = getWorkbenchPart();
> 
> 			if (part != null) {
> 				delegate = new RedoActionHandler(part.getSite(), context);
> 				delegate.setPruneHistory(true);
107a113,114
> 			}
> 		}
111,113c118,119
<             firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled),
<                     Boolean.valueOf(enabled));
<         }
---
> 		firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled), Boolean
> 				.valueOf(enabled));
250c256,257
<      * Sets my undo context.
---
> 	 * Sets my undo context. It will no longer be derived from the workbench
> 	 * part.
255,257c262,264
<     public final void setUndoContext(IUndoContext undoContext) {
<         this.undoContext = undoContext;
<         initializeWithContext(undoContext);
---
> 	public final void setUndoContext(IUndoContext context) {
> 		this.undoContext = context;
> 		initializeWithContext(context);
286a294,307
> 	/**
> 	 * Disposes my delegate.
> 	 */
> 	public void dispose() {
> 
> 		if (delegate != null) {
> 			delegate.removePropertyChangeListener(getDelegateListener());
> 			delegate.dispose();
> 			delegate = null;
> 		}
> 
> 		super.dispose();
> 	}
> 
