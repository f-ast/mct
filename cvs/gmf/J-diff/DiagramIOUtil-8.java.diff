70c70
< 		public Resource load(TransactionalEditingDomain domain, Map loadOptions, IProgressMonitor monitor) throws CoreException;
---
> 		public Resource load(TransactionalEditingDomain domain, Map loadOptions, IProgressMonitor monitor) throws IOException, CoreException;
80c80
< 		public Resource load(TransactionalEditingDomain domain, Map loadOptions, IProgressMonitor monitor) throws CoreException {
---
> 		public Resource load(TransactionalEditingDomain domain, Map loadOptions, IProgressMonitor monitor) throws IOException, CoreException {
93,95d92
< 				// We will place a special extended metadata in here to ensure that we can load diagrams
< 				//  from older versions of our metamodel.
< 				loadingOptions.put(XMLResource.OPTION_EXTENDED_META_DATA, new NotationExtendedMetaData());
107c104,105
< 					// Proceed with an unloaded resource.
---
>                 	resource.unload();
>                 	throw e;
123c121
< 			throws CoreException {
---
> 			throws IOException, CoreException {
161,162c159
< 
< 			} catch (Exception e) {
---
> 			} catch (Resource.IOWrappedException e) {
164c161
< 					Throwable t = e.getCause();
---
> 					Throwable causeError = e.getWrappedException();
166d162
< 					Throwable causeError = t.getCause();
168c164
< 						causeError = t;
---
> 						causeError = e;
169a166
> 					
177a175
> 					
182a181,185
>             				
>                             // We will place a special extended metadata in here to ensure that we can load diagrams
>             				//  from older versions of our metamodel.
>             				loadOptions.put(XMLResource.OPTION_EXTENDED_META_DATA, new NotationExtendedMetaData());
>             				
222a226,227
>         save(domain, file, diagram, progressMonitor, options);
> 	}
223a229,230
>     static public void save(TransactionalEditingDomain domain, IFile file, Diagram diagram, IProgressMonitor progressMonitor) throws CoreException {
>         Map options = new HashMap();
360c367
< 			} else if (szOption == MessageDialogWithToggle.ALWAYS) {
---
> 			} else if (MessageDialogWithToggle.ALWAYS.equals(szOption)) {
