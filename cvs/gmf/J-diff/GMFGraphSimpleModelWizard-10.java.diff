14d13
< import java.util.HashMap;
16d14
< import java.util.Map;
19d16
< import org.eclipse.core.runtime.IProgressMonitor;
24d20
< import org.eclipse.emf.ecore.xmi.XMLResource;
27d22
< import org.eclipse.gmf.gmfgraph.provider.GMFGraphEditPlugin;
30a26
> import org.eclipse.gmf.internal.bridge.ui.Plugin;
36d31
< import org.eclipse.ui.actions.WorkspaceModifyOperation;
46a42,47
> 	protected WizardOperationMode mode = new WizardOperationMode("gmfgraph", WizardOperationMode.CREATE); //$NON-NLS-1$
> 
> 	public void setMode(String mode) {
> 		this.mode.setMode(mode);
> 	}
> 
59c60
< 				saveModel(graphicalModelSelectionPage.getResource());
---
> 				WizardUtil.saveModel(getContainer(), graphicalModelSelectionPage.getResource());
61c62
< 				GMFGraphEditPlugin.INSTANCE.log(exception);
---
> 				Plugin.log(exception);
92,110d92
< 	@SuppressWarnings("unchecked")
< 	protected void saveModel(final Resource resource) throws Exception {
< 		WorkspaceModifyOperation operation = new WorkspaceModifyOperation() {
< 
< 			protected void execute(IProgressMonitor progressMonitor) {
< 				try {
< 					Map options = new HashMap();
< 					options.put(XMLResource.OPTION_ENCODING, "UTF-8"); //$NON-NLS-1$
< 					resource.save(options);
< 				} catch (Exception exception) {
< 					GMFGraphEditPlugin.INSTANCE.log(exception);
< 				} finally {
< 					progressMonitor.done();
< 				}
< 			}
< 		};
< 		getContainer().run(false, false, operation);
< 	}
< 
113,115c95,96
< 		final boolean reconcileMode = !rloc.getSelectedURIs("gmfgraph", true).isEmpty(); // enabled when gmfgraph model selected
< 		if (reconcileMode) {
< 			graphicalModelSelectionPage = new ModelSelectionPage("GraphicalModelSelectionPage", rloc) {
---
> 		if (mode.detectReconcile(rloc)) {
> 			graphicalModelSelectionPage = new ModelSelectionPage("GraphicalModelSelectionPage", rloc) { //$NON-NLS-1$
140c121
< 		DomainModelSelectionPage domainModelSelectionPage = new DomainModelSelectionPage("DomainModelSelectionPage", rloc);
---
> 		DomainModelSelectionPage domainModelSelectionPage = new DomainModelSelectionPage("DomainModelSelectionPage", rloc); //$NON-NLS-1$
