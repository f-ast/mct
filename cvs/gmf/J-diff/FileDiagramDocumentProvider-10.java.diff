92,93c92
< 				IDiagramDocument diagramDocument = (IDiagramDocument)event.getEventInfo();
< 				Diagram newContent = diagramDocument.getDiagram();
---
> 				Diagram newContent = (Diagram)event.getEventInfo();
128d126
< 			((DiagramFileInfo)info).fListener.stopListening();
129a128,129
>         if(((DiagramFileInfo)info).fListener != null)
>             ((DiagramFileInfo)info).fListener.stopListening();
243c243,244
< 	protected FileInfo createFileInfo(IDocument document, FileSynchronizer synchronizer, IFileEditorInput input) {
---
>     protected FileInfo createFileInfo(IDocument document,
>             FileSynchronizer synchronizer, IFileEditorInput input) {
246,247c247,253
< 		DiagramModificationListener diagramListener = new FileDiagramModificationListener(this, (DiagramDocument)document, input);
< 		DiagramFileInfo info = new DiagramFileInfo(document, synchronizer, diagramListener);
---
>         DiagramModificationListener diagramListener = null;
>         if (((DiagramDocument) document).getDiagram() != null) {
>             diagramListener = new FileDiagramModificationListener(this,
>                 (DiagramDocument) document, input);
>         }
>         DiagramFileInfo info = new DiagramFileInfo(document, synchronizer,
>             diagramListener);
249c255,256
< 		diagramListener.startListening();
---
>         if (info.fListener != null)
>             info.fListener.startListening();
252,254c259,263
< 
< 	/* (non-Javadoc)
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.StorageDocumentProvider#setDocumentContent(org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.IDocument, org.eclipse.ui.IEditorInput)
---
> 	/*
>      * (non-Javadoc)
>      * 
>      * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.StorageDocumentProvider#setDocumentContent(org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.IDocument,
>      *      org.eclipse.ui.IEditorInput)
