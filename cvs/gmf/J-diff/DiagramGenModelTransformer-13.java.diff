14a15
> import java.util.Collection;
34a36
> import org.eclipse.gmf.codegen.gmfgen.DesignLabelModelFacet;
108a111
> import org.eclipse.gmf.mappings.DesignLabelMapping;
113a117
> import org.eclipse.gmf.mappings.FeatureLabelMapping;
591c595,596
< 		if (mapping.getFeatures().size() > 0) {
---
> 		if (mapping instanceof FeatureLabelMapping) {
> 			FeatureLabelMapping flMapping = (FeatureLabelMapping) mapping;
593,594c598,599
< 			for (Iterator features = mapping.getFeatures().iterator(); features.hasNext();) {
< 				modelFacet.getMetaFeatures().add(findGenFeature((EAttribute) features.next()));
---
> 			for (EAttribute attr : (Collection<? extends EAttribute>) flMapping.getFeatures()) {
> 				modelFacet.getMetaFeatures().add(findGenFeature(attr));
596,597c601,602
< 			modelFacet.setViewPattern(mapping.getViewPattern());
< 			modelFacet.setEditPattern(mapping.getEditPattern());
---
> 			modelFacet.setViewPattern(flMapping.getViewPattern());
> 			modelFacet.setEditPattern(flMapping.getEditPattern());
600,602c605,607
< 		if (!mapping.isReadOnly()) {
< 			// use design model facet if there are no features and label is editable
< 			//return GMFGenFactory.eINSTANCE.createDesignLabelModelFacet();
---
> 		if (mapping instanceof DesignLabelMapping) {
> 			DesignLabelModelFacet modelFacet = GMFGenFactory.eINSTANCE.createDesignLabelModelFacet();
> 			return modelFacet;
685,687c690,696
< 		boolean ok = true;
< 		for (Iterator it = entry.getLabelMappings().iterator(); ok && it.hasNext();) {
< 			ok = checkLabelFeatureValidity((LabelMapping) it.next());
---
> 		for (LabelMapping labelMapping : (Collection<? extends LabelMapping>) entry.getLabelMappings()) {
> 			if (labelMapping instanceof FeatureLabelMapping) {
> 				final EClass domainElement = labelMapping.getMapEntry().getDomainContext();
> 				for (EAttribute attr : (Collection<? extends EAttribute>) ((FeatureLabelMapping) labelMapping).getFeatures()) {
> 					if (!attr.getEContainingClass().isSuperTypeOf(domainElement)) {
> 						return false;
> 					}
689d697
< 		return ok;
691,697d698
< 
< 	private static boolean checkLabelFeatureValidity(LabelMapping labelMapping) {
< 		final EClass domainElement = labelMapping.getMapEntry().getDomainContext(); 
< 		boolean isOk = true;
< 		for (Iterator it = labelMapping.getFeatures().iterator(); isOk && it.hasNext(); ) {
< 			EClass attrContainer = ((EAttribute) it.next()).getEContainingClass();
< 			isOk = attrContainer.isSuperTypeOf(domainElement);
699c700
< 		return isOk;
---
> 		return true;
