13a14,15
> import java.awt.RenderingHints;
> import java.awt.Shape;
18a21,23
> import org.apache.batik.gvt.renderer.ImageRenderer;
> import org.apache.batik.gvt.renderer.StaticRenderer;
> import org.apache.batik.transcoder.SVGAbstractTranscoder;
25c30
< public class SimpleImageTranscoder extends ImageTranscoder {
---
> public class SimpleImageTranscoder extends SVGAbstractTranscoder {
30a36
> 	private RenderingHints renderingHints;
33a40
> 		renderingHints = new RenderingHints(null);
39a47,50
> 	public final RenderingHints getRenderingHints() {
> 		return renderingHints;
> 	}
> 
136,138c147,163
< 	public final BufferedImage getBufferedImage() {
< 		if (bufferedImage == null) {
< 			updateImage();
---
> 	protected void transcode(Document document, String uri, TranscoderOutput output) throws TranscoderException {
> 		super.transcode(document, uri, output);
> 		int w = (int) (width + 0.5);
> 		int h = (int) (height + 0.5);
> 		ImageRenderer renderer = createImageRenderer();
> 		renderer.updateOffScreen(w, h);
> 		// curTxf.translate(0.5, 0.5);
> 		renderer.setTransform(curTxf);
> 		renderer.setTree(this.root);
> 		this.root = null; // We're done with it...
> 		try {
> 			Shape raoi = new Rectangle2D.Float(0, 0, width, height);
> 			// Warning: the renderer's AOI must be in user space
> 			renderer.repaint(curTxf.createInverse().createTransformedShape(raoi));
> 			bufferedImage = renderer.getOffScreen();
> 		} catch (Exception ex) {
> 			throw new TranscoderException(ex);
140d164
< 		return bufferedImage;
143,145c167,170
< 	@Override
< 	public final BufferedImage createImage(int width, int height) {
< 		return new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
---
> 	protected ImageRenderer createImageRenderer() {
> 		StaticRenderer renderer = new StaticRenderer();
> 		renderer.getRenderingHints().add(renderingHints);
> 		return renderer;
148,150c173,177
< 	@Override
< 	public final void writeImage(BufferedImage img, TranscoderOutput output) throws TranscoderException {
< 		bufferedImage = img;
---
> 	public final BufferedImage getBufferedImage() {
> 		if (bufferedImage == null) {
> 			updateImage();
> 		}
> 		return bufferedImage;
