7,11c7
< import org.eclipse.gmf.internal.xpand.ast.TextStatement;
< import org.eclipse.gmf.internal.xpand.expression.ast.SyntaxElement;
< import org.eclipse.gmf.internal.xpand.model.Output;
< 
< public class BufferOutput implements Output {
---
> public class BufferOutput extends AbstractOutput {
17,18d12
< 	private boolean deleteLine = false;
< 
56,84c50,51
< 	public void enterStatement(SyntaxElement stmt) {
< 		if (stmt instanceof TextStatement) {
< 			deleteLine = ((TextStatement) stmt).isDeleteLine();
< 		}
< 	}
< 
< 	public void exitStatement(SyntaxElement stmt) {
< 		deleteLine = false;
< 	}
< 
< 	public void write(String text) {
< 		if (deleteLine) {
< 			int i = 0;
< 			while (i < text.length()) {
< 				char charAt = text.charAt(i);
< 				if (Character.isWhitespace(charAt)) {
< 					if ((charAt == '\r' || charAt == '\n') && (i+1 < text.length())) {
< 						char nextToLF = text.charAt(++i);
< 						if (nextToLF != charAt && (nextToLF == '\n' || nextToLF == '\r')) {
< 							i++;
< 						}
< 						break;
< 					}
< 				}
< 				i++;
< 			}
< 			outletStack.peek().append(text.substring(i));
< 			deleteLine = false;
< 		} else {
---
> 	@Override
> 	protected void doAppend(String text) {
88d54
< }
\ No newline at end of file
