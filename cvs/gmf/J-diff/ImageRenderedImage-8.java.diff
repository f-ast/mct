76c76
< 			int newHeight = bufferWidth;
---
>             int newHeight = bufferHeight;
79,83c79,83
< 				if (newWidth > newHeight) {
< 					newHeight = (int)Math.round(newWidth * origHeight / (double)origWidth);
< 				}
< 				else {
< 					newWidth = (int)Math.round(newHeight * origWidth / (double)origHeight);
---
>                 double origAspectRatio = origHeight / (double)origWidth;
>                 if (origAspectRatio > newHeight / (double)newWidth) {
>                     newWidth = (int)Math.round(newHeight / origAspectRatio);
>                 } else {
>                     newHeight = (int)Math.round(newWidth * origAspectRatio);
