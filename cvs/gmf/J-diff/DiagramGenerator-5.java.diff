35,37d34
< import org.eclipse.jface.resource.ImageDescriptor;
< import org.eclipse.swt.graphics.ImageData;
< 
38a36
> import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
50d47
< import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
54c51,52
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
---
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapModeUtil;
57a56,57
> import org.eclipse.jface.resource.ImageDescriptor;
> import org.eclipse.swt.graphics.ImageData;
68c68
< 	private static final int IMAGE_MARGIN = MapMode.DPtoLP(10);
---
> 	private int image_margin = 0;
79a80
> 		image_margin = getMapMode().DPtoLP(10);
182a184,185
> 			IMapMode mm = getMapMode();
> 			
184c187
< 			graphics = setUpGraphics(MapMode.LPtoDP(sourceRect.width), MapMode
---
> 			graphics = setUpGraphics(mm.LPtoDP(sourceRect.width), mm
188c191
< 				graphics);
---
> 				graphics, getMapMode());
213a217,224
> 	 * @return
> 	 */
> 	protected IMapMode getMapMode() {
> 		IMapMode mm = MapModeUtil.getMapMode(getDiagramEditPart().getFigure());
> 		return mm;
> 	}
> 
> 	/**
543a555,556
> 		IMapMode mm = getMapMode();
> 		
550c563
< 			bounds = bounds.getExpanded(IMAGE_MARGIN, IMAGE_MARGIN);
---
> 			bounds = bounds.getExpanded(getImageMargin(), getImageMargin());
568c581
< 			width = MapMode.DPtoLP(100);
---
> 			width = mm.DPtoLP(100);
572c585
< 			height = MapMode.DPtoLP(100); // create an empty image if the
---
> 			height = mm.DPtoLP(100); // create an empty image if the
595a609
> 		IMapMode mm = getMapMode();
629,632c643,646
< 					position.setPartHeight(MapMode.LPtoDP(bounds.height));
< 					position.setPartWidth(MapMode.LPtoDP(bounds.width));
< 					position.setPartX(MapMode.LPtoDP(bounds.x));
< 					position.setPartY(MapMode.LPtoDP(bounds.y));
---
> 					position.setPartHeight(mm.LPtoDP(bounds.height));
> 					position.setPartWidth(mm.LPtoDP(bounds.width));
> 					position.setPartX(mm.LPtoDP(bounds.x));
> 					position.setPartY(mm.LPtoDP(bounds.y));
718c732
< 			orthoPoint1 = segment.locatePoint(0.0, IMAGE_MARGIN, Sign.POSITIVE);
---
> 			orthoPoint1 = segment.locatePoint(0.0, getImageMargin(), Sign.POSITIVE);
720c734
< 			orthoPoint2 = segment.locatePoint(1.0, IMAGE_MARGIN, Sign.POSITIVE);
---
> 			orthoPoint2 = segment.locatePoint(1.0, getImageMargin(), Sign.POSITIVE);
754a769,771
> 		
> 		IMapMode mm = getMapMode();
> 		
757c774
< 			Point newPoint = new Point(MapMode.LPtoDP(point.x), MapMode.LPtoDP(point.y));
---
> 			Point newPoint = new Point(mm.LPtoDP(point.x), mm.LPtoDP(point.y));
763a781,788
> 	
> 	/**
> 	 * @return <code>int</code> value that is the margin around the generated image in logical coordinates.
> 	 */
> 	protected int getImageMargin() {
> 		return image_margin;
> 	}
> 	
