30d29
< import org.eclipse.core.resources.IMarker;
45d43
< import org.eclipse.emf.transaction.ResourceSetChangeEvent;
78d75
< import org.eclipse.gmf.runtime.common.ui.services.marker.MarkerNavigationService;
136d132
< import org.eclipse.ui.PlatformUI;
965,1001d960
<     private class DiagramEventBrokerThreadSafe extends DiagramEventBroker {
< 
<         public DiagramEventBrokerThreadSafe() {
<             super();
<             // TODO Auto-generated constructor stub
<         }
< 
<         /* (non-Javadoc)
<          * @see org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker#resourceSetChanged(org.eclipse.emf.transaction.ResourceSetChangeEvent)
<          */
<         public void resourceSetChanged(ResourceSetChangeEvent event) {
<             if (Display.getCurrent() == null) {
<                 EditPartViewer viewer = getDiagramGraphicalViewer();
<                 if (viewer instanceof DiagramGraphicalViewer) {
<                     DiagramGraphicalViewer dgv = (DiagramGraphicalViewer)viewer;
<                     if (!dgv.areUpdatesDisabled()) {
<                         // force synchronization with the main thread
<                         final ResourceSetChangeEvent eventToHandle = event;
<                         PlatformUI.getWorkbench().getDisplay().asyncExec(new Runnable() { 
<                             public void run() {
<                                 internal_resourceSetChanged(eventToHandle);
<                             }
<                         });
<                         
<                         return;
<                     }
<                 }
<             }
<             
<             super.resourceSetChanged(event);
<         }
<         
<         private void internal_resourceSetChanged(ResourceSetChangeEvent event) {
<             super.resourceSetChanged(event);
<         }
<     };
<     
1023c982
<                 DiagramEventBroker.startListening(domain, new DiagramEventBrokerThreadSafe());
---
>                 DiagramEventBroker.startListening(domain);
