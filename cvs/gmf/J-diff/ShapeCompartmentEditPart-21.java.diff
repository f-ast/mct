2c2
<  * Copyright (c) 2002, 2007 IBM Corporation and others.
---
>  * Copyright (c) 2002, 2008 IBM Corporation and others.
24d23
< import org.eclipse.draw2d.Bendpoint;
26d24
< import org.eclipse.draw2d.ConnectionAnchor;
35c33
< import org.eclipse.draw2d.geometry.PointList;
---
> import org.eclipse.draw2d.geometry.PrecisionPoint;
134a133,138
> 				
> 				if (!source.getFigure().isShowing() || !target.getFigure().isShowing()) {
> 					connection.setVisible(false);
> 					continue;
> 				}
> 				
144,162c148,156
<                 ConnectionAnchor sc = cep.getSourceConnectionAnchor();
<                 ConnectionAnchor tc = cep.getTargetConnectionAnchor();
<                 Point sRefPoint;
<                 Point tRefPoint;
<                 List bendpoints = (List) connection.getConnectionRouter()
<                     .getConstraint(connection);
<                 if (bendpoints.size() >= 2) {
<                     sRefPoint = ((Bendpoint) bendpoints.get(0)).getLocation()
<                         .getCopy();
<                     connection.translateToAbsolute(sRefPoint);
<                     tRefPoint = ((Bendpoint) bendpoints
<                         .get(bendpoints.size() - 1)).getLocation().getCopy();
<                     connection.translateToAbsolute(tRefPoint);
<                 } else {
<                     sRefPoint = tc.getReferencePoint();
<                     tRefPoint = sc.getReferencePoint();
<                 }
<                 Point sLoc = sc.getLocation(sRefPoint);
<                 Point tLoc = tc.getLocation(tRefPoint);
---
> 				if (!connection.isVisible()) {
> 					connection.setVisible(true);
> 					connection.getConnectionRouter().route(connection);
> 					connection.setVisible(false);
> 				}
> 				Point sLoc = new PrecisionPoint(connection.getPoints().getFirstPoint());
> 				Point tLoc = new PrecisionPoint(connection.getPoints().getLastPoint());
> 				connection.translateToAbsolute(sLoc);
> 				connection.translateToAbsolute(tLoc);
394c388
< 		 * Walks up the hierarchy to make sure that supplied figure is visible
---
> 		 * Walks up the hierarchy to make sure that the point <code>loc</code> is visible
407,408c401
< 			if (!(figure.isVisible())) {
< 				return false;
---
> 			if (!(figure.isShowing())) {
414a408
> 				return false;
773a768,775
> 	/* (non-Javadoc)
> 	 * @see org.eclipse.gmf.runtime.diagram.ui.editparts.ResizableCompartmentEditPart#setCollapsed(boolean, boolean)
> 	 */
> 	protected void setCollapsed(boolean collapsed, boolean animate) {
> 		super.setCollapsed(collapsed, animate);
> 		refreshConnections();
> 	}
> 
