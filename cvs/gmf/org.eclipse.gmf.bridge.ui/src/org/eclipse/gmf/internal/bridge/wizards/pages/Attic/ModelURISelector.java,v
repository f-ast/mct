head	1.5;
access;
symbols
	v20080924-1925:1.5
	M3_20:1.3
	v20061117-0800:1.3
	v20061013-1330:1.3
	v20060925-1700:1.3
	v20060919-0800:1.3
	M1_20:1.3
	v20060904-1500:1.3
	v20060713-1700:1.3
	R1_0_maintenance:1.3.0.2
	R1_0:1.3
	v20060627-1200:1.3
	v20060626-1420:1.3
	v20060620-0400:1.3
	v20060616-1200:1.3
	v20060609-1400:1.3
	v20060531-1730:1.3
	v20060526-1200:1.3
	v20060519-0800:1.3
	v20060512-1000:1.3
	I20060512-1000:1.3
	I20060428-1300:1.3
	I20060424-0500:1.3
	I20060424-0300:1.3
	M6_10:1.3
	I20060407-1200:1.3
	I20060331-1000:1.3
	I20060324-0300:1.3
	I20060317-1300:1.3
	I20060317-1200:1.3
	I20060316-1300:1.3
	I20060309-1300:1.3
	M5_10:1.3
	S20060303-1600:1.3;
locks; strict;
comment	@# @;
expand	@k@;


1.5
date	2006.11.24.16.19.41;	author dstadnik;	state dead;
branches;
next	1.4;
commitid	bf145671b9d4567;

1.4
date	2006.11.22.17.34.12;	author ashatalin;	state Exp;
branches;
next	1.3;
commitid	112b45648a134567;

1.3
date	2006.03.03.16.50.24;	author atikhomirov;	state Exp;
branches;
next	1.2;

1.2
date	2006.03.03.14.53.10;	author atikhomirov;	state Exp;
branches;
next	1.1;

1.1
date	2006.02.28.19.07.41;	author atikhomirov;	state Exp;
branches;
next	;


desc
@@


1.5
log
@[142460] Inconsistent buttons in GMFMap creation wizard
@
text
@/*
 * Copyright (c) 2006 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Artem Tikhomirov (Borland) - initial API and implementation
 */
package org.eclipse.gmf.internal.bridge.wizards.pages;

import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.IResource;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.emf.common.util.URI;
import org.eclipse.swt.SWT;
import org.eclipse.swt.graphics.Point;
import org.eclipse.swt.graphics.Rectangle;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Control;
import org.eclipse.swt.widgets.Event;
import org.eclipse.swt.widgets.FileDialog;
import org.eclipse.swt.widgets.Group;
import org.eclipse.swt.widgets.Listener;
import org.eclipse.swt.widgets.Menu;
import org.eclipse.swt.widgets.MenuItem;
import org.eclipse.swt.widgets.Shell;
import org.eclipse.swt.widgets.Text;
import org.eclipse.swt.widgets.ToolBar;
import org.eclipse.swt.widgets.ToolItem;
import org.eclipse.ui.dialogs.ResourceSelectionDialog;

/**
 * @@author artem
 */
public class ModelURISelector implements Listener {

	private final String myGroupTitle;

	private final String myFileExt;

	private final Loader myModelLoader;

	private Text uriText;

	private Menu browseMenu;

	private Group myControl;

	private Listener mySetTextActionListener;

	private ToolItem myLoadBtn;

	public ModelURISelector(String groupTitle, String fileExt, Loader modelLoader) {
		myGroupTitle = groupTitle;
		myFileExt = fileExt;
		myModelLoader = modelLoader;
	}

	public void setURIText(String text) {
		uriText.setText(text);
	}
	public void setURIText(URI uri) {
		setURIText(uri.toString());
	}

	public Control createControl(Composite parent) {
		myControl = new Group(parent, SWT.NONE);
		GridLayout l = new GridLayout();
		l.numColumns = 2;
		myControl.setLayout(l);
		myControl.setText(myGroupTitle);
		uriText = new Text(myControl, SWT.SINGLE | SWT.BORDER);
		uriText.setLayoutData(new GridData(SWT.FILL, SWT.CENTER, true, false));
		browseMenu = createBrowseMenu(myControl);
		createToolBar(myControl);
		return myControl;
	}

	public Menu getBrowseMenu() {
		return browseMenu;
	}

	public void addBrowseMenuSeparator() {
		new MenuItem(getBrowseMenu(), SWT.SEPARATOR);
	}

	public void addBrowseMenuAction(String text, String uriValue) {
		assert text != null && uriValue != null; 
		MenuItem item = new MenuItem(getBrowseMenu(), SWT.PUSH);
		item.setText(text);
		item.setData(uriValue);
		item.addListener(SWT.Selection, getTextActionListener());
	}

	public void addBrowseMenuAction(String text, Listener l) {
		assert text != null && l != null; 
		MenuItem item = new MenuItem(getBrowseMenu(), SWT.PUSH);
		item.setText(text);
		item.addListener(SWT.Selection, l);
	}

	public void disableLoad() {
		assert myLoadBtn != null;
		myLoadBtn.setEnabled(false);
	}

	public void enableLoad() {
		assert myLoadBtn != null;
		myLoadBtn.setEnabled(true);
	}

	private Listener getTextActionListener() {
		if (mySetTextActionListener == null) {
			mySetTextActionListener = new Listener() {
				public void handleEvent(Event event) {
					if (event.widget.getData() instanceof URI) {
						setURIText((URI) event.widget.getData());
					} else {
						setURIText(String.valueOf(event.widget.getData()));
					}
					enableLoad();
				}
			};
		}
		return mySetTextActionListener;
	}

	/**
	 * @@see http://www.eclipse.org/swt/snippets/
	 * @@param parent
	 */
	private void createToolBar(Composite parent) {
		final ToolBar toolBar = new ToolBar(parent, SWT.NONE);
		new ToolItem(toolBar, SWT.SEPARATOR);
		new ToolItem(toolBar, SWT.SEPARATOR);
		final ToolItem toolItem = new ToolItem(toolBar, SWT.DROP_DOWN);
		toolItem.setText(Messages.uriSelectorBrowse);
		toolItem.addListener(SWT.Selection, new Listener() {
			public void handleEvent(Event event) {
				if (event.detail == SWT.ARROW) {
					Rectangle rect = toolItem.getBounds();
					Point pt = new Point(rect.x, rect.y + rect.height);
					pt = toolBar.toDisplay(pt);
					getBrowseMenu().setLocation(pt.x, pt.y);
					getBrowseMenu().setVisible(true);
				} else {
					// ordinary click on the toolItem
					handleDefaultToolBarAction();
				}
			}
		});

		new ToolItem(toolBar, SWT.SEPARATOR);
		new ToolItem(toolBar, SWT.SEPARATOR);
		myLoadBtn = new ToolItem(toolBar, SWT.PUSH);
		myLoadBtn.setText(Messages.uriSelectorLoad);
		myLoadBtn.addListener(SWT.Selection, this);
	}

	protected Menu createBrowseMenu(Control parent) {
		Menu menu = new Menu(parent);
		MenuItem item = new MenuItem(menu, SWT.PUSH);
		item.setText(Messages.uriSelectorWorkspace);
		item.addListener(SWT.Selection, new Listener() {
			public void handleEvent(Event event) {
				handleBrowseWorkspace();
			}
		});
		item = new MenuItem(menu, SWT.PUSH);
		item.setText(Messages.uriSelectorFilesystem);
		item.addListener(SWT.Selection, new Listener() {
			public void handleEvent(Event event) {
				handleBrowseFilesystem();
			}
		});
		return menu;
	}

	protected void handleDefaultToolBarAction() {
		// browse workspace by default
		handleBrowseWorkspace();
	}

	protected void handleBrowseWorkspace() {
		ResourceSelectionDialog d = new ResourceSelectionDialog(getShell(), ResourcesPlugin.getWorkspace().getRoot(), null);
		if (ResourceSelectionDialog.OK != d.open()) {
			return;
		}
		Object[] result = d.getResult();
		if (result != null) {
			IResource resource = (IResource) result[0];
			if (isValidWorkspaceResource(resource)) {
				setURIText(URI.createURI(URI.createPlatformResourceURI(resource.getFullPath().toString(), true).toString(), true).toString());
				enableLoad();
			}
		}
	}

	protected void handleBrowseFilesystem() {
		FileDialog fileDialog = new FileDialog(getShell(), SWT.OPEN | SWT.SINGLE);
		fileDialog.setFilterExtensions(new String[] { "*." + myFileExt }); //$NON-NLS-1$

		if (fileDialog.open() != null && fileDialog.getFileNames().length > 0) {
			String filePath = fileDialog.getFileNames()[0];
			setURIText(URI.createFileURI(filePath).toString());
			enableLoad();
		}
	}

	protected boolean isValidWorkspaceResource(IResource resource) {
		if (resource.getType() != IResource.FILE) {
			return false;
		}
		return myFileExt.equals(((IFile) resource).getFileExtension());
	}

	protected Shell getShell() {
		return myControl.getShell();
	}

	public void handleEvent(Event event) {
		myModelLoader.run(this, uriText.getText());
	}

	interface Loader {
		void run(ModelURISelector selector, String uriText);
	}
}
@


1.4
log
@Removing warnings
@
text
@@


1.3
log
@option to create tooling definition as part of mapping process
@
text
@d198 1
a198 1
				setURIText(URI.createURI(URI.createPlatformResourceURI(resource.getFullPath().toString()).toString(), true).toString());
@


1.2
log
@handle default selection
@
text
@d54 4
d88 45
d160 3
a162 3
		ToolItem toolItem1 = new ToolItem(toolBar, SWT.PUSH);
		toolItem1.setText(Messages.uriSelectorLoad);
		toolItem1.addListener(SWT.Selection, this);
d199 1
d211 1
@


1.1
log
@Introduced separate plugin for Tooling UI, moved mapping wizard of #114186 to this plugin.
Wizard got some NLS, respect selection, open-created-model-in-editor improvements as well as aligned with recent gmfmap changes.
Plus, some refactorings to address user-prioritized strategies to select nodes/links doubled number of classes we had.
@
text
@d102 3
d135 5
@

