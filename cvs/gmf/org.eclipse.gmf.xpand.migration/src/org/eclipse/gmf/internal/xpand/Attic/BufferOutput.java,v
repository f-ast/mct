head	1.1;
access;
symbols
	ocl_qvt:1.1.0.2;
locks; strict;
comment	@# @;
expand	@k@;


1.1
date	2008.07.29.15.57.57;	author ashatalin;	state dead;
branches
	1.1.2.1;
next	;
commitid	33cb488f3dd14567;

1.1.2.1
date	2008.07.29.15.57.57;	author ashatalin;	state Exp;
branches;
next	;
commitid	33cb488f3dd14567;


desc
@@


1.1
log
@file BufferOutput.java was initially added on branch ocl_qvt.
@
text
@@


1.1.2.1
log
@Xtend-based implementation of XPand extensions was separated into .migration plugin.
@
text
@a0 54
package org.eclipse.gmf.internal.xpand;

import java.util.Collections;
import java.util.Map;
import java.util.Stack;

public class BufferOutput extends AbstractOutput {
	/**
	 * INV: size > 0
	 */
	private final Stack<StringBuilder> outletStack;

	private final Map<String, StringBuilder> namedSlots;

	public BufferOutput(StringBuilder buffer) {
		this(buffer, null);
	}

	// XXX not map but config to show whether to append/overwrite content
	public BufferOutput(StringBuilder buffer, Map<String, StringBuilder> namedSlots) {
		assert buffer != null;
		outletStack = new Stack<StringBuilder>();
		outletStack.push(buffer);
		if (namedSlots != null) {
			this.namedSlots = namedSlots;
		} else {
			this.namedSlots = Collections.emptyMap();
		}
	}

	public void closeFile() {
		if (outletStack.size() == 1) {
			String msg = "CLOSE FILE without previous openFile";
			System.err.println("<<<" + msg);
			throw new UnsupportedOperationException(msg);
		}
		outletStack.pop();
	}

	public void openFile(String path, String outletName) {
		if (!namedSlots.containsKey(outletName)) {
			String msg = "OPEN FILE ('" + path + "', " + outletName + ")";
			System.err.println(">>>" + msg);
			throw new UnsupportedOperationException(msg);
		}
		outletStack.push(namedSlots.get(outletName));
		assert outletStack.peek() != null;
	}

	@@Override
	protected void doAppend(String text) {
		outletStack.peek().append(text);
	}
}@

