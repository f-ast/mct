25a26,26
> import org.eclipse.gmf.runtime.draw2d.ui.figures.IPolygonAnchorableFigure;
27a29,29
> import org.eclipse.gmf.runtime.draw2d.ui.geometry.PointListUtilities;
31,31d32
< import org.eclipse.jface.util.Assert;
197,197d197
<         PointList points = new PointList();
198a204,212
> 	/**
>      * Return a point list that contains the bend points on the connections
>      * clients can override this method to introduce calculated bend points 
>      * on the connection 
> 	 * @param conn the connection to get the bend points for
> 	 * @return bend points as a Point List
> 	 */
> 	protected PointList calculateBendPoints(Connection conn) {
>         PointList points = new PointList();        
207a222,222
> 		return points;
207a198,199
>         PointList points = calculateBendPoints(conn);
>              
208,208d197
<         
209,209c200,200
<         routeLine(conn, 0, points);
---
>         routeLine(conn, 0, points);
210,210c201,201
< 		conn.setPoints(points);
---
> 		conn.setPoints(points);
210a202,202
> 	}
253a266,266
> 		PointList startPolygon = null;
254,254d265
< 		Rectangle startRect = null;        
255a268,268
>             startPolygon = getFigurePolygon(sourceOwner,conn);
256,258d267
<             startRect = new Rectangle(sourceOwner.getBounds());
<             sourceOwner.translateToAbsolute(startRect);
<             conn.translateToRelative(startRect);
260a271,271
>         PointList endPolygon = null;
261,261d270
<         Rectangle endRect = null;        
262a273,273
>             endPolygon = getFigurePolygon(targetOwner,conn);
263,265d272
<     		endRect = new Rectangle(targetOwner.getBounds());
<             targetOwner.translateToAbsolute(endRect);
<     		conn.translateToRelative(endRect);
274a283,284
> 			else if ((startPolygon == null || !PointListUtilities.containsPoint(startPolygon,pt))
>                 && (endPolygon == null || !PointListUtilities.containsPoint(endPolygon,pt))) {
275,276d282
< 			else if ((startRect == null || !startRect.contains(pt))
<                 && (endRect == null || !endRect.contains(pt))) {
292a301,323
>      protected PointList getFigurePolygon(IFigure owner, Connection conn) {
>         PointList polygon = new PointList();
>         if (owner instanceof IPolygonAnchorableFigure){
>             PointList points =  ((IPolygonAnchorableFigure)owner).getPolygonPoints();
>             for(int index = 0 ; index < points.size(); index++){
>                 Point point  = points.getPoint(index).getCopy();
>                 owner.translateToAbsolute(point);
>                 conn.translateToRelative(point);
>                 polygon.addPoint(point);
>             }
>         }else {
>            Rectangle rect =  owner.getBounds().getCopy();
>            owner.translateToAbsolute(rect);
>            conn.translateToRelative(rect);
>            polygon.addPoint(rect.getTopLeft());
>            polygon.addPoint(rect.getTopRight());
>            polygon.addPoint(rect.getBottomRight());
>            polygon.addPoint(rect.getBottomLeft());
>            polygon.addPoint(rect.getTopLeft());
>         }
>         return polygon;
>     }
> 	
412,412c443,443
< 			Assert.isTrue(nIndex >= 0);
---
>             assert nIndex >= 0;
