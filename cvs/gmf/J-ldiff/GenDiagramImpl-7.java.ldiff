11,11d10
< import java.util.Iterator;
22,22d20
< import org.eclipse.emf.ecore.EPackage;
42,42d39
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getEmfGenModel <em>Emf Gen Model</em>}</li>
76a74,74
> 	protected GenPackage domainMetaModel = null;
77,87d73
< 	protected EPackage domainMetaModel = null;
< 
< 	/**
< 	 * The cached value of the '{@link #getEmfGenModel() <em>Emf Gen Model</em>}' reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getEmfGenModel()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenModel emfGenModel = null;
97,97c84,84
< 	protected EClass domainDiagramElement = null;
---
> 	protected GenClass domainDiagramElement = null;
472,472c459,459
< 	public EPackage getDomainMetaModel() {
---
> 	public GenPackage getDomainMetaModel() {
473a461,461
> 			GenPackage oldDomainMetaModel = domainMetaModel;
474,474d460
< 			EPackage oldDomainMetaModel = domainMetaModel;
475,475c462,462
< 			domainMetaModel = (EPackage)eResolveProxy((InternalEObject)domainMetaModel);
---
> 			domainMetaModel = (GenPackage)eResolveProxy((InternalEObject)domainMetaModel);
489,489c476,476
< 	public EPackage basicGetDomainMetaModel() {
---
> 	public GenPackage basicGetDomainMetaModel() {
498,498c485,485
< 	public void setDomainMetaModel(EPackage newDomainMetaModel) {
---
> 	public void setDomainMetaModel(GenPackage newDomainMetaModel) {
499,499c486,486
< 		EPackage oldDomainMetaModel = domainMetaModel;
---
> 		GenPackage oldDomainMetaModel = domainMetaModel;
509a1022,1023
> 	public GenModel getEMFGenModel() {
> 		return getDomainMetaModel().getGenModel();
509a497,497
> 	public GenClass getDomainDiagramElement() {
510,519d1021
< 	public GenModel getEmfGenModel() {
< 		if (emfGenModel != null && emfGenModel.eIsProxy()) {
< 			GenModel oldEmfGenModel = emfGenModel;
< 			emfGenModel = (GenModel)eResolveProxy((InternalEObject)emfGenModel);
< 			if (emfGenModel != oldEmfGenModel) {
< 				if (eNotificationRequired())
< 					eNotify(new ENotificationImpl(this, Notification.RESOLVE, GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL, oldEmfGenModel, emfGenModel));
< 			}
< 		}
< 		return emfGenModel;
520,520c1024,1024
< 	}
---
> 	}
521,521c1025,1025
< 
---
> 
522,522c1026,1026
< 	/**
---
> 	/**
523,523c1027,1027
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
524,524c1028,1028
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
524a1029,1029
> 	 * @generated NOT
525,525d1028
< 	 * @generated
526,526c1030,1030
< 	 */
---
> 	 */
527,548d1030
< 	public GenModel basicGetEmfGenModel() {
< 		return emfGenModel;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setEmfGenModel(GenModel newEmfGenModel) {
< 		GenModel oldEmfGenModel = emfGenModel;
< 		emfGenModel = newEmfGenModel;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL, oldEmfGenModel, emfGenModel));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public EClass getDomainDiagramElement() {
549a499,499
> 			GenClass oldDomainDiagramElement = domainDiagramElement;
550,550d498
< 			EClass oldDomainDiagramElement = domainDiagramElement;
551,551c500,500
< 			domainDiagramElement = (EClass)eResolveProxy((InternalEObject)domainDiagramElement);
---
> 			domainDiagramElement = (GenClass)eResolveProxy((InternalEObject)domainDiagramElement);
565,565c514,514
< 	public EClass basicGetDomainDiagramElement() {
---
> 	public GenClass basicGetDomainDiagramElement() {
574,574c523,523
< 	public void setDomainDiagramElement(EClass newDomainDiagramElement) {
---
> 	public void setDomainDiagramElement(GenClass newDomainDiagramElement) {
575,575c524,524
< 		EClass oldDomainDiagramElement = domainDiagramElement;
---
> 		GenClass oldDomainDiagramElement = domainDiagramElement;
660,660c609,609
< 			return toLowerCase(getDomainMetaModel().getName()) + ".edit.parts";
---
> 			return getPackageNamePrefix() + ".edit.parts";
689,689c638,638
< 			return toLowerCase(getDomainMetaModel().getName()) + ".edit.commands";
---
> 			return getPackageNamePrefix() + ".edit.commands";
717a1507,1507
> 	private String getPackageNamePrefix() {
717a667,667
> 			return getPackageNamePrefix() + ".providers";
718,718c1508,1508
< 			return toLowerCase(getDomainMetaModel().getName()) + ".providers";
---
> 		return toLowerCase(getDomainMetaModel().getEcorePackage().getName());
718a1509,1510
> 	}
> 
740,740c689,689
< 			char[] v = getDomainMetaModel().getName().toCharArray();
---
> 			char[] v = getDomainMetaModel().getEcorePackage().getName().toCharArray();
809,809c758,758
< 			return getEmfGenModel().getModelPluginID() + ".gmf.editor";
---
> 			return getEMFGenModel().getModelPluginID() + ".gmf.editor";
838,838c787,787
< 			return CodeGenUtil.validJavaIdentifier(getEmfGenModel().getModelName()) + "DiagramEditorPlugin";
---
> 			return CodeGenUtil.validJavaIdentifier(getEMFGenModel().getModelName()) + "DiagramEditorPlugin";
867,867c816,816
< 			return toLowerCase(getDomainMetaModel().getName()) + ".editor";
---
> 			return getPackageNamePrefix() + ".editor";
896,896c845,845
< 			return toLowerCase(getDomainMetaModel().getName()) + ".edit.providers";
---
> 			return getPackageNamePrefix() + ".edit.providers";
1009,1009c958,958
< 			return getEmfGenModel().getModelName().toLowerCase() + "_diagram";
---
> 			return getEMFGenModel().getModelName().toLowerCase() + "_diagram";
1107,1107c1065,1065
< 	 * @generated NOT
---
> 	 * @generated
1109a1068,1070
> 		// TODO: implement this method
> 		// Ensure that you remove @generated or mark it @generated NOT
> 		throw new UnsupportedOperationException();
1110,1117d1067
< 		GenPackage gp = getEmfGenModel().findGenPackage(domainMetaClass.getEPackage());
< 		for (Iterator it = gp.getGenClasses().iterator(); it.hasNext();) {
< 			GenClass genClass = (GenClass) it.next();
< 			if (genClass.getEcoreClass().equals(domainMetaClass)) {
< 				return genClass;
< 			}
< 		}
< 		throw new IllegalStateException("Can't find genClass for class '" + domainMetaClass.getName() + "' in package " + gp.getPackageName());
1123,1123c1076,1076
< 	 * @generated NOT
---
> 	 * @generated
1125a1079,1081
> 		// TODO: implement this method
> 		// Ensure that you remove @generated or mark it @generated NOT
> 		throw new UnsupportedOperationException();
1126,1133d1078
< 		GenClass genClass = findGenClass(domainMetaFeature.getEContainingClass());
< 		for (Iterator it = genClass.getGenFeatures().iterator(); it.hasNext();) {
< 			GenFeature next = (GenFeature) it.next();
< 			if (next.getEcoreFeature().equals(domainMetaFeature)) {
< 				return next;
< 			}
< 		}
< 		throw new IllegalStateException("Can't find genFeature for feature '" + domainMetaFeature.getName() + "' in class " + genClass.getName());
1234,1236d1181
< 			case GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL:
< 				if (resolve) return getEmfGenModel();
< 				return basicGetEmfGenModel();
1301a1247,1247
> 				setDomainMetaModel((GenPackage)newValue);
1302,1305d1246
< 				setDomainMetaModel((EPackage)newValue);
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL:
< 				setEmfGenModel((GenModel)newValue);
1308,1308c1250,1250
< 				setDomainDiagramElement((EClass)newValue);
---
> 				setDomainDiagramElement((GenClass)newValue);
1392a1335,1335
> 				setDomainMetaModel((GenPackage)null);
1393,1396d1334
< 				setDomainMetaModel((EPackage)null);
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL:
< 				setEmfGenModel((GenModel)null);
1399,1399c1338,1338
< 				setDomainDiagramElement((EClass)null);
---
> 				setDomainDiagramElement((GenClass)null);
1479,1480d1417
< 			case GMFGenPackage.GEN_DIAGRAM__EMF_GEN_MODEL:
< 				return emfGenModel != null;
