98a99,99
> 									true);
98,98c98,98
< 							add((Resource) notifier, child);
---
> 							updateImportsAndExports((Resource) notifier, child,
197a199,200
> 				// handle processing of the new value that has been added
> 				updateImportsAndExports(resource, newValue, true);
198,198d198
< 				add(resource, newValue);
199a202,202
> 
215a219,220
> 					// handle processing of the new value that has been added
> 					updateImportsAndExports(resource, next, true);
216,216d218
< 					add(resource, next);
233a238,239
> 				// handle processing of the old value that has been removed
> 				updateImportsAndExports(resource, oldValue, false);
234,234d237
< 				remove(resource, oldValue);
251a257,258
> 					// handle processing of the old value that has been removed
> 					updateImportsAndExports(resource, next, false);
252,252d256
< 					remove(resource, next);
260a267,267
> 	 * Updates the imports and exports map for the specified eObject
261,262d266
< 	 * Adds all aggregate cross-references for the specified resource, due to
< 	 * attachment of an eObject.
266a272,281
> 	 *            the specified eObject
> 	 * @param register
> 	 *            boolean flag to indicate whether to register imports or
> 	 *            unregister imports
> 	 */
> 	public void updateImportsAndExports(Resource resource, EObject value,
> 			boolean register) {
> 		CrossReferenceAdapter adapter = getExistingCrossReferenceAdapter(value);
> 
> 		if (register) {
267,271d271
< 	 *            an object being removed from it
< 	 */
< 	protected void add(Resource resource, EObject eObject) {
< 		// now, register incoming unidirectional references and opposites
< 		CrossReferenceAdapter adapter = getExistingCrossReferenceAdapter(eObject);
273,273c314,314
< 			for (Iterator iter = adapter.getInverseReferencers(eObject, null,
---
> 				for (Iterator iter = adapter.getInverseReferencers(value, null,
275,275c287,287
< 				registerReference(((EObject) iter.next()).eResource(), resource);
---
> 					registerReference(((EObject) iter.next()).eResource(),
276,283d287
< 			}
< 		}
< 
< 		// go through the children of the eObject
< 		for (Iterator i = resolve() ? eObject.eContents().iterator()
< 				: ((InternalEList) eObject.eContents()).basicIterator(); i
< 				.hasNext();) {
< 			EObject notifier = (EObject) i.next();
284,284c288,288
< 			add(resource, notifier);
---
> 							resource);
286a291,291
> 		} else {
287,287d328
< 
288,288c329,329
< 	/**
---
> 	/**
288a330,331
> 	 * Updates the imports and exports map for the contents of the specified
> 	 * eObject
289,290d329
< 	 * Removes all aggregate cross-references for the specified resource, due to
< 	 * detachment of an eObject.
291,291c332,332
< 	 * 
---
> 	 * 
292,292c333,333
< 	 * @param resource
---
> 	 * @param resource
293,293c334,334
< 	 *            a resource
---
> 	 *            a resource
294,294c335,335
< 	 * @param eObject
---
> 	 * @param eObject
294a336,339
> 	 *            the specified eObject
> 	 * @param register
> 	 *            boolean flag to indicate whether to register imports or
> 	 *            unregister imports
295,295d335
< 	 *            an object being removed from it
296a341,342
> 	public void updateImportsAndExportsForContents(Resource resource,
> 			EObject value, boolean register) {
296,296c340,340
< 	 */
---
> 	 */
297,297d340
< 	protected void remove(Resource resource, EObject eObject) {
299,299c293,293
< 		EContentsEList.FeatureIterator crossReferences = (EContentsEList.FeatureIterator) (resolve() ? eObject
---
> 			EContentsEList.FeatureIterator crossReferences = (EContentsEList.FeatureIterator) (resolve() ? value
301a296,296
> 							.basicIterator());
301,301c295,295
< 				: ((InternalEList) eObject.eCrossReferences()).basicIterator());
---
> 					: ((InternalEList) value.eCrossReferences())
306a302,302
> 							.feature();
306,306c301,301
< 				EReference eReference = (EReference) crossReferences.feature();
---
> 					EReference eReference = (EReference) crossReferences
317,317d312
< 		CrossReferenceAdapter adapter = getExistingCrossReferenceAdapter(eObject);
318a283,284
> 				// now, register incoming unidirectional references and
> 				// opposites
319,319c285,285
< 			for (Iterator iter = adapter.getInverseReferencers(eObject, null,
---
> 				for (Iterator iter = adapter.getInverseReferencers(value, null,
324a320,327
> 		}
> 
> 		// process contents
> 		if (adapter != null) {
> 			adapter.updateImportsAndExportsForContents(resource, value,
> 					register);
> 		}
> 	}
327,327c344,344
< 		for (Iterator i = resolve() ? eObject.eContents().iterator()
---
> 		for (Iterator i = resolve() ? value.eContents().iterator()
328,328c345,345
< 				: ((InternalEList) eObject.eContents()).basicIterator(); i
---
> 				: ((InternalEList) value.eContents()).basicIterator(); i
330,330c347,347
< 			EObject notifier = (EObject) i.next();
---
> 			updateImportsAndExports(resource, (EObject) i.next(), register);
331,331d347
< 			remove(resource, notifier);
