16,16c24,24
< import org.eclipse.emf.ecore.EClass;
---
> import org.eclipse.gmf.gmfgraph.ChildAccess;
16a25,25
> import org.eclipse.gmf.gmfgraph.Compartment;
25a27,27
> import org.eclipse.gmf.gmfgraph.DiagramLabel;
26,26c28,28
< import org.eclipse.gmf.gmfgraph.FigureHandle;
---
> import org.eclipse.gmf.gmfgraph.Figure;
26a29,29
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
69a73,73
> 	 * Extended request data key to hold editpart visual id.
115,115c119,119
< 		Command epCommand = getSemanticCommandSwitch(completedRequest);
---
> 		Command semanticCommand = getSemanticCommandSwitch(completedRequest);
115a120,120
> 		if (semanticCommand != null) {
116,116d119
< 		if (epCommand != null) {
117,117c121,121
< 			ICommand command = epCommand instanceof ICommandProxy ? ((ICommandProxy) epCommand).getICommand() : new CommandProxy(epCommand);
---
> 			ICommand command = semanticCommand instanceof ICommandProxy ? ((ICommandProxy) semanticCommand).getICommand() : new CommandProxy(semanticCommand);
120,120d123
< 		Command ehCommand = null;
128,128c131,131
< 				ehCommand = new ICommandProxy(command);
---
> 				semanticCommand = new ICommandProxy(command);
139,139c142,142
< 				ehCommand = ehCommand == null ? deleteViewCommand : ehCommand.chain(deleteViewCommand);
---
> 				semanticCommand = semanticCommand == null ? deleteViewCommand : semanticCommand.chain(deleteViewCommand);
141,141c144,144
< 			return ehCommand;
---
> 			return semanticCommand;
256,256c259,259
< 	protected Command getMSLWrapper(ICommand cmd) {
---
> 	protected final Command getGEFWrapper(ICommand cmd) {
260a264,264
> 	 * @deprecated use getGEFWrapper() instead
262a267,269
> 	protected final Command getMSLWrapper(ICommand cmd) {
> 		// XXX deprecated: use getGEFWrapper() instead
> 		return getGEFWrapper(cmd);
263,263c275,275
< 	protected EObject getSemanticElement() {
---
> 	protected EObject getSemanticElement() {
264,264c276,276
< 		return ViewUtil.resolveSemanticElement((View) getHost().getModel());
---
> 		return ViewUtil.resolveSemanticElement((View) getHost().getModel());
268,272d272
< 	 * Finds container element for the new relationship of the specified type.
< 	 * Default implementation goes up by containment hierarchy starting from
< 	 * the specified element and returns the first element that is instance of
< 	 * the specified container class.
< 	 * 
275,284d274
< 	protected EObject getRelationshipContainer(Object uelement, EClass containerClass, IElementType relationshipType) {
< 		if (uelement instanceof EObject) {
< 			EObject element = (EObject) uelement;
< 			for (; element != null; element = element.eContainer()) {
< 				if (containerClass.isSuperTypeOf(element.eClass())) {
< 					return element;
< 				}
< 			}
< 		}
< 		return null;
300a293,293
> 	protected Command getDestroyElementCommand(View view) {
301,301d292
< 	protected Command getDestroyEdgeCommand(Edge edge, boolean confirm) {
302,302c294,294
< 		EditPart editPart = (EditPart) getHost().getViewer().getEditPartRegistry().get(edge);
---
> 		EditPart editPart = (EditPart) getHost().getViewer().getEditPartRegistry().get(view);
303,303c295,295
< 		DestroyElementRequest request = new DestroyElementRequest(getEditingDomain(), confirm);
---
> 		DestroyElementRequest request = new DestroyElementRequest(getEditingDomain(), false);
312,312c304,304
< 	protected CompoundCommand getDestroyEdgesCommand(boolean confirm) {
---
> 	protected CompoundCommand getDestroyEdgesCommand() {
316,316c308,308
< 			cmd.add(getDestroyEdgeCommand((Edge) it.next(), confirm));
---
> 			cmd.add(getDestroyElementCommand((Edge) it.next()));
319,319c311,311
< 			cmd.add(getDestroyEdgeCommand((Edge) it.next(), confirm));
---
> 			cmd.add(getDestroyElementCommand((Edge) it.next()));
326a319,335
> 	protected void addDestroyShortcutsCommand(CompoundCommand command) {
> 		View view = (View) getHost().getModel();
> 		if (view.getEAnnotation("Shortcut") != null) { //$NON-NLS-1$
> 			return;
> 		}
> 		for (Iterator it = view.getDiagram().getChildren().iterator(); it.hasNext();) {
> 			View nextView = (View) it.next();
> 			if (nextView.getEAnnotation("Shortcut") == null || !nextView.isSetElement() || nextView.getElement() != view.getElement()) { //$NON-NLS-1$
> 				continue;
> 			}
> 			command.add(getDestroyElementCommand(nextView));
> 		}
> 	}
> 
> 	/**
> 	 * @generated
> 	 */
332,332c405,405
< 		public static boolean canCreateDiagramElementFigure_4001(DiagramElement source, FigureHandle target) {
---
> 		public static boolean canExistDiagramElementFigure_4005(DiagramElement source, FigureDescriptor target) {
338,338c378,378
< 			return canExistDiagramElementFigure_4001(source, target);
---
> 			return canExistDiagramElementFigure_4005(source, target);
338a379,399
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
> 		public static boolean canExistChildAccess_4002(FigureDescriptor source, Figure target) {
> 			return true;
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
> 		public static boolean canExistCompartmentAccessor_4003(Compartment source, ChildAccess target) {
> 			return true;
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
> 		public static boolean canExistDiagramLabelAccessor_4004(DiagramLabel source, ChildAccess target) {
> 			return true;
343a341,371
> 		public static boolean canCreateChildAccess_4002(FigureDescriptor source, Figure target) {
> 			return canExistChildAccess_4002(source, target);
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
> 		public static boolean canCreateCompartmentAccessor_4003(Compartment source, ChildAccess target) {
> 			if (source != null) {
> 				if (source.getAccessor() != null) {
> 					return false;
> 				}
> 			}
> 			return canExistCompartmentAccessor_4003(source, target);
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
> 		public static boolean canCreateDiagramLabelAccessor_4004(DiagramLabel source, ChildAccess target) {
> 			if (source != null) {
> 				if (source.getAccessor() != null) {
> 					return false;
> 				}
> 			}
> 			return canExistDiagramLabelAccessor_4004(source, target);
> 		}
> 
> 		/**
> 		 * @generated
> 		 */
344,344c372,372
< 		public static boolean canExistDiagramElementFigure_4001(DiagramElement source, FigureHandle target) {
---
> 		public static boolean canCreateDiagramElementFigure_4005(DiagramElement source, FigureDescriptor target) {
