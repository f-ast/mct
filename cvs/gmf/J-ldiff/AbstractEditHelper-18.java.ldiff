21a22,22
> import java.util.Set;
43a45,45
> import org.eclipse.gmf.runtime.emf.type.core.internal.requests.RequestCacheEntries;
306a312,312
> 		IEditHelperAdvice[] advices = null;
307a151,151
> 	
307,307c150,150
< 
---
> 
308a314,324
> 		Map cacheMaps = (Map) req
> 			.getParameter(RequestCacheEntries.Cache_Maps);
> 		if (cacheMaps != null) {
> 			Map contextMap = (Map) cacheMaps.get(editHelperContext);
> 			if (contextMap != null) {
> 				advices = (IEditHelperAdvice[]) contextMap.get(RequestCacheEntries.EditHelper_Advice);
> 			}			
> 		}		
> 		
> 		if (advices == null) {			
> 			advices = ElementTypeRegistry.getInstance().getEditHelperAdvice(
309,309d313
< 		return ElementTypeRegistry.getInstance().getEditHelperAdvice(
321a153,153
>     
322,322d152
< 		
324,324c340,340
< 				req.getEditingDomain(),
---
> 			req.getEditingDomain(), req.getLabel()) {
325,325d340
< 				req.getLabel()) {
332,332c347,347
< 				CommandResult result = super.getCommandResult();
---
> 				CommandResult _result = super.getCommandResult();
334,334c349,349
< 				IStatus status = result.getStatus();
---
> 				IStatus status = (_result == null) ? null : _result.getStatus();
336,336c351,351
< 				if (status.getSeverity() == IStatus.OK) {
---
> 				if (status != null && status.getSeverity() == IStatus.OK) {
339,339c354,354
< 					Object returnValue = result.getReturnValue();
---
> 					Object returnValue = _result.getReturnValue();
351,351c366,366
< 					result = new CommandResult(status, returnObject);
---
> 					_result = new CommandResult(status, returnObject);
353a369,369
> 				return _result;
354a328,328
> 	}
354,354c327,327
< 				return result;
---
> 		return advices;
361a649,649
> 	
361,361c648,648
< 		
---
> 	
645,645c661,661
< 	protected ICommand getDestroyElementWithDependentsCommand(DestroyElementRequest req) {
---
> 	protected ICommand getDestroyElementWithDependentsCommand(
645a662,662
> 			DestroyElementRequest req) {
647a665,665
> 		EObject initial = (EObject) req
648,648d664
< 		EObject initial = (EObject) req.getParameter(
649,649c666,666
< 				DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER);
---
> 			.getParameter(DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER);
654,654c671,671
< 					DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER,
---
> 				DestroyElementRequest.INITIAL_ELEMENT_TO_DESTROY_PARAMETER, req
655,655c672,672
< 					req.getElementToDestroy());
---
> 					.getElementToDestroy());
660,660c677,677
< 		DestroyDependentsRequest ddr = (DestroyDependentsRequest) req.getParameter(
---
> 		DestroyDependentsRequest ddr = (DestroyDependentsRequest) req
661,661c678,678
< 				DestroyElementRequest.DESTROY_DEPENDENTS_REQUEST_PARAMETER);
---
> 			.getParameter(DestroyElementRequest.DESTROY_DEPENDENTS_REQUEST_PARAMETER);
664a682,682
> 			ddr = new DestroyDependentsRequest(req.getEditingDomain(), req
665,667d681
< 			ddr = new DestroyDependentsRequest(
< 				req.getEditingDomain(),
< 				req.getElementToDestroy(),
668,668c683,683
< 				req.isConfirmationRequired());
---
> 				.getElementToDestroy(), req.isConfirmationRequired());
672a688,688
> 			req
673,673c689,689
< 			req.setParameter(
---
> 				.setParameter(
679a696,707
> 		IElementType typeToDestroy = null;
> 		Map cacheMaps = (Map) req.getParameter(RequestCacheEntries.Cache_Maps);
> 		if (cacheMaps != null) {
> 			Map map = (Map) cacheMaps.get(req.getElementToDestroy());
> 			if (map != null) {
> 				typeToDestroy = (IElementType) map
> 					.get(RequestCacheEntries.Element_Type);
> 			}
> 		}
> 
> 		if (typeToDestroy == null) {
> 			typeToDestroy = ElementTypeRegistry.getInstance().getElementType(
680,680d695
< 		IElementType typeToDestroy = ElementTypeRegistry.getInstance().getElementType(
681a709,709
> 		}
710a739,753
> 		
> 		IElementType parentType = null;	
> 		
> 		Map cacheMaps = (Map) req
> 			.getParameter(RequestCacheEntries.Cache_Maps);
> 		Set checkedElement = null;
> 		if (cacheMaps != null) {
> 			checkedElement = (Set) cacheMaps
> 			.get(RequestCacheEntries.Checked_Elements);
> 			checkedElement.add(parent);
> 			Map parentMap = (Map) cacheMaps.get(parent);
> 			parentType = (IElementType) parentMap
> 				.get(RequestCacheEntries.Element_Type);			
> 		} else {
> 			parentType = ElementTypeRegistry.getInstance().getElementType(
711,711d738
< 		IElementType parentType = ElementTypeRegistry.getInstance().getElementType(
712a755,755
> 		}
722,722c765,765
< 				//    is (transitively) a dependent, then don't destroy it again
---
> 				// is (transitively) a dependent, then don't destroy it again .
723,723c766,766
< 				if ((ddr == null) || !ddr.getDependentElementsToDestroy().contains(next)) {
---
> 				if ((ddr == null) || ((checkedElement != null) && checkedElement.add(next)) || (!ddr.getDependentElementsToDestroy().contains(next))) {
