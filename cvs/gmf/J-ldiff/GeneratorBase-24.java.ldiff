317a318,318
> 			pm.beginTask(null, 6);
318,318d317
< 			pm.beginTask(null, 5);
319,319c319,319
< 			String genText = emitter.generate(new SubProgressMonitor(pm, 1), input);
---
> 			String genText = emitter.generate(new SubProgressMonitor(pm, 2), input);
323a331,331
> 				genText = mergeJavaCode(oldContents, cu.getSource(), new SubProgressMonitor(pm, 1));
324,324d330
< 				genText = mergeJavaCode(oldContents, genText, new SubProgressMonitor(pm, 1));
325,325c332,332
< 				genText = formatCode(genText);
---
> 				genText = formatCode(genText);
326a334,334
> 					cu.getBuffer().setContents(genText);
326,326c333,333
< 				if (!genText.equals(oldContents)) { // compare text with fqns; works for jet templates
---
> 				if (!genText.equals(oldContents)) {
334,336d330
< 					String newContents = formatCode(cu.getSource());
< 					if (!newContents.equals(oldContents)) { // compare text with organized imports; works for xpand templates
< 						cu.getBuffer().setContents(newContents);
338a337,337
> 					cu.getBuffer().close(); // discard changes
342,344d340
< 					pm.worked(2);
< 				}
< 			} else {
