14a15,15
> import java.text.MessageFormat;
28a30,30
> import org.eclipse.emf.ecore.EObject;
54,54d55
< 	private URI myMapModelURI;
60a62,62
> 	private IStatus myLoadMapmodelStatus = Status.CANCEL_STATUS;
61,61d61
< 	private IStatus myLoadMapmodelStatus;
62,62c63,63
< 	private IStatus myStaleGenmodelStatus;
---
> 	private IStatus myStaleGenmodelStatus = Status.CANCEL_STATUS;
63a65,65
> 	public TransformToGenModelOperation() {
64,66d64
< 	public TransformToGenModelOperation(URI mapURI) {
< 		assert mapURI != null;
< 		this.myMapModelURI = mapURI;
74,77d72
< 	public URI getMapURI() {
< 		return this.myMapModelURI;
< 	}
< 	
82,82c77,77
< 	void setGenURI(URI gmfGen) {
---
> 	public void setGenURI(URI gmfGen) {
86,86c81,81
< 	private GenModel getGenModel() {
---
> 	public GenModel getGenModel() {
94,94c89,89
< 	private void setMapping(Mapping m) {
---
> 	private void setMapping(Mapping m, IStatus loadStatus) {
95a91,92
> 		this.myLoadMapmodelStatus = loadStatus;
> 		myGMDetector = (m != null) ? new GenModelDetector(m) : null;
96,96d90
< 		myGMDetector = null;
99a96,96
> 	public GenModelDetector getGenModelDetector() {
100,103d95
< 	GenModelDetector getGenModelDetector() {
< 		if (myGMDetector == null) {
< 			myGMDetector = new GenModelDetector(getMapping());
< 		}
107,107c100,100
< 	IStatus getLoadMappingStatus() {
---
> 	public IStatus getLoadMappingStatus() {
111,111c104,104
< 	IStatus getStaleGenmodelStatus() {
---
> 	public IStatus getStaleGenmodelStatus() {
115a109,110
> 		Mapping content = null;
> 		IStatus status = Status.CANCEL_STATUS;
115,115c108,108
< 	Mapping loadMappingModel(ResourceSet rs, URI uri, IProgressMonitor pm) throws CoreException {
---
> 	public Mapping loadMappingModel(ResourceSet rs, URI uri, IProgressMonitor pm) throws CoreException {
117a113,116
> 			checkResourceSet(rs);
> 			if (uri == null) {
> 				throw new IllegalArgumentException(Messages.TransformToGenModelOperation_e_null_map_uri);
> 			}
122a122,123
> 			status = loadHelper.getStatus();
> 			if (!status.isOK()) {
123,124d121
< 			IStatus loadStatus = loadHelper.getStatus();
< 			if (!loadStatus.isOK()) {
125,125c124,124
< 				throw new CoreException(loadStatus);
---
> 				throw new CoreException(status);
127a127,133
> 			EObject root = loadHelper.getContentsRoot();
> 			if (!(root instanceof Mapping)) {
> 				String msg = MessageFormat.format(Messages.TransformToGenModelOperation_e_wrong_root_element, root.getClass().getName());
> 				status = Plugin.createError(msg, null);
> 				throw new CoreException(status);
> 			}
> 			content = (Mapping) loadHelper.getContentsRoot();
128,128d126
< 			final Mapping content = (Mapping) loadHelper.getContentsRoot();
130a136,136
> 			status = getFirst(mapIsValid);
131,131d135
< 			IStatus mapStatus = getFirst(mapIsValid);
132,132c137,137
< 			if (Diagnostic.CANCEL == mapStatus.getSeverity()) {
---
> 			if (Diagnostic.CANCEL == status.getSeverity()) {
134,134c139,139
< 			} else if(Diagnostic.ERROR == mapStatus.getSeverity()) {
---
> 			} else if(Diagnostic.ERROR == status.getSeverity()) {
135,135c140,140
< 				throw new CoreException(mapStatus);
---
> 				throw new CoreException(status);
137,138d141
< 				setMapping(content);
< 				this.myLoadMapmodelStatus = mapStatus;
140a144,148
> 		} catch (CoreException e) {
> 			throw e;
> 		} catch (Exception e) {
> 			IStatus error = Plugin.createError(Messages.TransformToGenModelOperation_e_load_mapping_model, e);
> 			throw new CoreException(error);
141a150,151
> 			setMapping(content, status);
> 			if (monitor != null) {
144a155,155
> 	}
146,146c157,157
< 	GenModel findGenmodel(ResourceSet rs) throws CoreException {
---
> 	public GenModel findGenmodel(ResourceSet rs) throws CoreException {
147a159,160
> 			checkResourceSet(rs);
> 			checkMapping();
162,162c175,175
< 	GenModel loadGenModel(ResourceSet rs, URI uri, IProgressMonitor pm) throws CoreException {
---
> 	public GenModel loadGenModel(ResourceSet rs, URI uri, IProgressMonitor pm) throws CoreException {
164a178,179
> 			checkResourceSet(rs);
> 			checkMapping();
209,209c224,224
< 	IStatus executeTransformation(ResourceSet rs, IProgressMonitor pm) {
---
> 	public IStatus executeTransformation(ResourceSet rs, IProgressMonitor pm) {
211a227,231
> 			checkResourceSet(rs);
> 			if (getGenURI() == null) {
> 				throw new IllegalStateException(Messages.TransformToGenModelOperation_e_null_gmfgen_uri);
> 			}
> 			checkMapping();
258a279,288
> 	private void checkResourceSet(ResourceSet rs) {
> 		if (rs == null) {
> 			throw new IllegalArgumentException(Messages.TransformToGenModelOperation_e_null_resource_set);
> 		}
> 	}
> 
> 	private void checkMapping() {
> 		if (getMapping() == null) {
> 			throw new IllegalStateException(Messages.TransformToGenModelOperation_e_null_mapping);
> 		}
259,264d278
< 	public void reset(URI uri) {
< 		assert uri != null;
< 		myMapModelURI = uri;
< 		setMapping(null);
< 		myLoadMapmodelStatus = null;
< 		myStaleGenmodelStatus = null;
