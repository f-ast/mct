27a28,29
> import org.eclipse.gmf.gmfgraph.util.FigureQualifiedNameSwitch;
> import org.eclipse.gmf.gmfgraph.util.GMFGraphSwitch;
39a42,45
> import org.eclipse.gmf.internal.codegen.dispatch.EmitterFactory;
> import org.eclipse.gmf.internal.codegen.dispatch.HierarchyKeyMap;
> import org.eclipse.gmf.internal.codegen.dispatch.KeyChain;
> import org.eclipse.gmf.internal.codegen.dispatch.KeyMap;
40,43d41
< import org.eclipse.gmf.internal.graphdef.codegen.DispatcherImpl;
< import org.eclipse.gmf.internal.graphdef.codegen.HierarchyKeyMap;
< import org.eclipse.gmf.internal.graphdef.codegen.KeyChain;
< import org.eclipse.gmf.internal.graphdef.codegen.KeyMap;
44,44c46,46
< import org.eclipse.gmf.internal.graphdef.codegen.StaticTemplateRegistry;
---
> import org.eclipse.gmf.internal.codegen.dispatch.StaticTemplateRegistry;
45,45c47,47
< import org.eclipse.gmf.internal.graphdef.codegen.TemplateRegistry;
---
> import org.eclipse.gmf.internal.codegen.dispatch.TemplateRegistry;
46,46d47
< import org.eclipse.gmf.internal.graphdef.codegen.YAEmitterFactory;
54a56,56
> 	private GraphDefDispatcher myTopDispatcher;
55,55d55
< 	private Dispatcher myTopDispatcher;
56,56c57,57
< 	private Dispatcher myInnerDispatcher;
---
> 	private GraphDefDispatcher myInnerDispatcher;
58a60,60
> 		this(null, new NullImportAssistant(), new FigureQualifiedNameSwitch());
59,59d59
< 		this(null);
62,62c63,63
< 	public FigureGenerator(String aPackageName) {
---
> 	public FigureGenerator(String aPackageName, ImportAssistant importManager, GMFGraphSwitch figureNameSwitch) {
84a86,86
> 		myTopDispatcher = new GraphDefDispatcher(topFactory, keyMap, importManager, figureNameSwitch);
84,84c85,85
< 		YAEmitterFactory topFactory = new YAEmitterFactory(thisBundle.getEntry("/"), fillTopLevel(), true, variables, true);
---
> 		EmitterFactory topFactory = new EmitterFactory(thisBundle.getEntry("/"), fillTopLevel(), true, variables, true);
85,85d85
< 		myTopDispatcher = new DispatcherImpl(topFactory, keyMap);
86,86c87,87
< 		YAEmitterFactory innerFactory = new YAEmitterFactory(thisBundle.getEntry("/"), fillAttrs(), true, variables, true);
---
> 		EmitterFactory innerFactory = new EmitterFactory(thisBundle.getEntry("/"), fillAttrs(), true, variables, true);
87,87c88,88
< 		myInnerDispatcher = new DispatcherImpl(innerFactory, keyMap);
---
> 		myInnerDispatcher = new GraphDefDispatcher(innerFactory, keyMap, importManager, figureNameSwitch);
131,134d131
< 		return go(fig, new NullImportAssistant());
< 	}
< 
< 	public String go(Figure fig, ImportAssistant importManager) {
135a133,133
> 		Object args = new Object[] {fig, myTopDispatcher.getImportManager(), myTopDispatcher.getFQNSwitch(), myInnerDispatcher};
136,136c134,134
< 		res = myTopDispatcher.dispatch(fig, new Object[] {fig, importManager, myInnerDispatcher});
---
> 		res = myTopDispatcher.dispatch(fig, args);
