92,92d91
< 				IDiagramDocument diagramDocument = (IDiagramDocument)event.getEventInfo();
93,93c92,92
< 				Diagram newContent = diagramDocument.getDiagram();
---
> 				Diagram newContent = (Diagram)event.getEventInfo();
127a128,128
>         if(((DiagramFileInfo)info).fListener != null)
128,128c129,129
< 			((DiagramFileInfo)info).fListener.stopListening();
---
>             ((DiagramFileInfo)info).fListener.stopListening();
242a243,243
>     protected FileInfo createFileInfo(IDocument document,
243,243c244,244
< 	protected FileInfo createFileInfo(IDocument document, FileSynchronizer synchronizer, IFileEditorInput input) {
---
>             FileSynchronizer synchronizer, IFileEditorInput input) {
245a247,251
>         DiagramModificationListener diagramListener = null;
>         if (((DiagramDocument) document).getDiagram() != null) {
>             diagramListener = new FileDiagramModificationListener(this,
>                 (DiagramDocument) document, input);
>         }
246,246d246
< 		DiagramModificationListener diagramListener = new FileDiagramModificationListener(this, (DiagramDocument)document, input);
247a253,253
>             diagramListener);
247,247c252,252
< 		DiagramFileInfo info = new DiagramFileInfo(document, synchronizer, diagramListener);
---
>         DiagramFileInfo info = new DiagramFileInfo(document, synchronizer,
248a255,256
>         if (info.fListener != null)
>             info.fListener.startListening();
249,249d254
< 		diagramListener.startListening();
251a259,261
> 	/*
>      * (non-Javadoc)
>      * 
252,253d258
< 
< 	/* (non-Javadoc)
254,254c262,262
< 	 * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.StorageDocumentProvider#setDocumentContent(org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.IDocument, org.eclipse.ui.IEditorInput)
---
>      * @see org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.StorageDocumentProvider#setDocumentContent(org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.IDocument,
254a263,263
>      *      org.eclipse.ui.IEditorInput)
