54a55,55
> import org.eclipse.swt.graphics.Image;
504a506,507
>         IFigure fig = getEditPart().getFigure();
> 
505,505d505
<     	WrapLabel fig = ((TextCompartmentEditPart)this.getEditPart()).getLabel();
512a515,515
> 
527a531,552
>         Rectangle iconBounds;
>         Image icon;
>         int textPlacement;
>         String subStringText;
>         String text;
> 
>         IFigure fig = getEditPart().getFigure();
>         if (fig instanceof WrapLabel) {
>             WrapLabel label = (WrapLabel) fig;
>             iconBounds = label.getIconBounds().getCopy();
>             icon = label.getIcon();
>             textPlacement = label.getTextPlacement();
>             subStringText = label.getSubStringText();
>             text = label.getText();
>         } else if (fig instanceof Label) {
>             Label label = (Label) fig;
>             iconBounds = label.getIconBounds().getCopy();
>             icon = label.getIcon();
>             textPlacement = label.getTextPlacement();
>             subStringText = label.getSubStringText();
>             text = label.getText();
>         } else {
528,528d530
< 		if (!(getEditPart() instanceof TextCompartmentEditPart)) {
533,533d556
< 		WrapLabel fig = ((TextCompartmentEditPart)this.getEditPart()).getLabel();
548,548d570
< 		Rectangle iconBounds = fig.getIconBounds().getCopy();
555,555c577,577
< 		if (fig.getIcon() != null && fig.getTextPlacement() == PositionConstants.EAST) 
---
>         if (icon != null && textPlacement == PositionConstants.EAST) 
566,566c588,588
< 		StringTokenizer tokenizer = new StringTokenizer(fig.getSubStringText(), "\n"); //$NON-NLS-1$
---
>         StringTokenizer tokenizer = new StringTokenizer(subStringText, "\n"); //$NON-NLS-1$
574,574c596,596
< 				String newLineCheck = fig.getText().substring(charCount,charCount+1); 
---
>                 String newLineCheck = text.substring(charCount,charCount+1); 
