2,2c2,2
<  * Copyright (c) 2006 Borland Software Corporation and others.
---
>  *  Copyright (c) 2006, 2007 Borland Software Corporation and others.
12a13,16
> import java.util.ArrayList;
> import java.util.Collection;
> import java.util.Collections;
> import java.util.Iterator;
13,14d35
< import org.eclipse.gef.commands.Command;
< import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
15,15c36,36
< import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
16,16c37,37
< import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
17,20d37
< import org.eclipse.emf.ecore.EObject;
< import org.eclipse.emf.ecore.EAnnotation;
< import org.eclipse.gmf.runtime.notation.View;
< import org.eclipse.emf.ecore.EClass;
21a18,21
> import org.eclipse.emf.ecore.EObject;
> import org.eclipse.gef.EditPart;
> import org.eclipse.gef.commands.Command;
> import org.eclipse.gef.commands.CompoundCommand;
23,23c125,125
< 
---
> 
24a24,24
> import org.eclipse.gmf.gmfgraph.FigureHandle;
25a26,30
> import org.eclipse.gmf.graphdef.editor.edit.commands.EllipseCreateCommand;
> import org.eclipse.gmf.graphdef.editor.edit.commands.PolylineCreateCommand;
> import org.eclipse.gmf.graphdef.editor.edit.commands.Rectangle2CreateCommand;
> import org.eclipse.gmf.graphdef.editor.edit.commands.RoundedRectangleCreateCommand;
> import org.eclipse.gmf.graphdef.editor.edit.parts.Rectangle2EditPart;
26,26d25
< 
27a32,32
> import org.eclipse.gmf.runtime.diagram.ui.requests.EditCommandRequestWrapper;
28,28d31
< 
29,29c33,33
< import org.eclipse.gmf.runtime.emf.type.core.commands.CreateElementCommand;
---
> import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
31,31d34
< 
33a39,40
> import org.eclipse.gmf.runtime.notation.Edge;
> import org.eclipse.gmf.runtime.notation.View;
48,48c55,55
< 			return getMSLWrapper(new CreateRectangle_3002Command(req));
---
> 			return getMSLWrapper(new Rectangle2CreateCommand(req));
54,54c61,61
< 			return getMSLWrapper(new CreateEllipse_3003Command(req));
---
> 			return getMSLWrapper(new EllipseCreateCommand(req));
60,60c67,67
< 			return getMSLWrapper(new CreateRoundedRectangle_3004Command(req));
---
> 			return getMSLWrapper(new RoundedRectangleCreateCommand(req));
66,66c73,73
< 			return getMSLWrapper(new CreatePolyline_3005Command(req));
---
> 			return getMSLWrapper(new PolylineCreateCommand(req));
74,197d80
< 	private static class CreateRectangle_3002Command extends CreateElementCommand {
< 
< 		/**
< 		 * @generated
< 		 */
< 		public CreateRectangle_3002Command(CreateElementRequest req) {
< 			super(req);
< 		}
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EClass getEClassToEdit() {
< 			return GMFGraphPackage.eINSTANCE.getRectangle();
< 		};
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EObject getElementToEdit() {
< 			EObject container = ((CreateElementRequest) getRequest()).getContainer();
< 			if (container instanceof View) {
< 				container = ((View) container).getElement();
< 			}
< 			return container;
< 		}
< 	}
< 
< 	/**
< 	 * @generated
< 	 */
< 	private static class CreateEllipse_3003Command extends CreateElementCommand {
< 
< 		/**
< 		 * @generated
< 		 */
< 		public CreateEllipse_3003Command(CreateElementRequest req) {
< 			super(req);
< 		}
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EClass getEClassToEdit() {
< 			return GMFGraphPackage.eINSTANCE.getRectangle();
< 		};
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EObject getElementToEdit() {
< 			EObject container = ((CreateElementRequest) getRequest()).getContainer();
< 			if (container instanceof View) {
< 				container = ((View) container).getElement();
< 			}
< 			return container;
< 		}
< 	}
< 
< 	/**
< 	 * @generated
< 	 */
< 	private static class CreateRoundedRectangle_3004Command extends CreateElementCommand {
< 
< 		/**
< 		 * @generated
< 		 */
< 		public CreateRoundedRectangle_3004Command(CreateElementRequest req) {
< 			super(req);
< 		}
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EClass getEClassToEdit() {
< 			return GMFGraphPackage.eINSTANCE.getRectangle();
< 		};
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EObject getElementToEdit() {
< 			EObject container = ((CreateElementRequest) getRequest()).getContainer();
< 			if (container instanceof View) {
< 				container = ((View) container).getElement();
< 			}
< 			return container;
< 		}
< 	}
< 
< 	/**
< 	 * @generated
< 	 */
< 	private static class CreatePolyline_3005Command extends CreateElementCommand {
< 
< 		/**
< 		 * @generated
< 		 */
< 		public CreatePolyline_3005Command(CreateElementRequest req) {
< 			super(req);
< 		}
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EClass getEClassToEdit() {
< 			return GMFGraphPackage.eINSTANCE.getRectangle();
< 		};
< 
< 		/**
< 		 * @generated
< 		 */
< 		protected EObject getElementToEdit() {
< 			EObject container = ((CreateElementRequest) getRequest()).getContainer();
< 			if (container instanceof View) {
< 				container = ((View) container).getElement();
< 			}
< 			return container;
< 		}
< 	}
< 
< 	/**
< 	 * @generated
< 	 */
198a82,83
> 		CompoundCommand cc = new CompoundCommand();
> 		Collection allEdges = new ArrayList();
199,199c94,94
< 		return getMSLWrapper(new DestroyElementCommand(req) {
---
> 		cc.add(getMSLWrapper(new DestroyElementCommand(req)));
199a95,95
> 		return cc;
200,201d94
< 
< 			protected EObject getElementToDestroy() {
202a85,92
> 		allEdges.addAll(view.getSourceEdges());
> 		allEdges.addAll(view.getTargetEdges());
> 		for (Iterator it = allEdges.iterator(); it.hasNext();) {
> 			Edge nextEdge = (Edge) it.next();
> 			EditPart nextEditPart = (EditPart) getHost().getViewer().getEditPartRegistry().get(nextEdge);
> 			EditCommandRequestWrapper editCommandRequest = new EditCommandRequestWrapper(new DestroyElementRequest(((Rectangle2EditPart) getHost()).getEditingDomain(), req.isConfirmationRequired()),
> 					Collections.EMPTY_MAP);
> 			cc.add(nextEditPart.getCommand(editCommandRequest));
203,205d84
< 				EAnnotation annotation = view.getEAnnotation("Shortcut"); //$NON-NLS-1$
< 				if (annotation != null) {
< 					return view;
207,210d93
< 				return super.getElementToDestroy();
< 			}
< 
< 		});
218,218c103,103
< 			return req.getTarget() == null ? null : getCreateCompleteIncomingDiagramElement_Figure4001Command(req);
---
> 			return req.getTarget() == null ? null : getCreateCompleteIncomingDiagramElementFigure_4001Command(req);
226,226c111,111
< 	protected Command getCreateCompleteIncomingDiagramElement_Figure4001Command(CreateRelationshipRequest req) {
---
> 	protected Command getCreateCompleteIncomingDiagramElementFigure_4001Command(CreateRelationshipRequest req) {
226a112,114
> 		EObject sourceEObject = req.getSource();
> 		EObject targetEObject = req.getTarget();
> 		if (false == sourceEObject instanceof DiagramElement || false == targetEObject instanceof FigureHandle) {
227,227d111
< 		if (!(req.getSource() instanceof DiagramElement)) {
229a117,119
> 		DiagramElement source = (DiagramElement) sourceEObject;
> 		FigureHandle target = (FigureHandle) targetEObject;
> 		if (!GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001(source, target)) {
230,231d116
< 		DiagramElement element = (DiagramElement) req.getSource();
< 		if (element.getFigure() != null) {
234,234c122,122
< 		SetRequest setReq = new SetRequest(req.getSource(), GMFGraphPackage.eINSTANCE.getDiagramElement_Figure(), req.getTarget());
---
> 		SetRequest setReq = new SetRequest(sourceEObject, GMFGraphPackage.eINSTANCE.getDiagramElement_Figure(), target);
