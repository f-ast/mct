13,13d12
< import org.eclipse.emf.codegen.ecore.genmodel.GenModel;
30,30c33,33
< import org.eclipse.gmf.codegen.gmfgen.GenAuditContainer;
---
> import org.eclipse.gmf.codegen.gmfgen.GenEditorGenerator;
36,36c41,41
< import org.eclipse.gmf.codegen.gmfgen.GenPlugin;
---
> import org.eclipse.gmf.common.codegen.ImportAssistant;
96,96d94
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getDomainMetaModel <em>Domain Meta Model</em>}</li>
102,102c95,95
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getAudits <em>Audits</em>}</li>
---
>  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getEditorGen <em>Editor Gen</em>}</li>
104,104d101
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPlugin <em>Plugin</em>}</li>
975,984d971
< 	 * The cached value of the '{@link #getDomainMetaModel() <em>Domain Meta Model</em>}' reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getDomainMetaModel()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenPackage domainMetaModel = null;
< 
< 	/**
1035,1044d1021
< 	 * The cached value of the '{@link #getAudits() <em>Audits</em>}' containment reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getAudits()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenAuditContainer audits = null;
< 
< 	/**
1055,1064d1031
< 	 * The cached value of the '{@link #getPlugin() <em>Plugin</em>}' containment reference.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPlugin()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected GenPlugin plugin = null;
< 
< 	/**
1138,1175d1104
< 	public GenPackage getDomainMetaModel() {
< 		if (domainMetaModel != null && domainMetaModel.eIsProxy()) {
< 			InternalEObject oldDomainMetaModel = (InternalEObject)domainMetaModel;
< 			domainMetaModel = (GenPackage)eResolveProxy(oldDomainMetaModel);
< 			if (domainMetaModel != oldDomainMetaModel) {
< 				if (eNotificationRequired())
< 					eNotify(new ENotificationImpl(this, Notification.RESOLVE, GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL, oldDomainMetaModel, domainMetaModel));
< 			}
< 		}
< 		return domainMetaModel;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public GenPackage basicGetDomainMetaModel() {
< 		return domainMetaModel;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setDomainMetaModel(GenPackage newDomainMetaModel) {
< 		GenPackage oldDomainMetaModel = domainMetaModel;
< 		domainMetaModel = newDomainMetaModel;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL, oldDomainMetaModel, domainMetaModel));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1262,1304d1190
< 	public GenAuditContainer getAudits() {
< 		return audits;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public NotificationChain basicSetAudits(GenAuditContainer newAudits, NotificationChain msgs) {
< 		GenAuditContainer oldAudits = audits;
< 		audits = newAudits;
< 		if (eNotificationRequired()) {
< 			ENotificationImpl notification = new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__AUDITS, oldAudits, newAudits);
< 			if (msgs == null) msgs = notification; else msgs.add(notification);
< 		}
< 		return msgs;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setAudits(GenAuditContainer newAudits) {
< 		if (newAudits != audits) {
< 			NotificationChain msgs = null;
< 			if (audits != null)
< 				msgs = ((InternalEObject)audits).eInverseRemove(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__AUDITS, null, msgs);
< 			if (newAudits != null)
< 				msgs = ((InternalEObject)newAudits).eInverseAdd(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__AUDITS, null, msgs);
< 			msgs = basicSetAudits(newAudits, msgs);
< 			if (msgs != null) msgs.dispatch();
< 		}
< 		else if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__AUDITS, newAudits, newAudits));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1347a2731,2736
> 	public NotificationChain eBasicRemoveFromContainerFeature(NotificationChain msgs) {
> 		switch (eContainerFeatureID) {
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
> 				return eInternalContainer().eInverseRemove(this, GMFGenPackage.GEN_EDITOR_GENERATOR__DIAGRAM, GenEditorGenerator.class, msgs);
> 		}
> 		return super.eBasicRemoveFromContainerFeature(msgs);
1348,1349d2730
< 	public GenPlugin getPlugin() {
< 		return plugin;
1350,1350c2737,2737
< 	}
---
> 	}
1351,1351c2738,2738
< 
---
> 
1352,1352c2739,2739
< 	/**
---
> 	/**
1353,1353c2740,2740
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
1354,1354c2741,2741
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
1355,1355c2742,2742
< 	 * @generated
---
> 	 * @generated
1356,1356c2743,2743
< 	 */
---
> 	 */
1357,1390d2743
< 	public NotificationChain basicSetPlugin(GenPlugin newPlugin, NotificationChain msgs) {
< 		GenPlugin oldPlugin = plugin;
< 		plugin = newPlugin;
< 		if (eNotificationRequired()) {
< 			ENotificationImpl notification = new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, oldPlugin, newPlugin);
< 			if (msgs == null) msgs = notification; else msgs.add(notification);
< 		}
< 		return msgs;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setPlugin(GenPlugin newPlugin) {
< 		if (newPlugin != plugin) {
< 			NotificationChain msgs = null;
< 			if (plugin != null)
< 				msgs = ((InternalEObject)plugin).eInverseRemove(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
< 			if (newPlugin != null)
< 				msgs = ((InternalEObject)newPlugin).eInverseAdd(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
< 			msgs = basicSetPlugin(newPlugin, msgs);
< 			if (msgs != null) msgs.dispatch();
< 		}
< 		else if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, newPlugin, newPlugin));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
1474,1474d1316
< 		String prefix;
1476,1476c1318,1318
< 			prefix = getDomainDiagramElement().getName();
---
> 			return  getDomainDiagramElement().getName();
1477a1320,1320
> 			return getEditorGen().getDomainGenModel().getModelName();
1478,1480d1319
< 			char[] v = getDomainMetaModel().getEcorePackage().getName().toCharArray();
< 			v[0] = Character.toUpperCase(v[0]);
< 			prefix = new String(v);
1481a1322,1322
> 		// XXX NPE in gmfgen editor when neither domainGenModel nor domainDiagramElement has been set?
1482,1482d1321
< 		return prefix;
2166,2166c2016,2016
< 			return getEMFGenModel().getModelName().toLowerCase() + "_diagram";
---
> 			return getEditorGen().getDomainGenModel().getModelName().toLowerCase() + "_diagram";
2701a1593,1595
> 	public GenEditorGenerator getEditorGen() {
> 		if (eContainerFeatureID != GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN) return null;
> 		return (GenEditorGenerator)eContainer();
2702,2703d1592
< 	public GenModel getEMFGenModel() {
< 		return getDomainMetaModel().getGenModel();
2704,2704c1596,1596
< 	}
---
> 	}
2705,2705c1597,1597
< 
---
> 
2706,2706c1598,1598
< 	/**
---
> 	/**
2707,2707c1599,1599
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
2708,2708c1600,1600
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
2708a1601,1601
> 	 * @generated
2709,2709d1600
< 	 * @generated NOT
2710,2710c1602,1602
< 	 */
---
> 	 */
2854,2854c2683,2683
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
2855a2685,2685
> 					msgs = eBasicRemoveFromContainer(msgs);
2855,2855c2684,2684
< 				if (plugin != null)
---
> 				if (eInternalContainer() != null)
2856,2856d2684
< 					msgs = ((InternalEObject)plugin).eInverseRemove(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__PLUGIN, null, msgs);
2857,2857c2686,2686
< 				return basicSetPlugin((GenPlugin)otherEnd, msgs);
---
> 				return eBasicSetContainer(otherEnd, GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN, msgs);
2877,2877c2710,2710
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
2878,2878c2711,2711
< 				return basicSetAudits(null, msgs);
---
> 				return eBasicSetContainer(null, GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN, msgs);
2881,2882d2721
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return basicSetPlugin(null, msgs);
2984,2986d2835
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				if (resolve) return getDomainMetaModel();
< 				return basicGetDomainMetaModel();
2998,2998c2836,2836
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
2999,2999c2837,2837
< 				return getAudits();
---
> 				return getEditorGen();
3002,3003d2850
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return getPlugin();
3157,3159d3003
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				setDomainMetaModel((GenPackage)newValue);
< 				return;
3179,3181d3022
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				setAudits((GenAuditContainer)newValue);
< 				return;
3185,3187d3025
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				setPlugin((GenPlugin)newValue);
< 				return;
3340,3342d3177
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
< 				setDomainMetaModel((GenPackage)null);
< 				return;
3358,3360d3192
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				setAudits((GenAuditContainer)null);
< 				return;
3364,3366d3195
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				setPlugin((GenPlugin)null);
< 				return;
3474,3474c3303,3303
< 			case GMFGenPackage.GEN_DIAGRAM__DOMAIN_META_MODEL:
---
> 			case GMFGenPackage.GEN_DIAGRAM__EDITOR_GEN:
3475,3475c3304,3304
< 				return domainMetaModel != null;
---
> 				return getEditorGen() != null;
3486,3487d3314
< 			case GMFGenPackage.GEN_DIAGRAM__AUDITS:
< 				return audits != null;
3490,3491d3316
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
< 				return plugin != null;
4095a3921,3921
> 		GenPackage primaryPackage = (GenPackage) getEditorGen().getDomainGenModel().getGenPackages().get(0);
4096,4096c3922,3922
< 		String prefix = CodeGenUtil.safeName(getDomainMetaModel().getPackageName());
---
> 		String prefix = CodeGenUtil.safeName(primaryPackage.getPackageName());
4097,4097c3923,3923
< 		String basePackage = getDomainMetaModel().getBasePackage();
---
> 		String basePackage = primaryPackage.getBasePackage();
4105,4105c3931,3931
< 		String name = CodeGenUtil.validJavaIdentifier(getEMFGenModel().getModelName());
---
> 		String name = CodeGenUtil.validJavaIdentifier(getEditorGen().getDomainGenModel().getModelName());
4110a3937,3940
> 
> 	public String getMetaPackageName(ImportAssistant importManager) {
> 		return importManager.getImportedName(getDomainDiagramElement().getGenPackage().getQualifiedPackageInterfaceName());
> 	}
