40,40d39
< 	protected final FigureQualifiedNameSwitch myFigureNameSwitch;
51a51,52
> 		public MapModeCodeGenStrategy getMapMode();
> 		public String getRuntimeToken();
52,53d50
< 
< 		public boolean needsMapMode(); // FIXME remove or (?) return MapModeCodeGenStrategy
65a65,65
> 		private final String myRuntimeToken;
65,65c64,64
< 		private final boolean myNeedsMapMode;
---
> 		private final MapModeCodeGenStrategy myMapMode;
68,68c68,68
< 			this(pluginId, mainPackageName, true);
---
> 			this(pluginId, mainPackageName, MapModeCodeGenStrategy.DYNAMIC, null);
70a71,71
> 		public ConfigImpl(String pluginId, String mainPackageName, MapModeCodeGenStrategy mapMode, String runtimeToken) {
71,71d70
< 		public ConfigImpl(String pluginId, String mainPackageName, boolean useMapMode) {
72,72c72,72
< 			this(pluginId, mainPackageName, pluginId, "", "PluginActivator", (mainPackageName == null ? "" : mainPackageName + ".")  + "activator", useMapMode);
---
> 			this(pluginId, mainPackageName, pluginId, "", "PluginActivator", (mainPackageName == null ? "" : mainPackageName + ".")  + "activator", mapMode, null);
75,75c75,75
< 		public ConfigImpl(String pluginId, String mainPackageName, String pluginFriendlyName, String pluginProviderName, String pluginActivatorClassName, String pluginActivatorPackageName, boolean needsMapMode){
---
> 		public ConfigImpl(String pluginId, String mainPackageName, String pluginFriendlyName, String pluginProviderName, String pluginActivatorClassName, String pluginActivatorPackageName, MapModeCodeGenStrategy mapMode, String runtimeToken){
81a82,83
> 			myMapMode = mapMode;
> 			myRuntimeToken = runtimeToken;
82,82d81
< 			myNeedsMapMode = needsMapMode;
108a110,115
> 		public MapModeCodeGenStrategy getMapMode() {
> 			return myMapMode;
> 		}
> 
> 		public String getRuntimeToken() {
> 			return myRuntimeToken;
109,110d109
< 		public boolean needsMapMode() {
< 			return myNeedsMapMode;
126a132,132
> 	public StandaloneGenerator(Processor p, Config config) {
127,127d131
< 	public StandaloneGenerator(Processor p, Config config, FigureQualifiedNameSwitch fqnSwitch) {
128,128c133,133
< 		this(p, config, fqnSwitch, null);
---
> 		this(p, config, null);
131,131c136,136
< 	public StandaloneGenerator(Processor p, Config config, FigureQualifiedNameSwitch fqnSwitch, URL[] dynamicTemplates) {
---
> 	public StandaloneGenerator(Processor p, Config config, URL[] dynamicTemplates) {
132,132c137,137
< 		assert p != null && config != null && fqnSwitch != null;
---
> 		assert p != null && config != null;
135,135d139
< 		myFigureNameSwitch = fqnSwitch;
137,137c141,141
< 		MapModeCodeGenStrategy strategy;
---
> 		final MapModeCodeGenStrategy strategy;
139,139c143,143
< 		if (config.needsMapMode()) {
---
> 		if (config.getMapMode() == MapModeCodeGenStrategy.DYNAMIC) {
143,143c147,147
< 			strategy = MapModeCodeGenStrategy.STATIC;
---
> 			strategy = config.getMapMode() == null ? MapModeCodeGenStrategy.STATIC : config.getMapMode();
147,147c151,151
< 		myFigureGenerator = new FigureGenerator(fqnSwitch, strategy, accessor, false, dynamicTemplates);
---
> 		myFigureGenerator = new FigureGenerator(config.getRuntimeToken(), strategy, accessor, false, dynamicTemplates);
190,190c194,194
< 		doGenerateFile(myAuxiliaryGenerators.getManifestMFEmitter(), new Path("META-INF/MANIFEST.MF"), myArgs, myProcessor.getRequiredBundles(myFigureNameSwitch));
---
> 		doGenerateFile(myAuxiliaryGenerators.getManifestMFEmitter(), new Path("META-INF/MANIFEST.MF"), myArgs, myProcessor.getRequiredBundles(null));
