15a17,17
> import java.util.Map;
16,16c15,15
< import java.util.Iterator;
---
> import java.util.Collections;
81,81c82,82
< 			for(Iterator it = getEditingDomain().getResourceSet().getResources().iterator(); it.hasNext(); ) {
---
> 			for(Resource next : getEditingDomain().getResourceSet().getResources()) {
82,82d82
< 				Resource next = (Resource) it.next();
94a95,102
> 		myDiagramDisplayer.save(getSaveOptions(), monitor);
> 	}
> 
> 	/**
> 	 * Returns the options with which the resources will be saved. Subclasses should override.
> 	 */
> 	protected Map<?, ?> getSaveOptions() {
> 		return Collections.emptyMap();
95,95d94
< 		myDiagramDisplayer.save(monitor);
348a356,356
> 				for(Resource next : resourceSet.getResources()) {
349,349d355
< 				for(Iterator it = resourceSet.getResources().iterator(); it.hasNext(); ) {
350,350c357,357
< 					((Resource) it.next()).setTrackingModification(true);
---
> 					next.setTrackingModification(true);
353a361,361
> 
365a374,375
> 					@SuppressWarnings("unchecked") Collection<Resource> resources = (Collection<Resource>) msg.getNewValue();
> 					for(Resource next : resources) {
366,367d373
< 					Collection resources = (Collection) msg.getNewValue();
< 					for(Iterator it = resources.iterator(); it.hasNext(); ) {
368,368c376,376
< 						((Resource) it.next()).setTrackingModification(true);
---
> 						next.setTrackingModification(true);
