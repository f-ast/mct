15a17,19
> import org.eclipse.gmf.internal.bridge.ui.dashboard.Plugin;
> import org.osgi.service.prefs.BackingStoreException;
> import org.osgi.service.prefs.Preferences;
16,16c15,15
< import org.eclipse.ui.IMemento;
---
> import org.eclipse.core.runtime.IStatus;
48a52,53
> 	private Preferences prefs;
> 
52,55d56
< 	public DashboardState(IMemento memento) {
< 		if (memento != null) {
< 			read(memento);
< 		}
83a93,93
> 		write(DM_KEY, dm);
87a98,98
> 		write(DGM_KEY, dgm);
91a103,103
> 		write(GDM_KEY, gdm);
95a108,108
> 		write(TDM_KEY, tdm);
99a113,113
> 		write(MM_KEY, mm);
103a118,118
> 		write(GM_KEY, gm);
107a123,123
> 		write(DM_KEY, dm);
111a128,128
> 		write(DGM_KEY, dgm);
115a133,133
> 		write(GDM_KEY, gdm);
119a138,138
> 		write(TDM_KEY, tdm);
123a143,143
> 		write(MM_KEY, mm);
127a148,148
> 		write(GM_KEY, gm);
163a185,187
> 	private URI read(String key) {
> 		if (prefs == null) {
> 			return null;
163a57,59
> 	public DashboardState(Preferences prefs) {
> 		this.prefs = prefs;
> 		dm = read(DM_KEY);
164,165d56
< 	private void read(IMemento memento) {
< 		dm = read(memento, DM_KEY);
166,166c60,60
< 		dgm = read(memento, DGM_KEY);
---
> 		dgm = read(DGM_KEY);
167,167c61,61
< 		gdm = read(memento, GDM_KEY);
---
> 		gdm = read(GDM_KEY);
168,168c62,62
< 		tdm = read(memento, TDM_KEY);
---
> 		tdm = read(TDM_KEY);
169,169c63,63
< 		mm = read(memento, MM_KEY);
---
> 		mm = read(MM_KEY);
170,170c64,64
< 		gm = read(memento, GM_KEY);
---
> 		gm = read(GM_KEY);
171a189,189
> 		String s = prefs.get(key, null);
172,174d188
< 
< 	private static URI read(IMemento memento, String key) {
< 		String s = memento.getString(key);
180a196,197
> 			IStatus status = Plugin.createError("Invalid URI", e);
> 			Plugin.getDefault().getLog().log(status);
185,193d201
< 	public void write(IMemento memento) {
< 		write(memento, DM_KEY, dm);
< 		write(memento, DGM_KEY, dgm);
< 		write(memento, GDM_KEY, gdm);
< 		write(memento, TDM_KEY, tdm);
< 		write(memento, MM_KEY, mm);
< 		write(memento, GM_KEY, gm);
< 	}
< 
194,194c202,202
< 	private static void write(IMemento memento, String key, URI uri) {
---
> 	private void write(String key, URI uri) {
198a207,213
> 		prefs.put(key, s);
> 		try {
> 			prefs.flush();
> 		} catch (BackingStoreException e) {
> 			IStatus status = Plugin.createError("Unable to update state", e);
> 			Plugin.getDefault().getLog().log(status);
> 		}
199,199d206
< 		memento.putString(key, s);
