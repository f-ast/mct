101,101d100
<         if (context != null) {
104a104,104
> 			delegate = null;
106a107,110
> 		if (context != null) {
> 			IWorkbenchPart part = getWorkbenchPart();
> 
> 			if (part != null) {
107,107c111,111
<             delegate = new UndoActionHandler(getWorkbenchPart().getSite(),
---
> 				delegate = new UndoActionHandler(part.getSite(), context);
108,108d111
<                 context);
110a114,115
> 			}
> 		}
114,114c119,119
<             firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled),
---
> 		firePropertyChange(IAction.ENABLED, Boolean.valueOf(!enabled), Boolean
115,115c120,120
<                 Boolean.valueOf(enabled));
---
> 				.valueOf(enabled));
116,116d120
<         }
258a263,263
> 		this.undoContext = context;
258,258c262,262
<     public final void setUndoContext(IUndoContext undoContext) {
---
> 	public final void setUndoContext(IUndoContext context) {
259,259d262
<         this.undoContext = undoContext;
260,260c264,264
<         initializeWithContext(undoContext);
---
> 		initializeWithContext(context);
288a293,306
> 
> 	/**
> 	 * Disposes my delegate.
> 	 */
> 	public void dispose() {
> 
> 		if (delegate != null) {
> 			delegate.removePropertyChangeListener(getDelegateListener());
> 			delegate.dispose();
> 			delegate = null;
> 		}
> 
> 		super.dispose();
> 	}
