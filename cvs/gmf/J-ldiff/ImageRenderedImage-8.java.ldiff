76,76c76,76
< 			int newHeight = bufferWidth;
---
>             int newHeight = bufferHeight;
79,79d78
< 				if (newWidth > newHeight) {
80,80c79,79
< 					newHeight = (int)Math.round(newWidth * origHeight / (double)origWidth);
---
>                 double origAspectRatio = origHeight / (double)origWidth;
80a80,80
>                 if (origAspectRatio > newHeight / (double)newWidth) {
81,82d79
< 				}
< 				else {
83a82,83
>                 } else {
>                     newHeight = (int)Math.round(newWidth * origAspectRatio);
83,83c81,81
< 					newWidth = (int)Math.round(newHeight * origWidth / (double)origHeight);
---
>                     newWidth = (int)Math.round(newHeight / origAspectRatio);
