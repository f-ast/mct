2,2c2,2
<  * Copyright (c) 2006 Borland Software Corporation and others.
---
>  * Copyright (c) 2006, 2007 Borland Software Corporation and others.
56a57,57
> import org.eclipse.gmf.runtime.diagram.ui.commands.ICommandProxy;
56,56c56,56
< import org.eclipse.gmf.runtime.diagram.ui.commands.SetViewMutabilityCommand;
---
> import org.eclipse.gmf.runtime.diagram.ui.commands.DeferredLayoutCommand;
162a164,177
> 		List createdViews = new LinkedList();
> 		createdViews.addAll(refreshSemanticChildren());
> 		List createdConnectionViews = new LinkedList();
> 		createdConnectionViews.addAll(refreshSemanticConnections());
> 		createdConnectionViews.addAll(refreshConnections());
> 
> 		if (createdViews.size() > 1) {
> 			// perform a layout of the container
> 			DeferredLayoutCommand layoutCmd = new DeferredLayoutCommand(host().getEditingDomain(), createdViews, host());
> 			executeCommand(new ICommandProxy(layoutCmd));
> 		}
> 
> 		createdViews.addAll(createdConnectionViews);
> 		makeViewsImmutable(createdViews);
163,164d163
< 		super.refreshSemantic();
< 		refreshConnections();
180,180c193,193
< 	private void refreshConnections() {
---
> 	private Collection refreshConnections() {
200,200c213,213
< 			createConnections(myLinkDescriptors);
---
> 			return createConnections(myLinkDescriptors);
242,242c255,255
< 	private void createConnections(Collection linkDescriptors) {
---
> 	private Collection createConnections(Collection linkDescriptors) {
243a257,257
> 			return Collections.EMPTY_LIST;
244,244c284,284
< 			return;
---
> 		return adapters;
245a259,259
> 		List adapters = new LinkedList();
264a279,281
> 				if (viewAdapter != null) {
> 					adapters.add(viewAdapter);
> 				}
265,265d278
< 				SetViewMutabilityCommand.makeImmutable(viewAdapter).execute();
