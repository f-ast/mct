121a122,122
> import org.eclipse.swt.widgets.Display;
428a430,436
>      * Alternative operation history listener. By default it adds it disables
>      * updates when command is executing on a separate thread and then reables
>      * afterwards.
>      */
>     private IOperationHistoryListener disableUpdateHistoryListener;
> 
>     /**
460a469,502
>         disableUpdateHistoryListener = createDisableUpdateHistoryListener();
>     }
> 
>     /**
>      * Creates a listener on the <code>IOperationHistory</code> that allows
>      * us to turn off updates when execution is performed on a separate
>      * thread.
>      * 
>      * @return 
>      */
>     private IOperationHistoryListener createDisableUpdateHistoryListener() {
>         return new IOperationHistoryListener() {
> 
>             public void historyNotification(final OperationHistoryEvent event) {
> 
>                 if (event.getEventType() == OperationHistoryEvent.ABOUT_TO_EXECUTE ||
>                     event.getEventType() == OperationHistoryEvent.ABOUT_TO_UNDO ||
>                     event.getEventType() == OperationHistoryEvent.ABOUT_TO_REDO) {
>                     DiagramGraphicalViewer viewer = (DiagramGraphicalViewer)getDiagramGraphicalViewer();
> 
>                     if (viewer != null && Display.getCurrent() == null)
>                         viewer.enableUpdates(false); 
>                 }
>                 else if (event.getEventType() == OperationHistoryEvent.OPERATION_NOT_OK ||
>                     event.getEventType() == OperationHistoryEvent.DONE ||
>                     event.getEventType() == OperationHistoryEvent.UNDONE ||
>                     event.getEventType() == OperationHistoryEvent.REDONE) {
>                     DiagramGraphicalViewer viewer = (DiagramGraphicalViewer)getDiagramGraphicalViewer();
> 
>                     if (viewer != null)
>                         viewer.enableUpdates(true); 
>                 }
>             }
>         };
649a692,696
>         if (disableUpdateHistoryListener != null) {
>             getOperationHistory().removeOperationHistoryListener(
>                 disableUpdateHistoryListener);
>         }
>         
892a940,944
>             if (disableUpdateHistoryListener != null) { 
>                 getOperationHistory().addOperationHistoryListener(
>                     disableUpdateHistoryListener);
>             }
>             
911a964,968
>         
>         if (disableUpdateHistoryListener != null) {
>             getOperationHistory().removeOperationHistoryListener(
>                 disableUpdateHistoryListener);
>         }
