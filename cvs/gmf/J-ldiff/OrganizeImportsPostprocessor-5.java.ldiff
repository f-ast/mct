56a57,57
> 	 *            specifies if the existing imports should be kept or removed,
57,57c58,58
< 	 *        specifies if the existing imports should be kept or removed, see {@link ImportRewrite#create(CompilationUnit, boolean)} for details.
---
> 	 *            see {@link ImportRewrite#create(CompilationUnit, boolean)} for
57a59,59
> 	 *            details.
149,149c151,151
< 		Set<String> oldSingleImports = new HashSet<String>();
---
> 		HashSet<String> oldSingleImports = new HashSet<String>();
150,150c152,152
< 		Set<String> oldDemandImports = new HashSet<String>();
---
> 		HashSet<String> oldDemandImports = new HashSet<String>();
151a154,155
> 		@SuppressWarnings("unchecked")
> 		final List<ImportDeclaration> importDeclarations = astRoot.imports();
152,152c156,156
<         String[] customImports = substract(declaredImports, astRoot.imports());
---
> 		String[] customImports = substract(declaredImports, importDeclarations);
160a165,165
> 		ArrayList<Name> qualifiedTypeReferences = new ArrayList<Name>();
161,161d164
< 		Collection<Name> qualifiedTypeReferences = new ArrayList<Name>();
162,162c166,166
< 		Collection<SimpleName> simpleTypeReferences = new ArrayList<SimpleName>();
---
> 		ArrayList<SimpleName> simpleTypeReferences = new ArrayList<SimpleName>();
163,163c167,167
< 		Collection<String> importsAdded = new ArrayList<String>();
---
> 		ArrayList<String> importsAdded = new ArrayList<String>();
209,209c213,213
<      * Since we do organizeImports prior to merge, we must ensure
---
> 	 * Since we do organizeImports prior to merge, we must ensure imports added
210,210c214,214
<      * imports added manually are known to OrganizeImportsProcessor
---
> 	 * manually are known to OrganizeImportsProcessor
221,221c225,225
<     private String[] substract(String[] declaredImports, List list) {
---
> 	private String[] substract(String[] declaredImports, List<ImportDeclaration> list) {
225,225c229,229
<         List<String> result = new ArrayList<String>(Arrays.asList(declaredImports));
---
> 		ArrayList<String> result = new ArrayList<String>(Arrays.asList(declaredImports));
227,227d230
<             ImportDeclaration next = (ImportDeclaration) list.get(i);
228,228c231,231
<             result.remove(next.getName().getFullyQualifiedName());
---
> 			result.remove(list.get(i).getName().getFullyQualifiedName());
251a255,255
> 		@SuppressWarnings("unchecked")
252,252c256,256
<         final List imports = astRoot.imports();
---
> 		final List<ImportDeclaration> imports = astRoot.imports();
254,254c258,258
< 			ImportDeclaration curr = (ImportDeclaration) imports.get(i);
---
> 			ImportDeclaration curr = imports.get(i);
