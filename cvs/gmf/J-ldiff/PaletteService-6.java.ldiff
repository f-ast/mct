14,14d13
< import java.util.ArrayList;
25,25c40,40
< import org.eclipse.jface.util.Assert;
---
> import org.eclipse.jface.util.Assert;
26,26c41,41
< import org.eclipse.ui.IEditorPart;
---
> import org.eclipse.ui.IEditorPart;
27,27d41
< 
268,268c266,266
< 		HashMap existingEntries = new HashMap();
---
> 		HashMap existingEntryIds = new HashMap();
272,272c270,270
< 			existingEntries.put(entry.getId(), entry);
---
> 			existingEntryIds.put(entry.getId(), entry);
274a273,274
> 		int lastExistingEntryIndex = 0;
> 		// cycle through the new entries
275,276d272
< 		List updatedChildren = new ArrayList(newContainer.getChildren().size());
< 
280a279,283
> 			PaletteEntry existingEntry = (PaletteEntry) existingEntryIds
> 				.get(newEntry.getId());
> 			if (existingEntry != null) { // is already in existing container
> 				// update the index
> 				lastExistingEntryIndex = existingContainer.getChildren()
281,283d278
< 			Object existingEntry = existingEntries.get(newEntry.getId());
< 			if (existingEntry != null) {
< 				// keep the existing entry
284a285,288
> 
> 				// remove the entry that was just updated from the map
> 				existingEntryIds.remove(existingEntry.getId());
> 
284,284c284,284
< 				updatedChildren.add(existingEntry);
---
> 					.indexOf(existingEntry);
292a297,298
> 			} else { // this is a new entry that did not previously exist
> 				existingContainer.add(++lastExistingEntryIndex, newEntry);
293,293c299,299
< 			} else {
---
> 			}
294,296d299
< 				// add new entries that did not
< 				// previously exist
< 				updatedChildren.add(newEntry);
298a302,306
> 		// remove existing entries that were not found in the new container
> 		for (Iterator iter = existingEntryIds.values().iterator(); iter
> 			.hasNext();) {
> 			PaletteEntry entry = (PaletteEntry) iter.next();
> 			existingContainer.remove(entry);
299a308,308
> 
300,300d307
< 		existingContainer.setChildren(updatedChildren);
