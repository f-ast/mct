34,34d33
< 
35a35,36
> import org.eclipse.gmf.runtime.emf.core.internal.plugin.EMFCoreDebugOptions;
> import org.eclipse.gmf.runtime.emf.core.internal.plugin.EMFCorePlugin;
36,39d34
< import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.internal.domain.MSLEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.internal.plugin.MSLDebugOptions;
< import org.eclipse.gmf.runtime.emf.core.internal.plugin.MSLPlugin;
40,40c37,37
< import org.eclipse.gmf.runtime.emf.core.internal.resources.MSLResource;
---
> import org.eclipse.gmf.runtime.emf.core.internal.resources.GMFResource;
41,41c38,38
< import org.eclipse.gmf.runtime.emf.core.internal.resources.MSLSave;
---
> import org.eclipse.gmf.runtime.emf.core.internal.resources.GMFSave;
41a39,39
> import org.eclipse.gmf.runtime.emf.core.internal.util.EMFCoreConstants;
42,42d38
< import org.eclipse.gmf.runtime.emf.core.internal.util.MSLConstants;
43,43c40,40
< import org.eclipse.gmf.runtime.emf.core.internal.util.MSLUtil;
---
> import org.eclipse.gmf.runtime.emf.core.internal.util.Util;
44,44c41,41
< import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
---
> import org.eclipse.gmf.runtime.emf.core.util.EMFCoreUtil;
107,107c104,104
< 				if (((MSLConstants.PLATFORM_SCHEME.equals(anUri.scheme())) && (MSLConstants.PLATFORM_SCHEME
---
> 				if (((EMFCoreConstants.PLATFORM_SCHEME.equals(anUri.scheme())) && (EMFCoreConstants.PLATFORM_SCHEME
122a120,124
> 				EObject eObj = obj;
> 				
> 				if (obj.eIsProxy()) {
> 					eObj = EcoreUtil.resolve(obj, xmlResource);
> 					if (eObj == null) {
123,123d119
< 				EObject eObj = MSLUtil.resolve((MSLEditingDomain)MEditingDomain.getEditingDomain(xmlResource),
124,124c125,125
< 					obj, true);
---
> 						eObj = null;
124a126,128
> 					}
> 				}
> 				
141,141c145,145
< 				if (otherResource instanceof MSLResource) {
---
> 				if (otherResource instanceof GMFResource) {
142,142c146,146
< 					String qName = EObjectUtil.getQName(obj, true);
---
> 					String qName = EMFCoreUtil.getQualifiedName(obj, true);
146,146c150,150
< 						buffer.append(MSLConstants.FRAGMENT_SEPARATOR);
---
> 						buffer.append(EMFCoreConstants.FRAGMENT_SEPARATOR);
147,147c151,151
< 						buffer.append(MSLUtil.encodeQName(qName));
---
> 						buffer.append(Util.encodeQualifiedName(qName));
170a175,175
> 		Trace.throwing(EMFCorePlugin.getDefault(),
171,171d174
< 		Trace.throwing(MSLPlugin.getDefault(),
172,172c176,176
< 			MSLDebugOptions.EXCEPTIONS_THROWING, getClass(), methodName, ex);
---
> 			EMFCoreDebugOptions.EXCEPTIONS_THROWING, getClass(), methodName, ex);
191,191c195,195
< 		return new MSLSave(createXMLHelper()) {
---
> 		return new GMFSave(createXMLHelper()) {
321,321c325,325
< 			getEObjectToIDMap().put(eObject, EObjectUtil.getID(eObject));
---
> 			getEObjectToIDMap().put(eObject, xmlResource.getID(eObject));
322,322c326,326
< 			getIDToEObjectMap().put(EObjectUtil.getID(eObject), eObject);
---
> 			getIDToEObjectMap().put(xmlResource.getID(eObject), eObject);
