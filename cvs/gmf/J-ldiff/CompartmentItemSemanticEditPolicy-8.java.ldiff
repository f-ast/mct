12a13,14
> import java.util.Iterator;
> 
14,14d15
< import org.eclipse.emf.ecore.EObject;
16a18,19
> import org.eclipse.gmf.graphdef.editor.edit.commands.CompartmentAccessorCreateCommand;
> import org.eclipse.gmf.graphdef.editor.edit.commands.CompartmentAccessorReorientCommand;
17,17c20,20
< import org.eclipse.gef.commands.UnexecutableCommand;
---
> import org.eclipse.gmf.graphdef.editor.edit.commands.DiagramElementFigureCreateCommand;
18,18d20
< import org.eclipse.gmf.gmfgraph.DiagramElement;
19a22,23
> import org.eclipse.gmf.graphdef.editor.edit.parts.CompartmentAccessorEditPart;
> import org.eclipse.gmf.graphdef.editor.edit.parts.CompartmentVisualFacetsEditPart;
20a25,25
> import org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry;
25a31,31
> import org.eclipse.gmf.runtime.notation.Node;
36a43,49
> 		CompoundCommand cc = getDestroyEdgesCommand();
> 		addDestroyChildNodesCommand(cc);
> 		addDestroyShortcutsCommand(cc);
> 		View view = (View) getHost().getModel();
> 		if (view.getEAnnotation("Shortcut") != null) { //$NON-NLS-1$
> 			req.setElementToDestroy(view);
> 		}
37,37d42
< 		CompoundCommand cc = getDestroyEdgesCommand(req.isConfirmationRequired());
38,38c50,50
< 		cc.add(getMSLWrapper(new DestroyElementCommand(req) {
---
> 		cc.add(getGEFWrapper(new DestroyElementCommand(req)));
38a51,52
> 		return cc.unwrap();
> 	}
39a54,57
> 	/**
> 	 * @generated
> 	 */
> 	protected void addDestroyChildNodesCommand(CompoundCommand cmd) {
40,40d53
< 			protected EObject getElementToDestroy() {
43a61,72
> 			return;
> 		}
> 		for (Iterator it = view.getChildren().iterator(); it.hasNext();) {
> 			Node node = (Node) it.next();
> 			switch (GMFGraphVisualIDRegistry.getVisualID(node)) {
> 			case CompartmentVisualFacetsEditPart.VISUAL_ID:
> 				for (Iterator cit = node.getChildren().iterator(); cit.hasNext();) {
> 					Node cnode = (Node) cit.next();
> 					switch (GMFGraphVisualIDRegistry.getVisualID(cnode)) {
> 					}
> 				}
> 				break;
44,44c108,108
< 					return view;
---
> 		return null;
46,46d73
< 				return super.getElementToDestroy();
48,50d74
< 
< 		}));
< 		return cc.unwrap();
57a106,106
> 			return null;
57,57c105,105
< 		if (GMFGraphElementTypes.DiagramElementFigure_4001 == req.getElementType()) {
---
> 		if (GMFGraphElementTypes.DiagramElementFigure_4005 == req.getElementType()) {
58,58d105
< 			return req.getTarget() == null ? getCreateStartOutgoingDiagramElementFigure_4001Command(req) : null;
59a92,95
> 		if (GMFGraphElementTypes.DiagramElementFigure_4005 == req.getElementType()) {
> 			return getGEFWrapper(new DiagramElementFigureCreateCommand(req, req.getSource(), req.getTarget()));
> 		}
> 		return null;
59a81,81
> 		Command command = req.getTarget() == null ? getStartCreateRelationshipCommand(req) : getCompleteCreateRelationshipCommand(req);
60a83,90
> 	}
> 
> 	/**
> 	 * @generated
> 	 */
> 	protected Command getStartCreateRelationshipCommand(CreateRelationshipRequest req) {
> 		if (GMFGraphElementTypes.CompartmentAccessor_4003 == req.getElementType()) {
> 			return getGEFWrapper(new CompartmentAccessorCreateCommand(req, req.getSource(), req.getTarget()));
60,60c82,82
< 		return super.getCreateRelationshipCommand(req);
---
> 		return command != null ? command : super.getCreateRelationshipCommand(req);
66a102,103
> 		if (GMFGraphElementTypes.CompartmentAccessor_4003 == req.getElementType()) {
> 			return null;
66,66c101,101
< 	protected Command getCreateStartOutgoingDiagramElementFigure_4001Command(CreateRelationshipRequest req) {
---
> 	protected Command getCompleteCreateRelationshipCommand(CreateRelationshipRequest req) {
67,69d101
< 		EObject sourceEObject = req.getSource();
< 		if (false == sourceEObject instanceof DiagramElement) {
< 			return UnexecutableCommand.INSTANCE;
71,73d104
< 		DiagramElement source = (DiagramElement) sourceEObject;
< 		if (!GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001(source, null)) {
< 			return UnexecutableCommand.INSTANCE;
75,76d107
< 		return new Command() {
< 		};
86a119,120
> 		case CompartmentAccessorEditPart.VISUAL_ID:
> 			return getGEFWrapper(new CompartmentAccessorReorientCommand(req));
88,88c122,122
< 			return getMSLWrapper(new DiagramElementFigureReorientCommand(req));
---
> 			return getGEFWrapper(new DiagramElementFigureReorientCommand(req));
91a126,126
> 
