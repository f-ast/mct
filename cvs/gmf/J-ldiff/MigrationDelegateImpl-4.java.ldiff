28a30,30
> import org.eclipse.emf.ecore.resource.Resource;
29,29c23,23
< import org.eclipse.emf.ecore.xmi.XMLResource;
---
> import org.eclipse.emf.ecore.EDataType;
45a47,47
> 	private Map<EClass, Map<String, EStructuralFeature>> myTracedHierarchyFeatures = new HashMap<EClass, Map<String, EStructuralFeature>>();
46,46d46
< 	private Map<EClass, Map<String, EStructuralFeature>> myRenamedParentAttributes = new HashMap<EClass, Map<String, EStructuralFeature>>();
47,47c48,48
< 	private XMLResource myResource;
---
> 	private Resource myResource;
57a59,64
> 	/**
> 	 * Traced feature is a feature you use through the hierarchy as a marker, catching it in setValue and notifying of
> 	 * whether migration has happened or not
> 	 */
> 	public void registerTracedFeatureForHierarchy(EClass eClass, Map<String, EStructuralFeature> tracedFeature) {
> 		myTracedHierarchyFeatures.put(eClass, tracedFeature);
58,59d58
< 	public void registerRenamedParentAttributes(EClass eClass, Map<String, EStructuralFeature> renamedAttributes) {
< 		myRenamedParentAttributes.put(eClass, renamedAttributes);
78a84,90
> 	/**
> 	 * Traced feature is a feature you use through the hierarchy as a marker, catching it in setValue and notifying of
> 	 * whether migration has happened or not
> 	 */
> 	public void registerTracedFeatureForHierarchy(EClass eClass, String xmlName, EStructuralFeature tracerFeature) {
> 		Map<String, EStructuralFeature> tracedFeatures = myTracedHierarchyFeatures.get(eClass);
> 		if (tracedFeatures == null) {
79,81d83
< 	public void registerRenamedParentAttribute(EClass eClass, String oldName, EStructuralFeature newStructuralFeature) {
< 		Map<String, EStructuralFeature> renamedAttributes = myRenamedParentAttributes.get(eClass);
< 		if (renamedAttributes == null) {
82,82c91,91
< 			renamedAttributes = new HashMap<String, EStructuralFeature>();
---
> 			tracedFeatures = new HashMap<String, EStructuralFeature>();
83a93,94
> 		tracedFeatures.put(xmlName, tracerFeature);
> 		registerTracedFeatureForHierarchy(eClass, tracedFeatures);
84,85d92
< 		renamedAttributes.put(oldName, newStructuralFeature);
< 		registerRenamedParentAttributes(eClass, renamedAttributes);
107a117,117
> 	    Map<String, EStructuralFeature> tracings = myTracedHierarchyFeatures.get(clazz);
107,107c116,116
< 	public EStructuralFeature getRenamedParentFeatureFor(EClass clazz, String name) {
---
> 	public EStructuralFeature getTracedParentFeatureFor(EClass clazz, String name) {
108,108d116
< 	    Map<String, EStructuralFeature> renamings = myRenamedParentAttributes.get(clazz);
109,109c118,118
< 	    EStructuralFeature result = renamings != null ? renamings.get(name) : null;
---
> 	    EStructuralFeature result = tracings != null ? tracings.get(name) : null;
112,112c121,121
< 			result = getRenamedParentFeatureFor(nextParent, name);
---
> 			result = getTracedParentFeatureFor(nextParent, name);
131,133d139
< 		} else if ((rename = getRenamedParentFeatureFor(eClass, name)) != null) {
< 			result = rename;
< 			fireMigrationApplied(true);
136a143,146
> 		} else if ((rename = getTracedParentFeatureFor(eClass, name)) != null) {
> 			result = rename;
> 			// if somebody has provided a feature to trace, it is his own business to notify us of whether 
> 			// a migration is required and has happened, cause it is not necessary that anything has been actually changed.
159,160d168
< 	public String getID(EObject obj) {
< 		return null;
163,163c169,169
< 	public void postProcess() {
---
> 	public void preResolve() {
165a175,176
> 	public boolean setManyReference(EObject object, EStructuralFeature feature, Object[] values) {
> 		return false;
166,166c172,172
< 	public void processObject(EObject result) {
---
> 	public void processObject(EObject result) {
191,191c201,201
< 	protected static EAttribute createNewAttribute(String name, EClassifier eType, boolean isMany) {
---
> 	protected static EAttribute createNewAttribute(String name, EDataType eType, boolean isMany) {
195,195c205,205
< 	protected static EAttribute createNewAttribute(String name, EClassifier eType, boolean isMany, boolean isObligatory) {
---
> 	protected static EAttribute createNewAttribute(String name, EDataType eType, boolean isMany, boolean isObligatory) {
204,204c214,214
< 	public void setResource(XMLResource resource) {
---
> 	public void setResource(Resource resource) {
208,208c218,218
< 	protected XMLResource getResource() {
---
> 	protected Resource getResource() {
210a221,223
> 
> 	public void postLoad(){
> 	}
