43a44,44
> import org.eclipse.emf.transaction.RunnableWithResult;
74,74c75,75
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
---
> import org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker;
101,101c84,84
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
---
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIStatusCodes;
296a298,300
> 			try {
> 				TransactionUtil.getEditingDomain(getDiagram())
> 					.runExclusive(new Runnable() {
297,297d297
< 			MEditingDomainGetter.getMEditingDomain(getDiagram()).runAsRead(new MRunnable() {
299,299c302,302
< 				public Object run() {
---
> 					public void run() {
301a941,941
>     }
301,301c940,940
< 					return null;
---
>         return null;
303a306,313
> 			} catch (InterruptedException e) {
> 				Trace.catching(DiagramUIPlugin.getInstance(),
> 					DiagramUIDebugOptions.EXCEPTIONS_CATCHING, getClass(),
> 					"initializeOutlineViewer", e); //$NON-NLS-1$
> 				Log.error(DiagramUIPlugin.getInstance(),
> 					DiagramUIStatusCodes.IGNORED_EXCEPTION_WARNING,
> 					"initializeOutlineViewer", e); //$NON-NLS-1$
> 			}
501,501c511,511
<                     TransactionalEditingDomain editingDomain = TransactionalEditingDomain.Factory.INSTANCE
---
>                     TransactionalEditingDomain resourceSetEditingDomain = TransactionalEditingDomain.Factory.INSTANCE
504,504c514,514
<                     if (domain.equals(editingDomain)) {
---
>                     if (domain.equals(resourceSetEditingDomain)) {
815,815d824
< 
857a867,874
> 		// Create a diagram event broker if there isn't already one for this editing domain.
> 		TransactionalEditingDomain domain = getEditingDomain();
> 		if (domain != null) {
> 			DiagramEventBroker eventBroker = DiagramEventBroker.getInstance(domain);
> 			if (eventBroker == null) {
> 				DiagramEventBroker.startListening(domain);
> 			}
> 		}
858,858d866
< 		// do nothing
919a936,937
>     public TransactionalEditingDomain getEditingDomain() {
>     	if (getDiagram() != null) {
920,920d935
<     protected EditingDomain getEditingDomain() {
933,933c952,952
<             TransactionalEditingDomain domain = (TransactionalEditingDomain) getEditingDomain();
---
>             TransactionalEditingDomain domain = getEditingDomain();
1193,1193c1212,1212
< 			DiagramRulerProvider vertProvider = new DiagramRulerProvider((TransactionalEditingDomain) getEditingDomain(),
---
> 			DiagramRulerProvider vertProvider = new DiagramRulerProvider(getEditingDomain(),
1203,1203c1222,1222
< 			DiagramRulerProvider horzProvider = new DiagramRulerProvider((TransactionalEditingDomain) getEditingDomain(),
---
> 			DiagramRulerProvider horzProvider = new DiagramRulerProvider(getEditingDomain(),
1251,1251c1270,1270
< 		if (selection instanceof IStructuredSelection) {
---
> 		if (selection instanceof IStructuredSelection && !selection.isEmpty()) {
1252a1272,1276
> 			try {
> 				return (List) TransactionUtil.getEditingDomain(
> 					((IAdaptable) ((IStructuredSelection) selection).toList()
> 						.get(0)).getAdapter(View.class)).runExclusive(
> 					new RunnableWithResult.Impl() {
1253,1255d1271
< 			return (List) MEditingDomainGetter.getMEditingDomain(
< 				((IStructuredSelection) selection).toList()).runAsRead(
< 				new MRunnable() {
1257,1257c1278,1278
< 					public Object run() {
---
> 						public void run() {
1279,1279c1300,1300
< 						return retval;
---
> 							setResult(retval);
1281a1303,1308
> 			} catch (InterruptedException e) {
> 				Trace.catching(DiagramUIPlugin.getInstance(),
> 					DiagramUIDebugOptions.EXCEPTIONS_CATCHING, getClass(),
> 					"createEditPart", e); //$NON-NLS-1$
> 				return Collections.EMPTY_LIST;
> 			}
1310,1310d1336
<    
