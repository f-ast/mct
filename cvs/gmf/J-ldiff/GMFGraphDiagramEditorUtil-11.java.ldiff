25,25d24
< import org.eclipse.core.resources.IResource;
39a40,40
> import org.eclipse.emf.workspace.util.WorkspaceSynchronizer;
69a71,88
> 	private static Map ourSaveOptions = null;
> 
> 	/**
> 	 * @generated
> 	 */
> 	public static Map getSaveOptions() {
> 		if (ourSaveOptions == null) {
> 			ourSaveOptions = new HashMap();
> 			ourSaveOptions.put(XMIResource.OPTION_ENCODING, "UTF-8"); //$NON-NLS-1$
> 			ourSaveOptions.put(XMLResource.OPTION_RECORD_UNKNOWN_FEATURE, Boolean.TRUE);
> 			ourSaveOptions.put(Resource.OPTION_SAVE_ONLY_IF_CHANGED, Resource.OPTION_SAVE_ONLY_IF_CHANGED_MEMORY_BUFFER);
> 		}
> 		return ourSaveOptions;
> 	}
> 
> 	/**
> 	 * @generated
> 	 */
77,77c96,96
< 	private static void setCharset(org.eclipse.emf.common.util.URI uri) {
---
> 	public static void setCharset(IFile file) {
78,78d96
< 		IFile file = getFile(uri);
92,105d109
< 	public static IFile getFile(org.eclipse.emf.common.util.URI uri) {
< 		if (uri.toString().startsWith("platform:/resource")) { //$NON-NLS-1$
< 			String path = uri.toString().substring("platform:/resource".length()); //$NON-NLS-1$
< 			IResource workspaceResource = ResourcesPlugin.getWorkspace().getRoot().findMember(new Path(path));
< 			if (workspaceResource instanceof IFile) {
< 				return (IFile) workspaceResource;
< 			}
< 		}
< 		return null;
< 	}
< 
< 	/**
< 	 * @generated
< 	 */
151a156,156
> 	public static Resource createDiagram(URI diagramURI, URI modelURI, IProgressMonitor progressMonitor) {
151a33,33
> import org.eclipse.emf.common.util.URI;
152,152d32
< 	public static Resource createDiagram(org.eclipse.emf.common.util.URI diagramURI, org.eclipse.emf.common.util.URI modelURI, IProgressMonitor progressMonitor) {
153a158,158
> 		progressMonitor.beginTask(Messages.GMFGraphDiagramEditorUtil_CreateDiagramProgressTask, 3);
154,154d157
< 		progressMonitor.beginTask("Creating diagram and model files", 3);
158,158c162,162
< 		AbstractTransactionalCommand command = new AbstractTransactionalCommand(editingDomain, "Creating diagram and model", Collections.EMPTY_LIST) { //$NON-NLS-1$
---
> 		AbstractTransactionalCommand command = new AbstractTransactionalCommand(editingDomain, Messages.GMFGraphDiagramEditorUtil_CreateDiagramCommandLabel, Collections.EMPTY_LIST) {
171a176,177
> 					modelResource.save(org.eclipse.gmf.graphdef.editor.part.GMFGraphDiagramEditorUtil.getSaveOptions());
> 					diagramResource.save(org.eclipse.gmf.graphdef.editor.part.GMFGraphDiagramEditorUtil.getSaveOptions());
172,175d175
< 					Map options = new HashMap();
< 					options.put(XMIResource.OPTION_ENCODING, "UTF-8"); //$NON-NLS-1$
< 					modelResource.save(options);
< 					diagramResource.save(options);
187a190,191
> 		setCharset(WorkspaceSynchronizer.getFile(modelResource));
> 		setCharset(WorkspaceSynchronizer.getFile(diagramResource));
188,189d189
< 		setCharset(modelURI);
< 		setCharset(diagramURI);
