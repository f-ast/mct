39a40,43
> 	boolean isEnabled() {
> 		return !myIsDelegateDisabled;
> 	}
> 	
106a111,116
> 	@Override
> 	public void addPrefix(String prefix, String uri) {
> 		super.addPrefix(prefix, uri);
> 		if (myDelegate.isOldVersionDetected(uri)) {
> 			enableDelegate(true);
> 		}
107,109d110
< 	protected EStructuralFeature getOriginalFeature(EStructuralFeature feature) {
< 		if (myNarrowedFeatureTypes == null) {
< 			myNarrowedFeatureTypes = new HashMap<EStructuralFeature, EStructuralFeature>();
110a118,119
> 
> 	protected EStructuralFeature getOriginalFeature(EStructuralFeature feature) {
111,111c120,120
< 		return myNarrowedFeatureTypes.get(feature);
---
> 		return myNarrowedFeatureTypes == null ? null : myNarrowedFeatureTypes.get(feature);
