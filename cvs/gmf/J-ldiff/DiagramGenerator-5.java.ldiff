35,35c56,56
< import org.eclipse.jface.resource.ImageDescriptor;
---
> import org.eclipse.jface.resource.ImageDescriptor;
36,36c57,57
< import org.eclipse.swt.graphics.ImageData;
---
> import org.eclipse.swt.graphics.ImageData;
37,37d57
< 
50,50c36,36
< import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
---
> import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
54a52,52
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapModeUtil;
54,54c51,51
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
---
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
67a68,68
> 	private int image_margin = 0;
68,68d67
< 	private static final int IMAGE_MARGIN = MapMode.DPtoLP(10);
79a80,80
> 		image_margin = getMapMode().DPtoLP(10);
182a184,185
> 			IMapMode mm = getMapMode();
> 			
184,184c187,187
< 			graphics = setUpGraphics(MapMode.LPtoDP(sourceRect.width), MapMode
---
> 			graphics = setUpGraphics(mm.LPtoDP(sourceRect.width), mm
188,188c191,191
< 				graphics);
---
> 				graphics, getMapMode());
213a217,224
> 	 * @return
> 	 */
> 	protected IMapMode getMapMode() {
> 		IMapMode mm = MapModeUtil.getMapMode(getDiagramEditPart().getFigure());
> 		return mm;
> 	}
> 
> 	/**
543a555,556
> 		IMapMode mm = getMapMode();
> 		
550,550c563,563
< 			bounds = bounds.getExpanded(IMAGE_MARGIN, IMAGE_MARGIN);
---
> 			bounds = bounds.getExpanded(getImageMargin(), getImageMargin());
568,568c581,581
< 			width = MapMode.DPtoLP(100);
---
> 			width = mm.DPtoLP(100);
572,572c585,585
< 			height = MapMode.DPtoLP(100); // create an empty image if the
---
> 			height = mm.DPtoLP(100); // create an empty image if the
595a609,609
> 		IMapMode mm = getMapMode();
629,629c643,643
< 					position.setPartHeight(MapMode.LPtoDP(bounds.height));
---
> 					position.setPartHeight(mm.LPtoDP(bounds.height));
630,630c644,644
< 					position.setPartWidth(MapMode.LPtoDP(bounds.width));
---
> 					position.setPartWidth(mm.LPtoDP(bounds.width));
631,631c645,645
< 					position.setPartX(MapMode.LPtoDP(bounds.x));
---
> 					position.setPartX(mm.LPtoDP(bounds.x));
632,632c646,646
< 					position.setPartY(MapMode.LPtoDP(bounds.y));
---
> 					position.setPartY(mm.LPtoDP(bounds.y));
718,718c732,732
< 			orthoPoint1 = segment.locatePoint(0.0, IMAGE_MARGIN, Sign.POSITIVE);
---
> 			orthoPoint1 = segment.locatePoint(0.0, getImageMargin(), Sign.POSITIVE);
720,720c734,734
< 			orthoPoint2 = segment.locatePoint(1.0, IMAGE_MARGIN, Sign.POSITIVE);
---
> 			orthoPoint2 = segment.locatePoint(1.0, getImageMargin(), Sign.POSITIVE);
754a769,771
> 		
> 		IMapMode mm = getMapMode();
> 		
757,757c774,774
< 			Point newPoint = new Point(MapMode.LPtoDP(point.x), MapMode.LPtoDP(point.y));
---
> 			Point newPoint = new Point(mm.LPtoDP(point.x), mm.LPtoDP(point.y));
763a781,788
> 	
> 	/**
> 	 * @return <code>int</code> value that is the margin around the generated image in logical coordinates.
> 	 */
> 	protected int getImageMargin() {
> 		return image_margin;
> 	}
> 	
