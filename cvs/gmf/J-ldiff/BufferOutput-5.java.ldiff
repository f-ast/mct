6a7,7
> public class BufferOutput extends AbstractOutput {
7,11d6
< import org.eclipse.gmf.internal.xpand.ast.TextStatement;
< import org.eclipse.gmf.internal.xpand.expression.ast.SyntaxElement;
< import org.eclipse.gmf.internal.xpand.model.Output;
< 
< public class BufferOutput implements Output {
17,18d12
< 	private boolean deleteLine = false;
< 
55a50,51
> 	@Override
> 	protected void doAppend(String text) {
56,84d49
< 	public void enterStatement(SyntaxElement stmt) {
< 		if (stmt instanceof TextStatement) {
< 			deleteLine = ((TextStatement) stmt).isDeleteLine();
< 		}
< 	}
< 
< 	public void exitStatement(SyntaxElement stmt) {
< 		deleteLine = false;
< 	}
< 
< 	public void write(String text) {
< 		if (deleteLine) {
< 			int i = 0;
< 			while (i < text.length()) {
< 				char charAt = text.charAt(i);
< 				if (Character.isWhitespace(charAt)) {
< 					if ((charAt == '\r' || charAt == '\n') && (i+1 < text.length())) {
< 						char nextToLF = text.charAt(++i);
< 						if (nextToLF != charAt && (nextToLF == '\n' || nextToLF == '\r')) {
< 							i++;
< 						}
< 						break;
< 					}
< 				}
< 				i++;
< 			}
< 			outletStack.peek().append(text.substring(i));
< 			deleteLine = false;
< 		} else {
88,88d54
< }