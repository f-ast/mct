2,2c2,2
<  * Copyright (c) 2002, 2005 IBM Corporation and others.
---
>  * Copyright (c) 2002, 2006 IBM Corporation and others.
30,30c20,20
< import org.eclipse.gmf.runtime.common.core.command.CommandManager;
---
> import org.eclipse.core.commands.ExecutionException;
30a21,21
> import org.eclipse.core.commands.operations.IOperationHistory;
235a237,237
> 		final IOperationHistory manager = (IOperationHistory) getContext()
236,236d236
< 		final CommandManager manager = (CommandManager) getContext()
237,237c238,238
< 			.getActivePart().getAdapter(CommandManager.class);
---
> 			.getActivePart().getAdapter(IOperationHistory.class);
257a259,271
>                     try {
>                         manager.execute(command, new NullProgressMonitor(),
>                             null);
>                     } catch (ExecutionException e) {
>                         Trace
>                             .catching(
>                                 CommonUIServicesDNDPlugin.getDefault(),
>                                 CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                                 getClass(), "drop", e); //$NON-NLS-1$
>                         Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                             CommonUIServicesDNDStatusCodes.SERVICE_FAILURE,
>                             "drop", e); //$NON-NLS-1$
>                     }
258,258d258
< 					manager.execute(command, new NullProgressMonitor());
262a276,284
>             try {
>                 manager.execute(command, new NullProgressMonitor(), null);
>             } catch (ExecutionException e) {
>                 Trace.catching(CommonUIServicesDNDPlugin.getDefault(),
>                     CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                     getClass(), "drop", e); //$NON-NLS-1$
>                 Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                     CommonUIServicesDNDStatusCodes.SERVICE_FAILURE, "drop", e); //$NON-NLS-1$
>             }
263,263d275
< 			manager.execute(command, new NullProgressMonitor());
405a427,428
> 		/* Get the operation history */
> 		final IOperationHistory manager = (IOperationHistory) getContext()
406,407d426
< 		/* Get the command manager */
< 		final CommandManager manager = (CommandManager) getContext()
408,408c429,429
< 			.getActivePart().getAdapter(CommandManager.class);
---
> 			.getActivePart().getAdapter(IOperationHistory.class);
412a434,450
>                 try {
>                     manager.execute(command, monitor, null);
>                     
>                 } catch (ExecutionException e) {
>                     Trace.catching(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDDebugOptions.EXCEPTIONS_CATCHING,
>                         getClass(), "drop", e); //$NON-NLS-1$
>                     Log.error(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDStatusCodes.SERVICE_FAILURE, "drop", e); //$NON-NLS-1$
>                     
>                     RuntimeException re = new RuntimeException(e);
> 
>                     Trace.throwing(CommonUIServicesDNDPlugin.getDefault(),
>                         CommonUIServicesDNDDebugOptions.EXCEPTIONS_THROWING,
>                         getClass(), "runCommandInProgressMonitorDialog", re); //$NON-NLS-1$
>                     throw re;
>                 }
413,413d433
< 				manager.execute(command, monitor);
