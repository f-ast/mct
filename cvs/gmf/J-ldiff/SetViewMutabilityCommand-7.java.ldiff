18a19,19
> import java.util.Map;
19a21,21
> import org.eclipse.core.commands.ExecutionException;
21a32,35
> import org.eclipse.gmf.runtime.common.core.util.Log;
> import org.eclipse.gmf.runtime.common.core.util.StringStatics;
> import org.eclipse.gmf.runtime.common.core.util.Trace;
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIDebugOptions;
22,22c36,36
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
---
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIPlugin;
22a37,37
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIStatusCodes;
24,24c23,23
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
---
> import org.eclipse.core.runtime.IProgressMonitor;
24a24,30
> import org.eclipse.core.runtime.IStatus;
> import org.eclipse.core.runtime.NullProgressMonitor;
> import org.eclipse.core.runtime.Status;
> import org.eclipse.emf.transaction.Transaction;
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
> import org.eclipse.emf.transaction.util.TransactionUtil;
> import org.eclipse.emf.workspace.AbstractEMFOperation;
114,114c128,128
< 		SetMutability(_immutable);
---
> 		setMutability(_immutable);
117a132,147
> 	private void setMutability(final boolean immutable) {
> 		if (!_viewAdapters.isEmpty()) {
> 			
> 			TransactionalEditingDomain editingDomain = TransactionUtil
> 				.getEditingDomain(((IAdaptable) _viewAdapters.get(0))
> 					.getAdapter(View.class));
> 			if (editingDomain != null) {
> 
> 				Map options = Collections.singletonMap(
> 					Transaction.OPTION_UNPROTECTED, Boolean.TRUE);
> 				AbstractEMFOperation operation = new AbstractEMFOperation(
> 					editingDomain, StringStatics.BLANK, options) {
> 
> 					protected IStatus doExecute(IProgressMonitor monitor,
> 							IAdaptable info)
> 						throws ExecutionException {
118,120d131
< 	private void SetMutability(final boolean immutable) {
< 		MEditingDomainGetter.getMEditingDomain(_viewAdapters).runAsUnchecked(new MRunnable() {
< 			public Object run() {
124,124c151,151
< 					View notationView = (View)adapter.getAdapter(View.class);
---
> 							View notationView = (View) adapter
124a152,152
> 								.getAdapter(View.class);
128a157,172
> 						return Status.OK_STATUS;
> 					}
> 				};
> 				try {
> 					operation.execute(new NullProgressMonitor(), null);
> 				} catch (ExecutionException e) {
> 					Trace.catching(DiagramUIPlugin.getInstance(),
> 						DiagramUIDebugOptions.EXCEPTIONS_CATCHING, getClass(),
> 						"setMutability", e); //$NON-NLS-1$
> 					Log.warning(DiagramUIPlugin.getInstance(),
> 						DiagramUIStatusCodes.IGNORED_EXCEPTION_WARNING,
> 						"setMutability", e); //$NON-NLS-1$
> 
> 				}
> 
> 			}
129,129d156
< 				return null; 
131,131d173
< 		});
147,147c189,189
< 		SetMutability(_immutable);
---
> 		setMutability(_immutable);
154,154c196,196
< 		SetMutability(!_immutable);
---
> 		setMutability(!_immutable);
