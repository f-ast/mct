2,2c2,2
<  * Copyright (c) 2006 Borland Software Corporation
---
>  * Copyright (c) 2006, 2007 Borland Software Corporation
15,15c14,14
< import java.util.Iterator;
---
> import java.util.ArrayList;
24,25d23
< import org.eclipse.emf.common.util.BasicEList;
< import org.eclipse.emf.common.util.EList;
86,86d83
< 	@SuppressWarnings("unchecked")
91a89,91
> 		ArrayList<ToolGroup> groups = new ArrayList<ToolGroup>(palette.getTools().size());
> 		ArrayList<ToolGroupItem> topLevelTools = new ArrayList<ToolGroupItem>(palette.getTools().size());
> 		for (ToolGroupItem next : new ToolSwitch(myToolHistory).toGroupItems(palette.getTools())) {
92,95d88
< 		List groupItems = new ToolSwitch(myToolHistory).toGroupItems(palette.getTools());
< 		EList topLevelTools = new BasicEList();
< 		for (Iterator it = groupItems.iterator(); it.hasNext(); ) {
< 			ToolGroupItem next = (ToolGroupItem) it.next();
96a93,94
> 				groups.add((ToolGroup) next);
> 			} else {
96,96c92,92
< 			if (false == next instanceof ToolGroup) {
---
> 			if (next instanceof ToolGroup) {
97,97d92
< 				it.remove();
109,109c106,106
< 		getGenPalette().getGroups().addAll(groupItems);
---
> 		getGenPalette().getGroups().addAll(groups);
122,122d118
< 	@SuppressWarnings("unchecked")
133,133d128
< 	@SuppressWarnings("unchecked")
171,171d165
< 	@SuppressWarnings("unchecked")
212,212c206,206
< 	private static class ToolSwitch extends GMFToolSwitch {
---
> 	private static class ToolSwitch extends GMFToolSwitch<ToolGroupItem> {
224,224c218,218
< 				ToolGroupItem value = (ToolGroupItem) doSwitch(next);
---
> 				ToolGroupItem value = doSwitch(next);
235,235c229,229
< 		public Object casePaletteSeparator(PaletteSeparator object) {
---
> 		public ToolGroupItem casePaletteSeparator(PaletteSeparator object) {
239,239c233,233
< 		public Object caseCreationTool(CreationTool tool) {
---
> 		public ToolGroupItem caseCreationTool(CreationTool tool) {
245,245c239,239
< 		public Object caseStandardTool(StandardTool standardTool) {
---
> 		public ToolGroupItem caseStandardTool(StandardTool standardTool) {
265,265c259,259
< 		public Object caseGenericTool(GenericTool tool) {
---
> 		public ToolGroupItem caseGenericTool(GenericTool tool) {
276,276d269
< 		@SuppressWarnings("unchecked")
277,277c270,270
< 		public Object caseToolGroup(org.eclipse.gmf.tooldef.ToolGroup toolGroup) {
---
> 		public ToolGroupItem caseToolGroup(org.eclipse.gmf.tooldef.ToolGroup toolGroup) {
