17,17d16
< import java.util.Iterator;
19,19d17
< import java.util.ListIterator;
65a71,71
> 
66,66c72,72
< 			List results = Collections.EMPTY_LIST;
---
> 			return Collections.EMPTY_LIST;
67a67,68
> 				if (providers.size() != 0) {
> 					return Collections.singletonList(operation.execute((IProvider) providers.get(0)));
67a102,102
> 			for (int i = PRIORITIES.length; --i >= 0;) {
68,68d101
< 			for (int i = 0; i < PRIORITIES.length; i++) {
69a104,104
> 				int size = providers.size();
69,69c103,103
< 				List targets = getProviders(service, this, PRIORITIES[i], operation);
---
> 				List providers = service.getProviders(this, PRIORITIES[i], operation);
70,73d103
< 
< 				if (!targets.isEmpty()) {
< 					results = Collections.singletonList(operation.execute((IProvider) targets.get(0)));
< 					break;
75a247,247
> 
76,76c248,248
< 			return results;
---
> 		return providers;
77a74,74
> 
82a80,84
> 			List descriptors = service.getProviders(priority);
> 			int size = descriptors.size();
> 
> 			for (int i = 0; i < size; ++i) {
> 				ProviderDescriptor descriptor = (ProviderDescriptor)descriptors.get(i);
83,83d79
< 			List providers = getProviders(service, priority);
85,86d85
< 			for (ListIterator i = providers.listIterator(); i.hasNext();) {
< 				ProviderDescriptor descriptor = (ProviderDescriptor) i.next();
90a90,90
> 
101a144,145
> 			for (int i = 0; i < PRIORITIES.length; ++i) {
> 				List providers = service.getProviders(this, PRIORITIES[i], operation);
102,105d143
< 			List results = Collections.EMPTY_LIST;
< 
< 			for (int i = PRIORITIES.length - 1; i >= 0; i--) {
< 				List targets = getProviders(service, this, PRIORITIES[i], operation);
106,106c146,146
< 				int size = targets.size();
---
> 				int size = providers.size();
109,109c107,107
< 					results = Collections.singletonList(
---
> 					return Collections.singletonList(
111,111c109,109
< 							(IProvider) targets.get(size - 1)));
---
> 							(IProvider) providers.get(size - 1)));
112,112d109
< 					break;
114a112,113
> 
> 			return Collections.EMPTY_LIST;
115,115d111
< 			return results;
116a115,115
> 
122,122d120
< 				List providers = getProviders(service, priority);
123a236,240
> 		List descriptors = service.getProviders(priority);
> 		int size = descriptors.size();
> 		List providers = new ArrayList(size);
> 
> 		for (int i = 0; i < size; ++i) {
124,124d235
< 				for (ListIterator i = providers.listIterator(providers.size()); i.hasPrevious();) {
125,125c241,241
< 					ProviderDescriptor descriptor = (ProviderDescriptor) i.previous();
---
> 			ProviderDescriptor descriptor = (ProviderDescriptor)descriptors.get(i);
129a130,130
> 
143,143c64,64
< 			for (int i = 0; i < PRIORITIES.length; i++) {
---
> 			for (int i = 0; i < PRIORITIES.length; ++i) {
144,144c65,65
< 				List targets = getProviders(service, this, PRIORITIES[i], operation);
---
> 				List providers = service.getProviders(this, PRIORITIES[i], operation);
145a148,148
> 				for (int j = 0; j < size; ++j) {
146,146d147
< 				for (int j = 0; j < targets.size(); j++) {
147,147c149,149
< 					results.add(operation.execute((IProvider) targets.get(j)));
---
> 					results.add(operation.execute((IProvider) providers.get(j)));
149a152,152
> 
163,163c166,166
< 			for (int i = PRIORITIES.length - 1; i >= 0; i--) {
---
> 			for (int i = PRIORITIES.length; --i >= 0;) {
164,164c167,167
< 				List targets = getProviders(service, this, PRIORITIES[i], operation);
---
> 				List providers = service.getProviders(this, PRIORITIES[i], operation);
165a169,169
> 				for (int j = providers.size(); --j >= 0;) {
166,166d168
< 				for (int j = targets.size() - 1; j >= 0; j--) {
167,167c170,170
< 					results.add(operation.execute((IProvider) targets.get(j)));
---
> 					results.add(operation.execute((IProvider) providers.get(j)));
169a173,173
> 
232,232d235
< 		List targets = new ArrayList();
233a121,123
> 			List descriptors = service.getProviders(priority);
> 
> 			for (int i = descriptors.size(); --i >= 0;) {
234,234d120
< 		for (Iterator i = getProviders(service, priority).iterator(); i.hasNext();) {
235,235c124,124
< 			ProviderDescriptor descriptor = (ProviderDescriptor) i.next();
---
> 				ProviderDescriptor descriptor = (ProviderDescriptor)descriptors.get(i);
237,237c244,244
< 				targets.add(descriptor.getProvider());
---
> 				providers.add(descriptor.getProvider());
240,240d246
< 		return targets;
