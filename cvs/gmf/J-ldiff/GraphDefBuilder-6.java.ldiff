2,2c2,2
<  * Copyright (c) 2006 Eclipse.org
---
>  * Copyright (c) 2006, 2007 Borland Software Corporation
25a27,27
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
26,26c22,22
< import org.eclipse.gmf.gmfgraph.Figure;
---
> import org.eclipse.gmf.gmfgraph.ChildAccess;
33a35,35
> import org.eclipse.gmf.gmfgraph.RealFigure;
47,47c49,49
< 	protected GMFGraphFactory gmfGraphFactory = GMFGraphPackage.eINSTANCE.getGMFGraphFactory();
---
> 	protected final GMFGraphFactory gmfGraphFactory = GMFGraphPackage.eINSTANCE.getGMFGraphFactory();
49,49c51,51
< 	protected NamesDispenser namesDispenser = new IncrementalNamesDispenser();
---
> 	protected final NamesDispenser namesDispenser = new IncrementalNamesDispenser();
163,163d164
< 	@SuppressWarnings("unchecked")
168,168d168
< 		fGallery.getFigures().add(figure);
170,170c170,170
< 		node.setFigure(figure);
---
> 		node.setFigure(newDescriptor(figure.getName(), figure));
170a171,171
> 		fGallery.getDescriptors().add(node.getFigure());
176,176d176
< 	@SuppressWarnings("unchecked")
181,181d180
< 		fGallery.getFigures().add(figure);
183a183,183
> 		fGallery.getDescriptors().add(link.getFigure());
183,183c182,182
< 		link.setFigure(figure);
---
> 		link.setFigure(newDescriptor(figure.getName(), figure));
189,189d188
< 	@SuppressWarnings("unchecked")
197,197d195
< 		fGallery.getFigures().add(figure);
200,200c198,198
< 		link.setFigure(figure);
---
> 		link.setFigure(newDescriptor(figure.getName(), figure));
200a199,199
> 		fGallery.getDescriptors().add(link.getFigure());
206,206d204
< 	@SuppressWarnings("unchecked")
215,215c213,213
< 		assert parent.getFigure() instanceof Figure : "We are creators of this gmfgraph; there should be no figure accessors"; //$NON-NLS-1$
---
> 		assert parent.getFigure().getActualFigure() instanceof RealFigure : "We are creators of this gmfgraph; there should be nothing but figure"; //$NON-NLS-1$
216,216c214,214
< 		((Figure) parent.getFigure()).getChildren().add(figure);
---
> 		((RealFigure) parent.getFigure().getActualFigure()).getChildren().add(figure);
218a217,217
> 		label.setAccessor(newAccess(parent.getFigure(), figure));
218,218c216,216
< 		label.setFigure(figure);
---
> 		label.setFigure(parent.getFigure());
222a222,234
> 
> 	private static FigureDescriptor newDescriptor(String name, RealFigure fig) {
> 		FigureDescriptor fd = GMFGraphFactory.eINSTANCE.createFigureDescriptor();
> 		fd.setActualFigure(fig);
> 		fd.setName(name);
> 		return fd;
> 	}
> 	private static ChildAccess newAccess(FigureDescriptor fd, RealFigure child) {
> 		ChildAccess ca = GMFGraphFactory.eINSTANCE.createChildAccess();
> 		ca.setFigure(child);
> 		fd.getAccessors().add(ca);
> 		return ca;
> 	}
