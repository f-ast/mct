108a109,112
> 	}
> 	
> 	public static Collection filterByNodeMapping(Collection compartments, ChildReference childReference) {
> 		return getChildrenOf(compartments, childReference.getParentNode(), true);
108,108c108,108
< 		return sort(getChildReferencesOf(childReferences, mapping.getParentNode()));
---
> 		return sort(getChildrenOf(childReferences, mapping.getParentNode(), false));
214a219,219
> 	private static Collection getChildrenOf(Collection elements, EObject container, boolean addNull) {
215,215d218
< 	private static Collection getChildReferencesOf(Collection childReferences, NodeMapping parentNode) {
217,217c221,221
< 		for (Iterator it = childReferences.iterator(); it.hasNext();) {
---
> 		for (Iterator it = elements.iterator(); it.hasNext();) {
217a222,223
> 			EObject nextEObject = (EObject) it.next();
> 			if (nextEObject == null ? addNull : nextEObject.eContainer() == container) {
218,219d221
< 			ChildReference nextChildReference = (ChildReference) it.next();
< 			if (nextChildReference != null && nextChildReference.getParentNode() == parentNode) {
220,220c224,224
< 				result.add(nextChildReference);
---
> 				result.add(nextEObject);
