40,40c42,42
< import org.eclipse.emf.transaction.impl.InternalTransaction;
---
> import org.eclipse.gef.EditPartViewer;
41,41d42
< import org.eclipse.emf.transaction.impl.InternalTransactionalEditingDomain;
66a66,66
> import org.eclipse.gmf.runtime.diagram.ui.internal.parts.NotificationForEditPartsListener;
68a69,69
> import org.eclipse.gmf.runtime.diagram.ui.util.EditPartUtil;
100,100c101,101
< implements NotificationListener {
---
> implements NotificationForEditPartsListener {
488a490,490
>             !EditPartUtil.isWriteTransactionInProgress((IGraphicalEditPart)getHost(), false))
489,489d489
<             !isWriteTransactionInProgress())
1180a1182,1184
> 	/* 
> 	 * (non-Javadoc)
> 	 * @see org.eclipse.gmf.runtime.diagram.ui.internal.parts.NotificationForEditPartsListener#getViewer()
1181,1185d1181
<     /**
<      * Checks if the current active transaction is a Write transaction or not
<      * unprotected transaction are not considered write transaction
<      * 
<      * @return true if the current active transaction is a write transaction 
1186a1186,1187
> 	final public EditPartViewer getViewer() {
> 		return getHost().getViewer();
1187,1201d1185
<     private boolean isWriteTransactionInProgress() {
<         TransactionalEditingDomain theEditingDomain = ((IGraphicalEditPart) getHost())
<             .getEditingDomain();
<         if (theEditingDomain instanceof InternalTransactionalEditingDomain){
<             InternalTransactionalEditingDomain internalEditingDomain = 
<                 (InternalTransactionalEditingDomain)theEditingDomain;
<             InternalTransaction transaction = internalEditingDomain.getActiveTransaction();
<             if (transaction!=null && !transaction.isReadOnly()){
<                 Object unprotectedMode = transaction.getOptions().get(Transaction.OPTION_UNPROTECTED); 
<                 if (unprotectedMode == null ||
<                     unprotectedMode == Boolean.FALSE)
<                 return true;
<             }
<         }
<         return false;
1202a1189,1190
>     
>     
