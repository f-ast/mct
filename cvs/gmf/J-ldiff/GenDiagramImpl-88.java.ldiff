11a12,13
> import java.util.LinkedList;
> import java.util.List;
28a31,31
> import org.eclipse.gmf.codegen.gmfgen.FeatureModelFacet;
5346,5346d5348
< 		if(getEditorGen() != null && getEditorGen().getDiagram() != null) {
5347,5347c5349,5349
< 			for (Iterator it = getEditorGen().getDiagram().eAllContents(); it.hasNext(); ) {
---
> 		for (Iterator it = getAllNodes().iterator(); it.hasNext(); ) {
5348,5348c5350,5350
< 				Object next = it.next();
---
> 			GenNode next = (GenNode) it.next();
5350,5350d5351
< 				if (next instanceof GenNode) {
5351,5351c5352,5352
< 					modelFacet = ((GenNode) next).getModelFacet();
---
> 			modelFacet = next.getModelFacet();
5353,5353c5354,5354
< 						resultMap.put(modelFacet, (GenNode)next);					
---
> 				resultMap.put(modelFacet, next);					
5354a5357,5360
> 		for (Iterator it = getLinks().iterator(); it.hasNext();) {
> 			GenLink next = (GenLink) it.next();
> 			if (next.getModelFacet() instanceof TypeLinkModelFacet) {
> 				TypeLinkModelFacet modelFacet = (TypeLinkModelFacet) next.getModelFacet();
5355,5356d5356
< 				} else if (next instanceof GenLink && ((GenLink) next).getModelFacet() instanceof TypeLinkModelFacet) {
< 					modelFacet = (TypeLinkModelFacet) ((GenLink) next).getModelFacet();
5357,5357c5361,5361
< 					if(modelFacet != null) { 
---
> 				if(modelFacet != null) {
5358,5358c5362,5362
< 						resultMap.put(modelFacet, (GenLink) next);
---
> 					resultMap.put(modelFacet, next);
5364a5368,5394
> 
> 	public Map<GenClass, GenTopLevelNode> getGenClass2PhantomMap() {
> 		LinkedHashMap<GenClass, GenTopLevelNode> genClass2Phantom = new LinkedHashMap<GenClass, GenTopLevelNode>();
> 		for (Iterator topLevelNodes = getTopLevelNodes().iterator(); topLevelNodes.hasNext();) {
> 			GenTopLevelNode nextTopLevelNode = (GenTopLevelNode) topLevelNodes.next();
> 			TypeModelFacet nextModelFacet = nextTopLevelNode.getModelFacet();
> 			if (nextModelFacet == null || !nextModelFacet.isPhantomElement()) {
> 				continue;
> 			}
> 			genClass2Phantom.put(nextModelFacet.getMetaClass(), nextTopLevelNode);
> 		}
> 		return genClass2Phantom;
> 	}
> 
> 	public List<GenLink> getPhantomLinks() {
> 		LinkedList<GenLink> phantomLinks = new LinkedList<GenLink>();
> 		for (Iterator it = getLinks().iterator(); it.hasNext();) {
> 			GenLink nextLink = (GenLink) it.next();
> 			if (nextLink.getModelFacet() instanceof FeatureModelFacet) {
> 				FeatureModelFacet nextModelFacet = (FeatureModelFacet) nextLink.getModelFacet();
> 				if (nextModelFacet.getMetaFeature().isContains()) {
> 					phantomLinks.add(nextLink);
> 				}
> 			}
> 		}
> 		return phantomLinks;
> 	}
