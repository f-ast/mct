13a14,14
> import java.util.Collection;
14a16,16
> import java.util.LinkedList;
15a18,18
> import org.eclipse.emf.ecore.EStructuralFeature;
25a29,29
> import org.eclipse.gmf.gmfgraph.GMFGraphPackage;
52a57,57
> 		// TODO respect implementation from original FigureGallery, see (#x#) 
142a148,151
> 		if (figure instanceof CustomFigure && isPlainBareCustomFigure((CustomFigure) figure)) {
> 			// XXX an implementationBundle might be an issue here (#x#),
> 			// since myOutcomeGallery gonna get one we generate, while the original CustomFigure
> 			// may have one specified in the ownining FigureGallery. 
143,143d147
< 		if (figure instanceof CustomFigure /* && isPlainBareFigureHandle()*/) {
150a159,188
> 	/**
> 	 * FIXME diplicates {@link org.eclipse.gmf.bridge.genmodel.InnerClassViewmapProducer#isBareInstance}
> 	 * Should be merged somehow.
> 	 */
> 	private static boolean isPlainBareCustomFigure(CustomFigure figure) {
> 		if (!figure.getChildren().isEmpty()) {
> 			return false;
> 		}
> 		final Collection featuresToCheck = new LinkedList(figure.eClass().getEAllStructuralFeatures());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getIdentity_Name());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getFigure_Children());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getFigureMarker_Parent());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getFigureHandle_ReferencingElements());
> 
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getCustomClass_BundleName());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getCustomClass_QualifiedClassName());
> 		featuresToCheck.remove(GMFGraphPackage.eINSTANCE.getCustomFigure_CustomChildren());
> 
> 		for(Iterator it = featuresToCheck.iterator(); it.hasNext();) {
> 			final EStructuralFeature next = (EStructuralFeature) it.next();
> 			if (next.isDerived()) {
> 				continue;
> 			}
> 			if (figure.eIsSet(next)) {
> 				return false;
> 			}
> 		}
> 		return true;
> 	}
> 
