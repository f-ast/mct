10,11d9
< import java.util.Collections;
< import java.util.HashSet;
13,14d10
< import java.util.LinkedHashSet;
< import java.util.Set;
40,40d35
< import org.eclipse.gmf.codegen.gmfgen.GenNode;
44,44d39
< import org.eclipse.gmf.codegen.gmfgen.LinkModelFacet;
49,49d35
< import org.eclipse.gmf.codegen.gmfgen.TypeLinkModelFacet;
50,50c36,36
< import org.eclipse.gmf.codegen.gmfgen.TypeModelFacet;
---
> import org.eclipse.gmf.codegen.gmfgen.GenPlugin;
51,51d36
< 
91,91d82
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPluginClassName <em>Plugin Class Name</em>}</li>
109,109c100,100
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPluginID <em>Plugin ID</em>}</li>
---
>  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPlugin <em>Plugin</em>}</li>
110,111d100
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getPluginName <em>Plugin Name</em>}</li>
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#getProviderName <em>Provider Name</em>}</li>
113,113d101
<  *   <li>{@link org.eclipse.gmf.codegen.gmfgen.impl.GenDiagramImpl#isPrintingEnabled <em>Printing Enabled</em>}</li>
743,762d730
< 	 * The default value of the '{@link #getPluginClassName() <em>Plugin Class Name</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPluginClassName()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected static final String PLUGIN_CLASS_NAME_EDEFAULT = null;
< 
< 	/**
< 	 * The cached value of the '{@link #getPluginClassName() <em>Plugin Class Name</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPluginClassName()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected String pluginClassName = PLUGIN_CLASS_NAME_EDEFAULT;
< 
< 	/**
1003,1012d970
< 	 * The default value of the '{@link #getPluginID() <em>Plugin ID</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPluginID()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected static final String PLUGIN_ID_EDEFAULT = null;
< 
< 	/**
1013,1013c971,971
< 	 * The cached value of the '{@link #getPluginID() <em>Plugin ID</em>}' attribute.
---
> 	 * The cached value of the '{@link #getPlugin() <em>Plugin</em>}' containment reference.
1014,1023d971
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPluginID()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected String pluginID = PLUGIN_ID_EDEFAULT;
< 
< 	/**
< 	 * The default value of the '{@link #getPluginName() <em>Plugin Name</em>}' attribute.
1026,1026c974,974
< 	 * @see #getPluginName()
---
> 	 * @see #getPlugin()
1029a978,978
> 	protected GenPlugin plugin = null;
1030,1060d977
< 	protected static final String PLUGIN_NAME_EDEFAULT = null;
< 
< 	/**
< 	 * The cached value of the '{@link #getPluginName() <em>Plugin Name</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getPluginName()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected String pluginName = PLUGIN_NAME_EDEFAULT;
< 
< 	/**
< 	 * The default value of the '{@link #getProviderName() <em>Provider Name</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getProviderName()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected static final String PROVIDER_NAME_EDEFAULT = "Sample Plugin Provider, Inc";
< 
< 	/**
< 	 * The cached value of the '{@link #getProviderName() <em>Provider Name</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #getProviderName()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected String providerName = PROVIDER_NAME_EDEFAULT;
1083,1102d1000
< 	 * The default value of the '{@link #isPrintingEnabled() <em>Printing Enabled</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #isPrintingEnabled()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected static final boolean PRINTING_ENABLED_EDEFAULT = false;
< 
< 	/**
< 	 * The cached value of the '{@link #isPrintingEnabled() <em>Printing Enabled</em>}' attribute.
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @see #isPrintingEnabled()
< 	 * @generated
< 	 * @ordered
< 	 */
< 	protected boolean printingEnabled = PRINTING_ENABLED_EDEFAULT;
< 
< 	/**
1122,1122c1020,1020
< 	private static final String DIAGRAM_EDITOR_TOKEN = "gmf.editor";
---
> 	static final String DIAGRAM_EDITOR_TOKEN = "gmf.editor";
1472a1264,1265
> 	public GenPlugin getPlugin() {
> 		return plugin;
1473,1474d1263
< 	public String getPluginName() {
< 		return pluginName;
1475,1475c1266,1266
< 	}
---
> 	}
1476,1476c1267,1267
< 
---
> 
1477,1477c1268,1268
< 	/**
---
> 	/**
1478,1478c1269,1269
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
1479,1479c1270,1270
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
1480,1480c1271,1271
< 	 * @generated
---
> 	 * @generated
1481,1481c1272,1272
< 	 */
---
> 	 */
1481a1273,1280
> 	public NotificationChain basicSetPlugin(GenPlugin newPlugin, NotificationChain msgs) {
> 		GenPlugin oldPlugin = plugin;
> 		plugin = newPlugin;
> 		if (eNotificationRequired()) {
> 			ENotificationImpl notification = new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, oldPlugin, newPlugin);
> 			if (msgs == null) msgs = notification; else msgs.add(notification);
> 		}
> 		return msgs;
1482,1486d1272
< 	public void setPluginName(String newPluginName) {
< 		String oldPluginName = pluginName;
< 		pluginName = newPluginName;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN_NAME, oldPluginName, pluginName));
1487,1487c1281,1281
< 	}
---
> 	}
1488,1488c1282,1282
< 
---
> 
1489,1489c1283,1283
< 	/**
---
> 	/**
1490,1490c1284,1284
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
1491,1491c1285,1285
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
1492,1492c1286,1286
< 	 * @generated
---
> 	 * @generated
1493a1288,1299
> 	public void setPlugin(GenPlugin newPlugin) {
> 		if (newPlugin != plugin) {
> 			NotificationChain msgs = null;
> 			if (plugin != null)
> 				msgs = ((InternalEObject)plugin).eInverseRemove(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
> 			if (newPlugin != null)
> 				msgs = ((InternalEObject)newPlugin).eInverseAdd(this, GMFGenPackage.GEN_PLUGIN__DIAGRAM, GenPlugin.class, msgs);
> 			msgs = basicSetPlugin(newPlugin, msgs);
> 			if (msgs != null) msgs.dispatch();
> 		}
> 		else if (eNotificationRequired())
> 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN, newPlugin, newPlugin));
1493,1493c1287,1287
< 	 */
---
> 	 */
1494,1495d1287
< 	public String getProviderName() {
< 		return providerName;
1496,1496c1300,1300
< 	}
---
> 	}
1497,1497c1301,1301
< 
---
> 
1498,1498c1302,1302
< 	/**
---
> 	/**
1499,1499c1303,1303
< 	 * <!-- begin-user-doc -->
---
> 	 * <!-- begin-user-doc -->
1500,1500c1304,1304
< 	 * <!-- end-user-doc -->
---
> 	 * <!-- end-user-doc -->
1501,1501c1305,1305
< 	 * @generated
---
> 	 * @generated
1502,1502c1306,1306
< 	 */
---
> 	 */
1503,1572d1306
< 	public void setProviderName(String newProviderName) {
< 		String oldProviderName = providerName;
< 		providerName = newProviderName;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PROVIDER_NAME, oldProviderName, providerName));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public String getPluginIDGen() {
< 		return pluginID;
< 	}
< 
< 	public String getPluginID() {
< 		String value = getPluginIDGen();
< 		if (value == null || value.length() == 0) {
< 			return getEMFGenModel().getModelPluginID() + '.' + DIAGRAM_EDITOR_TOKEN;
< 		}
< 		return value;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setPluginID(String newPluginID) {
< 		String oldPluginID = pluginID;
< 		pluginID = newPluginID;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN_ID, oldPluginID, pluginID));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public String getPluginClassNameGen() {
< 		return pluginClassName;
< 	}
< 
< 	public String getPluginClassName() {
< 		String value = getPluginClassNameGen();
< 		if (isEmpty(value)) {
< 			value = getDomainPackageCapName() + "DiagramEditorPlugin";
< 		}
< 		return value;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setPluginClassName(String newPluginClassName) {
< 		String oldPluginClassName = pluginClassName;
< 		pluginClassName = newPluginClassName;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME, oldPluginClassName, pluginClassName));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
2284,2304d2124
< 	public boolean isPrintingEnabled() {
< 		return printingEnabled;
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
< 	public void setPrintingEnabled(boolean newPrintingEnabled) {
< 		boolean oldPrintingEnabled = printingEnabled;
< 		printingEnabled = newPrintingEnabled;
< 		if (eNotificationRequired())
< 			eNotify(new ENotificationImpl(this, Notification.SET, GMFGenPackage.GEN_DIAGRAM__PRINTING_ENABLED, oldPrintingEnabled, printingEnabled));
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated
< 	 */
2727,2735d2546
< 	public String getPluginQualifiedClassName() {
< 		return getEditorPackageName() + '.' + getPluginClassName();
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated NOT
< 	 */
2833a2645,2648
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
> 				if (plugin != null)
> 					msgs = ((InternalEObject)plugin).eInverseRemove(this, EOPPOSITE_FEATURE_BASE - GMFGenPackage.GEN_DIAGRAM__PLUGIN, null, msgs);
> 				return basicSetPlugin((GenPlugin)otherEnd, msgs);
2932,2933d2748
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME:
< 				return getPluginClassName();
2970,2970c2785,2785
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_ID:
---
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
2971,2971c2786,2786
< 				return getPluginID();
---
> 				return getPlugin();
2972,2975d2786
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_NAME:
< 				return getPluginName();
< 			case GMFGenPackage.GEN_DIAGRAM__PROVIDER_NAME:
< 				return getProviderName();
2978,2979d2788
< 			case GMFGenPackage.GEN_DIAGRAM__PRINTING_ENABLED:
< 				return isPrintingEnabled() ? Boolean.TRUE : Boolean.FALSE;
3090,3092d2898
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME:
< 				setPluginClassName((String)newValue);
< 				return;
3150,3150c2956,2956
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_ID:
---
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
3151,3153d2956
< 				setPluginID((String)newValue);
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_NAME:
3154,3154c2957,2957
< 				setPluginName((String)newValue);
---
> 				setPlugin((GenPlugin)newValue);
3155,3157d2957
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__PROVIDER_NAME:
< 				setProviderName((String)newValue);
3162,3164d2961
< 			case GMFGenPackage.GEN_DIAGRAM__PRINTING_ENABLED:
< 				setPrintingEnabled(((Boolean)newValue).booleanValue());
< 				return;
3275,3277d3071
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME:
< 				setPluginClassName(PLUGIN_CLASS_NAME_EDEFAULT);
< 				return;
3328a3123,3124
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
> 				setPlugin((GenPlugin)null);
3329,3336d3122
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_ID:
< 				setPluginID(PLUGIN_ID_EDEFAULT);
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_NAME:
< 				setPluginName(PLUGIN_NAME_EDEFAULT);
< 				return;
< 			case GMFGenPackage.GEN_DIAGRAM__PROVIDER_NAME:
< 				setProviderName(PROVIDER_NAME_EDEFAULT);
3341,3343d3128
< 			case GMFGenPackage.GEN_DIAGRAM__PRINTING_ENABLED:
< 				setPrintingEnabled(PRINTING_ENABLED_EDEFAULT);
< 				return;
3422,3423d3206
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME:
< 				return PLUGIN_CLASS_NAME_EDEFAULT == null ? pluginClassName != null : !PLUGIN_CLASS_NAME_EDEFAULT.equals(pluginClassName);
3458,3463d3240
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_ID:
< 				return PLUGIN_ID_EDEFAULT == null ? pluginID != null : !PLUGIN_ID_EDEFAULT.equals(pluginID);
< 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN_NAME:
< 				return PLUGIN_NAME_EDEFAULT == null ? pluginName != null : !PLUGIN_NAME_EDEFAULT.equals(pluginName);
< 			case GMFGenPackage.GEN_DIAGRAM__PROVIDER_NAME:
< 				return PROVIDER_NAME_EDEFAULT == null ? providerName != null : !PROVIDER_NAME_EDEFAULT.equals(providerName);
3466,3467d3244
< 			case GMFGenPackage.GEN_DIAGRAM__PRINTING_ENABLED:
< 				return printingEnabled != PRINTING_ENABLED_EDEFAULT;
3532a3241,3242
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
> 				return plugin != null;
3533,3533d3240
< 				case GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME: return GMFGenPackage.EDITOR_CANDIES__PLUGIN_CLASS_NAME;
3617a2672,2673
> 			case GMFGenPackage.GEN_DIAGRAM__PLUGIN:
> 				return basicSetPlugin(null, msgs);
3618,3618d2671
< 				case GMFGenPackage.EDITOR_CANDIES__PLUGIN_CLASS_NAME: return GMFGenPackage.GEN_DIAGRAM__PLUGIN_CLASS_NAME;
3785,3800d3559
< 	public EList getRequiredPluginIDs() {
< 		Collection requiredPlugins = new LinkedHashSet();
< 		if (usesSVGShapes()) {
< 			requiredPlugins.add("org.eclipse.gmf.diagramrt.gefsvg");
< 		}
< 		
< 		requiredPlugins.addAll(getExpressionsRequiredPluginIDs());
< 		requiredPlugins.addAll(getValidationRequiredPluginIDs());
< 		return new BasicEList(requiredPlugins);
< 	}
< 
< 	/**
< 	 * <!-- begin-user-doc -->
< 	 * <!-- end-user-doc -->
< 	 * @generated NOT
< 	 */
3940,3950d3698
< 	private boolean usesSVGShapes() {
< /* couldn't tell now
< 		for (Iterator it = getNodes().iterator(); it.hasNext();) {
< 			if (((GenNode) it.next()).getViewmapURI() != null) {
< 				return true;
< 			}
< 		}
< */
< 		return false;
< 	}
< 
4022,4023d3769
< 		result.append(", pluginClassName: ");
< 		result.append(pluginClassName);
4042,4047d3787
< 		result.append(", pluginID: ");
< 		result.append(pluginID);
< 		result.append(", pluginName: ");
< 		result.append(pluginName);
< 		result.append(", providerName: ");
< 		result.append(providerName);
4050,4051d3789
< 		result.append(", printingEnabled: ");
< 		result.append(printingEnabled);
4081,4120d3818
< 
< 	private Set getExpressionsRequiredPluginIDs() {
< 		Set requiredIDs = new HashSet();
< 		for (Iterator it = getAllNodes().iterator(); it.hasNext();) {
< 			GenNode nextNode = (GenNode) it.next();
< 			TypeModelFacet modelFacet = nextNode.getModelFacet();
< 			if(modelFacet.getModelElementInitializer() != null) {
< 				requiredIDs.addAll(modelFacet.getModelElementInitializer().getRequiredPluginIDs());
< 			}
< 			if(modelFacet.getModelElementSelector() != null) {
< 				requiredIDs.addAll(modelFacet.getModelElementSelector().getRequiredPluginIDs());				
< 			}
< 		}
< 		
< 		for (Iterator it = getLinks().iterator(); it.hasNext();) {
< 			GenLink nextLink = (GenLink) it.next();
< 			LinkModelFacet modelFacet = nextLink.getModelFacet();
< 			if(modelFacet instanceof TypeLinkModelFacet) {
< 				TypeLinkModelFacet  typeModelFacet = (TypeLinkModelFacet)modelFacet;
< 				if(typeModelFacet.getModelElementInitializer() != null) {
< 					requiredIDs.addAll(typeModelFacet.getModelElementInitializer().getRequiredPluginIDs());
< 				}
< 				if(typeModelFacet.getModelElementSelector() != null) {
< 					requiredIDs.addAll(typeModelFacet.getModelElementSelector().getRequiredPluginIDs());
< 				}
< 			}
< 		}		
< 		if(hasLinkCreationConstraints()) {
< 			requiredIDs.add("org.eclipse.emf.ocl"); //$NON-NLS-1$			
< 			requiredIDs.add("org.eclipse.emf.query.ocl"); //$NON-NLS-1$			
< 		}
< 		return requiredIDs;
< 	}
< 	
< 	private Set getValidationRequiredPluginIDs() {
< 		if(isValidationEnabled() || (getAudits() != null && !getAudits().getAllAuditRules().isEmpty())) {
< 			return Collections.singleton("org.eclipse.emf.validation"); //$NON-NLS-1$ 
< 		}
< 		return Collections.EMPTY_SET;
< 	}
