14,15d13
< import java.text.MessageFormat;
< 
23a22,22
> import org.eclipse.osgi.util.NLS;
24a24,24
> import org.eclipse.swt.widgets.Shell;
70a71,75
> 		Shell shell = null;
> 		if (PlatformUI.getWorkbench().getActiveWorkbenchWindow() != null && Display.getCurrent() != null) {
> 			shell = PlatformUI.getWorkbench().getActiveWorkbenchWindow()
> 				.getShell();
> 		}
71,72d81
< 		final boolean result[] = new boolean[] {false};
< 
73,73c82,82
< 		PlatformUI.getWorkbench().getDisplay().syncExec(new Runnable() {
---
> 			PlatformUI.getWorkbench().getDisplay().asyncExec(new Runnable() {
75,75d76
< 			public void run() {
76,76c77,77
< 				IStatus status = ResourcesPlugin.getWorkspace().validateEdit(
---
> 		final IStatus status = ResourcesPlugin.getWorkspace().validateEdit(
77,78d77
< 					files,
< 					PlatformUI.getWorkbench().getActiveWorkbenchWindow()
79,79c78,78
< 						.getShell());
---
> 			files, shell);
80a80,80
> 			return true;
81,81d79
< 					result[0] = true;
83a84,84
> 				public void run() {
87a89,90
> 							NLS
> 								.bind(
88,89d88
< 							MessageFormat
< 								.format(
90a92,96
> 									modificationReason),
> 							NLS
> 								.bind(
> 									CommonUIMessages.FileModificationValidator_EditProblemDialogMessage,
> 									modificationReason, status.getMessage()));
91,104d91
< 									new Object[] {modificationReason}),
< 							MessageFormat
< 								.format(
< 									CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part1,
< 									new Object[] {modificationReason})
< 								+ "\n\n" //$NON-NLS-1$
< 								+ CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part2
< 								+ "\n" //$NON-NLS-1$
< 								+ MessageFormat
< 									.format(
< 										CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part3,
< 										new Object[] {status.getMessage()}));
< 					result[0] = false;
< 				}
106a99,100
> 			return false;
> 		}
107,107d98
< 		return result[0];
142a136,137
> 					PlatformUI.getWorkbench().getActiveWorkbenchWindow()
> 						.getShell(),
143,143d135
< 					Display.getCurrent().getActiveShell(),
144a139,142
> 					NLS
> 						.bind(
> 							CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage,
> 							status.getMessage()));
145,152d138
< 					CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part1
< 						+ "\n\n" //$NON-NLS-1$
< 						+ CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part2
< 						+ "\n" //$NON-NLS-1$
< 						+ MessageFormat
< 							.format(
< 								CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part3,
< 								new Object[] {status.getMessage()}));
166,166c156,156
< 			String message = MessageFormat
---
> 			String message = NLS
167,167c157,157
< 				.format(
---
> 				.bind(
169,169c159,159
< 					new Object[] {file.getFullPath().toString()});
---
> 					file.getFullPath().toString());
