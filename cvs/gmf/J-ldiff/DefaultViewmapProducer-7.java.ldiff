2,2c2,2
<  * Copyright (c) 2005 Borland Software Corporation
---
>  * Copyright (c) 2005, 2007 Borland Software Corporation
29,29c25,25
< import org.eclipse.gmf.gmfgraph.FigureHandle;
---
> import org.eclipse.gmf.gmfgraph.DiagramElement;
32,32c33,33
< import org.eclipse.gmf.gmfgraph.Layoutable;
---
> import org.eclipse.gmf.gmfgraph.VisualFacet;
87a88,88
> 		Figure figure = diagramNode.getFigure().getActualFigure();
88,91d87
< 		FigureHandle figure = diagramNode.getFigure();
< 		if (false == figure instanceof Layoutable){
< 			return;
< 		}
92,92c89,89
< 		ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType(((Layoutable) figure).getLayout());
---
> 		ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType(figure.getLayout());
96,96c93,93
< 	protected final void setupStyleAttributes(Viewmap viewmap, FigureHandle handle){
---
> 	protected final void setupStyleAttributes(Viewmap viewmap, Figure figure){
97,97c94,94
< 		if (viewmap == null || false == handle instanceof Figure){
---
> 		if (viewmap == null || figure == null) {
100,100d96
< 		Figure figure = (Figure)handle;
126,126c122,122
< 		FigureHandle handle = node.getFigure();
---
> 		Figure figure = node.getFigure().getActualFigure();
127,128d122
< 		if (handle instanceof Figure){
< 			Figure figure = (Figure)handle;
130,130c124,124
< 			DefaultSizeFacet facet = (DefaultSizeFacet) node.find(DefaultSizeFacet.class);
---
> 		DefaultSizeFacet facet = findVF(node, DefaultSizeFacet.class);
143a138,145
> 
> 	protected static <T extends VisualFacet> T findVF(DiagramElement de, Class<T> facetClass) {
> 		for (VisualFacet vf : de.getFacets()) {
> 			if (facetClass.isInstance(vf)) {
> 				return facetClass.cast(vf);
> 			}
> 		}
> 		return null;
