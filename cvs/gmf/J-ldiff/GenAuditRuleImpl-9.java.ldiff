20,20c20,20
< import org.eclipse.gmf.codegen.gmfgen.GenEditorGenerator;
---
> import org.eclipse.gmf.codegen.gmfgen.GenDiagram;
378,381d377
< 		if(getTarget() == null) {
< 			return null;
< 		}
< 		GenEditorGenerator editorGen = getContainer().getEditor();
382,382c378,378
< 		if(editorGen.getDiagram() == null) {
---
> 		if(getTarget() == null || getDiagram() == null) {
385,385c381,381
< 		return editorGen.getDiagram().getValidationProviderClassName() + "$" + getContextSelectorLocalClassName(); //$NON-NLS-1$  
---
> 		return getDiagram().getValidationProviderClassName() + "$" + getContextSelectorLocalClassName(); //$NON-NLS-1$  
394,394d389
< 		GenEditorGenerator editorGen = getContainer().getEditor();
395,395c390,390
< 		if(editorGen.getDiagram() == null) {
---
> 		if(getTarget() == null || getDiagram() == null) {
398,398c393,393
< 		return editorGen.getDiagram().getValidationProviderQualifiedClassName() + "$" + getContextSelectorLocalClassName(); //$NON-NLS-1$ 
---
> 		return getDiagram().getValidationProviderQualifiedClassName() + "$" + getContextSelectorLocalClassName(); //$NON-NLS-1$ 
407a403,403
> 			return "NoCtx"; //$NON-NLS-1$
408,408d402
< 			return null;
415a411,472
> 	 * @generated NOT
> 	 */
> 	public String getConstraintAdapterClassName() {
> 		if(getDiagram() == null || getConstraintAdapterLocalClassName() == null) {
> 			return null;
> 		}		
> 		return getDiagram().getValidationProviderClassName() + "$" + getConstraintAdapterLocalClassName(); //$NON-NLS-1$
> 	}
> 	
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
> 	 * @generated NOT
> 	 */
> 	public String getConstraintAdapterLocalClassName() {
> 		if(getContainer() == null) {
> 			return null;
> 		}
> 		StringBuffer buf = new StringBuffer();
> 		for(GenAuditContainer container = getContainer(); container != null;) {
> 			GenAuditContainer parent = container.getParentContainer();
> 			if(parent != null) {
> 				buf.insert(0, parent.getChildContainers().indexOf(container) + 1);
> 			}
> 			container = parent;
> 		}
> 		buf.insert(0, "Adapter"); //$NON-NLS-1$
> 		buf.append(getContainer().getAudits().indexOf(this) + 1);
> 		return buf.toString(); 
> 	}
> 	
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
> 	 * @generated NOT
> 	 */	
> 	public String getConstraintAdapterQualifiedClassName() {
> 		if(getDiagram() == null) {
> 			return null;
> 		}
> 		return getDiagram().getValidationProviderQualifiedClassName() + "$" + getConstraintAdapterLocalClassName(); //$NON-NLS-1$
> 	}
> 	
> 	private GenDiagram getDiagram() {
> 		if(getContainer() != null && getContainer().getEditor() != null) {
> 			return getContainer().getEditor().getDiagram();
> 		}
> 		return null;
> 	}
> 
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
> 	 * @generated NOT
> 	 */	
> 	public boolean requiresConstraintAdapter() {
> 		return getRule() != null && !getRule().isOCLExpression();
> 	}
> 	
> 	/**
> 	 * <!-- begin-user-doc -->
> 	 * <!-- end-user-doc -->
