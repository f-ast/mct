45,45c45,45
<  * @author choang
---
>  * @author choang, cmahoney
47a48,48
> 	extends DiagramEditor
48,48d47
< 	extends DiagramEditor implements IActivityManagerListener
49a50,69
> 	/**
> 	 * Listens for activity/capability events.
> 	 * 
> 	 * @author cmahoney
> 	 */
> 	class ActivityManagerListener
> 		implements IActivityManagerListener {
> 
> 		public void activityManagerChanged(
> 				ActivityManagerEvent activityManagerEvent) {
> 			if (activityManagerEvent.haveEnabledActivityIdsChanged()) {
> 				updatePaletteRoot();
> 			}
> 		}
> 	}
> 	
> 	/**
> 	 * The activity listener.
> 	 */
> 	private ActivityManagerListener activityManagerListener;
90a111,111
> 			activityManagerListener = new ActivityManagerListener();
92,92c113,113
< 			.addActivityManagerListener(this);
---
> 				.addActivityManagerListener(activityManagerListener);
527a549,552
> 	protected void stopListening() {
> 		if (activityManagerListener != null) {
> 			PlatformUI.getWorkbench().getActivitySupport().getActivityManager()
> 				.removeActivityManagerListener(activityManagerListener);
528,535d548
< 	/*
< 	 * (non-Javadoc)
< 	 * 
< 	 * @see org.eclipse.ui.activities.IActivityManagerListener#activityManagerChanged(org.eclipse.ui.activities.ActivityManagerEvent)
< 	 */
< 	public void activityManagerChanged(ActivityManagerEvent activityManagerEvent) {
< 		if (activityManagerEvent.haveEnabledActivityIdsChanged()) {
< 			updatePaletteRoot();
536a554,555
> 		activityManagerListener = null;
> 		super.stopListening();
