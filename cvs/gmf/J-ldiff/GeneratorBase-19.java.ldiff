322,322d321
< 			String oldContents = null;
324,324c323,323
< 				oldContents = cu.getSource();
---
> 				final String oldContents = cu.getSource();
325a325,332
> 				genText = formatCode(genText);
> 				if (!genText.equals(oldContents)) { // compare text with fqns; works for jet templates
> 					cu.getBuffer().setContents(genText);
> 					getImportsPostrocessor().organizeImports(cu, isToRestoreExistingImports, new SubProgressMonitor(pm, 1));
> 					String newContents = formatCode(cu.getSource());
> 					if (!newContents.equals(oldContents)) { // compare text with organized imports; works for xpand templates
> 						cu.getBuffer().setContents(newContents);
> 						cu.save(new SubProgressMonitor(pm, 1), true);
328a337,340
> 					pm.worked(2);
> 				}
> 			} else {
> 				cu = pf.createCompilationUnit(cu.getElementName(), genText, true, new SubProgressMonitor(pm, 1));
329,331d336
< 			genText = formatCode(genText);
< 			if (!genText.equals(oldContents)) {
< 				ICompilationUnit newCU = pf.createCompilationUnit(cu.getElementName(), genText, true, new SubProgressMonitor(pm, 1));
332,332c341,341
<                 getImportsPostrocessor().organizeImports(newCU, isToRestoreExistingImports, new SubProgressMonitor(pm, 1));
---
> 				getImportsPostrocessor().organizeImports(cu, isToRestoreExistingImports, new SubProgressMonitor(pm, 1));
332a342,343
> 				String newContents = formatCode(cu.getSource());
> 				cu.getBuffer().setContents(newContents);
333,333c344,344
<                 newCU.save(new SubProgressMonitor(pm, 1), true);
---
> 				cu.save(new SubProgressMonitor(pm, 1), true);
335,335d336
< 				pm.worked(1);
