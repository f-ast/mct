14,15d13
< import java.beans.PropertyChangeEvent;
< import java.beans.PropertyChangeListener;
22,22c23,23
< import org.eclipse.draw2d.FigureListener;
---
> import org.eclipse.draw2d.LayoutListener;
50a49,49
> import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.PageBreakEditPart;
59a59,59
> import org.eclipse.jface.preference.IPreferenceStore;
72,72d71
< 	
74,74d72
< 	
109a108,121
> 	/**
> 	 * @author mmostafa
> 	 * PageBreaksLayoutListener Listens to post layout so it can update the page breaks  
> 	 */
> 	private class PageBreaksLayoutListener extends LayoutListener.Stub {
> 
> 		public void postLayout(IFigure container) {
> 			super.postLayout(container);
> 			updatePageBreaksLocation();
> 		}
> 		
> 		
> 	}
> 
146,146d157
< 			
159a171,171
> 		f.addLayoutListener(new PageBreaksLayoutListener());
160,160d170
< 
259,277d269
< 
< 		// Fired when figures are added or moved on the diagram			
< 		child.addFigureListener(new FigureListener() {
< 			public void figureMoved(IFigure source) {
< 				updatePageBreaksLocation();
< 			}
< 		});
< 
< 		// Fired when figures are to be deleted on the diagram
< 		child.addPropertyChangeListener(new PropertyChangeListener() {
< 			public void propertyChange(PropertyChangeEvent evt) {
< 				String pName = evt.getPropertyName();
< 				Object newValue = evt.getNewValue();
< 				if (pName == "parent" && newValue == null) { //$NON-NLS-1$
< 					shouldUpdatePageBreakLocation = true;
< 					//updatePageBreaksLocation();
< 				}
< 			}
< 		});
286a279,282
> 		// do not update unless we really need to
> 		PageBreakEditPart pagebreakEditpart = ((DiagramRootEditPart)getRoot()).getPageBreakEditPart();
> 		if (pagebreakEditpart == null ||
> 			pagebreakEditpart.getFigure().isVisible())
287,288d278
< 
< 		if (((DiagramRootEditPart) getRoot()).getWorkspaceViewerPreferences() == null)
290,293d283
< 
< 		((DiagramRootEditPart) getRoot())
< 		.getPageBreakEditPart()
< 		.resize(
294,294c284,284
< 		getChildrenBounds());
---
> 		pagebreakEditpart.resize(getChildrenBounds());
295,295d284
< 		
383,383d371
< 
