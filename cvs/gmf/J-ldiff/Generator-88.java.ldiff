15a16,16
> import java.lang.reflect.InvocationTargetException;
32,32d32
< import org.eclipse.emf.codegen.jet.JETException;
59a60,61
> import org.eclipse.gmf.internal.common.codegen.ImportUtil;
> import org.eclipse.gmf.internal.common.codegen.JETEmitterAdapter;
59,59c59,59
< import org.eclipse.gmf.common.codegen.GeneratorBase;
---
> import org.eclipse.gmf.internal.common.codegen.GeneratorBase;
238a241,241
> 		internalGenerateJavaClass(
239,239d240
< 		doGenerateJavaClass(
249a252,252
> 		internalGenerateJavaClass(
250,250d251
< 		doGenerateJavaClass(
267a270,270
> 		internalGenerateJavaClass(
268,268d269
< 		doGenerateJavaClass(
276a279,279
> 		internalGenerateJavaClass(
277,277d278
< 		doGenerateJavaClass(
287a290,290
> 		internalGenerateJavaClass(
288,288d289
< 		doGenerateJavaClass(
296a299,299
> 		internalGenerateJavaClass(
297,297d298
< 		doGenerateJavaClass(
305a308,308
> 		internalGenerateJavaClass(
306,306d307
< 		doGenerateJavaClass(
314a317,317
> 		internalGenerateJavaClass(
315,315d316
< 		doGenerateJavaClass(
323a326,326
> 		internalGenerateJavaClass(
324,324d325
< 		doGenerateJavaClass(
332a335,335
> 		internalGenerateJavaClass(
333,333d334
< 		doGenerateJavaClass(
341a344,344
> 		internalGenerateJavaClass(
342,342d343
< 		doGenerateJavaClass(
350a353,353
> 		internalGenerateJavaClass(
351,351d352
< 		doGenerateJavaClass(
359a362,362
> 		internalGenerateJavaClass(
360,360d361
< 		doGenerateJavaClass(
368a371,371
> 		internalGenerateJavaClass(
369,369d370
< 		doGenerateJavaClass(
379a382,382
> 		internalGenerateJavaClass(
380,380d381
< 		doGenerateJavaClass(
388a391,391
> 		internalGenerateJavaClass(
389,389d390
< 		doGenerateJavaClass(
397a400,400
> 		internalGenerateJavaClass(
398,398d399
< 		doGenerateJavaClass(
406a409,409
> 		internalGenerateJavaClass(
407,407d408
< 		doGenerateJavaClass(
415a418,418
> 		internalGenerateJavaClass(
416,416d417
< 		doGenerateJavaClass(
424a427,427
> 		internalGenerateJavaClass(
425,425d426
< 		doGenerateJavaClass(
433a436,436
> 		internalGenerateJavaClass(
434,434d435
< 		doGenerateJavaClass(
442a445,445
> 		internalGenerateJavaClass(
443,443d444
< 		doGenerateJavaClass(
451a454,454
> 		internalGenerateJavaClass(
452,452d453
< 		doGenerateJavaClass(
460a463,463
> 		internalGenerateJavaClass(
461,461d462
< 		doGenerateJavaClass(
469a472,472
> 		internalGenerateJavaClass(
470,470d471
< 		doGenerateJavaClass(
480a483,483
> 		internalGenerateJavaClass(
481,481d482
< 		doGenerateJavaClass(
489a492,492
> 		internalGenerateJavaClass(
490,490d491
< 		doGenerateJavaClass(
498a501,501
> 		internalGenerateJavaClass(
499,499d500
< 		doGenerateJavaClass(
507a510,510
> 		internalGenerateJavaClass(
508,508d509
< 		doGenerateJavaClass(
516a519,519
> 		internalGenerateJavaClass(
517,517d518
< 		doGenerateJavaClass(
525a528,528
> 		internalGenerateJavaClass(
526,526d527
< 		doGenerateJavaClass(
534a537,537
> 		internalGenerateJavaClass(
535,535d536
< 		doGenerateJavaClass(
543a546,546
> 		internalGenerateJavaClass(
544,544d545
< 		doGenerateJavaClass(
551a554,554
> 		internalGenerateJavaClass(
552,552d553
< 		doGenerateJavaClass(
559a562,562
> 		internalGenerateJavaClass(
560,560d561
< 		doGenerateJavaClass(
567a570,570
> 		internalGenerateJavaClass(
568,568d569
< 		doGenerateJavaClass(
575a578,578
> 		internalGenerateJavaClass(
576,576d577
< 		doGenerateJavaClass(
583a586,586
> 		internalGenerateJavaClass(
584,584d585
< 		doGenerateJavaClass(
591a594,594
> 		internalGenerateJavaClass(
592,592d593
< 		doGenerateJavaClass(
599a602,602
> 		internalGenerateJavaClass(
600,600d601
< 		doGenerateJavaClass(
607a610,610
> 		internalGenerateJavaClass(
608,608d609
< 		doGenerateJavaClass(
617a620,620
> 		internalGenerateJavaClass(
618,618d619
< 		doGenerateJavaClass(
626a629,629
> 		internalGenerateJavaClass(
627,627d628
< 		doGenerateJavaClass(
635a638,638
> 		internalGenerateJavaClass(
636,636d637
< 		doGenerateJavaClass(
644a647,647
> 		internalGenerateJavaClass(
645,645d646
< 		doGenerateJavaClass(
655a658,658
> 		internalGenerateJavaClass(
656,656d657
< 		doGenerateJavaClass(
663a666,666
> 		internalGenerateJavaClass(
664,664d665
< 		doGenerateJavaClass(
674a677,677
> 		internalGenerateJavaClass(
675,675d676
< 		doGenerateJavaClass(
683a686,686
> 		internalGenerateJavaClass(
684,684d685
< 		doGenerateJavaClass(
692a695,695
> 		internalGenerateJavaClass(
693,693d694
< 		doGenerateJavaClass(
701a704,704
> 		internalGenerateJavaClass(
702,702d703
< 		doGenerateJavaClass(
710a713,713
> 		internalGenerateJavaClass(
711,711d712
< 		doGenerateJavaClass(
719a722,722
> 		internalGenerateJavaClass(
720,720d721
< 		doGenerateJavaClass(
729a732,732
> 		internalGenerateJavaClass(
730,730d731
< 		doGenerateJavaClass(
741a744,744
> 		internalGenerateJavaClass(
742,742d743
< 		doGenerateJavaClass(
750a753,753
> 		internalGenerateJavaClass(
751,751d752
< 		doGenerateJavaClass(
762a765,765
> 		internalGenerateJavaClass(
763,763d764
< 		doGenerateJavaClass(
771a774,774
> 		internalGenerateJavaClass(
772,772d773
< 		doGenerateJavaClass(
781a784,784
> 		internalGenerateJavaClass(
782,782d783
< 		doGenerateJavaClass(
790a793,793
> 		internalGenerateJavaClass(
791,791d792
< 		doGenerateJavaClass(
799a802,802
> 		internalGenerateJavaClass(
800,800d801
< 		doGenerateJavaClass(
808a811,811
> 		internalGenerateJavaClass(
809,809d810
< 		doGenerateJavaClass(
820a823,823
> 		internalGenerateJavaClass(
821,821d822
< 		doGenerateJavaClass(
838a841,841
> 					internalGenerateJavaClass(
839,839d840
< 					doGenerateJavaClass(
851,851c853,853
< 		doGenerateFile(myEmitters.getPluginXmlEmitter(), new Path("plugin.xml"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getPluginXmlEmitter(), new Path("plugin.xml"), new Object[] { myDiagram.getEditorGen().getPlugin() });
855,855c857,857
< 		doGenerateFile(myEmitters.getPluginPropertiesEmitter(), new Path("plugin.properties"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getPluginPropertiesEmitter(), new Path("plugin.properties"), new Object[] { myDiagram.getEditorGen().getPlugin() });
859,859c861,861
< 		doGenerateFile(myEmitters.getOptionsFileEmitter(), new Path(".options"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getOptionsFileEmitter(), new Path(".options"), new Object[] { myDiagram.getEditorGen().getPlugin()  });
863,863c865,865
< 		doGenerateFile(myEmitters.getBundleManifestEmitter(), new Path("META-INF/MANIFEST.MF"), myDiagram.getEditorGen().getPlugin());
---
> 		doGenerateFile(myEmitters.getBundleManifestEmitter(), new Path("META-INF/MANIFEST.MF"), new Object[] { myDiagram.getEditorGen().getPlugin() });
867,867c869,869
< 		doGenerateFile(myEmitters.getBuildPropertiesEmitter(), new Path("build.properties"), myDiagram);
---
> 		doGenerateFile(myEmitters.getBuildPropertiesEmitter(), new Path("build.properties"), new Object[] { myDiagram });
874,874c876,876
< 			pm.beginTask(iconPath.lastSegment(), 3);
---
> 			pm.beginTask(iconPath.lastSegment(), 4);
878,878c880,880
< 			byte[] contents = myEmitters.getShortcutImageEmitter().generateGif();
---
> 			byte[] contents = myEmitters.getShortcutImageEmitter().generate(new SubProgressMonitor(pm, 1), null);
888a891,891
> 		} catch (InvocationTargetException ex) {
889,889d890
< 		} catch (JETException ex) {
890,890c892,892
< 			handleException(ex.getStatus());
---
> 			handleException(ex.getCause());
897a900,907
> 	/**
> 	 * Passes initialized ImportManager as second template argument
> 	 */
> 	private void internalGenerateJavaClass(JETEmitter emitter, String packageName, String className, Object argument) throws InterruptedException {
> 		ImportUtil importUtil = new ImportUtil(packageName, className);
> 		doGenerateJavaClass(new JETEmitterAdapter(emitter), packageName, className, new Object[] {new Object[] {argument, importUtil}});
> 	}
> 
