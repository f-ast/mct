2,2c2,2
<  * Copyright (c) 2004, 2005 IBM Corporation and others.
---
>  * Copyright (c) 2004, 2006 IBM Corporation and others.
14,14c15,15
< import java.io.FileInputStream;
---
> import java.io.InputStream;
15,15d15
< import java.io.FileNotFoundException;
23a23,23
> import org.eclipse.core.runtime.Path;
24a156,158
> 				}
> 				
> 			}
25,25c159,159
< 
---
> 
28a28,28
> import org.osgi.framework.Bundle;
123,123c122,122
< 			URL installURL = Platform.getBundle(
---
> 			Bundle bundle = Platform.getBundle(
124a124,124
> 			
124,124c123,123
< 				element.getDeclaringExtension().getNamespace()).getEntry("/");//$NON-NLS-1$
---
> 					element.getDeclaringExtension().getNamespace());
125,125c125,125
< 			URL resolveURL = null;
---
> 			assert bundle != null;
125a126,136
> 			
> 			URL url = Platform.find(bundle, new Path(relativePath));
> 			
> 			if (url == null) {
> 				Log.error(CommonCorePlugin.getDefault(),
> 					CommonCoreStatusCodes.SERVICE_FAILURE,
> 					"Couldn't find relative path " + relativePath + " in " //$NON-NLS-1$ //$NON-NLS-2$
> 						+ element.getDeclaringExtension().getNamespace());
> 			}
> 			
> 			InputStream is = null;
127,130d138
< 				resolveURL = Platform.resolve(installURL);
< 			} catch (IOException e1) {
< 				// shouldn't happen
< 				assert (false);
131a147,147
> 			finally {
132,132d146
< 			String fullPath = resolveURL.getFile() + relativePath;
133a139,139
> 				is = url.openStream();
133a149,149
> 				if (is != null) {
134,134d138
< 			// load the properties file
135,135c140,140
< 			Properties properties = new Properties();
---
> 				Properties properties = new Properties();
135a141,145
> 				properties.load(is);
> 				propertiesMap.putAll(properties);
> 				
> 			} catch (IOException e) {
> 				handleException(e);
136a151,151
> 						is.close();
137,141d150
< 				FileInputStream stream = new FileInputStream(fullPath);
< 				properties.load(stream);
< 			} catch (FileNotFoundException e) {
< 				handleException(e);
< 				continue;
144,144d153
< 				continue;
147,148d155
< 			// add the properties map
< 			propertiesMap.putAll(properties);
