17,17d17
< import org.eclipse.core.resources.ResourcesPlugin;
18,18c18,18
< import org.eclipse.core.runtime.Path;
---
> import org.eclipse.emf.transaction.RunnableWithResult;
18a19,21
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
> import org.eclipse.emf.transaction.util.TransactionUtil;
> import org.eclipse.emf.workspace.util.WorkspaceSynchronizer;
20,20c27,27
< import org.eclipse.jface.resource.ImageDescriptor;
---
> import org.eclipse.jface.resource.ImageDescriptor;
21,21c28,28
< import org.eclipse.jface.util.Assert;
---
> import org.eclipse.jface.util.Assert;
22,22c29,29
< import org.eclipse.ui.IPersistableElement;
---
> import org.eclipse.ui.IPersistableElement;
23,23d29
< 
25,25d22
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
28,29d24
< import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
30,30c25,25
< import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
---
> import org.eclipse.gmf.runtime.emf.core.util.EMFCoreUtil;
81,81d78
< 		final String[] name = new String[1];
82a80,84
> 			return (String) TransactionUtil.getEditingDomain(getDiagram())
> 				.runExclusive(new RunnableWithResult.Impl() {
> 
> 					public void run() {
> 						setResult(EMFCoreUtil.getQualifiedName(getDiagram(), false));
83,86d79
< 			MEditingDomainGetter.getMEditingDomain(getDiagram()).runAsRead(new MRunnable() {
< 				public Object run() {
< 					name[0] = EObjectUtil.getQName(getDiagram(), false);
< 					return null;
95a94,94
> 			return null;
96,96d93
< 			name[0] = null;
98,98d95
< 		return name[0];
106,106d102
< 		final String[] name = new String[1];
107a104,108
> 			return (String) TransactionUtil.getEditingDomain(getDiagram())
> 				.runExclusive(new RunnableWithResult.Impl() {
> 
> 					public void run() {
> 						setResult(EMFCoreUtil.getName(getDiagram()));
108,111d103
< 			MEditingDomainGetter.getMEditingDomain(getDiagram()).runAsRead(new MRunnable() {
< 				public Object run() {
< 					name[0] = EObjectUtil.getName(getDiagram()); //((IElement) getDiagram()).getFullyQualifiedName(false);
< 					return null;
120a118,118
> 			return null;
121,121d117
< 			name[0] = null;
123,123d119
< 		return name[0];
190,190d185
< 		final IFile[] file = new IFile[1];
191a187,188
> 			final TransactionalEditingDomain editingDomain = TransactionUtil.getEditingDomain(getDiagram());
> 			return (IFile) editingDomain.runExclusive(new RunnableWithResult.Impl() {
192,193d186
< 			final MEditingDomain editingDomain = MEditingDomainGetter.getMEditingDomain(getDiagram());
< 			editingDomain.runAsRead(new MRunnable() {
195,195c190,190
< 				public Object run() {
---
> 				public void run() {
196a192,194
> 						setResult(model != null ? WorkspaceSynchronizer
> 							.getFile(model)
> 							: null);
197,204d191
< 					String path = editingDomain.getResourceFileName(model);
< 					file[0] = model != null && path != null
< 						&& path.length() != 0 ? ResourcesPlugin.getWorkspace()
< 						.getRoot().getFileForLocation(
< 							new Path(path))
< 						: null;
< 
< 					return null;
210a201,201
> 			return null;
211,211d200
< 			file[0] = null;
213,213d202
< 		return file[0];
