16a17,17
> import org.eclipse.gmf.runtime.diagram.core.preferences.PreferencesHint;
18,18c19,19
< import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramRootEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IDiagramPreferenceSupport;
56a58,77
>         return createDiagramEditPart(diagram, new Shell(), null);
> 	}
>     
>     /**
>      * Creates a <code>DiagramEditPart</code> given the <code>Diagram</code>
>      * without opening an editor.
>      * 
>      * @param diagram
>      *            the <code>Diagram</code>
>      * @param shell
>      *            the shell
>      * @param preferencesHint
>      *            the preferences hint to be used when creating the diagram; if
>      *            null, the preferences hint from the root editpart will be
>      *            used.
>      * @return the new populated <code>DiagramEditPart</code>
>      */
>      public DiagramEditPart createDiagramEditPart(
>         Diagram diagram, Shell shell, PreferencesHint preferencesHint) {     
>         
57,57d57
< 		Shell shell = new Shell();
68,68c88,88
< 		RootEditPart rep = EditPartService.getInstance()
---
>         RootEditPart rootEP = EditPartService.getInstance().createRootEditPart(
68a89,98
>             diagram);
>         if (rootEP instanceof IDiagramPreferenceSupport) {
>             if (preferencesHint == null) {
>                 preferencesHint = ((IDiagramPreferenceSupport) rootEP)
>                     .getPreferencesHint();
>             } else {
>                 ((IDiagramPreferenceSupport) rootEP)
>                     .setPreferencesHint(preferencesHint);
>             }
>             customViewer
69,73d88
< 		.createRootEditPart(diagram);
< 		if (rep instanceof DiagramRootEditPart) {
< 			DiagramRootEditPart drep = (DiagramRootEditPart)rep;
< 			IPreferenceStore fPreferences = (IPreferenceStore) drep.getPreferencesHint().getPreferenceStore();
< 
74a100,100
>                     .getPreferenceStore());
74,74c99,99
< 			customViewer.hookWorkspacePreferenceStore(fPreferences);
---
>                 .hookWorkspacePreferenceStore((IPreferenceStore) preferencesHint
77,77c103,103
< 		customViewer.setRootEditPart(rep);
---
>         customViewer.setRootEditPart(rootEP);
85a115,115
> 
86,86d114
< 		
90a117,117
> 
