14,14d13
< import java.lang.ref.SoftReference;
19,19d17
< import java.util.Map;
24,24d21
< import org.eclipse.emf.common.util.URI;
65,65c62,62
< 	private CodegenEmitters myEmitters;
---
> 	private final CodegenEmitters myEmitters;
66a64,65
> 	public Generator(GenEditorGenerator genModel, CodegenEmitters emitters) {
> 		assert genModel != null && emitters != null;
67,69d63
< 	private static Map/*<URI, SoftReference>*/ myCachedURI2EmitterMap = new HashMap();
< 
< 	public Generator(GenEditorGenerator genModel) {
71a68,68
> 		myEmitters = emitters;
72,84d67
< 		URI resourceURI = myEditorGen.eResource().getURI();
< 		if (myEditorGen.isDynamicTemplates()) {
< 			myCachedURI2EmitterMap.remove(resourceURI);
< 		}
< 		CodegenEmitters old = myCachedURI2EmitterMap.containsKey(resourceURI) ? (CodegenEmitters) ((SoftReference) myCachedURI2EmitterMap.get(resourceURI)).get() : null;
< 		if (old == null) {
< 			myEmitters = new CodegenEmitters(!myEditorGen.isDynamicTemplates(), myEditorGen.getTemplateDirectory());
< 			if (!myEditorGen.isDynamicTemplates()) {
< 				myCachedURI2EmitterMap.put(resourceURI, new SoftReference(myEmitters));
< 			}
< 		} else {
< 			myEmitters = old;
< 		}
964,964c948,948
< 		private final HashMap/*<EClass, Integer>*/ myCounters = new HashMap();
---
> 		private final HashMap<EClass, Integer> myCounters = new HashMap<EClass, Integer>();
965,965c949,949
< 		private final HashMap/*<EClass, Integer>*/ myCache = new HashMap();
---
> 		private final HashMap<EClass, Integer> myCache = new HashMap<EClass, Integer>();
982a967,967
> 		@SuppressWarnings("unchecked")
989,989c974,974
< 			LinkedList/*<EClass>*/ checkQueue = new LinkedList();
---
> 			LinkedList<EClass> checkQueue = new LinkedList<EClass>();
992,992c977,977
< 				Object key = checkQueue.removeFirst();
---
> 				EClass key = checkQueue.removeFirst();
994,994c979,979
< 					final Integer value = (Integer) myCounters.get(key);
---
> 					final Integer value = myCounters.get(key);
999,999c984,984
< 					checkQueue.addAll(((EClass) key).getESuperTypes());
---
> 					checkQueue.addAll(key.getESuperTypes());
1007,1007c992,992
< 			return (Integer) myCache.get(nextKey);
---
> 			return myCache.get(nextKey);
