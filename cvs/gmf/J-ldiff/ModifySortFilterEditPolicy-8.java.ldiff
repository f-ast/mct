15a16,16
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
20a22,22
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
26,26c28,28
< import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeModelCommand;
---
> import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeTransactionalCommand;
50a53,56
>             TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost()).getEditingDomain();
> 			CompositeTransactionalCommand command = new CompositeTransactionalCommand(editingDomain, DiagramUIMessages.Command_SortFilterCommand);
>             SetPropertyCommand filteringCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_FILTERING, Properties.ID_FILTERING, req.getFiltering());
> 			SetPropertyCommand filterKeyCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_FILTERING_KEYS, Properties.ID_FILTERING_KEYS, req.getFilterKeys());
51,53d52
< 			CompositeModelCommand command = new CompositeModelCommand(DiagramUIMessages.Command_SortFilterCommand);
< 			SetPropertyCommand filteringCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_FILTERING, Properties.ID_FILTERING, req.getFiltering());
< 			SetPropertyCommand filterKeyCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_FILTERING_KEYS, Properties.ID_FILTERING_KEYS, req.getFilterKeys());
54,54c57,57
< 			SetPropertyCommand filteredObjectsCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_FILTERED_OBJECTS, Properties.ID_FILTERED_OBJECTS, req.getFilteredObjects());
---
> 			SetPropertyCommand filteredObjectsCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_FILTERED_OBJECTS, Properties.ID_FILTERED_OBJECTS, req.getFilteredObjects());
59a63,63
> 			SetPropertyCommand sortingCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_SORTING, Properties.ID_SORTING, req.getSorting());
60,60d62
< 			SetPropertyCommand sortingCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_SORTING, Properties.ID_SORTING, req.getSorting());
61,61c64,64
< 			SetPropertyCommand sortingKeysCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_SORTING_KEYS, Properties.ID_SORTING_KEYS, req.getSortKeys() == null ? Collections.EMPTY_MAP : req.getSortKeys());
---
> 			SetPropertyCommand sortingKeysCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_SORTING_KEYS, Properties.ID_SORTING_KEYS, req.getSortKeys() == null ? Collections.EMPTY_MAP : req.getSortKeys());
62,62c65,65
< 			SetPropertyCommand sortedObjectsCommand = new SetPropertyCommand(new EObjectAdapter(view), Properties.ID_SORTED_OBJECTS, Properties.ID_SORTED_OBJECTS, req.getSortedObjects());
---
> 			SetPropertyCommand sortedObjectsCommand = new SetPropertyCommand(editingDomain, new EObjectAdapter(view), Properties.ID_SORTED_OBJECTS, Properties.ID_SORTED_OBJECTS, req.getSortedObjects());
68,68c71,71
< 			return new EtoolsProxyCommand(command.unwrap());
---
> 			return new EtoolsProxyCommand(command.reduce());
