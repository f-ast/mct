10a11,12
> import org.eclipse.draw2d.RectangleFigure;
> 
12a15,16
> import org.eclipse.draw2d.XYLayout;
> 
20a25,26
> import org.eclipse.emf.ecore.EObject;
> 
27c33
< import org.eclipse.gmf.gmfgraph.Shape;
---
> import org.eclipse.gmf.graphdef.editor.edit.policies.PolylineCanonicalEditPolicy;
31c37
< import org.eclipse.gmf.graphdef.editor.edit.polocies.DomainBasedXYLayoutEditPolicy;
---
> import org.eclipse.gmf.graphdef.editor.edit.polocies.PointContainerXYLayoutEditPolicy;
38a45,48
> import org.eclipse.gmf.runtime.diagram.ui.editpolicies.CreationEditPolicy;
> 
> import org.eclipse.gmf.runtime.diagram.ui.editpolicies.DragDropEditPolicy;
> 
42a53,54
> import org.eclipse.gmf.runtime.draw2d.ui.figures.ConstrainedToolbarLayout;
> 
60a73
>         installEditPolicy (EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy ());
62a76,77
>         installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy ());
>         installEditPolicy (EditPolicyRoles.CANONICAL_ROLE, new PolylineCanonicalEditPolicy ());
67c82
<         return new DomainBasedXYLayoutEditPolicy (getMapMode ());
---
>         return new PointContainerXYLayoutEditPolicy (getMapMode ());
83a99,104
>     public EditPolicy getPrimaryDragEditPolicy () {
>         NonResizableEditPolicyEx editPolicy = new NonResizableEditPolicyEx ();
>         editPolicy.setDragAllowed (false);
>         return editPolicy;
>     }
> 
89c110,115
<         contentPane = setupContentPane (shape);
---
>         RectangleFigure childContainer = new RectangleFigure ();
>         childContainer.setFill (false);
>         childContainer.setOutline (false);
>         figure.add (childContainer);
>         childContainer.setLayoutManager (new XYLayout ());
>         contentPane = childContainer;
93a120,124
>         if (nodeShape.getLayoutManager () == null) {
>             ConstrainedToolbarLayout layout = new ConstrainedToolbarLayout ();
>             layout.setSpacing (getMapMode ().DPtoLP (5));
>             nodeShape.setLayoutManager (layout);
>         }
119,122c150,157
<     private org.eclipse.gmf.gmfgraph.Polyline getModelFigureElement () {
<         Shape shape = getShape ();
<         if (shape instanceof org.eclipse.gmf.gmfgraph.Polyline) {
<             org.eclipse.gmf.gmfgraph.Polyline modelFigureElement = (org.eclipse.gmf.gmfgraph.Polyline) shape;
---
>     private org.eclipse.gmf.gmfgraph.Polyline getGmfgraphElement () {
>         View view = getNotationView ();
>         if (view == null) {
>             return null;
>         }
>         EObject element = view.getElement ();
>         if (element instanceof org.eclipse.gmf.gmfgraph.Polyline) {
>             org.eclipse.gmf.gmfgraph.Polyline modelFigureElement = (org.eclipse.gmf.gmfgraph.Polyline) element;
129c164
<         org.eclipse.gmf.gmfgraph.Polyline modelElement = (org.eclipse.gmf.gmfgraph.Polyline) getModelFigureElement ();
---
>         org.eclipse.gmf.gmfgraph.Polyline modelElement = getGmfgraphElement ();
139c174
<         org.eclipse.gmf.gmfgraph.Polyline modelElement = (org.eclipse.gmf.gmfgraph.Polyline) getModelFigureElement ();
---
>         org.eclipse.gmf.gmfgraph.Polyline modelElement = getGmfgraphElement ();
164c199
<         final org.eclipse.gmf.gmfgraph.Polyline modelElement = (org.eclipse.gmf.gmfgraph.Polyline) getModelFigureElement ();
---
>         final org.eclipse.gmf.gmfgraph.Polyline modelElement = getGmfgraphElement ();
311c346
<         org.eclipse.gmf.gmfgraph.Polyline modelElement = (org.eclipse.gmf.gmfgraph.Polyline) getModelFigureElement ();
---
>         org.eclipse.gmf.gmfgraph.Polyline modelElement = getGmfgraphElement ();
329,334d363
<     public EditPolicy getPrimaryDragEditPolicy () {
<         NonResizableEditPolicyEx editPolicy = new NonResizableEditPolicyEx ();
<         editPolicy.setDragAllowed (false);
<         return editPolicy;
<     }
< 
346c375,378
<             return getPrimaryShape ().getBounds ();
---
>             Rectangle polylineBounds = getPrimaryShape ().getBounds ().getCopy ();
>             Rectangle contentPaneBounds = getContentPane ().getBounds ().getCopy ();
>             contentPaneBounds.setSize (getContentPane ().getPreferredSize ());
>             return polylineBounds.getUnion (contentPaneBounds);
