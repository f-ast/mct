41,42d40
< import org.eclipse.gef.commands.UnexecutableCommand;
< 
44a43,44
> import org.eclipse.gef.commands.UnexecutableCommand;
> 
95,96d94
< import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.IEditableEditPart;
< 
98a97,98
> import org.eclipse.gmf.runtime.diagram.ui.internal.editparts.IEditableEditPart;
> 
113,114d112
< import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramWorkbenchPart;
< 
147,150d144
< import org.eclipse.ui.IWorkbenchPart;
< 
< import org.eclipse.ui.PlatformUI;
< 
288,293c282,285
<         IWorkbenchPart activePart = PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getActivePage ().getActivePart ();
<         if (activePart != null) {
<             IDiagramWorkbenchPart editor = (IDiagramWorkbenchPart) activePart;
<             if (editor != null) {
<                 DiagramGraphicalViewer viewer = (DiagramGraphicalViewer) editor.getDiagramGraphicalViewer ();
<                 IPreferenceStore preferenceStore = viewer.getWorkspaceViewerPreferenceStore ();
---
>         IGraphicalEditPart firstEditPart = (IGraphicalEditPart) editparts.get (0);
>         if (firstEditPart.getViewer () instanceof DiagramGraphicalViewer) {
>             IPreferenceStore preferenceStore = ((DiagramGraphicalViewer) firstEditPart.getViewer ()).getWorkspaceViewerPreferenceStore ();
>             if (preferenceStore != null) {
