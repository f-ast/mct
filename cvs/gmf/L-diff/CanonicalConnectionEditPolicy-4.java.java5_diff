109,111c109,110
<     protected final EditPart getEditPartFor (Object element) {
<         if (element instanceof EObject && ! (element instanceof View)) {
<             EObject eObject = (EObject) element;
---
>     private EditPart getEditPartFor (EObject element, EObject context) {
>         if (! (element instanceof View)) {
114c113
<                 List parts = ((IDiagramGraphicalViewer) viewer).findEditPartsForElement (EObjectUtil.getID (eObject), ShapeNodeEditPart.class);
---
>                 List parts = ((IDiagramGraphicalViewer) viewer).findEditPartsForElement (EObjectUtil.getID (element), ShapeNodeEditPart.class);
116,117c115,116
<                     EObject container = ((EObject) element).eContainer ();
<                     EditPart containerEP = getEditPartFor (container);
---
>                     EObject container = element.eContainer ();
>                     EditPart containerEP = getEditPartFor (container, null);
120c119
<                         parts = ((IDiagramGraphicalViewer) viewer).findEditPartsForElement (EObjectUtil.getID (eObject), ShapeNodeEditPart.class);
---
>                         parts = ((IDiagramGraphicalViewer) viewer).findEditPartsForElement (EObjectUtil.getID (element), ShapeNodeEditPart.class);
123c122
<                 return findEditPartForElement (element, parts);
---
>                 return findEditPartForElement (element, context, parts);
129c128
<     protected EditPart findEditPartForElement (Object element, List parts) {
---
>     protected EditPart findEditPartForElement (EObject element, EObject context, List parts) {
205c204
<         tep = getEditPartFor (tel);
---
>         tep = getEditPartFor (tel, connector);
213c212
<         sep = getEditPartFor (sel);
---
>         sep = getEditPartFor (sel, connector);
268c267
<             EditPart sourceEP = getEditPartFor (edge.getSource ());
---
>             EditPart sourceEP = getEditPartFor (edge.getSource (), edge);
272c271
<             EditPart targetEP = getEditPartFor (edge.getTarget ());
---
>             EditPart targetEP = getEditPartFor (edge.getTarget (), edge);
