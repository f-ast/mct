20a21,22
> import org.eclipse.emf.ecore.resource.Resource;
> 
140,141c142,143
<     protected EObject getSuitableParentUsingAncestry (String preferredTypeName) {
<         EObject suitableParent = getSuitableParentUsingAncestry (getParentEObject (), preferredTypeName, true);
---
>     protected PasteTarget getSuitableParentUsingAncestry (String preferredTypeName) {
>         PasteTarget suitableParent = getSuitableParentUsingAncestry (getParentTarget (), preferredTypeName, true);
143c145
<             suitableParent = getSuitableParentUsingAncestry (getParentEObject (), preferredTypeName, false);
---
>             suitableParent = getSuitableParentUsingAncestry (getParentTarget (), preferredTypeName, false);
148,149c150,153
<     private EObject getSuitableParentUsingAncestry (EObject potentialParentObject, String preferredTypeName, boolean strictMatch) {
<         EObject suitableParent = checkPotentialParent (potentialParentObject, preferredTypeName, strictMatch);
---
>     private PasteTarget getSuitableParentUsingAncestry (PasteTarget potentialParent, String preferredTypeName, boolean strictMatch) {
>         PasteTarget suitableParent = checkPotentialParent (potentialParent, preferredTypeName, strictMatch);
>         if (suitableParent == null && ! potentialParent.isResource ()) {
>             EObject potentialParentObject = (EObject) potentialParent.getObject ();
152c156,157
<             suitableParent = checkPotentialParent (potentialParentObject, preferredTypeName, strictMatch);
---
>                 suitableParent = checkPotentialParent (new PasteTarget (potentialParentObject), preferredTypeName, strictMatch);
>             }
170c175
<                         if (ClipboardSupportUtil.isChild (getParentEObject (), mergeTarget)) {
---
>                         if ((getParentTarget ().isResource () && getParentTarget ().getObject () == mergeTarget.eResource ()) || ClipboardSupportUtil.isChild (getParentEObject (), mergeTarget)) {
256c261
<             EObject possibleParent = getSuitableParentUsingAncestry (getLoadedDirectContainerEObject ().eClass ().getInstanceClassName ());
---
>             PasteTarget possibleParent = getSuitableParentUsingAncestry (getLoadedDirectContainerEObject ().eClass ().getInstanceClassName ());
272a278,281
>     public PasteTarget getParentTarget () {
>         return getParentPasteProcess ().getPasteTarget ();
>     }
> 
309c318
<             element = doPasteInto (getParentEObject ());
---
>             element = doPasteInto (getParentTarget ());
312c321
<                     EObject possibleParent = getSuitableParentUsingAncestry (getChildObjectInfo ().containerClass);
---
>                     PasteTarget possibleParent = getSuitableParentUsingAncestry (getChildObjectInfo ().containerClass);
336a346,356
>     protected EObject doPasteInto (PasteTarget pasteTarget) {
>         if (pasteTarget != null) {
>             if (pasteTarget.isResource ()) {
>                 return doPasteInto ((Resource) pasteTarget.getObject ());
>             } else {
>                 return doPasteInto ((EObject) pasteTarget.getObject ());
>             }
>         }
>         return null;
>     }
> 
357a378,388
>     protected EObject doPasteInto (Resource pasteIntoResource) {
>         EObject childElement = null;
>         if (handleCollision (null, pasteIntoResource.getContents (), getEObject (), getChildObjectInfo ())) {
>             childElement = ClipboardSupportUtil.appendEObject (pasteIntoResource, getEObject ());
>         } else if (getPastedElement () != null) {
>             childElement = getPastedElement ();
>         }
> 
>         return childElement;
>     }
> 
385,386c416,423
<     private EObject checkPotentialParent (EObject potentialParentObject, String preferredTypeName, boolean strictMatch) {
<         if ((potentialParentObject instanceof EAnnotation) == false) {
---
>     private PasteTarget checkPotentialParent (PasteTarget potentialParent, String preferredTypeName, boolean strictMatch) {
>         if ((potentialParent.getObject () instanceof EAnnotation) == false) {
>             if (potentialParent.isResource ()) {
>                 if (preferredTypeName == null || strictMatch == false) {
>                     return potentialParent;
>                 }
>             } else {
>                 EObject potentialParentObject = (EObject) potentialParent.getObject ();
388c425
<                 return potentialParentObject;
---
>                     return potentialParent;
390c427
<                 return potentialParentObject;
---
>                     return potentialParent;
393a431
>         }
418a457,459
>                         if (reference == null) {
>                             ClipboardSupportUtil.destroyEObjectInResource (object);
>                         } else {
419a461
>                         }
567a610
>         if (! getParentTarget ().isResource ()) {
573a617
>         }
