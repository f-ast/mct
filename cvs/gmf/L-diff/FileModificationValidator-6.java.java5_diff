3,4d2
< import java.text.MessageFormat;
< 
20a19,20
> import org.eclipse.osgi.util.NLS;
> 
22a23,24
> import org.eclipse.swt.widgets.Shell;
> 
39,43c41,45
<         final boolean result [] = new boolean [] {false};
<         PlatformUI.getWorkbench ().getDisplay ().syncExec (new Runnable () {
< 
<             public void run () {
<                 IStatus status = ResourcesPlugin.getWorkspace ().validateEdit (files, PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getShell ());
---
>         Shell shell = null;
>         if (PlatformUI.getWorkbench ().getActiveWorkbenchWindow () != null && Display.getCurrent () != null) {
>             shell = PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getShell ();
>         }
>         final IStatus status = ResourcesPlugin.getWorkspace ().validateEdit (files, shell);
45c47
<                     result [0] = true;
---
>             return true;
47,49c49,52
<                     MessageDialog.openError (PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getShell (), MessageFormat.format (CommonUIMessages.FileModificationValidator_EditProblemDialogTitle, new Object [] {modificationReason}), MessageFormat.format (CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part1, new Object [] {modificationReason}) + "\n\n" + CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part2 + "\n" + MessageFormat.format (CommonUIMessages.FileModificationValidator_EditProblemDialogMessage_part3, new Object [] {status.getMessage ()}));
<                     result [0] = false;
<                 }
---
>             PlatformUI.getWorkbench ().getDisplay ().asyncExec (new Runnable () {
> 
>                 public void run () {
>                     MessageDialog.openError (PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getShell (), NLS.bind (CommonUIMessages.FileModificationValidator_EditProblemDialogTitle, modificationReason), NLS.bind (CommonUIMessages.FileModificationValidator_EditProblemDialogMessage, modificationReason, status.getMessage ()));
55c58,59
<         return result [0];
---
>             return false;
>         }
73c77
<             MessageDialog.openError (Display.getCurrent ().getActiveShell (), CommonUIMessages.FileModificationValidator_SaveProblemDialogTitle, CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part1 + "\n\n" + CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part2 + "\n" + MessageFormat.format (CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage_part3, new Object [] {status.getMessage ()}));
---
>             MessageDialog.openError (PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getShell (), CommonUIMessages.FileModificationValidator_SaveProblemDialogTitle, NLS.bind (CommonUIMessages.FileModificationValidator_SaveProblemDialogMessage, status.getMessage ()));
80c84
<             String message = MessageFormat.format (CommonUIMessages.FileModificationValidator_FileIsReadOnlyErrorMessage, new Object [] {file.getFullPath ().toString ()});
---
>             String message = NLS.bind (CommonUIMessages.FileModificationValidator_FileIsReadOnlyErrorMessage, file.getFullPath ().toString ());
