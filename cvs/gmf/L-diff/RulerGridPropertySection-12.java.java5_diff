32a33,34
> import org.eclipse.jface.resource.CompositeImageDescriptor;
> 
52a55,60
> import org.eclipse.swt.graphics.Image;
> 
> import org.eclipse.swt.graphics.ImageData;
> 
> import org.eclipse.swt.graphics.PaletteData;
> 
128a137,159
>     private static class ColorOverlayImageDescriptor extends CompositeImageDescriptor {
>         private static final Point ICON_SIZE = new Point (16, 16);
>         private ImageData basicImgData;
>         private RGB rgb;
> 
>         public ColorOverlayImageDescriptor (ImageData basicImgData, RGB rgb) {
>             this.basicImgData = basicImgData;
>             this.rgb = rgb;
>         }
> 
>         protected void drawCompositeImage (int width, int height) {
>             if (rgb != null) {
>                 ImageData colorBar = new ImageData (width, height / 5, 1, new PaletteData (new RGB [] {rgb}));
>                 drawImage (colorBar, 0, height - height / 5);
>             }
>             drawImage (basicImgData, 0, 0);
>         }
> 
>         protected Point getSize () {
>             return ICON_SIZE;
>         }
> 
>     }
221c252
<                 lineColor = changeColor (event, lineColorButton, DiagramUIPropertiesImages.DESC_LINE_COLOR);
---
>                 lineColor = changeColor (event, lineColorButton, DiagramUIPropertiesImages.DESC_LINE_COLOR, getWorkspacePropertyInt (WorkspaceViewerProperties.GRIDLINECOLOR));
252c283
<     private RGB changeColor (SelectionEvent event, Button button, ImageDescriptor imageDescriptor) {
---
>     private RGB changeColor (SelectionEvent event, Button button, ImageDescriptor imageDescriptor, int previousColor) {
253a285
>         popup.setPreviousColor (previousColor);
257a290,292
>             Image overlyedImage = new ColorOverlayImageDescriptor (imageDescriptor.getImageData (), FigureUtilities.integerToRGB (new Integer (LIGHT_GRAY_RGB))).createImage ();
>             disposeImage (button.getImage ());
>             button.setImage (overlyedImage);
259a295,299
>         if (popup.getSelectedColor () != null) {
>             Image overlyedImage = new ColorOverlayImageDescriptor (imageDescriptor.getImageData (), popup.getSelectedColor ()).createImage ();
>             disposeImage (button.getImage ());
>             button.setImage (overlyedImage);
>         }
262a303,314
>     private void disposeImage (Image image) {
>         if (image == null) {
>             return;
>         }
>         if (image.equals (DiagramUIPropertiesImages.get (DiagramUIPropertiesImages.IMG_LINE_COLOR))) {
>             return;
>         }
>         if (! image.isDisposed ()) {
>             image.dispose ();
>         }
>     }
> 
429a482,484
>         Image overlyedImage = new ColorOverlayImageDescriptor ((DiagramUIPropertiesImages.DESC_LINE_COLOR).getImageData (), FigureUtilities.integerToRGB (getWorkspacePropertyInt (WorkspaceViewerProperties.GRIDLINECOLOR))).createImage ();
>         disposeImage (lineColorButton.getImage ());
>         lineColorButton.setImage (overlyedImage);
