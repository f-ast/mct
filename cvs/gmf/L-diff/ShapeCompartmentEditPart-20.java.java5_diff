20a21,22
> import org.eclipse.draw2d.Bendpoint;
> 
40a43,44
> import org.eclipse.draw2d.geometry.PointList;
> 
145,146c149,162
<                 Point sLoc = sc.getLocation (tc.getReferencePoint ());
<                 Point tLoc = tc.getLocation (sc.getReferencePoint ());
---
>                 Point sRefPoint;
>                 Point tRefPoint;
>                 List bendpoints = (List) connection.getConnectionRouter ().getConstraint (connection);
>                 if (bendpoints.size () >= 2) {
>                     sRefPoint = ((Bendpoint) bendpoints.get (0)).getLocation ().getCopy ();
>                     connection.translateToAbsolute (sRefPoint);
>                     tRefPoint = ((Bendpoint) bendpoints.get (bendpoints.size () - 1)).getLocation ().getCopy ();
>                     connection.translateToAbsolute (tRefPoint);
>                 } else {
>                     sRefPoint = tc.getReferencePoint ();
>                     tRefPoint = sc.getReferencePoint ();
>                 }
>                 Point sLoc = sc.getLocation (sRefPoint);
>                 Point tLoc = tc.getLocation (tRefPoint);
