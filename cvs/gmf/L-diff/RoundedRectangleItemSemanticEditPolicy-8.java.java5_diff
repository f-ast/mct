3c3,5
< import org.eclipse.emf.ecore.EObject;
---
> import java.util.Iterator;
> 
> import org.eclipse.emf.ecore.EAnnotation;
9,14d10
< import org.eclipse.gef.commands.UnexecutableCommand;
< 
< import org.eclipse.gmf.gmfgraph.DiagramElement;
< 
< import org.eclipse.gmf.gmfgraph.FigureHandle;
< 
17c13,15
< import org.eclipse.gmf.graphdef.editor.edit.commands.DiagramElementFigureReorientCommand;
---
> import org.eclipse.gmf.graphdef.editor.edit.commands.ChildAccessCreateCommand;
> 
> import org.eclipse.gmf.graphdef.editor.edit.commands.ChildAccessReorientCommand;
27c25,35
< import org.eclipse.gmf.graphdef.editor.edit.parts.DiagramElementFigureEditPart;
---
> import org.eclipse.gmf.graphdef.editor.edit.parts.ChildAccessEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.EllipseEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.PolylineEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.Rectangle2EditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.RoundedRectangleEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry;
33,34d40
< import org.eclipse.gmf.runtime.emf.type.core.commands.SetValueCommand;
< 
41c47,49
< import org.eclipse.gmf.runtime.emf.type.core.requests.ReorientReferenceRelationshipRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.ReorientRelationshipRequest;
> 
> import org.eclipse.gmf.runtime.notation.Node;
43c51
< import org.eclipse.gmf.runtime.emf.type.core.requests.SetRequest;
---
> import org.eclipse.gmf.runtime.notation.View;
48c56
<         if (GMFGraphElementTypes.Rectangle_3002 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Rectangle_3011 == req.getElementType ()) {
50c58
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
52c60
<             return getMSLWrapper (new Rectangle2CreateCommand (req));
---
>             return getGEFWrapper (new Rectangle2CreateCommand (req));
54c62
<         if (GMFGraphElementTypes.Ellipse_3003 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Ellipse_3012 == req.getElementType ()) {
56c64
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
58c66
<             return getMSLWrapper (new EllipseCreateCommand (req));
---
>             return getGEFWrapper (new EllipseCreateCommand (req));
60c68
<         if (GMFGraphElementTypes.RoundedRectangle_3004 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.RoundedRectangle_3013 == req.getElementType ()) {
62c70
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
64c72
<             return getMSLWrapper (new RoundedRectangleCreateCommand (req));
---
>             return getGEFWrapper (new RoundedRectangleCreateCommand (req));
66c74
<         if (GMFGraphElementTypes.Polyline_3005 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Polyline_3014 == req.getElementType ()) {
68c76
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
70c78
<             return getMSLWrapper (new PolylineCreateCommand (req));
---
>             return getGEFWrapper (new PolylineCreateCommand (req));
76,77c84,87
<         CompoundCommand cc = getDestroyEdgesCommand (req.isConfirmationRequired ());
<         cc.add (getMSLWrapper (new DestroyElementCommand (req)));
---
>         CompoundCommand cc = getDestroyEdgesCommand ();
>         addDestroyChildNodesCommand (cc);
>         addDestroyShortcutsCommand (cc);
>         cc.add (getGEFWrapper (new DestroyElementCommand (req)));
81,83c91,113
<     protected Command getCreateRelationshipCommand (CreateRelationshipRequest req) {
<         if (GMFGraphElementTypes.DiagramElementFigure_4001 == req.getElementType ()) {
<             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElementFigure_4001Command (req);
---
>     protected void addDestroyChildNodesCommand (CompoundCommand cmd) {
>         View view = (View) getHost ().getModel ();
>         EAnnotation annotation = view.getEAnnotation ("Shortcut");
>         if (annotation != null) {
>             return;
>         }
>         for (Iterator it = view.getChildren ().iterator ();
>         it.hasNext ();) {
>             Node node = (Node) it.next ();
>             switch (GMFGraphVisualIDRegistry.getVisualID (node)) {
>                 case Rectangle2EditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case EllipseEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case RoundedRectangleEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case PolylineEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>             }
85d114
<         return super.getCreateRelationshipCommand (req);
88,92c117,119
<     protected Command getCreateCompleteIncomingDiagramElementFigure_4001Command (CreateRelationshipRequest req) {
<         EObject sourceEObject = req.getSource ();
<         EObject targetEObject = req.getTarget ();
<         if (false == sourceEObject instanceof DiagramElement || false == targetEObject instanceof FigureHandle) {
<             return UnexecutableCommand.INSTANCE;
---
>     protected Command getCreateRelationshipCommand (CreateRelationshipRequest req) {
>         Command command = req.getTarget () == null ? getStartCreateRelationshipCommand (req) : getCompleteCreateRelationshipCommand (req);
>         return command != null ? command : super.getCreateRelationshipCommand (req);
94,97c121,131
<         DiagramElement source = (DiagramElement) sourceEObject;
<         FigureHandle target = (FigureHandle) targetEObject;
<         if (! GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001 (source, target)) {
<             return UnexecutableCommand.INSTANCE;
---
> 
>     protected Command getStartCreateRelationshipCommand (CreateRelationshipRequest req) {
>         if (GMFGraphElementTypes.ChildAccess_4002 == req.getElementType ()) {
>             return null;
>         }
>         return null;
>     }
> 
>     protected Command getCompleteCreateRelationshipCommand (CreateRelationshipRequest req) {
>         if (GMFGraphElementTypes.ChildAccess_4002 == req.getElementType ()) {
>             return getGEFWrapper (new ChildAccessCreateCommand (req, req.getSource (), req.getTarget ()));
99,100c133
<         SetRequest setReq = new SetRequest (sourceEObject, GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), target);
<         return getMSLWrapper (new SetValueCommand (setReq));
---
>         return null;
103c136
<     protected Command getReorientReferenceRelationshipCommand (ReorientReferenceRelationshipRequest req) {
---
>     protected Command getReorientRelationshipCommand (ReorientRelationshipRequest req) {
105,106c138,139
<             case DiagramElementFigureEditPart.VISUAL_ID :
<                 return getMSLWrapper (new DiagramElementFigureReorientCommand (req));
---
>             case ChildAccessEditPart.VISUAL_ID :
>                 return getGEFWrapper (new ChildAccessReorientCommand (req));
108c141
<         return super.getReorientReferenceRelationshipCommand (req);
---
>         return super.getReorientRelationshipCommand (req);
