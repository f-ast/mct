4a5,8
> import org.eclipse.draw2d.IFigure;
> 
> import org.eclipse.draw2d.Label;
> 
16a21,22
> import org.eclipse.gmf.runtime.diagram.ui.editparts.ITextAwareEditPart;
> 
91,92c97,121
<     public TextDirectEditManager (TextCompartmentEditPart source) {
<         super (source, getTextCellEditorClass (source), new TextCellEditorLocator (source.getLabel ()));
---
>     private static class LabelCellEditorLocator implements CellEditorLocator {
>         private Label label;
> 
>         public LabelCellEditorLocator (Label label) {
>             this.label = label;
>         }
> 
>         public Label getLabel () {
>             return label;
>         }
> 
>         public void relocate (CellEditor celleditor) {
>             Text text = (Text) celleditor.getControl ();
>             Rectangle rect = getLabel ().getTextBounds ().getCopy ();
>             getLabel ().translateToAbsolute (rect);
>             int avr = FigureUtilities.getFontMetrics (text.getFont ()).getAverageCharWidth ();
>             rect.setSize (new Dimension (text.computeSize (SWT.DEFAULT, SWT.DEFAULT)).expand (avr * 2, 0));
>             if (! rect.equals (new Rectangle (text.getBounds ()))) text.setBounds (rect.x, rect.y, rect.width, rect.height);
> 
>         }
> 
>     }
> 
>     public TextDirectEditManager (ITextAwareEditPart source) {
>         super (source, getTextCellEditorClass (source), getTextCellEditorLocator (source));
99,101c128,139
<     private static Class getTextCellEditorClass (TextCompartmentEditPart source) {
<         WrapLabel wrapLabel = source.getLabel ();
<         if (wrapLabel.isTextWrapped ()) return WrapTextCellEditor.class;
---
>     public static CellEditorLocator getTextCellEditorLocator (ITextAwareEditPart source) {
>         if (source instanceof TextCompartmentEditPart) return new TextCellEditorLocator (((TextCompartmentEditPart) source).getLabel ());
>         else {
>             IFigure figure = source.getFigure ();
>             assert figure instanceof Label;
>             return new LabelCellEditorLocator ((Label) figure);
>         }
>     }
> 
>     public static Class getTextCellEditorClass (GraphicalEditPart source) {
>         IFigure figure = source.getFigure ();
>         if (figure instanceof WrapLabel && ((WrapLabel) figure).isTextWrapped ()) return WrapTextCellEditor.class;
106c144
<     protected Font getScaledFont (WrapLabel label) {
---
>     protected Font getScaledFont (IFigure label) {
120c158
<         TextCompartmentEditPart textEP = (TextCompartmentEditPart) getEditPart ();
---
>         ITextAwareEditPart textEP = (ITextAwareEditPart) getEditPart ();
122c160
<         WrapLabel label = textEP.getLabel ();
---
>         IFigure label = textEP.getFigure ();
181c219
<         TextCompartmentEditPart textEP = (TextCompartmentEditPart) getEditPart ();
---
>         ITextAwareEditPart textEP = (ITextAwareEditPart) getEditPart ();
183,185c221
<         WrapLabel label = textEP.getLabel ();
<         Assert.isNotNull (label);
<         label.setText (toEdit);
---
>         textEP.setLabelText (toEdit);
