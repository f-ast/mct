5,6d4
< import java.util.Enumeration;
< 
10a9,10
> import org.eclipse.gmf.gmfgraph.ConnectionFigure;
> 
12a13,14
> import org.eclipse.gmf.gmfgraph.DecorationFigure;
> 
14a17,18
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
> 
24c28
<     private final GenerationInfoImpl myGenerationInfo;
---
>     private final Map < FigureDescriptor, String > myFigure2FQN = new IdentityHashMap < FigureDescriptor, String > ();
29d32
<         myGenerationInfo = new GenerationInfoImpl ();
41,47c44,48
<         for (Enumeration < Figure > originalFigures = myGenerationInfo.getProcessedFigures ();
<         originalFigures.hasMoreElements ();) {
<             Figure nextOriginal = originalFigures.nextElement ();
<             String nextConvertedFqn = myGenerationInfo.getGeneratedClassFQN (nextOriginal);
<             CustomFigure custom = DiagramElementsCopier.createCustomFigure (nextOriginal);
<             custom.setName (nextOriginal.getName ());
<             custom.setBundleName (myGeneratedBundle);
---
>         for (FigureDescriptor fd : myFigure2FQN.keySet ()) {
>             Figure nextOriginal = fd.getActualFigure ();
>             String nextConvertedFqn = myFigure2FQN.get (fd);
>             CustomFigure custom = createCustomFigure (nextOriginal);
>             custom.setName (fd.getName ());
54,73c55,56
<     public GenerationInfo getGenerationInfo () {
<         return myGenerationInfo;
<     }
< 
<     protected void handle (Figure next, String fqn) {
<         myGenerationInfo.registerFQN (next, fqn);
<     }
< 
<     public interface GenerationInfo {
< 
<         public Enumeration < Figure > getProcessedFigures ();
< 
<         public String getGeneratedClassFQN (Figure figure);
< 
<     }
< 
<     private static class GenerationInfoImpl implements GenerationInfo {
<         private final Map < Figure, String > myFigure2FQN = new IdentityHashMap < Figure, String > ();
< 
<         public GenerationInfoImpl () {
---
>     public Map < FigureDescriptor, String > getGenerationInfo () {
>         return Collections.unmodifiableMap (myFigure2FQN);
76,77c59,60
<         public void registerFQN (Figure figure, String fqn) {
<             myFigure2FQN.put (figure, fqn);
---
>     protected void handle (FigureDescriptor next, String fqn) {
>         myFigure2FQN.put (next, fqn);
80,81c63,66
<         public String getGeneratedClassFQN (Figure figure) {
<             return myFigure2FQN.get (figure);
---
>     static CustomFigure createCustomFigure (Figure original) {
>         GMFGraphFactory factory = GMFGraphFactory.eINSTANCE;
>         if (original instanceof DecorationFigure) {
>             return factory.createCustomDecoration ();
83,85c68,69
< 
<         public Enumeration < Figure > getProcessedFigures () {
<             return Collections.enumeration (myFigure2FQN.keySet ());
---
>         if (original instanceof ConnectionFigure) {
>             return factory.createCustomConnection ();
87c71
< 
---
>         return factory.createCustomFigure ();
