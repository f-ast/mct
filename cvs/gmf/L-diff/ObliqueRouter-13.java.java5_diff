280c280
<             if (sourceBounds.intersects (targetBounds) && ! sourceBounds.contains (targetBounds) && ! targetBounds.contains (sourceBounds)) {
---
>             if (sourceBounds.intersects (targetBounds) && ! sourceBounds.contains (targetBounds) && ! targetBounds.contains (sourceBounds) || sourceBounds.equals (targetBounds)) {
320a321,327
>             case PositionConstants.NONE :
>                 diff = connRectangle.getCenter ().getDifference (sourceRect.getCenter ());
>                 if (diff.width == 0) {
>                     return diff.height < 0 ? PositionConstants.SOUTH : PositionConstants.NORTH;
>                 } else {
>                     return diff.width < 0 ? PositionConstants.EAST : PositionConstants.WEST;
>                 }
371a379,393
>             case PositionConstants.NONE :
>                 if (sourcePosition == PositionConstants.NORTH) {
>                     line.addPoint (connRect.getTopLeft ());
>                     line.addPoint (connRect.getBottomLeft ());
>                 } else if (sourcePosition == PositionConstants.SOUTH) {
>                     line.addPoint (connRect.getBottomLeft ());
>                     line.addPoint (connRect.getTopLeft ());
>                 } else if (sourcePosition == PositionConstants.WEST) {
>                     line.addPoint (connRect.getTopLeft ());
>                     line.addPoint (connRect.getTopRight ());
>                 } else {
>                     line.addPoint (connRect.getTopRight ());
>                     line.addPoint (connRect.getTopLeft ());
>                 }
> 
460a483,485
>         if (position == PositionConstants.NONE) {
>             connArea = intersection;
>         }
461a487
>         if (position != PositionConstants.NONE) {
472a499,501
>         } else {
>             connArea.expand (selfrelsizeincr.x << 1, selfrelsizeincr.x << 1);
>         }
475,476c504,505
<         Point ptS2 = newLine.getPoint (0);
<         Point ptS1 = conn.getSourceAnchor ().getReferencePoint ();
---
>         PrecisionPoint ptS2 = new PrecisionPoint (newLine.getPoint (0));
>         PrecisionPoint ptS1 = new PrecisionPoint (conn.getSourceAnchor ().getReferencePoint ());
480c509
<         Point ptEdge = conn.getSourceAnchor ().getLocation (ptAbsS2);
---
>         PrecisionPoint ptEdge = new PrecisionPoint (conn.getSourceAnchor ().getLocation (ptAbsS2));
482,484c511,513
<         ptS1 = getStraightEdgePoint (ptEdge, ptS1, ptS2);
<         Point ptE2 = newLine.getPoint (newLine.size () - 1);
<         Point ptE1 = conn.getTargetAnchor ().getReferencePoint ();
---
>         ptS1 = new PrecisionPoint (getStraightEdgePoint (ptEdge, ptS1, ptS2));
>         PrecisionPoint ptE2 = new PrecisionPoint (newLine.getPoint (newLine.size () - 1));
>         PrecisionPoint ptE1 = new PrecisionPoint (conn.getTargetAnchor ().getReferencePoint ());
486c515
<         Point ptAbsE2 = new Point (ptE2);
---
>         PrecisionPoint ptAbsE2 = (PrecisionPoint) ptE2.getCopy ();
488c517
<         ptEdge = conn.getTargetAnchor ().getLocation (ptAbsE2);
---
>         ptEdge = new PrecisionPoint (conn.getTargetAnchor ().getLocation (ptAbsE2));
490,492c519,521
<         ptE1 = getStraightEdgePoint (ptEdge, ptE1, ptE2);
<         newLine.insertPoint (ptS1, 0);
<         newLine.insertPoint (ptE1, newLine.size ());
---
>         ptE1 = new PrecisionPoint (getStraightEdgePoint (ptEdge, ptE1, ptE2));
>         newLine.insertPoint (new Point (Math.round (ptS1.preciseX), Math.round (ptS1.preciseY)), 0);
>         newLine.insertPoint (new Point (Math.round (ptE1.preciseX), Math.round (ptE1.preciseY)), newLine.size ());
