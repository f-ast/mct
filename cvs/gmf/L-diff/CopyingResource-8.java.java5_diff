198c198,204
<         return (eObject.eResource () == xmlResource);
---
>         while (eObject != null) {
>             if (((InternalEObject) eObject).eDirectResource () == xmlResource) {
>                 return true;
>             }
>             eObject = eObject.eContainer ();
>         }
>         return false;
246a253
>         XMLResource lastRes = null;
249,251c256,261
<             EObject eObject = (EObject) iter.next ();
<             getEObjectToIDMap ().put (eObject, xmlResource.getID (eObject));
<             getIDToEObjectMap ().put (xmlResource.getID (eObject), eObject);
---
>             InternalEObject eObject = (InternalEObject) iter.next ();
>             if (eObject.eDirectResource () != null) {
>                 lastRes = (XMLResource) eObject.eDirectResource ();
>             }
>             getEObjectToIDMap ().put (eObject, lastRes.getID (eObject));
>             getIDToEObjectMap ().put (lastRes.getID (eObject), eObject);
