55,56d54
< import org.eclipse.swt.accessibility.ACC;
< 
87,89c85
< import org.eclipse.swt.widgets.ToolBar;
< 
< import org.eclipse.swt.widgets.ToolItem;
---
> import org.eclipse.swt.widgets.Label;
99c95
<     protected ToolItem fillColorButton;
---
>     protected Button fillColorButton;
103,105c99,100
<     private ToolBar toolBar;
<     private ToolItem fontBoldButton;
<     private ToolItem fontItalicButton;
---
>     private Button fontBoldButton;
>     private Button fontItalicButton;
107,108c102,103
<     protected ToolItem fontColorButton;
<     protected ToolItem lineColorButton;
---
>     protected Button fontColorButton;
>     protected Button lineColorButton;
180c175
<         toolBar = new ToolBar (parent, SWT.FLAT);
---
>         Composite toolBar = new Composite (parent, SWT.SHADOW_NONE);
183c178
<         fontBoldButton = new ToolItem (toolBar, SWT.CHECK);
---
>         fontBoldButton = new Button (toolBar, SWT.TOGGLE);
184a180,199
>         fontBoldButton.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
> 
>             public void getName (AccessibleEvent e) {
>                 e.result = DiagramUIMessages.PropertyDescriptorFactory_FontStyle_Bold;
>             }
> 
>         }
> 
>         );
>         fontItalicButton = new Button (toolBar, SWT.TOGGLE);
>         fontItalicButton.setImage (DiagramUIPropertiesImages.get (DiagramUIPropertiesImages.IMG_ITALIC));
>         fontItalicButton.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
> 
>             public void getName (AccessibleEvent e) {
>                 e.result = DiagramUIMessages.PropertyDescriptorFactory_FontStyle_Italic;
>             }
> 
>         }
> 
>         );
194,197d208
<         fontBoldButton.setToolTipText (DiagramUIMessages.FontStyleAction_bold_tooltip);
<         fontItalicButton = new ToolItem (toolBar, SWT.CHECK);
<         fontItalicButton.setImage (DiagramUIPropertiesImages.get (DiagramUIPropertiesImages.IMG_ITALIC));
<         fontItalicButton.setToolTipText (DiagramUIMessages.PropertyDescriptorFactory_FontStyle_Italic);
207c218,219
<         fontColorButton = new ToolItem (toolBar, SWT.DROP_DOWN);
---
>         new Label (toolBar, SWT.LEFT);
>         fontColorButton = new Button (toolBar, SWT.PUSH);
209c221,229
<         fontColorButton.setToolTipText (DiagramUIMessages.PropertyDescriptorFactory_FontColor);
---
>         fontColorButton.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
> 
>             public void getName (AccessibleEvent e) {
>                 e.result = DiagramUIMessages.PropertyDescriptorFactory_FontColor;
>             }
> 
>         }
> 
>         );
219c239,240
<         lineColorButton = new ToolItem (toolBar, SWT.DROP_DOWN);
---
>         new Label (toolBar, SWT.LEFT);
>         lineColorButton = new Button (toolBar, SWT.PUSH);
221c242,250
<         lineColorButton.setToolTipText (DiagramUIMessages.PropertyDescriptorFactory_LineColor);
---
>         lineColorButton.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
> 
>             public void getName (AccessibleEvent e) {
>                 e.result = DiagramUIMessages.PropertyDescriptorFactory_LineColor;
>             }
> 
>         }
> 
>         );
231c260
<         fillColorButton = new ToolItem (toolBar, SWT.DROP_DOWN);
---
>         fillColorButton = new Button (toolBar, SWT.PUSH);
233,235c262
<         fillColorButton.setToolTipText (DiagramUIMessages.PropertyDescriptorFactory_FillColor);
<         fillColorButton.setEnabled (false);
<         toolBar.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
---
>         fillColorButton.getAccessible ().addAccessibleListener (new AccessibleAdapter () {
238,246c265
<                 if (e.childID != ACC.CHILDID_SELF) {
<                     ToolItem item = toolBar.getItem (e.childID);
<                     if (item != null) {
<                         String toolTip = item.getToolTipText ();
<                         if (toolTip != null) {
<                             e.result = toolTip;
<                         }
<                     }
<                 }
---
>                 e.result = DiagramUIMessages.PropertyDescriptorFactory_FillColor;
251a271
>         fillColorButton.setEnabled (false);
277,280d296
<     protected RGB changeColor (SelectionEvent event, ToolItem toolItem, String preferenceId, final String propertyId, String commandName, ImageDescriptor imageDescriptor) {
<         return changeColor (event, toolItem, propertyId, commandName, imageDescriptor);
<     }
< 
332,382d347
<     protected RGB changeColor (SelectionEvent event, ToolItem toolItem, final String propertyId, String commandName, ImageDescriptor imageDescriptor) {
<         ColorPalettePopup popup = new ColorPalettePopup (toolItem.getParent ().getShell (), IDialogConstants.BUTTON_BAR_HEIGHT);
<         popup.setPreviousColor (previousColor);
<         Rectangle r = toolItem.getBounds ();
<         Point location = toolItem.getParent ().toDisplay (r.x, r.y);
<         popup.open (new Point (location.x, location.y + r.height));
<         if (popup.getSelectedColor () == null && ! popup.useDefaultColor ()) {
<             return null;
<         }
<         final RGB selectedColor = popup.getSelectedColor ();
<         final EStructuralFeature feature = (EStructuralFeature) PackageUtil.getElement (propertyId);
<         List commands = new ArrayList ();
<         Iterator it = getInputIterator ();
<         RGB colorToReturn = selectedColor;
<         RGB color = selectedColor;
<         while (it.hasNext ()) {
<             final IGraphicalEditPart ep = (IGraphicalEditPart) it.next ();
<             color = selectedColor;
<             if (popup.useDefaultColor ()) {
<                 Object preferredValue = ep.getPreferredValue (feature);
<                 if (preferredValue instanceof Integer) {
<                     color = FigureUtilities.integerToRGB ((Integer) preferredValue);
<                 }
<             }
<             if (colorToReturn == null) {
<                 colorToReturn = color;
<             }
<             if (color != null) {
<                 final RGB finalColor = color;
<                 commands.add (createCommand (commandName, ((View) ep.getModel ()).eResource (), new Runnable () {
< 
<                     public void run () {
<                         ENamedElement element = PackageUtil.getElement (propertyId);
<                         if (element instanceof EStructuralFeature) ep.setStructuralFeatureValue (feature, FigureUtilities.RGBToInteger (finalColor));
< 
<                     }
< 
<                 }
< 
<                 ));
<             }
<         }
<         if (! commands.isEmpty ()) {
<             executeAsCompositeCommand (commandName, commands);
<             Image overlyedImage = new ColorOverlayImageDescriptor (imageDescriptor.getImageData (), color).createImage ();
<             disposeImage (toolItem.getImage ());
<             toolItem.setImage (overlyedImage);
<         }
<         return colorToReturn;
<     }
< 
