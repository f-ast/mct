8a9,10
> import java.util.ArrayList;
> 
31,40d32
< import org.eclipse.gmf.internal.codegen.dispatch.CachingEmitterFactory;
< 
< import org.eclipse.gmf.internal.codegen.dispatch.EmitterFactory;
< 
< import org.eclipse.gmf.internal.codegen.dispatch.EmitterFactoryImpl;
< 
< import org.eclipse.gmf.internal.codegen.dispatch.NoSuchTemplateException;
< 
< import org.eclipse.gmf.internal.codegen.dispatch.StaticTemplateRegistry;
< 
47,48d38
< import org.eclipse.gmf.internal.common.codegen.JETEmitterAdapter;
< 
65,84c55,68
<     private static final String TEMPLATES_PLUGIN_ID = "org.eclipse.gmf.codegen";
<     private final EmitterFactory myFactory;
<     private final String [] myTemplatePath;
<     private ResourceManager myResourceManager;
< 
<     public CodegenEmitters (boolean usePrecompiled, String templateDirectory) {
<         this (usePrecompiled, templateDirectory, getDefaultVariables (), new StaticTemplateRegistry (CodegenEmitters.class.getClassLoader ()));
<     }
< 
<     public CodegenEmitters (boolean usePrecompiled, String templateDirectory, String [] variables, StaticTemplateRegistry registry) {
<         final URL baseURL = getTemplatesBundle ().getEntry ("/templates/");
<         final URL dynModelBase = getTemplatesBundle ().getEntry ("/templates-dynmodel/");
<         final URL dynamicURL = usePrecompiled ? null : getDynamicTemplatesURL (templateDirectory);
<         myTemplatePath = new String [] {dynamicURL != null ? dynamicURL.toString () : null, baseURL.toString ()};
<         myFactory = new CachingEmitterFactory (new EmitterFactoryImpl (getTemplatePath (), registry, usePrecompiled, variables));
<         if (dynamicURL == null) {
<             myResourceManager = new BundleResourceManager (baseURL, dynModelBase);
<         } else {
<             myResourceManager = new BundleResourceManager (dynamicURL, baseURL, dynModelBase);
<         }
---
>     private final ResourceManager myResourceManager;
>     private final URL [] myLocations;
> 
>     public CodegenEmitters (boolean useBaseTemplatesOnly, String templateDirectory, boolean includeDynamicModelTemplates) {
>         ArrayList < URL > urls = new ArrayList < URL > (5);
>         if (! useBaseTemplatesOnly) {
>             urls.add (getDynamicTemplatesURL (templateDirectory));
>         }
>         if (includeDynamicModelTemplates) {
>             urls.add (getTemplatesBundle ().getEntry ("/templates-dynmodel/"));
>         }
>         urls.add (getTemplatesBundle ().getEntry ("/templates/"));
>         myLocations = urls.toArray (new URL [urls.size ()]);
>         myResourceManager = new BundleResourceManager (myLocations);
100,111d83
<     public TextEmitter retrieve (Class < ? > key) throws UnexpectedBehaviourException {
<         try {
<             return new JETEmitterAdapter (myFactory.acquireEmitter (key));
<         } catch (NoSuchTemplateException ex) {
<             throw new UnexpectedBehaviourException (ex.getMessage (), ex);
<         }
<     }
< 
<     private String [] getTemplatePath () {
<         return myTemplatePath;
<     }
< 
113c85
<         return Platform.getBundle (TEMPLATES_PLUGIN_ID);
---
>         return Platform.getBundle ("org.eclipse.gmf.codegen");
122,123c94
<                 String pluginID = "org.eclipse.gmf.codegen";
<                 Platform.getLog (Platform.getBundle (pluginID)).log (new Status (IStatus.ERROR, pluginID, 0, "Incorrecct dynamic templates location", e));
---
>                 Platform.getLog (getTemplatesBundle ()).log (new Status (IStatus.ERROR, getTemplatesBundle ().getSymbolicName (), 0, "Incorrecct dynamic templates location", e));
736c707,712
<         String templateLocation = JETCompiler.find (getTemplatePath (), relativePath);
---
>         String [] templatesPath = new String [myLocations.length];
>         for (int i = 0;
>         i < myLocations.length; i ++) {
>             templatesPath [i] = myLocations [i].toString ();
>         }
>         String templateLocation = JETCompiler.find (templatesPath, relativePath);
747,750d722
<     protected static String [] getDefaultVariables () {
<         return new String [] {"org.eclipse.emf.codegen", "org.eclipse.emf.codegen.ecore", "org.eclipse.emf.common", "org.eclipse.emf.ecore", "org.eclipse.gmf.common", "org.eclipse.gmf.codegen",};
<     }
< 
