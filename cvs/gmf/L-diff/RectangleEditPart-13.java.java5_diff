26a27,30
> import org.eclipse.draw2d.geometry.Point;
> 
> import org.eclipse.draw2d.geometry.Rectangle;
> 
49,50d52
< import org.eclipse.gmf.gmfgraph.Point;
< 
53,54d54
< import org.eclipse.gmf.gmfgraph.Rectangle;
< 
61,62d60
< import org.eclipse.gmf.graphdef.editor.edit.policies.RectangleGraphicalNodeEditPolicy;
< 
98,99d95
<     private RectangleFigure myFigure;
<     protected Figure myNodeFigure;
105a102,214
>     protected void createDefaultEditPolicies () {
>         installEditPolicy (EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy ());
>         super.createDefaultEditPolicies ();
>         installEditPolicy (EditPolicyRoles.SEMANTIC_ROLE, new RectangleItemSemanticEditPolicy ());
>         installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy ());
>         installEditPolicy (EditPolicyRoles.CANONICAL_ROLE, new RectangleCanonicalEditPolicy ());
>         installEditPolicy (EditPolicy.LAYOUT_ROLE, createLayoutEditPolicy ());
>     }
> 
>     protected LayoutEditPolicy createLayoutEditPolicy () {
>         XYLayoutEditPolicy lep = new XYLayoutEditPolicy () {
> 
>             protected EditPolicy createChildEditPolicy (EditPart child) {
>                 EditPolicy result = super.createChildEditPolicy (child);
>                 if (result == null) {
>                     return new ResizableShapeEditPolicy ();
>                 }
>                 return result;
>             }
> 
>             protected Point getLayoutOrigin () {
>                 return ((GraphicalEditPart) getHost ()).getContentPane ().getClientArea ().getLocation ();
>             }
> 
>             protected Rectangle getCurrentConstraintFor (org.eclipse.gef.GraphicalEditPart child) {
>                 Rectangle result = super.getCurrentConstraintFor (child);
>                 if (result == null) {
>                     IFigure fig = child.getFigure ();
>                     result = fig.getBounds ().getCopy ();
>                 }
>                 return result;
>             }
> 
>         }
> 
>         ;
>         return lep;
>     }
> 
>     protected IFigure createNodeShape () {
>         RectangleFigure figure = new RectangleFigure ();
>         figure.setUseLocalCoordinates (true);
>         myFigure = figure;
>         org.eclipse.gmf.gmfgraph.Rectangle modelElement = (org.eclipse.gmf.gmfgraph.Rectangle) ((View) getModel ()).getElement ();
>         if (modelElement != null) {
>             {
>                 layoutDataChanged (modelElement.getLayoutData ());
>             } {
>                 layoutChanged (modelElement.getLayout ());
>             } {
>                 myFigure.setOutline (modelElement.isOutline ());
>             } {
>                 myFigure.setFill (modelElement.isFill ());
>             } {
>                 myFigure.setLineWidth (modelElement.getLineWidth ());
>             } {
>                 myFigure.setLineStyle (getLineStyle (modelElement.getLineKind ()));
>             } {
>                 myFigure.setFillXOR (modelElement.isXorFill ());
>             } {
>                 myFigure.setOutlineXOR (modelElement.isXorOutline ());
>             }}
>         return primaryShape = figure;
>     }
> 
>     public RectangleFigure getPrimaryShape () {
>         return (RectangleFigure) primaryShape;
>     }
> 
>     protected NodeFigure createNodePlate () {
>         DefaultSizeNodeFigure result = new DefaultSizeNodeFigure (getMapMode ().DPtoLP (0), getMapMode ().DPtoLP (0));
>         myNodeFigure = result;
>         return result;
>     }
> 
>     protected NodeFigure createNodeFigure () {
>         NodeFigure figure = createNodePlate ();
>         figure.setLayoutManager (new StackLayout ());
>         IFigure shape = createNodeShape ();
>         figure.add (shape);
>         contentPane = setupContentPane (shape);
>         return figure;
>     }
> 
>     protected IFigure setupContentPane (IFigure nodeShape) {
>         if (nodeShape.getLayoutManager () == null) {
>             nodeShape.setLayoutManager (new FreeformLayout () {
> 
>                 public Object getConstraint (IFigure figure) {
>                     Object result = constraints.get (figure);
>                     if (result == null) {
>                         result = new Rectangle (0, 0, - 1, - 1);
>                     }
>                     return result;
>                 }
> 
>             }
> 
>             );
>         }
>         return nodeShape;
>     }
> 
>     public IFigure getContentPane () {
>         if (contentPane != null) {
>             return contentPane;
>         }
>         return super.getContentPane ();
>     }
> 
>     private RectangleFigure myFigure;
>     protected Figure myNodeFigure;
> 
115c224
<         final Rectangle modelElement = (Rectangle) view.getElement ();
---
>         final org.eclipse.gmf.gmfgraph.Rectangle modelElement = (org.eclipse.gmf.gmfgraph.Rectangle) view.getElement ();
271c380
<                             Point location = modelElement.getLocation ();
---
>                             org.eclipse.gmf.gmfgraph.Point location = modelElement.getLocation ();
289c398
<                             myNodeFigure.setLocation (new org.eclipse.draw2d.geometry.Point (bounds.getX (), bounds.getY ()));
---
>                             myNodeFigure.setLocation (new Point (bounds.getX (), bounds.getY ()));
302c411
<                                 Point topLeft;
---
>                                 org.eclipse.gmf.gmfgraph.Point topLeft;
462,557c571,572
<     protected void createDefaultEditPolicies () {
<         installEditPolicy (EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy ());
<         super.createDefaultEditPolicies ();
<         installEditPolicy (EditPolicyRoles.SEMANTIC_ROLE, new RectangleItemSemanticEditPolicy ());
<         installEditPolicy (EditPolicy.GRAPHICAL_NODE_ROLE, new RectangleGraphicalNodeEditPolicy ());
<         installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy ());
<         installEditPolicy (EditPolicyRoles.CANONICAL_ROLE, new RectangleCanonicalEditPolicy ());
<         installEditPolicy (EditPolicy.LAYOUT_ROLE, createLayoutEditPolicy ());
<     }
< 
<     protected LayoutEditPolicy createLayoutEditPolicy () {
<         XYLayoutEditPolicy lep = new XYLayoutEditPolicy () {
< 
<             protected EditPolicy createChildEditPolicy (EditPart child) {
<                 EditPolicy result = super.createChildEditPolicy (child);
<                 if (result == null) {
<                     return new ResizableShapeEditPolicy ();
<                 }
<                 return result;
<             }
< 
<             protected org.eclipse.draw2d.geometry.Point getLayoutOrigin () {
<                 return ((GraphicalEditPart) getHost ()).getContentPane ().getClientArea ().getLocation ();
<             }
< 
<             protected org.eclipse.draw2d.geometry.Rectangle getCurrentConstraintFor (org.eclipse.gef.GraphicalEditPart child) {
<                 org.eclipse.draw2d.geometry.Rectangle result = super.getCurrentConstraintFor (child);
<                 if (result == null) {
<                     IFigure fig = child.getFigure ();
<                     result = fig.getBounds ().getCopy ();
<                 }
<                 return result;
<             }
< 
<         }
< 
<         ;
<         return lep;
<     }
< 
<     protected IFigure createNodeShape () {
<         RectangleFigure figure = new RectangleFigure ();
<         figure.setUseLocalCoordinates (true);
<         myFigure = figure;
<         Rectangle modelElement = (Rectangle) ((View) getModel ()).getElement ();
<         if (modelElement != null) {
<             {
<                 layoutDataChanged (modelElement.getLayoutData ());
<             } {
<                 layoutChanged (modelElement.getLayout ());
<             } {
<                 myFigure.setOutline (modelElement.isOutline ());
<             } {
<                 myFigure.setFill (modelElement.isFill ());
<             } {
<                 myFigure.setLineWidth (modelElement.getLineWidth ());
<             } {
<                 myFigure.setLineStyle (getLineStyle (modelElement.getLineKind ()));
<             } {
<                 myFigure.setFillXOR (modelElement.isXorFill ());
<             } {
<                 myFigure.setOutlineXOR (modelElement.isXorOutline ());
<             }}
<         return primaryShape = figure;
<     }
< 
<     public RectangleFigure getPrimaryShape () {
<         return (RectangleFigure) primaryShape;
<     }
< 
<     protected NodeFigure createNodePlate () {
<         return new DefaultSizeNodeFigure (getMapMode ().DPtoLP (0), getMapMode ().DPtoLP (0));
<     }
< 
<     protected NodeFigure createNodeFigure () {
<         NodeFigure figure = createNodePlate ();
<         myNodeFigure = figure;
<         figure.setLayoutManager (new StackLayout ());
<         IFigure shape = createNodeShape ();
<         figure.add (shape);
<         contentPane = setupContentPane (shape);
<         return figure;
<     }
< 
<     protected IFigure setupContentPane (IFigure nodeShape) {
<         if (nodeShape.getLayoutManager () == null) {
<             nodeShape.setLayoutManager (new FreeformLayout () {
< 
<                 public Object getConstraint (IFigure figure) {
<                     Object result = constraints.get (figure);
<                     if (result == null) {
<                         result = new org.eclipse.draw2d.geometry.Rectangle (0, 0, - 1, - 1);
<                     }
<                     return result;
<                 }
< 
---
>     protected LayoutManager getFigureLayoutManager () {
>         return myFigure.getLayoutManager ();
560,562c575,576
<             );
<         }
<         return nodeShape;
---
>     protected void setFigureLayoutManager (LayoutManager layoutManager) {
>         myFigure.setLayoutManager (layoutManager);
565,567c579,585
<     public IFigure getContentPane () {
<         if (contentPane != null) {
<             return contentPane;
---
>     protected void refreshBounds () {
>         if (((View) getParent ().getModel ()).getElement () instanceof FigureMarker) {
>             int width = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Width ())).intValue ();
>             int height = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Height ())).intValue ();
>             myNodeFigure.setPreferredSize (new org.eclipse.draw2d.geometry.Dimension (width, height));
>         } else {
>             super.refreshBounds ();
569d586
<         return super.getContentPane ();
595,612d611
<     protected LayoutManager getFigureLayoutManager () {
<         return myFigure.getLayoutManager ();
<     }
< 
<     protected void setFigureLayoutManager (LayoutManager layoutManager) {
<         myFigure.setLayoutManager (layoutManager);
<     }
< 
<     protected void refreshBounds () {
<         if (((View) getParent ().getModel ()).getElement () instanceof FigureMarker) {
<             int width = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Width ())).intValue ();
<             int height = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Height ())).intValue ();
<             myNodeFigure.setPreferredSize (new org.eclipse.draw2d.geometry.Dimension (width, height));
<         } else {
<             super.refreshBounds ();
<         }
<     }
< 
