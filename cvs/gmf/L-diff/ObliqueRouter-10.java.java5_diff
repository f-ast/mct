24a25,26
> import org.eclipse.gmf.runtime.draw2d.ui.figures.IPolygonAnchorableFigure;
> 
28a31,32
> import org.eclipse.gmf.runtime.draw2d.ui.geometry.PointListUtilities;
> 
35,36d38
< import org.eclipse.jface.util.Assert;
< 
167a170,175
>         PointList points = calculateBendPoints (conn);
>         routeLine (conn, 0, points);
>         conn.setPoints (points);
>     }
> 
>     protected PointList calculateBendPoints (Connection conn) {
177,178c185
<         routeLine (conn, 0, points);
<         conn.setPoints (points);
---
>         return points;
196c203
<         Rectangle startRect = null;
---
>         PointList startPolygon = null;
198,200c205
<             startRect = new Rectangle (sourceOwner.getBounds ());
<             sourceOwner.translateToAbsolute (startRect);
<             conn.translateToRelative (startRect);
---
>             startPolygon = getFigurePolygon (sourceOwner, conn);
202c207
<         Rectangle endRect = null;
---
>         PointList endPolygon = null;
204,206c209
<             endRect = new Rectangle (targetOwner.getBounds ());
<             targetOwner.translateToAbsolute (endRect);
<             conn.translateToRelative (endRect);
---
>             endPolygon = getFigurePolygon (targetOwner, conn);
213c216
<             else if ((startRect == null || ! startRect.contains (pt)) && (endRect == null || ! endRect.contains (pt))) {
---
>             else if ((startPolygon == null || ! PointListUtilities.containsPoint (startPolygon, pt)) && (endPolygon == null || ! PointListUtilities.containsPoint (endPolygon, pt))) {
228a232,255
>     protected PointList getFigurePolygon (IFigure owner, Connection conn) {
>         PointList polygon = new PointList ();
>         if (owner instanceof IPolygonAnchorableFigure) {
>             PointList points = ((IPolygonAnchorableFigure) owner).getPolygonPoints ();
>             for (int index = 0;
>             index < points.size (); index ++) {
>                 Point point = points.getPoint (index).getCopy ();
>                 owner.translateToAbsolute (point);
>                 conn.translateToRelative (point);
>                 polygon.addPoint (point);
>             }
>         } else {
>             Rectangle rect = owner.getBounds ().getCopy ();
>             owner.translateToAbsolute (rect);
>             conn.translateToRelative (rect);
>             polygon.addPoint (rect.getTopLeft ());
>             polygon.addPoint (rect.getTopRight ());
>             polygon.addPoint (rect.getBottomRight ());
>             polygon.addPoint (rect.getBottomLeft ());
>             polygon.addPoint (rect.getTopLeft ());
>         }
>         return polygon;
>     }
> 
288c315
<             Assert.isTrue (nIndex >= 0);
---
>             assert nIndex >= 0;
