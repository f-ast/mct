28a29,30
> import org.eclipse.emf.ecore.EStructuralFeature;
> 
30a33,34
> import org.eclipse.emf.ecore.EStructuralFeature.Setting;
> 
126,134c130,150
<         if ((features != null) && (features.length != 0)) {
<             Collection referencers = new ArrayList ();
<             for (int i = 0, count = features.length;
<             i < count; i ++) {
<                 EReference feature = features [i];
<                 Iterator j = crossReferenceAdapter.getInverseReferencers (eObject, feature, null).iterator ();
<                 while (j.hasNext ()) {
<                     EObject referencer = (EObject) j.next ();
<                     referencers.add (referencer);
---
>         Collection settings = crossReferenceAdapter.getInverseReferences (eObject);
>         if (settings.isEmpty () == false) {
>             ArrayList referencers = new ArrayList ();
>             int count;
>             if ((features != null) && ((count = features.length) != 0)) {
>                 Iterator it = settings.iterator ();
>                 while (it.hasNext ()) {
>                     Setting setting = (Setting) it.next ();
>                     EStructuralFeature feature = setting.getEStructuralFeature ();
>                     for (int i = 0;
>                     i < count; ++ i) {
>                         if (feature == features [i]) {
>                             referencers.add (setting.getEObject ());
>                             break;
>                         }
>                     }
>                 }
>             } else {
>                 Iterator it = settings.iterator ();
>                 while (it.hasNext ()) {
>                     referencers.add (((Setting) it.next ()).getEObject ());
138,139c154,155
<         } else return crossReferenceAdapter.getInverseReferencers (eObject, null, null);
< 
---
>         }
>         return Collections.EMPTY_LIST;
300c316,319
<                 return res.getID (proxy);
---
>                 String id = res.getID (proxy);
>                 if (id == null || id.length () == 0) {
>                     return res.getURIFragment (proxy);
>                 }
