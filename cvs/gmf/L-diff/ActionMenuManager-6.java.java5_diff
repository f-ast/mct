100a101
>             IContributionItem lastGroupMarker = null;
105,106c106,109
<                     if (i == 0 || i == items.length - 1 || items [i + 1] instanceof AbstractGroupMarker || mnu.getItemCount () < 1) continue;
< 
---
>                     if (i == 0 || i == items.length - 1 || items [i + 1] instanceof AbstractGroupMarker || mnu.getItemCount () < 1 || ! item.isVisible ()) {
>                         continue;
>                     } else {
>                         lastGroupMarker = item;
107a111
>                 } else {
111a116,119
>                         if (lastGroupMarker != null) {
>                             lastGroupMarker.fill (menu, - 1);
>                             lastGroupMarker = null;
>                         }
116a125
>             }
