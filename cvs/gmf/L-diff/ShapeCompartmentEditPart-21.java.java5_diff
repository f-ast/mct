21,22d20
< import org.eclipse.draw2d.Bendpoint;
< 
25,26d22
< import org.eclipse.draw2d.ConnectionAnchor;
< 
43c39
< import org.eclipse.draw2d.geometry.PointList;
---
> import org.eclipse.draw2d.geometry.PrecisionPoint;
139a136,139
>                 if (! source.getFigure ().isShowing () || ! target.getFigure ().isShowing ()) {
>                     connection.setVisible (false);
>                     continue;
>                 }
147,162c147,155
<                 ConnectionAnchor sc = cep.getSourceConnectionAnchor ();
<                 ConnectionAnchor tc = cep.getTargetConnectionAnchor ();
<                 Point sRefPoint;
<                 Point tRefPoint;
<                 List bendpoints = (List) connection.getConnectionRouter ().getConstraint (connection);
<                 if (bendpoints.size () >= 2) {
<                     sRefPoint = ((Bendpoint) bendpoints.get (0)).getLocation ().getCopy ();
<                     connection.translateToAbsolute (sRefPoint);
<                     tRefPoint = ((Bendpoint) bendpoints.get (bendpoints.size () - 1)).getLocation ().getCopy ();
<                     connection.translateToAbsolute (tRefPoint);
<                 } else {
<                     sRefPoint = tc.getReferencePoint ();
<                     tRefPoint = sc.getReferencePoint ();
<                 }
<                 Point sLoc = sc.getLocation (sRefPoint);
<                 Point tLoc = tc.getLocation (tRefPoint);
---
>                 if (! connection.isVisible ()) {
>                     connection.setVisible (true);
>                     connection.getConnectionRouter ().route (connection);
>                     connection.setVisible (false);
>                 }
>                 Point sLoc = new PrecisionPoint (connection.getPoints ().getFirstPoint ());
>                 Point tLoc = new PrecisionPoint (connection.getPoints ().getLastPoint ());
>                 connection.translateToAbsolute (sLoc);
>                 connection.translateToAbsolute (tLoc);
295,296c288
<             if (! (figure.isVisible ())) {
<                 return false;
---
>             if (! (figure.isShowing ())) {
302a295
>                 return false;
522a516,520
>     protected void setCollapsed (boolean collapsed, boolean animate) {
>         super.setCollapsed (collapsed, animate);
>         refreshConnections ();
>     }
> 
