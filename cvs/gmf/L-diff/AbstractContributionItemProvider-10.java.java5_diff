162c162
<                 if (item.isGlobal ()) actionBars.setGlobalActionHandler (item.getId (), getAction (item.getId (), partDescriptor));
---
>                 if (item.isGlobal ()) actionBars.setGlobalActionHandler (item.getId (), getAction (item.getId (), partDescriptor, item));
255a256,273
>     protected final IAction getAction (String actionId, IWorkbenchPartDescriptor partDescriptor, IPartSelector partSelector) {
>         boolean actionExistsAlready = false;
>         ActionRegistry registry = (ActionRegistry) actionCache.get (partDescriptor);
>         if (registry != null) {
>             if (getActionFromRegistry (actionId, partDescriptor, registry) != null) {
>                 actionExistsAlready = true;
>             }
>         }
>         IAction result = getAction (actionId, partDescriptor);
>         if (actionExistsAlready && partSelector instanceof ProviderContributionDescriptor.AbstractPopupContributionItemDescriptor) {
>             return result;
>         }
>         if (result instanceof AbstractActionHandler && partSelector != null) {
>             ((AbstractActionHandler) result).setPartSelector (partSelector);
>         }
>         return result;
>     }
> 
425c443
<                 IAction action = getAction (actionId, partDescriptor);
---
>                 IAction action = getAction (actionId, partDescriptor, partSelector);
427,431c445
<                     PluginActionContributionItem item = new PluginActionContributionItem (action);
<                     if (partSelector != null) {
<                         item.setPartSelector (partSelector);
<                     }
<                     return item;
---
>                     return new PluginActionContributionItem (action);
474c488,491
<                 return new PluginMenuManager (createMenuManager (menuId, partDescriptor));
---
>                 IMenuManager manager = createMenuManager (menuId, partDescriptor);
>                 if (manager != null) {
>                     return new PluginMenuManager (manager);
>                 }
779,785d795
<         public void setPartSelector (IPartSelector partSelector) {
<             IAction action = getAction ();
<             if (action instanceof AbstractActionHandler) {
<                 ((AbstractActionHandler) action).setPartSelector (partSelector);
<             }
<         }
< 
