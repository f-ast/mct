48d47
<         if (context != null) {
51a51
>             delegate = null;
53c53,56
<             delegate = new UndoActionHandler (getWorkbenchPart ().getSite (), context);
---
>         if (context != null) {
>             IWorkbenchPart part = getWorkbenchPart ();
>             if (part != null) {
>                 delegate = new UndoActionHandler (part.getSite (), context);
55a59,60
>             }
>         }
59d63
<     }
159,161c163,165
<     public final void setUndoContext (IUndoContext undoContext) {
<         this.undoContext = undoContext;
<         initializeWithContext (undoContext);
---
>     public final void setUndoContext (IUndoContext context) {
>         this.undoContext = context;
>         initializeWithContext (context);
177a182,190
>     public void dispose () {
>         if (delegate != null) {
>             delegate.removePropertyChangeListener (getDelegateListener ());
>             delegate.dispose ();
>             delegate = null;
>         }
>         super.dispose ();
>     }
> 
