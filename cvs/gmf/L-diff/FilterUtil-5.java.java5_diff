121c121,125
<         return sort (getChildReferencesOf (childReferences, mapping.getParentNode ()));
---
>         return sort (getChildrenOf (childReferences, mapping.getParentNode (), false));
>     }
> 
>     public static Collection filterByNodeMapping (Collection compartments, ChildReference childReference) {
>         return getChildrenOf (compartments, childReference.getParentNode (), true);
235c239
<     private static Collection getChildReferencesOf (Collection childReferences, NodeMapping parentNode) {
---
>     private static Collection getChildrenOf (Collection elements, EObject container, boolean addNull) {
237c241
<         for (Iterator it = childReferences.iterator ();
---
>         for (Iterator it = elements.iterator ();
239,241c243,245
<             ChildReference nextChildReference = (ChildReference) it.next ();
<             if (nextChildReference != null && nextChildReference.getParentNode () == parentNode) {
<                 result.add (nextChildReference);
---
>             EObject nextEObject = (EObject) it.next ();
>             if (nextEObject == null ? addNull : nextEObject.eContainer () == container) {
>                 result.add (nextEObject);
