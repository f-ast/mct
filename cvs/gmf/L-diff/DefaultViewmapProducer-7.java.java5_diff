24a25,26
> import org.eclipse.gmf.gmfgraph.DiagramElement;
> 
33,34d34
< import org.eclipse.gmf.gmfgraph.FigureHandle;
< 
39,40d38
< import org.eclipse.gmf.gmfgraph.Layoutable;
< 
42a41,42
> import org.eclipse.gmf.gmfgraph.VisualFacet;
> 
94,98c94,95
<         FigureHandle figure = diagramNode.getFigure ();
<         if (false == figure instanceof Layoutable) {
<             return;
<         }
<         ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType (((Layoutable) figure).getLayout ());
---
>         Figure figure = diagramNode.getFigure ().getActualFigure ();
>         ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType (figure.getLayout ());
102,103c99,100
<     protected final void setupStyleAttributes (Viewmap viewmap, FigureHandle handle) {
<         if (viewmap == null || false == handle instanceof Figure) {
---
>     protected final void setupStyleAttributes (Viewmap viewmap, Figure figure) {
>         if (viewmap == null || figure == null) {
106d102
<         Figure figure = (Figure) handle;
127,129c123
<         FigureHandle handle = node.getFigure ();
<         if (handle instanceof Figure) {
<             Figure figure = (Figure) handle;
---
>         Figure figure = node.getFigure ().getActualFigure ();
131c125
<             DefaultSizeFacet facet = (DefaultSizeFacet) node.find (DefaultSizeFacet.class);
---
>         DefaultSizeFacet facet = findVF (node, DefaultSizeFacet.class);
143a138,145
> 
>     protected static < T extends VisualFacet > T findVF (DiagramElement de, Class < T > facetClass) {
>         for (VisualFacet vf : de.getFacets ()) {
>             if (facetClass.isInstance (vf)) {
>                 return facetClass.cast (vf);
>             }
>         }
>         return null;
