2a3,4
> import java.net.MalformedURLException;
> 
12a15,16
> import org.eclipse.core.runtime.FileLocator;
> 
34a39,46
> import org.eclipse.gmf.runtime.common.core.util.Trace;
> 
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIDebugOptions;
> 
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIPlugin;
> 
> import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIStatusCodes;
> 
151,152d162
<             String pluginId = configElement.getDeclaringExtension ().getNamespace ();
<             Bundle bundle = Platform.getBundle (pluginId);
154,159c164
<             if (smallIconPath != null) {
<                 URL fullPathString = Platform.find (bundle, new Path (smallIconPath));
<                 if (fullPathString != null) {
<                     small_icon = ImageDescriptor.createFromURL (fullPathString);
<                 }
<             }
---
>             small_icon = findIconImageDescriptor (configElement, smallIconPath);
161,166c166
<             if (largeIconPath != null) {
<                 URL fullPathString = Platform.find (bundle, new Path (largeIconPath));
<                 if (fullPathString != null) {
<                     large_icon = ImageDescriptor.createFromURL (fullPathString);
<                 }
<             }
---
>             large_icon = findIconImageDescriptor (configElement, largeIconPath);
174a175,192
>         private ImageDescriptor findIconImageDescriptor (IConfigurationElement configElement, String iconPath) {
>             String pluginId = configElement.getDeclaringExtension ().getNamespaceIdentifier ();
>             Bundle bundle = Platform.getBundle (pluginId);
>             try {
>                 if (iconPath != null) {
>                     URL fullPathString = FileLocator.find (bundle, new Path (iconPath), null);
>                     fullPathString = fullPathString != null ? fullPathString : new URL (iconPath);
>                     if (fullPathString != null) {
>                         return ImageDescriptor.createFromURL (fullPathString);
>                     }
>                 }
>             } catch (MalformedURLException e) {
>                 Trace.catching (DiagramUIPlugin.getInstance (), DiagramUIDebugOptions.EXCEPTIONS_CATCHING, DefaultPaletteProvider.class, e.getLocalizedMessage (), e);
>                 Log.error (DiagramUIPlugin.getInstance (), DiagramUIStatusCodes.RESOURCE_FAILURE, e.getMessage (), e);
>             }
>             return null;
>         }
> 
