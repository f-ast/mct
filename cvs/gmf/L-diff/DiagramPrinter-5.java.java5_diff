15,32d14
< import org.eclipse.jface.preference.IPreferenceStore;
< 
< import org.eclipse.jface.resource.JFaceResources;
< 
< import org.eclipse.jface.util.Assert;
< 
< import org.eclipse.swt.graphics.Font;
< 
< import org.eclipse.swt.graphics.FontData;
< 
< import org.eclipse.swt.graphics.GC;
< 
< import org.eclipse.swt.graphics.Point;
< 
< import org.eclipse.swt.printing.Printer;
< 
< import org.eclipse.swt.widgets.Display;
< 
49c31,33
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
---
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
> 
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapModeUtil;
52a37,54
> import org.eclipse.jface.preference.IPreferenceStore;
> 
> import org.eclipse.jface.resource.JFaceResources;
> 
> import org.eclipse.jface.util.Assert;
> 
> import org.eclipse.swt.graphics.Font;
> 
> import org.eclipse.swt.graphics.FontData;
> 
> import org.eclipse.swt.graphics.GC;
> 
> import org.eclipse.swt.graphics.Point;
> 
> import org.eclipse.swt.printing.Printer;
> 
> import org.eclipse.swt.widgets.Display;
> 
66a69
>     private IMapMode mm;
68c71
<     public DiagramPrinter (PreferencesHint preferencesHint) {
---
>     public DiagramPrinter (PreferencesHint preferencesHint, IMapMode mm) {
70a74,82
>         this.mm = mm;
>     }
> 
>     public DiagramPrinter (PreferencesHint preferencesHint) {
>         this (preferencesHint, MapModeUtil.getMapMode ());
>     }
> 
>     protected IMapMode getMapMode () {
>         return mm;
143,144c155,156
<             offsetX = (int) (MapMode.DPtoLP ((int) (offsetX / 2.0f * display_dpi.x / printer.getDPI ().x)) / userScale);
<             offsetY = (int) (MapMode.DPtoLP ((int) (offsetY / 2.0f * display_dpi.y / printer.getDPI ().y)) / userScale);
---
>             offsetX = (int) (getMapMode ().DPtoLP ((int) (offsetX / 2.0f * display_dpi.x / printer.getDPI ().x)) / userScale);
>             offsetY = (int) (getMapMode ().DPtoLP ((int) (offsetY / 2.0f * display_dpi.y / printer.getDPI ().y)) / userScale);
190c202
<         this.graphics.drawText (headerOrFooter, HeaderAndFooterHelper.LEFT_MARGIN + (width - MapMode.DPtoLP (gc_.textExtent (headerOrFooter).x)) / 2, HeaderAndFooterHelper.TOP_MARGIN);
---
>         this.graphics.drawText (headerOrFooter, HeaderAndFooterHelper.LEFT_MARGIN + (width - getMapMode ().DPtoLP (gc_.textExtent (headerOrFooter).x)) / 2, HeaderAndFooterHelper.TOP_MARGIN);
192c204
<         this.graphics.drawText (headerOrFooter, HeaderAndFooterHelper.LEFT_MARGIN + (width - MapMode.DPtoLP (gc_.textExtent (headerOrFooter).x)) / 2, height - HeaderAndFooterHelper.BOTTOM_MARGIN);
---
>         this.graphics.drawText (headerOrFooter, HeaderAndFooterHelper.LEFT_MARGIN + (width - getMapMode ().DPtoLP (gc_.textExtent (headerOrFooter).x)) / 2, height - HeaderAndFooterHelper.BOTTOM_MARGIN);
269c281
<         return new MapModeGraphics (new PrinterGraphics (theGraphics, printer, true));
---
>         return new MapModeGraphics (new PrinterGraphics (theGraphics, printer, true), getMapMode ());
