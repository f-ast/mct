3c3
< import java.util.Collections;
---
> import org.eclipse.emf.ecore.ENamedElement;
5c5
< import java.util.List;
---
> import org.eclipse.emf.ecore.EStructuralFeature;
7c7
< import org.eclipse.gef.EditPart;
---
> import org.eclipse.gef.Request;
10a11,12
> import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
> 
13c15,17
< import org.eclipse.gmf.runtime.diagram.ui.editparts.TopGraphicEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
> 
> import org.eclipse.gmf.runtime.diagram.ui.requests.ChangeChildPropertyValueRequest;
36,43c40,41
<     protected List getTargetEdiParts (EditPart editpart) {
<         EditPart targetEP = null;
<         if (editpart instanceof TopGraphicEditPart) {
<             final TopGraphicEditPart topEP = (TopGraphicEditPart) editpart;
<             targetEP = (EditPart) MEditingDomainGetter.getMEditingDomain ((View) editpart.getModel ()).runAsRead (new MRunnable () {
< 
<                 public Object run () {
<                     return topEP.getChildBySemanticHint (getCompartmentSemanticHint ());
---
>     protected Request createTargetRequest () {
>         return new ChangeChildPropertyValueRequest (getPropertyName (), getPropertyId (), getCompartmentSemanticHint ());
45a44,45
>     protected String getCompartmentSemanticHint () {
>         return compartmentSemanticHint;
48c48,59
<             );
---
>     protected Object getPropertyValue (final IGraphicalEditPart editPart, final String thePropertyId) {
>         return MEditingDomainGetter.getMEditingDomain ((View) editPart.getModel ()).runAsRead (new MRunnable () {
> 
>             public Object run () {
>                 ENamedElement element = MetaModelUtil.getElement (thePropertyId);
>                 if (element instanceof EStructuralFeature) {
>                     View view = editPart.getNotationView ();
>                     if (view != null) {
>                         View childView = ViewUtil.getChildBySemanticHint (view, getCompartmentSemanticHint ());
>                         if (childView != null) {
>                             return ViewUtil.getStructuralFeatureValue (childView, (EStructuralFeature) element);
>                         }
50c61,62
<         return (targetEP == null) ? Collections.EMPTY_LIST : Collections.singletonList (targetEP);
---
>                 }
>                 return null;
53,54c65,67
<     protected String getCompartmentSemanticHint () {
<         return compartmentSemanticHint;
---
>         }
> 
>         );
