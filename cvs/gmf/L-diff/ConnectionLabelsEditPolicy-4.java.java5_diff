5c5
< import java.util.List;
---
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
13,14d12
< import org.eclipse.gef.commands.CompoundCommand;
< 
17c15,19
< import org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart;
---
> import org.eclipse.gmf.runtime.common.core.command.CompositeCommand;
> 
> import org.eclipse.gmf.runtime.diagram.core.commands.SetPropertyCommand;
> 
> import org.eclipse.gmf.runtime.diagram.ui.commands.ICommandProxy;
19c21,25
< import org.eclipse.gmf.runtime.diagram.ui.editparts.LabelEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.ConnectionEditPart;
> 
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
> 
> import org.eclipse.gmf.runtime.diagram.ui.editparts.ShapeNodeEditPart;
25,26d30
< import org.eclipse.gmf.runtime.diagram.ui.requests.ChangePropertyValueRequest;
< 
30a35,46
> import org.eclipse.gmf.runtime.emf.core.util.EObjectAdapter;
> 
> import org.eclipse.gmf.runtime.notation.LayoutConstraint;
> 
> import org.eclipse.gmf.runtime.notation.Location;
> 
> import org.eclipse.gmf.runtime.notation.Node;
> 
> import org.eclipse.gmf.runtime.notation.NotationPackage;
> 
> import org.eclipse.gmf.runtime.notation.View;
> 
40,42c56,60
<             CompoundCommand cc = new CompoundCommand ();
<             List children = getHost ().getChildren ();
<             Iterator iter = children.iterator ();
---
>             CompositeCommand cc = new CompositeCommand (DiagramUIMessages.Command_hideLabel_Label);
>             Object model = getHost ().getModel ();
>             if (model instanceof View) {
>                 View hostView = (View) model;
>                 Iterator iter = hostView.getChildren ().iterator ();
44,49c62,65
<                 GraphicalEditPart ep = (GraphicalEditPart) iter.next ();
<                 if (ep instanceof LabelEditPart) {
<                     ChangePropertyValueRequest req = new ChangePropertyValueRequest (DiagramUIMessages.Command_hideLabel_Label, Properties.ID_ISVISIBLE, Boolean.valueOf (showHide));
<                     Command setLabelVisCmd = ep.getCommand (req);
<                     if (setLabelVisCmd != null && setLabelVisCmd.canExecute ()) cc.add (setLabelVisCmd);
< 
---
>                     View childView = (View) iter.next ();
>                     if (isLabelView (getHost (), hostView, childView)) {
>                         cc.add (new SetPropertyCommand (getEditingDomain (), new EObjectAdapter (childView), Properties.ID_ISVISIBLE, DiagramUIMessages.Command_hideLabel_Label, Boolean.valueOf (showHide)));
>                     }
50a67
>                 return new ICommandProxy (cc);
52d68
<             return cc;
56a73,97
>     protected TransactionalEditingDomain getEditingDomain () {
>         return ((IGraphicalEditPart) getHost ()).getEditingDomain ();
>     }
> 
>     protected boolean isLabelView (EditPart containerEditPart, View parentView, View view) {
>         if ((containerEditPart instanceof ShapeNodeEditPart || containerEditPart instanceof ConnectionEditPart) && view instanceof Node) {
>             Node node = (Node) view;
>             String nodeType = node.getType ();
>             if (! isCompartment (node) && (nodeType != null && nodeType.length () > 0)) {
>                 LayoutConstraint lContraint = node.getLayoutConstraint ();
>                 if (lContraint instanceof Location) {
>                     return true;
>                 }
>             }
>         }
>         return false;
>     }
> 
>     protected boolean isCompartment (Node node) {
>         if (node.getStyle (NotationPackage.eINSTANCE.getDrawerStyle ()) != null) {
>             return true;
>         }
>         return false;
>     }
> 
