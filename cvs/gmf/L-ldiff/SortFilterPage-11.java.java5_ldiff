21,21c21,21
< import org.eclipse.gmf.runtime.diagram.ui.commands.CommandProxy;
---
> import org.eclipse.gef.commands.CompoundCommand;
23,23c23,23
< import org.eclipse.gmf.runtime.diagram.ui.commands.ICommandProxy;
---
> import org.eclipse.gef.commands.UnexecutableCommand;
41,42d40
< import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeTransactionalCommand;
< 
744a1028,1029
>     public Command getCommand () {
>         if (filterChanged || sortChanged) return getApplyCommand ();
745,746d1027
<     public boolean performOk () {
<         if (sortChanged || filterChanged) performApply ();
747a1031,1031
>         return null;
747,747c1030,1030
< 
---
> 
748,748d1030
<         return true;
749,749c1032,1032
<     }
---
>     }
750,750c1033,1033
< 
---
> 
752,752c751,751
<         if (pageType == CHILD_PAGE) {
---
>         if (pageType == CHILD_PAGE) {
757,757c786,786
<         } else if (pageType == ROOT_PAGE) {
---
>         } else if (pageType == ROOT_PAGE) {
758,758c787,787
<             PreferenceManager preferenceManager = ((SortFilterDialog) getContainer ()).getPreferenceManager ();
---
>             PreferenceManager preferenceManager = ((SortFilterDialog) getContainer ()).getPreferenceManager ();
759,759c788,788
<             Iterator nodes = preferenceManager.getElements (PreferenceManager.PRE_ORDER).iterator ();
---
>             Iterator nodes = preferenceManager.getElements (PreferenceManager.PRE_ORDER).iterator ();
760,760c789,789
<             SortFilterRootPreferenceNode rootNode = null;
---
>             SortFilterRootPreferenceNode rootNode = null;
760a790,790
>             CompoundCommand cc = new CompoundCommand (DiagramUIMessages.Command_SortFilterCommand);
761,761d789
<             CompositeTransactionalCommand cc = new CompositeTransactionalCommand (editPart.getEditingDomain (), DiagramUIMessages.Command_SortFilterCommand);
762,762c791,791
<             while (nodes.hasNext ()) {
---
>             while (nodes.hasNext ()) {
763,763c792,792
<                 PreferenceNode node = (PreferenceNode) nodes.next ();
---
>                 PreferenceNode node = (PreferenceNode) nodes.next ();
764,764c793,793
<                 SortFilterPage page = (SortFilterPage) node.getPage ();
---
>                 SortFilterPage page = (SortFilterPage) node.getPage ();
765,765c794,794
<                 if (page == this) {
---
>                 if (page == this) {
766,766c795,795
<                     rootNode = (SortFilterRootPreferenceNode) node;
---
>                     rootNode = (SortFilterRootPreferenceNode) node;
767,767c796,796
<                     continue;
---
>                     continue;
768,768c797,797
<                 }
---
>                 }
769,769c798,798
<                 ((SortFilterDialog) rootNode.getPreferenceDialog ()).showPage (node);
---
>                 ((SortFilterDialog) rootNode.getPreferenceDialog ()).showPage (node);
770,770c799,799
<                 if (compareFilters (page.getFilterList ())) {
---
>                 if (compareFilters (page.getFilterList ())) {
771,771c800,800
<                     page.setFilterCriteria (filters.getItems ());
---
>                     page.setFilterCriteria (filters.getItems ());
772,772c801,801
<                     page.setCriteria (filterList.getItems ());
---
>                     page.setCriteria (filterList.getItems ());
773,773c802,802
<                     page.filterItemsFromList ();
---
>                     page.filterItemsFromList ();
774a804,804
>                 cc.add (page.getApplyCommand ());
774,774c803,803
<                 }
---
>                 }
775,775d803
<                 cc.compose (new CommandProxy (page.getApplyCommand ()));
776a806,806
>             return cc;
776,776c805,805
<             }
---
>             }
777,777d805
<             editPart.getRoot ().getViewer ().getEditDomain ().getCommandStack ().execute (new ICommandProxy (cc));
778,778c807,807
<         }
---
>         }
779,779c808,808
< 
---
> 
779a809,809
>         return UnexecutableCommand.INSTANCE;
