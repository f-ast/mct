2a3,3
> import java.util.Iterator;
3,3c5,5
< import org.eclipse.emf.ecore.EAnnotation;
---
> import org.eclipse.emf.ecore.EAnnotation;
5,5d4
< import org.eclipse.emf.ecore.EObject;
11,11c11,11
< import org.eclipse.gef.commands.UnexecutableCommand;
---
> import org.eclipse.gmf.graphdef.editor.edit.commands.CompartmentAccessorCreateCommand;
11a12,13
> 
> import org.eclipse.gmf.graphdef.editor.edit.commands.CompartmentAccessorReorientCommand;
12a15,15
> import org.eclipse.gmf.graphdef.editor.edit.commands.DiagramElementFigureCreateCommand;
13a38,38
> 
13,13c37,37
< import org.eclipse.gmf.gmfgraph.DiagramElement;
---
> import org.eclipse.gmf.runtime.notation.Node;
16a19,22
> import org.eclipse.gmf.graphdef.editor.edit.parts.CompartmentAccessorEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.CompartmentVisualFacetsEditPart;
> 
18a25,26
> import org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry;
> 
33a44,50
>         CompoundCommand cc = getDestroyEdgesCommand ();
>         addDestroyChildNodesCommand (cc);
>         addDestroyShortcutsCommand (cc);
>         View view = (View) getHost ().getModel ();
>         if (view.getEAnnotation ("Shortcut") != null) {
>             req.setElementToDestroy (view);
>         }
34,34d43
<         CompoundCommand cc = getDestroyEdgesCommand (req.isConfirmationRequired ());
35a52,53
>         return cc.unwrap ();
>     }
35,35c51,51
<         cc.add (getMSLWrapper (new DestroyElementCommand (req) {
---
>         cc.add (getGEFWrapper (new DestroyElementCommand (req)));
36a55,55
>     protected void addDestroyChildNodesCommand (CompoundCommand cmd) {
37,37d54
<             protected EObject getElementToDestroy () {
41,41c59,59
<                     return view;
---
>             return;
42a61,72
>         for (Iterator it = view.getChildren ().iterator ();
>         it.hasNext ();) {
>             Node node = (Node) it.next ();
>             switch (GMFGraphVisualIDRegistry.getVisualID (node)) {
>                 case CompartmentVisualFacetsEditPart.VISUAL_ID :
>                     for (Iterator cit = node.getChildren ().iterator ();
>                     cit.hasNext ();) {
>                         Node cnode = (Node) cit.next ();
>                         switch (GMFGraphVisualIDRegistry.getVisualID (cnode)) {
>                         }
>                     }
>                     break;
43,43d60
<                 return super.getElementToDestroy ();
45,45d73
< 
47,49d74
< 
<         ));
<         return cc.unwrap ();
52a78,79
>         Command command = req.getTarget () == null ? getStartCreateRelationshipCommand (req) : getCompleteCreateRelationshipCommand (req);
>         return command != null ? command : super.getCreateRelationshipCommand (req);
52a92,94
>     protected Command getCompleteCreateRelationshipCommand (CreateRelationshipRequest req) {
>         if (GMFGraphElementTypes.CompartmentAccessor_4003 == req.getElementType ()) {
>             return null;
53,54d91
<         if (GMFGraphElementTypes.DiagramElementFigure_4001 == req.getElementType ()) {
<             return req.getTarget () == null ? getCreateStartOutgoingDiagramElementFigure_4001Command (req) : null;
55,55c95,95
<         }
---
>         }
55a96,99
>         if (GMFGraphElementTypes.DiagramElementFigure_4005 == req.getElementType ()) {
>             return null;
>         }
>         return null;
56,56d95
<         return super.getCreateRelationshipCommand (req);
59,59c82,82
<     protected Command getCreateStartOutgoingDiagramElementFigure_4001Command (CreateRelationshipRequest req) {
---
>     protected Command getStartCreateRelationshipCommand (CreateRelationshipRequest req) {
59a83,84
>         if (GMFGraphElementTypes.CompartmentAccessor_4003 == req.getElementType ()) {
>             return getGEFWrapper (new CompartmentAccessorCreateCommand (req, req.getSource (), req.getTarget ()));
60,62d82
<         EObject sourceEObject = req.getSource ();
<         if (false == sourceEObject instanceof DiagramElement) {
<             return UnexecutableCommand.INSTANCE;
63a86,87
>         if (GMFGraphElementTypes.DiagramElementFigure_4005 == req.getElementType ()) {
>             return getGEFWrapper (new DiagramElementFigureCreateCommand (req, req.getSource (), req.getTarget ()));
64,66d85
<         DiagramElement source = (DiagramElement) sourceEObject;
<         if (! GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001 (source, null)) {
<             return UnexecutableCommand.INSTANCE;
67a89,89
>         return null;
68,68d88
<         return new Command () {
71,71d91
<         ;
75a104,105
>             case CompartmentAccessorEditPart.VISUAL_ID :
>                 return getGEFWrapper (new CompartmentAccessorReorientCommand (req));
77,77c107,107
<                 return getMSLWrapper (new DiagramElementFigureReorientCommand (req));
---
>                 return getGEFWrapper (new DiagramElementFigureReorientCommand (req));
