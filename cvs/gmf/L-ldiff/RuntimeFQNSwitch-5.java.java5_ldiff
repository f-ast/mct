2a3,4
> import java.util.Arrays;
> 
9,16d10
< import org.eclipse.gmf.common.codegen.ImportAssistant;
< 
< import org.eclipse.gmf.gmfgraph.BorderLayout;
< 
< import org.eclipse.gmf.gmfgraph.CustomClass;
< 
< import org.eclipse.gmf.gmfgraph.Ellipse;
< 
19,19d12
< import org.eclipse.gmf.gmfgraph.FlowLayout;
27,28d12
< import org.eclipse.gmf.gmfgraph.LabeledContainer;
< 
29,29c13,13
< import org.eclipse.gmf.gmfgraph.Polygon;
---
> import org.eclipse.gmf.gmfgraph.GMFGraphPackage;
30,34d13
< 
< import org.eclipse.gmf.gmfgraph.PolygonDecoration;
< 
< import org.eclipse.gmf.gmfgraph.Polyline;
< 
36a23,23
> public class RuntimeFQNSwitch extends PureGEFFigureQualifiedNameSwitch {
37,49d22
< import org.eclipse.gmf.gmfgraph.PolylineDecoration;
< 
< import org.eclipse.gmf.gmfgraph.Rectangle;
< 
< import org.eclipse.gmf.gmfgraph.RoundedRectangle;
< 
< import org.eclipse.gmf.gmfgraph.StackLayout;
< 
< import org.eclipse.gmf.gmfgraph.XYLayout;
< 
< import org.eclipse.gmf.gmfgraph.XYLayoutData;
< 
< public class RuntimeFQNSwitch extends GMFGraphSwitch implements FigureQualifiedNameSwitch {
50a25,26
>     protected void collectDependencies (FigureGallery gallery, UniqueEList result) {
>         super.collectDependencies (gallery, result);
51,64d24
<     public String get (EObject gmfgraphObject) {
<         return (String) doSwitch (gmfgraphObject);
<     }
< 
<     public String get (EObject gmfgraphObject, ImportAssistant importManager) {
<         return importManager.getImportedName (get (gmfgraphObject));
<     }
< 
<     public String [] getDependencies (FigureGallery gallery) {
<         return (String []) caseFigureGallery (gallery);
<     }
< 
<     public Object caseFigureGallery (FigureGallery gallery) {
<         final String pluginBasicDraw2d = "org.eclipse.draw2d";
65a28,29
>         if (usesEClassWithID (gallery, new int [] {GMFGraphPackage.POLYLINE_CONNECTION, GMFGraphPackage.LABEL})) {
>             result.add (pluginRuntimeDraw2d);
66,71d27
<         UniqueEList rv = new UniqueEList ();
<         if (usesDraw2dFigures (gallery)) {
<             rv.add (pluginBasicDraw2d);
<         }
<         if (usesPolylineConnections (gallery)) {
<             rv.add (pluginRuntimeDraw2d);
73,76d30
<         if (gallery.getImplementationBundle () != null) {
<             rv.add (gallery.getImplementationBundle ());
<         }
<         return rv.toArray (new String [rv.size ()]);
79,79c33,33
<     private boolean usesPolylineConnections (FigureGallery gallery) {
---
>     private boolean usesEClassWithID (FigureGallery gallery, int [] ids) {
79a34,34
>         Arrays.sort (ids);
81a37,37
>             Object next = it.next ();
82,82c38,38
<             if (it.next () instanceof PolylineConnection) {
---
>             assert next instanceof EObject;
82a39,39
>             if (Arrays.binarySearch (ids, ((EObject) next).eClass ().getClassifierID ()) >= 0) {
89,96d45
<     private boolean usesDraw2dFigures (FigureGallery gallery) {
<         return ! gallery.getFigures ().isEmpty ();
<     }
< 
<     public Object caseCustomClass (CustomClass object) {
<         return object.getQualifiedClassName ();
<     }
< 
105,122d53
<     public Object caseFlowLayout (FlowLayout object) {
<         return object.isForceSingleLine () ? "org.eclipse.draw2d.ToolbarLayout" : "org.eclipse.draw2d.FlowLayout";
<     }
< 
<     public Object caseXYLayout (XYLayout object) {
<         return "org.eclipse.draw2d.XYLayout";
<     }
< 
<     public Object caseXYLayoutData (XYLayoutData object) {
<         return "org.eclipse.draw2d.geometry.Rectangle";
<     }
< 
<     public Object caseStackLayout (StackLayout object) {
<         return "org.eclipse.draw2d.StackLayout";
<     }
< 
<     public Object caseBorderLayout (BorderLayout object) {
<         return "org.eclipse.draw2d.BorderLayout";
125a59,59
>         return "org.eclipse.gmf.runtime.draw2d.ui.figures.WrapLabel";
126,160d53
<         return "org.eclipse.draw2d.Label";
<     }
< 
<     public Object caseLabeledContainer (LabeledContainer object) {
<         return "org.eclipse.draw2d.LabeledContainer";
<     }
< 
<     public Object caseRectangle (Rectangle object) {
<         return "org.eclipse.draw2d.RectangleFigure";
<     }
< 
<     public Object caseRoundedRectangle (RoundedRectangle object) {
<         return "org.eclipse.draw2d.RoundedRectangle";
<     }
< 
<     public Object caseEllipse (Ellipse object) {
<         return "org.eclipse.draw2d.Ellipse";
<     }
< 
<     public Object casePolygon (Polygon object) {
<         return "org.eclipse.draw2d.Polygon";
<     }
< 
<     public Object casePolygonDecoration (PolygonDecoration object) {
<         return "org.eclipse.draw2d.PolygonDecoration";
<     }
< 
<     public Object casePolyline (Polyline object) {
<         return "org.eclipse.draw2d.Polyline";
<     }
< 
<     public Object casePolylineDecoration (PolylineDecoration object) {
<         return "org.eclipse.draw2d.PolylineDecoration";
<     }
< 
161,161c54,54
<     public Object casePolylineConnection (PolylineConnection object) {
---
>     public Object casePolylineConnection (PolylineConnection object) {
162,162c55,55
<         return "org.eclipse.gmf.runtime.draw2d.ui.figures.PolylineConnectionEx";
---
>         return "org.eclipse.gmf.runtime.draw2d.ui.figures.PolylineConnectionEx";
