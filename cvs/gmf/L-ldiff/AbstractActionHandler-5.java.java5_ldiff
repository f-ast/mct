2a3,12
> import org.eclipse.core.commands.operations.IOperationHistory;
> 
> import org.eclipse.core.commands.operations.IOperationHistoryListener;
> 
> import org.eclipse.core.commands.operations.IUndoContext;
> 
> import org.eclipse.core.commands.operations.IUndoableOperation;
> 
> import org.eclipse.core.commands.operations.OperationHistoryEvent;
> 
34a63,63
> public abstract class AbstractActionHandler extends Action implements IDisposableAction, IActionWithProgress, ISelectionChangedListener, IOperationHistoryListener, IPropertyListener {
35,35c19,19
< import org.eclipse.gmf.runtime.common.core.command.CommandManager;
---
> import org.eclipse.gmf.runtime.common.core.command.CommandManager;
36,36c20,20
< 
---
> 
36a21,21
> import org.eclipse.gmf.runtime.common.core.util.Log;
37,37d20
< import org.eclipse.gmf.runtime.common.core.command.CommandManagerChangeEvent;
38a23,23
> import org.eclipse.gmf.runtime.common.core.util.StringStatics;
38,38c22,22
< 
---
> 
39,39d22
< import org.eclipse.gmf.runtime.common.core.command.ICommandManagerChangeListener;
40,40c24,24
< 
---
> 
40a25,25
> import org.eclipse.gmf.runtime.common.core.util.Trace;
41,41d24
< import org.eclipse.gmf.runtime.common.core.util.Log;
42a27,27
> import org.eclipse.gmf.runtime.common.ui.internal.CommonUIDebugOptions;
42,42c26,26
< 
---
> 
43,43d26
< import org.eclipse.gmf.runtime.common.core.util.StringStatics;
44,44c28,28
< 
---
> 
44a29,29
> import org.eclipse.gmf.runtime.common.ui.internal.CommonUIPlugin;
45,45d28
< import org.eclipse.gmf.runtime.common.core.util.Trace;
46,46c30,30
< 
---
> 
46a31,31
> import org.eclipse.gmf.runtime.common.ui.internal.CommonUIStatusCodes;
47,47d30
< import org.eclipse.gmf.runtime.common.ui.internal.CommonUIDebugOptions;
48,48c32,32
< 
---
> 
48a33,33
> import org.eclipse.gmf.runtime.common.ui.util.PartListenerAdapter;
49,49d32
< import org.eclipse.gmf.runtime.common.ui.internal.CommonUIPlugin;
50a35,35
> import org.eclipse.gmf.runtime.common.ui.util.StatusLineUtil;
50,50c34,34
< 
---
> 
51,51d34
< import org.eclipse.gmf.runtime.common.ui.internal.CommonUIStatusCodes;
52,52c36,36
< 
---
> 
53,57d36
< import org.eclipse.gmf.runtime.common.ui.util.PartListenerAdapter;
< 
< import org.eclipse.gmf.runtime.common.ui.util.StatusLineUtil;
< 
< public abstract class AbstractActionHandler extends Action implements IDisposableAction, IActionWithProgress, ISelectionChangedListener, ICommandManagerChangeListener, IPropertyListener {
131a138,139
>             if (isOperationHistoryListener ()) {
>                 getOperationHistory ().removeOperationHistoryListener (this);
132,133d137
<             if (isCommandStackListener ()) {
<                 getCommandManager ().removeCommandManagerChangeListener (this);
146a153,154
>             if (isOperationHistoryListener ()) {
>                 getOperationHistory ().addOperationHistoryListener (this);
147,148d152
<             if (isCommandStackListener ()) {
<                 getCommandManager ().addCommandManagerChangeListener (this);
166a173,177
>         return CommandManager.getDefault ();
>     }
> 
>     protected IOperationHistory getOperationHistory () {
>         return getActionManager ().getOperationHistory ();
167,167d172
<         return getActionManager ().getCommandManager ();
239a250,253
>     protected boolean isOperationHistoryListener () {
>         return false;
>     }
> 
264a279,283
>     public void historyNotification (OperationHistoryEvent event) {
>         IUndoableOperation operation = event.getOperation ();
>         if (operation != null) {
>             IUndoContext partContext = getUndoContext ();
>             if (partContext != null && operation.hasContext (partContext)) {
265,265d278
<     public final void commandManagerChanged (CommandManagerChangeEvent event) {
267a286,295
>         }
>     }
> 
>     protected IUndoContext getUndoContext () {
>         IWorkbenchPart part = getWorkbenchPart ();
>         if (part != null) {
>             return (IUndoContext) part.getAdapter (IUndoContext.class);
>         }
>         return null;
>     }
