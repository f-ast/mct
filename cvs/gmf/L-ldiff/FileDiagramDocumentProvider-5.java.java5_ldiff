29,29c55,55
< import org.eclipse.ui.IEditorInput;
---
> import org.eclipse.ui.IEditorInput;
30,30c56,56
< 
---
> 
31,31c57,57
< import org.eclipse.ui.IFileEditorInput;
---
> import org.eclipse.ui.IFileEditorInput;
32,32c58,58
< 
---
> 
34a31,32
> import org.eclipse.gmf.runtime.diagram.ui.resources.editor.document.DiagramModificationListener;
> 
58a61,61
>         DiagramModificationListener fListener;
60,60c63,63
<         public DiagramFileInfo (IDocument document, FileSynchronizer fileSynchronizer) {
---
>         public DiagramFileInfo (IDocument document, FileSynchronizer fileSynchronizer, DiagramModificationListener listener) {
61a65,65
>             fListener = listener;
72a77,77
>                 IDiagramDocument diagramDocument = (IDiagramDocument) event.getEventInfo ();
73,73c78,78
<                 Diagram newContent = (Diagram) event.getEventInfo ();
---
>                 Diagram newContent = diagramDocument.getDiagram ();
98a104,105
>             assert info instanceof DiagramFileInfo;
>             ((DiagramFileInfo) info).fListener.stopListening ();
155a163,164
>         assert document instanceof DiagramDocument;
>         DiagramModificationListener diagramListener = new FileDiagramModificationListener (this, (DiagramDocument) document, input);
155,155c162,162
<     protected FileInfo createFileInfo (IDocument document, FileSynchronizer synchronizer) {
---
>     protected FileInfo createFileInfo (IDocument document, FileSynchronizer synchronizer, IFileEditorInput input) {
156a166,167
>         diagramListener.startListening ();
>         return info;
156,156c165,165
<         return new DiagramFileInfo (document, synchronizer);
---
>         DiagramFileInfo info = new DiagramFileInfo (document, synchronizer, diagramListener);
