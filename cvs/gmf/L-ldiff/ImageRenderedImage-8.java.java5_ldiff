49,49c49,49
<             int newHeight = bufferWidth;
---
>             int newHeight = bufferHeight;
50a51,52
>                 double origAspectRatio = origHeight / (double) origWidth;
>                 if (origAspectRatio > newHeight / (double) newWidth) {
51,51d50
<                 if (newWidth > newHeight) {
52,52c53,53
<                     newHeight = (int) Math.round (newWidth * origHeight / (double) origWidth);
---
>                     newWidth = (int) Math.round (newHeight / origAspectRatio);
54,54c55,55
<                     newWidth = (int) Math.round (newHeight * origWidth / (double) origHeight);
---
>                     newHeight = (int) Math.round (newWidth * origAspectRatio);
