9,9c79,79
< import org.eclipse.draw2d.FigureUtilities;
---
> import org.eclipse.jface.viewers.ICellEditorValidator;
10,10d79
< 
17,18d14
< import org.eclipse.draw2d.geometry.Dimension;
< 
21,22d16
< import org.eclipse.draw2d.geometry.Rectangle;
< 
33,34d26
< import org.eclipse.gef.tools.CellEditorLocator;
< 
36a83,83
> import org.eclipse.swt.graphics.Color;
37,37d82
< import org.eclipse.jface.text.contentassist.IContentAssistProcessor;
38,38c84,84
< 
---
> 
39,48d84
< import org.eclipse.jface.viewers.CellEditor;
< 
< import org.eclipse.jface.viewers.ICellEditorValidator;
< 
< import org.eclipse.swt.SWT;
< 
< import org.eclipse.swt.accessibility.AccessibleEvent;
< 
< import org.eclipse.swt.graphics.Color;
< 
49,49c85,85
< import org.eclipse.swt.graphics.Image;
---
> import org.eclipse.swt.graphics.Image;
50,52d85
< 
< import org.eclipse.swt.widgets.Text;
< 
81,81c47,47
< import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
---
> import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
82,82c48,48
< 
---
> 
95,98d70
< import org.eclipse.gmf.runtime.gef.ui.parts.TextCellEditorEx;
< 
< import org.eclipse.gmf.runtime.gef.ui.parts.WrapTextCellEditor;
< 
104a77,77
> import org.eclipse.jface.text.contentassist.IContentAssistProcessor;
105,105c87,87
< public class TextCompartmentEditPart extends CompartmentEditPart {
---
> public class TextCompartmentEditPart extends CompartmentEditPart {
106,106d87
<     public class TextCellEditorLocator implements CellEditorLocator {
108,117d78
<         public void relocate (CellEditor celleditor) {
<             Text text = (Text) celleditor.getControl ();
<             Rectangle rect = getLabel ().getTextBounds ().getCopy ();
<             getLabel ().translateToAbsolute (rect);
<             if (getLabel ().isTextWrapped () && getLabel ().getText ().length () > 0) rect.setSize (new Dimension (text.computeSize (rect.width, SWT.DEFAULT)));
<             else {
<                 int avr = FigureUtilities.getFontMetrics (text.getFont ()).getAverageCharWidth ();
<                 rect.setSize (new Dimension (text.computeSize (SWT.DEFAULT, SWT.DEFAULT)).expand (avr * 2, 0));
<             }
<             if (! rect.equals (new Rectangle (text.getBounds ()))) text.setBounds (rect.x, rect.y, rect.width, rect.height);
118a81,81
> import org.eclipse.swt.accessibility.AccessibleEvent;
119,119d80
<         }
121,121d82
<     }
435,435c400,400
<         if (manager == null) setManager (new TextDirectEditManager (this, getLabel ().isTextWrapped () ? WrapTextCellEditor.class : TextCellEditorEx.class, new TextCellEditorLocator ()));
---
>         if (manager == null) setManager (new TextDirectEditManager (this));
