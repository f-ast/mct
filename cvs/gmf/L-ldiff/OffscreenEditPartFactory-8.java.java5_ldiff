8a9,10
> import org.eclipse.gmf.runtime.diagram.core.preferences.PreferencesHint;
> 
11,11c13,13
< import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramRootEditPart;
---
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IDiagramPreferenceSupport;
36a39,42
>         return createDiagramEditPart (diagram, new Shell (), null);
>     }
> 
>     public DiagramEditPart createDiagramEditPart (Diagram diagram, Shell shell, PreferencesHint preferencesHint) {
37,37d38
<         Shell shell = new Shell ();
43a49,54
>         if (rootEP instanceof IDiagramPreferenceSupport) {
>             if (preferencesHint == null) {
>                 preferencesHint = ((IDiagramPreferenceSupport) rootEP).getPreferencesHint ();
>             } else {
>                 ((IDiagramPreferenceSupport) rootEP).setPreferencesHint (preferencesHint);
>             }
43,43c48,48
<         RootEditPart rep = EditPartService.getInstance ().createRootEditPart (diagram);
---
>         RootEditPart rootEP = EditPartService.getInstance ().createRootEditPart (diagram);
44,45d48
<         if (rep instanceof DiagramRootEditPart) {
<             DiagramRootEditPart drep = (DiagramRootEditPart) rep;
46,46c55,55
<             IPreferenceStore fPreferences = (IPreferenceStore) drep.getPreferencesHint ().getPreferenceStore ();
---
>             customViewer.hookWorkspacePreferenceStore ((IPreferenceStore) preferencesHint.getPreferenceStore ());
47,47d55
<             customViewer.hookWorkspacePreferenceStore (fPreferences);
49,49c57,57
<         customViewer.setRootEditPart (rep);
---
>         customViewer.setRootEditPart (rootEP);
