138a139,142
> import org.eclipse.gmf.runtime.notation.Node;
> 
> import org.eclipse.gmf.runtime.notation.NotationFactory;
> 
160,160c164,164
<     private String elementGuid;
---
>     protected String elementGuid;
161a166,166
>     private static Node dummyNode = null;
162a168,169
>     public GraphicalEditPart (EObject model) {
>         setModel (model);
163,164d167
<     public GraphicalEditPart (View view) {
<         setModel (view);
172a178,181
>         EObject semanticProxy = null;
>         if (hasNotationView ()) semanticProxy = ((View) getModel ()).getElement ();
>         else semanticProxy = (EObject) basicGetModel ();
> 
173,173d177
<         EObject semanticProxy = ((View) getModel ()).getElement ();
174,174c182,182
<         EObject semanticElement = ProxyUtil.resolve (MEditingDomainGetter.getMEditingDomain ((View) getModel ()), semanticProxy);
---
>         EObject semanticElement = ProxyUtil.resolve (MEditingDomainGetter.getMEditingDomain ((EObject) getModel ()), semanticProxy);
199,201d206
<         if (listenerFilters == null) listenerFilters = new HashMap ();
< 
<         DiagramEventBroker.getInstance ().addNotificationListener (element, feature, listener);
242a248,251
>     final protected Object basicGetModel () {
>         return super.getModel ();
>     }
> 
244,244c253,253
<         Object model = getModel ();
---
>         Object model = basicGetModel ();
247a436,444
>                 Object model = getModel ();
>                 if (model instanceof View) return ViewUtil.resolveSemanticElement ((View) getModel ());
>                 else if (model instanceof EObject) {
>                     EObject element = (EObject) model;
>                     if (element.eIsProxy ()) return ProxyUtil.resolve (element);
>                     else return element;
> 
>                 }
> 
248,248d435
<         if (View.class.isAssignableFrom (key) && model instanceof View) {
249,249c445,445
<             return model;
---
>                 return null;
250a257,264
>         if (View.class.isAssignableFrom (key)) {
>             Object _model = getModel ();
>             if (_model instanceof View) return _model;
> 
>         }
>         if (model != null && EObject.class.isAssignableFrom (key)) {
>             EObject semanticObject = null;
>             if (hasNotationView ()) {
251,251d256
<         if (model != null && model instanceof View && EObject.class.isAssignableFrom (key)) {
252a266,270
>             } else {
>                 EObject element = (EObject) model;
>                 if (element.eIsProxy ()) {
>                     semanticObject = ProxyUtil.resolve (MEditingDomainGetter.getMEditingDomain (element), element);
>                 }
252,252c265,265
<             EObject semanticObject = ViewUtil.resolveSemanticElement ((View) model);
---
>                 semanticObject = ViewUtil.resolveSemanticElement ((View) model);
297,297c316,316
<             cmd = (Command) MEditingDomainGetter.getMEditingDomain ((View) getModel ()).runAsRead (new MRunnable () {
---
>             cmd = (Command) MEditingDomainGetter.getMEditingDomain ((EObject) getModel ()).runAsRead (new MRunnable () {
372,372c391,391
<         parent != null; parent = parent.getParent ()) if (parent instanceof IPrimaryEditPart) return (View) parent.getModel ();
---
>         parent != null; parent = parent.getParent ()) if (parent instanceof IPrimaryEditPart && parent.getModel () instanceof View) return (View) parent.getModel ();
408a428,429
>         else return null;
> 
408,408c427,427
<         return ViewUtil.getStructuralFeatureValue ((View) getModel (), feature);
---
>         if (hasNotationView ()) return ViewUtil.getStructuralFeatureValue ((View) getModel (), feature);
412,412c433,433
<         return (EObject) MEditingDomainGetter.getMEditingDomain ((View) getModel ()).runAsRead (new MRunnable () {
---
>         return (EObject) MEditingDomainGetter.getMEditingDomain ((EObject) getModel ()).runAsRead (new MRunnable () {
415,415d435
<                 return ViewUtil.resolveSemanticElement ((View) getModel ());
475,475c505,505
<         MEditingDomainGetter.getMEditingDomain ((View) getModel ()).runAsRead (new MRunnable () {
---
>         MEditingDomainGetter.getMEditingDomain ((EObject) getModel ()).runAsRead (new MRunnable () {
522a553,560
>         Object model = null;
>         EditPart ep = this;
>         while (! (model instanceof View) && ep != null) {
>             model = ep.getModel ();
>             ep = ep.getParent ();
>         }
>         if (model instanceof View) setVisibility (((View) model).isVisible ());
> 
523,523d552
<         setVisibility (((View) getModel ()).isVisible ());
562a600,600
> 
562,562c599,599
<         ViewUtil.setPropertyValue ((View) getModel (), id, value);
---
>         if (hasNotationView ()) ViewUtil.setPropertyValue ((View) getModel (), id, value);
566,566c604,604
<         ViewUtil.setStructuralFeatureValue ((View) getModel (), feature, value);
---
>         if (hasNotationView ()) ViewUtil.setStructuralFeatureValue ((View) getModel (), feature, value);
566a605,605
> 
577a617,617
> 
577,577c616,616
<         addListenerFilter ("View", this, (View) getModel ());
---
>         if (hasNotationView ()) addListenerFilter ("View", this, (View) getModel ());
610,610c650,650
<                 if (element instanceof EStructuralFeature && ViewUtil.isPropertySupported ((View) getModel (), prob)) local_properties.put (getAppearancePropertyIDs () [i], getStructuralFeatureValue ((EStructuralFeature) element));
---
>                 if (element instanceof EStructuralFeature && hasNotationView () && ViewUtil.isPropertySupported ((View) getModel (), prob)) local_properties.put (getAppearancePropertyIDs () [i], getStructuralFeatureValue ((EStructuralFeature) element));
613a654,654
> 
613,613c653,653
<             properties.put (((View) getModel ()).getType (), local_properties);
---
>             if (hasNotationView ()) properties.put (((View) getModel ()).getType (), local_properties);
683a725,725
>         if (hasNotationView ()) {
684a727,733
>         } else {
>             getViewer ().getEditPartRegistry ().put (basicGetModel (), this);
>         }
>         EObject ref = null;
>         if (hasNotationView ()) ref = getNotationView ().getElement ();
>         else ref = (EObject) basicGetModel ();
> 
685,685d726
<         EObject ref = ((View) getModel ()).getElement ();
838a887,903
>     public boolean hasNotationView () {
>         return true;
>     }
> 
>     public Object getModel () {
>         if (hasNotationView ()) {
>             return super.getModel ();
>         } else {
>             Object _model = basicGetModel ();
>             if (dummyNode == null) {
>                 dummyNode = NotationFactory.eINSTANCE.createNode ();
>             }
>             dummyNode.setElement ((EObject) _model);
>             return dummyNode;
>         }
>     }
> 
