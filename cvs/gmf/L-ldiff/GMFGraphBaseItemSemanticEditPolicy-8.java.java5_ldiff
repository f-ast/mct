16a17,18
> import org.eclipse.gmf.runtime.diagram.ui.commands.CommandProxy;
> 
58a61,62
> import org.eclipse.gmf.graphdef.editor.edit.helpers.GMFGraphBaseEditHelper;
> 
68a73,75
>         if (editHelperContext == null) {
>             editHelperContext = ViewUtil.resolveSemanticElement ((View) getHost ().getModel ());
>         }
73a86,86
>         Command ehCommand = null;
73a81,84
>         Command epCommand = getSemanticCommandSwitch (completedRequest);
>         if (epCommand != null) {
>             ICommand command = epCommand instanceof EtoolsProxyCommand ? ((EtoolsProxyCommand) epCommand).getICommand () : new CommandProxy (epCommand);
>             completedRequest.setParameter (GMFGraphBaseEditHelper.EDIT_POLICY_COMMAND, command);
74,74d85
<         Command semanticHelperCommand = null;
75,75c87,87
<         if (elementType != null) {
---
>         if (elementType != null) {
76,76c88,88
<             ICommand semanticCommand = elementType.getEditCommand (completedRequest);
---
>             ICommand command = elementType.getEditCommand (completedRequest);
77a90,91
>                 if (! (command instanceof CompositeTransactionalCommand)) {
>                     TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
77,77c89,89
<             if (semanticCommand != null) {
---
>             if (command != null) {
78,78c92,92
<                 semanticHelperCommand = new EtoolsProxyCommand (semanticCommand);
---
>                     command = new CompositeTransactionalCommand (editingDomain, null).compose (command);
79,79d92
<             }
81,86d85
<         Command semanticPolicyCommand = getSemanticCommandSwitch (completedRequest);
<         if (semanticPolicyCommand == null) {
<             if (semanticHelperCommand == null) {
<                 return null;
<             } else {
<                 semanticPolicyCommand = semanticHelperCommand;
87a94,94
>                 ehCommand = new EtoolsProxyCommand (command);
88,90d93
<         } else {
<             if (semanticHelperCommand != null) {
<                 semanticPolicyCommand = semanticPolicyCommand.chain (semanticHelperCommand);
98a103,103
>                 TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
99,99c104,104
<                 Command deleteViewCommand = new EtoolsProxyCommand (new DeleteCommand (((IGraphicalEditPart) getHost ()).getEditingDomain (), (View) getHost ().getModel ()));
---
>                 Command deleteViewCommand = new EtoolsProxyCommand (new DeleteCommand (editingDomain, (View) getHost ().getModel ()));
100,100c105,105
<                 semanticPolicyCommand = semanticPolicyCommand.chain (deleteViewCommand);
---
>                 ehCommand = ehCommand == null ? deleteViewCommand : ehCommand.chain (deleteViewCommand);
102,102c107,107
<             return semanticPolicyCommand;
---
>             return ehCommand;
180,182d184
<         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
<         CompositeTransactionalCommand modelCmd = new CompositeTransactionalCommand (editingDomain, cmd.getLabel ());
<         modelCmd.compose (cmd);
183,183c185,185
<         return new EtoolsProxyCommand (modelCmd);
---
>         return new EtoolsProxyCommand (cmd);
