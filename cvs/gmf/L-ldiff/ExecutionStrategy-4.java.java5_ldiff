9,10d8
< import java.util.Iterator;
< 
13,14d10
< import java.util.ListIterator;
< 
25,25c28,28
<             List results = Collections.EMPTY_LIST;
---
>             return Collections.EMPTY_LIST;
27,27c22,22
<             i < PRIORITIES.length; i ++) {
---
>             i < PRIORITIES.length; ++ i) {
27a23,24
>                 List providers = service.getProviders (this, PRIORITIES [i], operation);
>                 if (providers.size () != 0) {
28,29d22
<                 List targets = getProviders (service, this, PRIORITIES [i], operation);
<                 if (! targets.isEmpty ()) {
30,30c25,25
<                     results = Collections.singletonList (operation.execute ((IProvider) targets.get (0)));
---
>                     return Collections.singletonList (operation.execute ((IProvider) providers.get (0)));
31,31d25
<                     break;
34,34c140,140
<             return results;
---
>         return providers;
37a62,64
>             List descriptors = service.getProviders (priority);
>             for (int i = descriptors.size ();
>             -- i >= 0;) {
38,40d61
<             List providers = getProviders (service, priority);
<             for (ListIterator i = providers.listIterator ();
<             i.hasNext ();) {
41,41c65,65
<                 ProviderDescriptor descriptor = (ProviderDescriptor) i.next ();
---
>                 ProviderDescriptor descriptor = (ProviderDescriptor) descriptors.get (i);
55,55d49
<             List results = Collections.EMPTY_LIST;
56a51,52
>             -- i >= 0;) {
>                 List providers = service.getProviders (this, PRIORITIES [i], operation);
56,56c50,50
<             for (int i = PRIORITIES.length - 1;
---
>             for (int i = PRIORITIES.length;
57,58d50
<             i >= 0; i --) {
<                 List targets = getProviders (service, this, PRIORITIES [i], operation);
59,59c53,53
<                 int size = targets.size ();
---
>                 int size = providers.size ();
61,61c55,55
<                     results = Collections.singletonList (operation.execute ((IProvider) targets.get (size - 1)));
---
>                     return Collections.singletonList (operation.execute ((IProvider) providers.get (size - 1)));
62,62d55
<                     break;
64a58,58
>             return Collections.EMPTY_LIST;
65,65d57
<             return results;
68a130,134
>         List descriptors = service.getProviders (priority);
>         int size = descriptors.size ();
>         List providers = new ArrayList (size);
>         for (int i = 0;
>         i < size; ++ i) {
69,71d129
<             List providers = getProviders (service, priority);
<             for (ListIterator i = providers.listIterator (providers.size ());
<             i.hasPrevious ();) {
72,72c135,135
<                 ProviderDescriptor descriptor = (ProviderDescriptor) i.previous ();
---
>             ProviderDescriptor descriptor = (ProviderDescriptor) descriptors.get (i);
88,88c81,81
<             i < PRIORITIES.length; i ++) {
---
>             i < PRIORITIES.length; ++ i) {
89,89c82,82
<                 List targets = getProviders (service, this, PRIORITIES [i], operation);
---
>                 List providers = service.getProviders (this, PRIORITIES [i], operation);
89a83,83
>                 int size = providers.size ();
90a85,85
>                 j < size; ++ j) {
91,91d84
<                 j < targets.size (); j ++) {
92,92c86,86
<                     results.add (operation.execute ((IProvider) targets.get (j)));
---
>                     results.add (operation.execute ((IProvider) providers.get (j)));
104a99,103
>             for (int i = PRIORITIES.length;
>             -- i >= 0;) {
>                 List providers = service.getProviders (this, PRIORITIES [i], operation);
>                 for (int j = providers.size ();
>                 -- j >= 0;) {
105,109d98
<             for (int i = PRIORITIES.length - 1;
<             i >= 0; i --) {
<                 List targets = getProviders (service, this, PRIORITIES [i], operation);
<                 for (int j = targets.size () - 1;
<                 j >= 0; j --) {
110,110c104,104
<                     results.add (operation.execute ((IProvider) targets.get (j)));
---
>                     results.add (operation.execute ((IProvider) providers.get (j)));
135a32,35
>             List descriptors = service.getProviders (priority);
>             int size = descriptors.size ();
>             for (int i = 0;
>             i < size; ++ i) {
136,138d31
<         List targets = new ArrayList ();
<         for (Iterator i = getProviders (service, priority).iterator ();
<         i.hasNext ();) {
139,139c36,36
<             ProviderDescriptor descriptor = (ProviderDescriptor) i.next ();
---
>                 ProviderDescriptor descriptor = (ProviderDescriptor) descriptors.get (i);
141,141c137,137
<                 targets.add (descriptor.getProvider ());
---
>                 providers.add (descriptor.getProvider ());
144,144d139
<         return targets;
