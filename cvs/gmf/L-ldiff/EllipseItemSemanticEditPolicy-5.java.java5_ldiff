2a3,3
> import java.util.ArrayList;
3,3c15,15
< import org.eclipse.gef.commands.Command;
---
> import org.eclipse.gef.commands.Command;
4a5,5
> import java.util.Collection;
4a39,40
> import org.eclipse.gmf.runtime.diagram.ui.requests.EditCommandRequestWrapper;
> 
5,5c41,41
< import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
---
> import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
6a7,7
> import java.util.Collections;
7,7c47,47
< import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
7a48,50
> 
> import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
> 
8a9,9
> import java.util.Iterator;
9a24,24
> 
9,9c23,23
< import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
---
> import org.eclipse.gmf.gmfgraph.FigureHandle;
13,13c13,13
< import org.eclipse.emf.ecore.EAnnotation;
---
> import org.eclipse.gef.EditPart;
14a53,54
> import org.eclipse.gmf.runtime.notation.Edge;
> 
15a56,56
> 
15,15c55,55
< import org.eclipse.gmf.runtime.notation.View;
---
> import org.eclipse.gmf.runtime.notation.View;
17,17c17,17
< import org.eclipse.emf.ecore.EClass;
---
> import org.eclipse.gef.commands.CompoundCommand;
26a27,30
> import org.eclipse.gmf.graphdef.editor.edit.commands.EllipseCreateCommand;
> 
> import org.eclipse.gmf.graphdef.editor.edit.commands.PolylineCreateCommand;
> 
27,27c31,31
< import org.eclipse.gmf.runtime.emf.type.core.commands.CreateElementCommand;
---
> import org.eclipse.gmf.graphdef.editor.edit.commands.Rectangle2CreateCommand;
27a32,36
> 
> import org.eclipse.gmf.graphdef.editor.edit.commands.RoundedRectangleCreateCommand;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.EllipseEditPart;
> 
42,42c64,64
<             return getMSLWrapper (new CreateRectangle_3002Command (req));
---
>             return getMSLWrapper (new Rectangle2CreateCommand (req));
48,48c70,70
<             return getMSLWrapper (new CreateEllipse_3003Command (req));
---
>             return getMSLWrapper (new EllipseCreateCommand (req));
54,54c76,76
<             return getMSLWrapper (new CreateRoundedRectangle_3004Command (req));
---
>             return getMSLWrapper (new RoundedRectangleCreateCommand (req));
60,60c82,82
<             return getMSLWrapper (new CreatePolyline_3005Command (req));
---
>             return getMSLWrapper (new PolylineCreateCommand (req));
65,152d86
<     private static class CreateRectangle_3002Command extends CreateElementCommand {
< 
<         public CreateRectangle_3002Command (CreateElementRequest req) {
<             super (req);
<         }
< 
<         protected EClass getEClassToEdit () {
<             return GMFGraphPackage.eINSTANCE.getEllipse ();
<         }
< 
<         ;
< 
<         protected EObject getElementToEdit () {
<             EObject container = ((CreateElementRequest) getRequest ()).getContainer ();
<             if (container instanceof View) {
<                 container = ((View) container).getElement ();
<             }
<             return container;
<         }
< 
<     }
< 
<     private static class CreateEllipse_3003Command extends CreateElementCommand {
< 
<         public CreateEllipse_3003Command (CreateElementRequest req) {
<             super (req);
<         }
< 
<         protected EClass getEClassToEdit () {
<             return GMFGraphPackage.eINSTANCE.getEllipse ();
<         }
< 
<         ;
< 
<         protected EObject getElementToEdit () {
<             EObject container = ((CreateElementRequest) getRequest ()).getContainer ();
<             if (container instanceof View) {
<                 container = ((View) container).getElement ();
<             }
<             return container;
<         }
< 
<     }
< 
<     private static class CreateRoundedRectangle_3004Command extends CreateElementCommand {
< 
<         public CreateRoundedRectangle_3004Command (CreateElementRequest req) {
<             super (req);
<         }
< 
<         protected EClass getEClassToEdit () {
<             return GMFGraphPackage.eINSTANCE.getEllipse ();
<         }
< 
<         ;
< 
<         protected EObject getElementToEdit () {
<             EObject container = ((CreateElementRequest) getRequest ()).getContainer ();
<             if (container instanceof View) {
<                 container = ((View) container).getElement ();
<             }
<             return container;
<         }
< 
<     }
< 
<     private static class CreatePolyline_3005Command extends CreateElementCommand {
< 
<         public CreatePolyline_3005Command (CreateElementRequest req) {
<             super (req);
<         }
< 
<         protected EClass getEClassToEdit () {
<             return GMFGraphPackage.eINSTANCE.getEllipse ();
<         }
< 
<         ;
< 
<         protected EObject getElementToEdit () {
<             EObject container = ((CreateElementRequest) getRequest ()).getContainer ();
<             if (container instanceof View) {
<                 container = ((View) container).getElement ();
<             }
<             return container;
<         }
< 
<     }
< 
153a88,89
>         CompoundCommand cc = new CompoundCommand ();
>         Collection allEdges = new ArrayList ();
154a101,101
>         return cc;
154,154c100,100
<         return getMSLWrapper (new DestroyElementCommand (req) {
---
>         cc.add (getMSLWrapper (new DestroyElementCommand (req)));
155,156d100
< 
<             protected EObject getElementToDestroy () {
157a91,98
>         allEdges.addAll (view.getSourceEdges ());
>         allEdges.addAll (view.getTargetEdges ());
>         for (Iterator it = allEdges.iterator ();
>         it.hasNext ();) {
>             Edge nextEdge = (Edge) it.next ();
>             EditPart nextEditPart = (EditPart) getHost ().getViewer ().getEditPartRegistry ().get (nextEdge);
>             EditCommandRequestWrapper editCommandRequest = new EditCommandRequestWrapper (new DestroyElementRequest (((EllipseEditPart) getHost ()).getEditingDomain (), req.isConfirmationRequired ()), Collections.EMPTY_MAP);
>             cc.add (nextEditPart.getCommand (editCommandRequest));
158,160d90
<                 EAnnotation annotation = view.getEAnnotation ("Shortcut");
<                 if (annotation != null) {
<                     return view;
162,167d99
<                 return super.getElementToDestroy ();
<             }
< 
<         }
< 
<         );
172,172c106,106
<             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElement_Figure4001Command (req);
---
>             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElementFigure_4001Command (req);
177a112,113
>         EObject sourceEObject = req.getSource ();
>         EObject targetEObject = req.getTarget ();
177,177c111,111
<     protected Command getCreateCompleteIncomingDiagramElement_Figure4001Command (CreateRelationshipRequest req) {
---
>     protected Command getCreateCompleteIncomingDiagramElementFigure_4001Command (CreateRelationshipRequest req) {
178,178c114,114
<         if (! (req.getSource () instanceof DiagramElement)) {
---
>         if (false == sourceEObject instanceof DiagramElement || false == targetEObject instanceof FigureHandle) {
180a117,119
>         DiagramElement source = (DiagramElement) sourceEObject;
>         FigureHandle target = (FigureHandle) targetEObject;
>         if (! GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001 (source, target)) {
181,182d116
<         DiagramElement element = (DiagramElement) req.getSource ();
<         if (element.getFigure () != null) {
185,185c122,122
<         SetRequest setReq = new SetRequest (req.getSource (), GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), req.getTarget ());
---
>         SetRequest setReq = new SetRequest (sourceEObject, GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), target);
