40,40d39
<     protected final FigureQualifiedNameSwitch myFigureNameSwitch;
56a56,58
>         public MapModeCodeGenStrategy getMapMode ();
> 
>         public String getRuntimeToken ();
57,57d55
<         public boolean needsMapMode ();
68,68c69,69
<         private final boolean myNeedsMapMode;
---
>         private final MapModeCodeGenStrategy myMapMode;
68a70,70
>         private final String myRuntimeToken;
71,71c73,73
<             this (pluginId, mainPackageName, true);
---
>             this (pluginId, mainPackageName, MapModeCodeGenStrategy.DYNAMIC, null);
73a76,76
>         public ConfigImpl (String pluginId, String mainPackageName, MapModeCodeGenStrategy mapMode, String runtimeToken) {
74,74d75
<         public ConfigImpl (String pluginId, String mainPackageName, boolean useMapMode) {
75,75c77,77
<             this (pluginId, mainPackageName, pluginId, "", "PluginActivator", (mainPackageName == null ? "" : mainPackageName + ".") + "activator", useMapMode);
---
>             this (pluginId, mainPackageName, pluginId, "", "PluginActivator", (mainPackageName == null ? "" : mainPackageName + ".") + "activator", mapMode, null);
78,78c80,80
<         public ConfigImpl (String pluginId, String mainPackageName, String pluginFriendlyName, String pluginProviderName, String pluginActivatorClassName, String pluginActivatorPackageName, boolean needsMapMode) {
---
>         public ConfigImpl (String pluginId, String mainPackageName, String pluginFriendlyName, String pluginProviderName, String pluginActivatorClassName, String pluginActivatorPackageName, MapModeCodeGenStrategy mapMode, String runtimeToken) {
84a87,88
>             myMapMode = mapMode;
>             myRuntimeToken = runtimeToken;
85,85d86
<             myNeedsMapMode = needsMapMode;
111a115,120
>         public MapModeCodeGenStrategy getMapMode () {
>             return myMapMode;
>         }
> 
>         public String getRuntimeToken () {
>             return myRuntimeToken;
112,113d114
<         public boolean needsMapMode () {
<             return myNeedsMapMode;
133a141,141
>     public StandaloneGenerator (Processor p, Config config) {
134,134d140
<     public StandaloneGenerator (Processor p, Config config, FigureQualifiedNameSwitch fqnSwitch) {
135,135c142,142
<         this (p, config, fqnSwitch, null);
---
>         this (p, config, null);
138,138c145,145
<     public StandaloneGenerator (Processor p, Config config, FigureQualifiedNameSwitch fqnSwitch, URL [] dynamicTemplates) {
---
>     public StandaloneGenerator (Processor p, Config config, URL [] dynamicTemplates) {
139,139c146,146
<         assert p != null && config != null && fqnSwitch != null;
---
>         assert p != null && config != null;
142,142d148
<         myFigureNameSwitch = fqnSwitch;
144,144c150,150
<         MapModeCodeGenStrategy strategy;
---
>         final MapModeCodeGenStrategy strategy;
146,146c152,152
<         if (config.needsMapMode ()) {
---
>         if (config.getMapMode () == MapModeCodeGenStrategy.DYNAMIC) {
150,150c156,156
<             strategy = MapModeCodeGenStrategy.STATIC;
---
>             strategy = config.getMapMode () == null ? MapModeCodeGenStrategy.STATIC : config.getMapMode ();
153,153c159,159
<         myFigureGenerator = new FigureGenerator (fqnSwitch, strategy, accessor, false, dynamicTemplates);
---
>         myFigureGenerator = new FigureGenerator (config.getRuntimeToken (), strategy, accessor, false, dynamicTemplates);
189,189c195,195
<         doGenerateFile (myAuxiliaryGenerators.getManifestMFEmitter (), new Path ("META-INF/MANIFEST.MF"), myArgs, myProcessor.getRequiredBundles (myFigureNameSwitch));
---
>         doGenerateFile (myAuxiliaryGenerators.getManifestMFEmitter (), new Path ("META-INF/MANIFEST.MF"), myArgs, myProcessor.getRequiredBundles (null));
