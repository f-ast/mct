6a9,13
> import org.eclipse.gmf.internal.bridge.ui.dashboard.Plugin;
> 
> import org.osgi.service.prefs.BackingStoreException;
> 
> import org.osgi.service.prefs.Preferences;
7,7c5,5
< import org.eclipse.ui.IMemento;
---
> import org.eclipse.core.runtime.IStatus;
7a6,6
> 
21a28,28
>     private Preferences prefs;
26,29d32
<     public DashboardState (IMemento memento) {
<         if (memento != null) {
<             read (memento);
<         }
57a69,69
>         write (DM_KEY, dm);
61a74,74
>         write (DGM_KEY, dgm);
65a79,79
>         write (GDM_KEY, gdm);
69a84,84
>         write (TDM_KEY, tdm);
73a89,89
>         write (MM_KEY, mm);
77a94,94
>         write (GM_KEY, gm);
81a99,99
>         write (DM_KEY, dm);
85a104,104
>         write (DGM_KEY, dgm);
89a109,109
>         write (GDM_KEY, gdm);
93a114,114
>         write (TDM_KEY, tdm);
97a119,119
>         write (MM_KEY, mm);
101a124,124
>         write (GM_KEY, gm);
137a33,35
>     public DashboardState (Preferences prefs) {
>         this.prefs = prefs;
>         dm = read (DM_KEY);
137a161,163
>     private URI read (String key) {
>         if (prefs == null) {
>             return null;
138,139d32
<     private void read (IMemento memento) {
<         dm = read (memento, DM_KEY);
140,140c36,36
<         dgm = read (memento, DGM_KEY);
---
>         dgm = read (DGM_KEY);
141,141c37,37
<         gdm = read (memento, GDM_KEY);
---
>         gdm = read (GDM_KEY);
142,142c38,38
<         tdm = read (memento, TDM_KEY);
---
>         tdm = read (TDM_KEY);
143,143c39,39
<         mm = read (memento, MM_KEY);
---
>         mm = read (MM_KEY);
144,144c40,40
<         gm = read (memento, GM_KEY);
---
>         gm = read (GM_KEY);
145a165,165
>         String s = prefs.get (key, null);
146,148d164
< 
<     private static URI read (IMemento memento, String key) {
<         String s = memento.getString (key);
154a172,173
>             IStatus status = Plugin.createError ("Invalid URI", e);
>             Plugin.getDefault ().getLog ().log (status);
159,167d177
<     public void write (IMemento memento) {
<         write (memento, DM_KEY, dm);
<         write (memento, DGM_KEY, dgm);
<         write (memento, GDM_KEY, gdm);
<         write (memento, TDM_KEY, tdm);
<         write (memento, MM_KEY, mm);
<         write (memento, GM_KEY, gm);
<     }
< 
168,168c178,178
<     private static void write (IMemento memento, String key, URI uri) {
---
>     private void write (String key, URI uri) {
172a183,189
>         prefs.put (key, s);
>         try {
>             prefs.flush ();
>         } catch (BackingStoreException e) {
>             IStatus status = Plugin.createError ("Unable to update state", e);
>             Plugin.getDefault ().getLog ().log (status);
>         }
173,173d182
<         memento.putString (key, s);
