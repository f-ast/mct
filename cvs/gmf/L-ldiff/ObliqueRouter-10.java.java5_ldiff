24a25,26
> import org.eclipse.gmf.runtime.draw2d.ui.figures.IPolygonAnchorableFigure;
> 
28a31,32
> import org.eclipse.gmf.runtime.draw2d.ui.geometry.PointListUtilities;
> 
35,36d38
< import org.eclipse.jface.util.Assert;
< 
176a185,185
>         return points;
176a170,170
>         PointList points = calculateBendPoints (conn);
177,177c171,171
<         routeLine (conn, 0, points);
---
>         routeLine (conn, 0, points);
178a173,175
>     }
> 
>     protected PointList calculateBendPoints (Connection conn) {
178,178c172,172
<         conn.setPoints (points);
---
>         conn.setPoints (points);
195a203,203
>         PointList startPolygon = null;
196,196d202
<         Rectangle startRect = null;
197a205,205
>             startPolygon = getFigurePolygon (sourceOwner, conn);
198,200d204
<             startRect = new Rectangle (sourceOwner.getBounds ());
<             sourceOwner.translateToAbsolute (startRect);
<             conn.translateToRelative (startRect);
201a207,207
>         PointList endPolygon = null;
202,202d206
<         Rectangle endRect = null;
203a209,209
>             endPolygon = getFigurePolygon (targetOwner, conn);
204,206d208
<             endRect = new Rectangle (targetOwner.getBounds ());
<             targetOwner.translateToAbsolute (endRect);
<             conn.translateToRelative (endRect);
212a216,216
>             else if ((startPolygon == null || ! PointListUtilities.containsPoint (startPolygon, pt)) && (endPolygon == null || ! PointListUtilities.containsPoint (endPolygon, pt))) {
213,213d215
<             else if ((startRect == null || ! startRect.contains (pt)) && (endRect == null || ! endRect.contains (pt))) {
228a232,255
>     protected PointList getFigurePolygon (IFigure owner, Connection conn) {
>         PointList polygon = new PointList ();
>         if (owner instanceof IPolygonAnchorableFigure) {
>             PointList points = ((IPolygonAnchorableFigure) owner).getPolygonPoints ();
>             for (int index = 0;
>             index < points.size (); index ++) {
>                 Point point = points.getPoint (index).getCopy ();
>                 owner.translateToAbsolute (point);
>                 conn.translateToRelative (point);
>                 polygon.addPoint (point);
>             }
>         } else {
>             Rectangle rect = owner.getBounds ().getCopy ();
>             owner.translateToAbsolute (rect);
>             conn.translateToRelative (rect);
>             polygon.addPoint (rect.getTopLeft ());
>             polygon.addPoint (rect.getTopRight ());
>             polygon.addPoint (rect.getBottomRight ());
>             polygon.addPoint (rect.getBottomLeft ());
>             polygon.addPoint (rect.getTopLeft ());
>         }
>         return polygon;
>     }
> 
288,288c315,315
<             Assert.isTrue (nIndex >= 0);
---
>             assert nIndex >= 0;
