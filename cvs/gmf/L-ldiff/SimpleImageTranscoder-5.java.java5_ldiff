2a3,4
> import java.awt.geom.Rectangle2D;
> 
10a13,14
> import org.apache.batik.transcoder.TranscoderInput;
> 
18a23,59
>     private Document document;
>     private int canvasWidth = - 1, canvasHeight = - 1;
>     private Rectangle2D canvasAOI;
> 
>     public SimpleImageTranscoder (Document document) {
>         this.document = document;
>     }
> 
>     public final Document getDocument () {
>         return document;
>     }
> 
>     public final int getCanvasWidth () {
>         return canvasWidth;
>     }
> 
>     public final int getCanvasHeight () {
>         return canvasHeight;
>     }
> 
>     public void setCanvasSize (int width, int height) {
>         if (this.canvasWidth == width && this.canvasHeight == height) {
>             return;
>         }
>         this.canvasWidth = width;
>         this.canvasHeight = height;
>         contentChanged ();
>     }
> 
>     public final Rectangle2D getCanvasAreaOfInterest () {
>         if (canvasAOI == null) {
>             return null;
>         }
>         Rectangle2D result = new Rectangle2D.Float ();
>         result.setRect (canvasAOI);
>         return result;
>     }
19a61,82
>     public void setCanvasAreaOfInterest (Rectangle2D value) {
>         if (value == null) {
>             if (canvasAOI == null) {
>                 return;
>             }
>             canvasAOI = null;
>             contentChanged ();
>             return;
>         }
>         if (value.equals (canvasAOI)) {
>             return;
>         }
>         canvasAOI = new Rectangle2D.Float ();
>         canvasAOI.setRect (value);
>         contentChanged ();
>     }
> 
>     public BridgeContext initCSSEngine () {
>         if (this.document == null) {
>             return null;
>         }
>         SVGOMDocument sd = (SVGOMDocument) this.document;
20,21d60
<     public BridgeContext initCSSEngine (final Document d) {
<         SVGOMDocument sd = (SVGOMDocument) d;
28a90,90
>                 BridgeContextEx.this.setDocument (SimpleImageTranscoder.this.document);
29,29d89
<                 BridgeContextEx.this.setDocument (d);
30,30c91,91
<                 BridgeContextEx.this.initializeDocument (d);
---
>                 BridgeContextEx.this.initializeDocument (SimpleImageTranscoder.this.document);
37a99,132
>     public void contentChanged () {
>         bufferedImage = null;
>     }
> 
>     private void updateImage () {
>         if (document == null) {
>             return;
>         }
>         try {
>             if (canvasWidth >= 0) {
>                 addTranscodingHint (ImageTranscoder.KEY_WIDTH, new Float (canvasWidth));
>             } else {
>                 removeTranscodingHint (ImageTranscoder.KEY_WIDTH);
>             }
>             if (canvasHeight >= 0) {
>                 addTranscodingHint (ImageTranscoder.KEY_HEIGHT, new Float (canvasHeight));
>             } else {
>                 removeTranscodingHint (ImageTranscoder.KEY_HEIGHT);
>             }
>             if (canvasAOI != null) {
>                 addTranscodingHint (ImageTranscoder.KEY_AOI, canvasAOI);
>             } else {
>                 removeTranscodingHint (ImageTranscoder.KEY_AOI);
>             }
>             transcode (new TranscoderInput (document), new TranscoderOutput ());
>         } catch (TranscoderException e) {
>             Activator.logError ("Error transcoding SVG image", e);
>         }
>     }
> 
>     public final BufferedImage getBufferedImage () {
>         if (bufferedImage == null) {
>             updateImage ();
>         }
38,38d98
<     public BufferedImage getBufferedImage () {
43,43c137,137
<     public BufferedImage createImage (int width, int height) {
---
>     public final BufferedImage createImage (int width, int height) {
48,48c142,142
<     public void writeImage (BufferedImage img, TranscoderOutput output) throws TranscoderException {
---
>     public final void writeImage (BufferedImage img, TranscoderOutput output) throws TranscoderException {
