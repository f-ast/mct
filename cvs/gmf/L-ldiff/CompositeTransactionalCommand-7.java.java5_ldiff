122a123,124
>             case 0 :
>                 return this;
125,125c127,127
<                 if (child instanceof ICommand && (child instanceof CompositeEMFOperation || child instanceof AbstractEMFOperation)) {
---
>                 if (child instanceof ICommand && child instanceof AbstractEMFOperation) {
127a130,139
>             default :
>                 if (! isTransactionNestingEnabled ()) {
>                     List children = getChildren ();
>                     IUndoableOperation [] opChildren = (IUndoableOperation []) children.toArray (new IUndoableOperation [children.size ()]);
>                     children.clear ();
>                     for (int i = 0;
>                     i < opChildren.length; ++ i) {
>                         doReduce (opChildren [i], children);
>                     }
>                 }
131a144,154
>     private void doReduce (IUndoableOperation operation, List children) {
>         if (operation instanceof CompositeEMFOperation) {
>             for (Iterator i = ((CompositeEMFOperation) operation).iterator ();
>             i.hasNext ();) {
>                 doReduce ((IUndoableOperation) i.next (), children);
>             }
>         } else {
>             children.add (operation);
>         }
>     }
> 
