5,6d4
< import java.util.Enumeration;
< 
10a9,10
> import org.eclipse.gmf.gmfgraph.ConnectionFigure;
> 
12a13,14
> import org.eclipse.gmf.gmfgraph.DecorationFigure;
> 
14a17,18
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
> 
23a28,28
>     private final Map < FigureDescriptor, String > myFigure2FQN = new IdentityHashMap < FigureDescriptor, String > ();
24,24d27
<     private final GenerationInfoImpl myGenerationInfo;
29,29d32
<         myGenerationInfo = new GenerationInfoImpl ();
40a44,47
>         for (FigureDescriptor fd : myFigure2FQN.keySet ()) {
>             Figure nextOriginal = fd.getActualFigure ();
>             String nextConvertedFqn = myFigure2FQN.get (fd);
>             CustomFigure custom = createCustomFigure (nextOriginal);
41,45d43
<         for (Enumeration < Figure > originalFigures = myGenerationInfo.getProcessedFigures ();
<         originalFigures.hasMoreElements ();) {
<             Figure nextOriginal = originalFigures.nextElement ();
<             String nextConvertedFqn = myGenerationInfo.getGeneratedClassFQN (nextOriginal);
<             CustomFigure custom = DiagramElementsCopier.createCustomFigure (nextOriginal);
46,46c48,48
<             custom.setName (nextOriginal.getName ());
---
>             custom.setName (fd.getName ());
47,47d48
<             custom.setBundleName (myGeneratedBundle);
53a55,56
>     public Map < FigureDescriptor, String > getGenerationInfo () {
>         return Collections.unmodifiableMap (myFigure2FQN);
54,73d54
<     public GenerationInfo getGenerationInfo () {
<         return myGenerationInfo;
<     }
< 
<     protected void handle (Figure next, String fqn) {
<         myGenerationInfo.registerFQN (next, fqn);
<     }
< 
<     public interface GenerationInfo {
< 
<         public Enumeration < Figure > getProcessedFigures ();
< 
<         public String getGeneratedClassFQN (Figure figure);
< 
<     }
< 
<     private static class GenerationInfoImpl implements GenerationInfo {
<         private final Map < Figure, String > myFigure2FQN = new IdentityHashMap < Figure, String > ();
< 
<         public GenerationInfoImpl () {
75a59,59
>     protected void handle (FigureDescriptor next, String fqn) {
76,76d58
<         public void registerFQN (Figure figure, String fqn) {
77,77c60,60
<             myFigure2FQN.put (figure, fqn);
---
>         myFigure2FQN.put (next, fqn);
79a63,66
>     static CustomFigure createCustomFigure (Figure original) {
>         GMFGraphFactory factory = GMFGraphFactory.eINSTANCE;
>         if (original instanceof DecorationFigure) {
>             return factory.createCustomDecoration ();
80,81d62
<         public String getGeneratedClassFQN (Figure figure) {
<             return myFigure2FQN.get (figure);
82a68,69
>         if (original instanceof ConnectionFigure) {
>             return factory.createCustomConnection ();
83,85d67
< 
<         public Enumeration < Figure > getProcessedFigures () {
<             return Collections.enumeration (myFigure2FQN.keySet ());
86a71,71
>         return factory.createCustomFigure ();
87,87d70
< 
