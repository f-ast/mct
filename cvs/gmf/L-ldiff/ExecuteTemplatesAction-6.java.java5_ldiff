12a13,14
> import org.eclipse.emf.common.util.BasicDiagnostic;
> 
20a23,24
> import org.eclipse.emf.ecore.util.Diagnostician;
> 
54a59,59
>     private GenDiagram myGenModel;
61a67,74
>             loadGenModel ();
>             assert getGenModel () != null;
>             IStatus isGenModelValid = validateGenModel ();
>             if (! isGenModelValid.isOK ()) {
>                 if (! MessageDialog.openConfirm (getShell (), action.getText (), formatMessage ("generatecode.badsrc", isGenModelValid))) {
>                     return;
>                 }
>             }
63,63c76,76
<             new ProgressMonitorDialog (myPart.getSite ().getShell ()).run (true, true, this);
---
>             new ProgressMonitorDialog (getShell ()).run (true, true, this);
66,66c79,79
<                     MessageDialogWithToggle.openInformation (getShell (), getStatusDialogTitle (), CodeGenUIPlugin.getBundleString ("generatecode.ok"), CodeGenUIPlugin.getBundleString ("generatecode.neveragain"), false, getPreferences (), ASK_OK);
---
>                     MessageDialogWithToggle.openInformation (getShell (), action.getText (), CodeGenUIPlugin.getBundleString ("generatecode.ok"), CodeGenUIPlugin.getBundleString ("generatecode.neveragain"), false, getPreferences (), ASK_OK);
68,68c81,81
<             } else if ((myRunStatus.getSeverity () & IStatus.ERROR) != 0) {
---
>             } else if (myRunStatus.matches (IStatus.ERROR)) {
69a83,84
>                 MessageDialog.openError (getShell (), action.getText (), formatMessage ("generatecode.err", getRunStatus ()));
>             } else if (myRunStatus.matches (IStatus.WARNING)) {
70,71d82
<                 MessageDialog.openError (getShell (), getStatusDialogTitle (), formatMessage ("generatecode.err", getRunStatus ()));
<             } else if ((myRunStatus.getSeverity () & IStatus.WARNING) != 0) {
72,72c85,85
<                 MessageDialog.openWarning (getShell (), getStatusDialogTitle (), formatMessage ("generatecode.warn", getRunStatus ()));
---
>                 MessageDialog.openWarning (getShell (), action.getText (), formatMessage ("generatecode.warn", getRunStatus ()));
73,73c86,86
<             } else if ((myRunStatus.getSeverity () & IStatus.INFO) != 0) {
---
>             } else if (myRunStatus.matches (IStatus.INFO)) {
75,75c88,88
<                     MessageDialogWithToggle.openInformation (getShell (), getStatusDialogTitle (), formatMessage ("generatecode.info", getRunStatus ()), CodeGenUIPlugin.getBundleString ("generatecode.neveragain"), false, getPreferences (), ASK_INFO);
---
>                     MessageDialogWithToggle.openInformation (getShell (), action.getText (), formatMessage ("generatecode.info", getRunStatus ()), CodeGenUIPlugin.getBundleString ("generatecode.neveragain"), false, getPreferences (), ASK_INFO);
80a94,95
>         } finally {
>             unloadGenModel ();
84a123,127
>     private GenDiagram getGenModel () {
>         return myGenModel;
>     }
> 
>     private void loadGenModel () {
84a100,100
>         Generator g = new Generator (getGenModel ());
85,85c128,128
<         URI selected = URI.createPlatformResourceURI (mySelection.getFullPath ().toString ());
---
>         URI selected = URI.createPlatformResourceURI (mySelection.getFullPath ().toString ());
86,86c129,129
<         ResourceSet srcResSet = new ResourceSetImpl ();
---
>         ResourceSet srcResSet = new ResourceSetImpl ();
87,87c130,130
<         Resource srcRes = srcResSet.getResource (selected, true);
---
>         Resource srcRes = srcResSet.getResource (selected, true);
88,88c131,131
<         GenDiagram gd = (GenDiagram) srcRes.getContents ().get (0);
---
>         myGenModel = (GenDiagram) srcRes.getContents ().get (0);
89a133,143
>     }
> 
>     private void unloadGenModel () {
>         if (myGenModel != null && myGenModel.eResource () != null) {
>             myGenModel.eResource ().unload ();
>         }
>         myGenModel = null;
>     }
> 
>     private IStatus validateGenModel () {
>         return BasicDiagnostic.toIStatus (Diagnostician.INSTANCE.validate (getGenModel ()));
89,89c132,132
<         gd.getEMFGenModel ().reconcile ();
---
>         myGenModel.getEMFGenModel ().reconcile ();
90,90d132
<         Generator g = new Generator (gd);
95,98d104
<     private String getStatusDialogTitle () {
<         return CodeGenUIPlugin.getBundleString ("generatecode.status.title");
<     }
< 
109,109c115,115
<     private String formatMessage (String bundleStringKey, IStatus status) {
---
>     private static String formatMessage (String bundleStringKey, IStatus status) {
110,117d115
<         if (status.isMultiStatus ()) {
<             IStatus [] children = status.getChildren ();
<             StringBuffer sb = new StringBuffer ();
<             for (int i = 0;
<             i < children.length; i ++) {
<                 sb.append (children [i].getMessage ());
<                 sb.append ('\n');
<             }
118,118c116,116
<             return CodeGenUIPlugin.getBundleString (bundleStringKey, new Object [] {sb.toString ()});
---
>         return CodeGenUIPlugin.formatMessage (bundleStringKey, status);
119,121d116
<         } else {
<             return CodeGenUIPlugin.getBundleString (bundleStringKey, new Object [] {status.getMessage ()});
<         }
128,128c150,150
<     private static IPreferenceStore getPreferences () {
---
>     private static IPreferenceStore getPreferences () {
129,129c151,151
<         return CodeGenUIPlugin.getDefault ().getPreferenceStore ();
---
>         return CodeGenUIPlugin.getDefault ().getPreferenceStore ();
129a152,153
>     }
> 
