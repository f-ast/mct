5,5c7,7
< import org.eclipse.draw2d.geometry.Rectangle;
---
> import org.eclipse.draw2d.geometry.Rectangle;
7,7c5,5
< import org.eclipse.swt.graphics.Image;
---
> import org.eclipse.draw2d.geometry.Dimension;
10a11,11
> import org.eclipse.gmf.runtime.draw2d.ui.internal.mapmode.DiagramMapModeUtil;
11,11c13,13
< import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
---
> import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
13,13c19,19
< import org.eclipse.gmf.runtime.draw2d.ui.render.RenderInfo;
---
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.RenderHelper;
13a20,22
> 
> import org.eclipse.gmf.runtime.draw2d.ui.render.internal.RenderingListener;
> 
19a24,29
>     boolean allowDelayRender = false;
>     Dimension maximumRenderSize = null;
> 
>     public boolean shouldAllowDelayRender () {
>         return allowDelayRender;
>     }
22,22c32,32
<         super (g, mm);
---
>         this (g, mm, false, null);
24a35,39
>     public RenderedMapModeGraphics (Graphics g, IMapMode mm, boolean allowDelayRender, Dimension maximumRenderSize) {
>         super (g, mm);
>         this.allowDelayRender = allowDelayRender;
>         this.maximumRenderSize = maximumRenderSize;
>     }
25,35d34
<     public RenderedImage drawRenderedImage (RenderedImage srcImage, int x, int y, int width, int height) {
<         if (getGraphics () instanceof DrawableRenderedImage) {
<             Rectangle r = zoomRect (x, y, width, height);
<             return ((DrawableRenderedImage) getGraphics ()).drawRenderedImage (srcImage, r.x, r.y, r.width, r.height);
<         } else {
<             Rectangle r = zoomRect (x, y, width, height);
<             RenderInfo info = srcImage.getRenderInfo ();
<             info.setValues (r.width, r.height, info.getFillColor (), info.getOutlineColor (), info.shouldMaintainAspectRatio (), info.shouldAntiAlias ());
<             RenderedImage img = srcImage.getNewRenderedImage (info);
<             Image swtImg = img.getSWTImage ();
<             if (swtImg != null) getGraphics ().drawImage (swtImg, r.x, r.y + r.height - swtImg.getBounds ().height);
36a41,42
>     public RenderedImage drawRenderedImage (RenderedImage srcImage, Rectangle rect, RenderingListener listener) {
>         return RenderHelper.getInstance (DiagramMapModeUtil.getScale (getMapMode ()), true, shouldAllowDelayRender (), getMaximumRenderSize ()).drawRenderedImage (getGraphics (), srcImage, rect, listener);
37,37d40
<             return img;
38a44,46
> 
>     public Dimension getMaximumRenderSize () {
>         return maximumRenderSize;
