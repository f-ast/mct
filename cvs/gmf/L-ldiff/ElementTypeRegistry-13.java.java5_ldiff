69,69c69,69
<     private final Map metamodelTypeDescriptorsByEClass;
---
>     private final Map metamodelTypeDescriptorsByNsURI;
78,78c78,78
<         metamodelTypeDescriptorsByEClass = new HashMap ();
---
>         metamodelTypeDescriptorsByNsURI = new HashMap ();
270a271,271
>         Map metamodelTypeDescriptorsByEClass = (Map) metamodelTypeDescriptorsByNsURI.get (eClass.getEPackage ().getNsURI ());
271,271c272,272
<         Collection descriptors = (Collection) metamodelTypeDescriptorsByEClass.get (eClass);
---
>         Collection descriptors = metamodelTypeDescriptorsByEClass != null ? (Collection) metamodelTypeDescriptorsByEClass.get (eClass.getName ()) : null;
285,285c286,286
<                 descriptors = (Collection) metamodelTypeDescriptorsByEClass.get (nextEClass);
---
>                 descriptors = metamodelTypeDescriptorsByEClass != null ? (Collection) metamodelTypeDescriptorsByEClass.get (nextEClass.getName ()) : null;
424a426,433
>         String nsURI = typeDescriptor.getNsURI ();
>         String eClassName = typeDescriptor.getEClassName ();
>         Map metamodelTypeDescriptorsByEClass = (Map) metamodelTypeDescriptorsByNsURI.get (nsURI);
>         if (metamodelTypeDescriptorsByEClass == null) {
>             metamodelTypeDescriptorsByEClass = new HashMap ();
>             metamodelTypeDescriptorsByNsURI.put (nsURI, metamodelTypeDescriptorsByEClass);
>         }
>         Collection descriptors = (Collection) metamodelTypeDescriptorsByEClass.get (eClassName);
425,426d425
<         EClass eClass = typeDescriptor.getEClass ();
<         Collection descriptors = (Collection) metamodelTypeDescriptorsByEClass.get (eClass);
429,429c436,436
<             metamodelTypeDescriptorsByEClass.put (eClass, descriptors);
---
>             metamodelTypeDescriptorsByEClass.put (eClassName, descriptors);
