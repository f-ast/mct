26a27,28
> import org.eclipse.draw2d.geometry.Point;
> 
53,53c413,413
< import org.eclipse.gmf.gmfgraph.Point;
---
>                                 org.eclipse.gmf.gmfgraph.Point topLeft;
54,54d413
< 
63,64d62
< import org.eclipse.gmf.graphdef.editor.edit.policies.Ellipse2GraphicalNodeEditPolicy;
< 
100,101d97
<     private EllipseFigure myFigure;
<     protected Figure myNodeFigure;
273,273c382,382
<                             Point location = modelElement.getLocation ();
---
>                             org.eclipse.gmf.gmfgraph.Point location = modelElement.getLocation ();
291,291c400,400
<                             myNodeFigure.setLocation (new org.eclipse.draw2d.geometry.Point (bounds.getX (), bounds.getY ()));
---
>                             myNodeFigure.setLocation (new Point (bounds.getX (), bounds.getY ()));
304,304d412
<                                 Point topLeft;
463a573,574
>     protected LayoutManager getFigureLayoutManager () {
>         return myFigure.getLayoutManager ();
464,464c104,104
<     protected void createDefaultEditPolicies () {
---
>     protected void createDefaultEditPolicies () {
465,465c105,105
<         installEditPolicy (EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy ());
---
>         installEditPolicy (EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy ());
466,466c106,106
<         super.createDefaultEditPolicies ();
---
>         super.createDefaultEditPolicies ();
467,467c107,107
<         installEditPolicy (EditPolicyRoles.SEMANTIC_ROLE, new Ellipse2ItemSemanticEditPolicy ());
---
>         installEditPolicy (EditPolicyRoles.SEMANTIC_ROLE, new Ellipse2ItemSemanticEditPolicy ());
468,468d107
<         installEditPolicy (EditPolicy.GRAPHICAL_NODE_ROLE, new Ellipse2GraphicalNodeEditPolicy ());
469,469c108,108
<         installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy ());
---
>         installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy ());
470,470c109,109
<         installEditPolicy (EditPolicyRoles.CANONICAL_ROLE, new Ellipse2CanonicalEditPolicy ());
---
>         installEditPolicy (EditPolicyRoles.CANONICAL_ROLE, new Ellipse2CanonicalEditPolicy ());
471,471c110,110
<         installEditPolicy (EditPolicy.LAYOUT_ROLE, createLayoutEditPolicy ());
---
>         installEditPolicy (EditPolicy.LAYOUT_ROLE, createLayoutEditPolicy ());
472,472c111,111
<     }
---
>     }
473,473c112,112
< 
---
> 
474,474c113,113
<     protected LayoutEditPolicy createLayoutEditPolicy () {
---
>     protected LayoutEditPolicy createLayoutEditPolicy () {
475,475c114,114
<         XYLayoutEditPolicy lep = new XYLayoutEditPolicy () {
---
>         XYLayoutEditPolicy lep = new XYLayoutEditPolicy () {
476,476c115,115
< 
---
> 
477,477c116,116
<             protected EditPolicy createChildEditPolicy (EditPart child) {
---
>             protected EditPolicy createChildEditPolicy (EditPart child) {
478,478c117,117
<                 EditPolicy result = super.createChildEditPolicy (child);
---
>                 EditPolicy result = super.createChildEditPolicy (child);
479,479c118,118
<                 if (result == null) {
---
>                 if (result == null) {
480,480c119,119
<                     return new ResizableShapeEditPolicy ();
---
>                     return new ResizableShapeEditPolicy ();
481,481c120,120
<                 }
---
>                 }
482,482c121,121
<                 return result;
---
>                 return result;
483,483c122,122
<             }
---
>             }
484a124,124
>             protected Point getLayoutOrigin () {
484,484c123,123
< 
---
> 
485,485d123
<             protected org.eclipse.draw2d.geometry.Point getLayoutOrigin () {
486,486c125,125
<                 return ((GraphicalEditPart) getHost ()).getContentPane ().getClientArea ().getLocation ();
---
>                 return ((GraphicalEditPart) getHost ()).getContentPane ().getClientArea ().getLocation ();
487,487c126,126
<             }
---
>             }
488,488c127,127
< 
---
> 
489,489c128,128
<             protected Rectangle getCurrentConstraintFor (org.eclipse.gef.GraphicalEditPart child) {
---
>             protected Rectangle getCurrentConstraintFor (org.eclipse.gef.GraphicalEditPart child) {
490,490c129,129
<                 Rectangle result = super.getCurrentConstraintFor (child);
---
>                 Rectangle result = super.getCurrentConstraintFor (child);
491,491c130,130
<                 if (result == null) {
---
>                 if (result == null) {
492,492c131,131
<                     IFigure fig = child.getFigure ();
---
>                     IFigure fig = child.getFigure ();
493,493c132,132
<                     result = fig.getBounds ().getCopy ();
---
>                     result = fig.getBounds ().getCopy ();
494,494c133,133
<                 }
---
>                 }
495,495c134,134
<                 return result;
---
>                 return result;
496,496c135,135
<             }
---
>             }
497,497c136,136
< 
---
> 
498,498c137,137
<         }
---
>         }
499,499c138,138
< 
---
> 
500,500c139,139
<         ;
---
>         ;
501,501c140,140
<         return lep;
---
>         return lep;
502,502c141,141
<     }
---
>     }
503,503c142,142
< 
---
> 
504,504c143,143
<     protected IFigure createNodeShape () {
---
>     protected IFigure createNodeShape () {
505,505c144,144
<         EllipseFigure figure = new EllipseFigure ();
---
>         EllipseFigure figure = new EllipseFigure ();
506,506c145,145
<         figure.setUseLocalCoordinates (true);
---
>         figure.setUseLocalCoordinates (true);
507,507c146,146
<         myFigure = figure;
---
>         myFigure = figure;
508,508c147,147
<         Ellipse modelElement = (Ellipse) ((View) getModel ()).getElement ();
---
>         Ellipse modelElement = (Ellipse) ((View) getModel ()).getElement ();
509,509c148,148
<         if (modelElement != null) {
---
>         if (modelElement != null) {
510,510c149,149
<             {
---
>             {
511,511c150,150
<                 layoutDataChanged (modelElement.getLayoutData ());
---
>                 layoutDataChanged (modelElement.getLayoutData ());
512,512c151,151
<             } {
---
>             } {
513,513c152,152
<                 layoutChanged (modelElement.getLayout ());
---
>                 layoutChanged (modelElement.getLayout ());
514,514c153,153
<             } {
---
>             } {
515,515c154,154
<                 myFigure.setOutline (modelElement.isOutline ());
---
>                 myFigure.setOutline (modelElement.isOutline ());
516,516c155,155
<             } {
---
>             } {
517,517c156,156
<                 myFigure.setFill (modelElement.isFill ());
---
>                 myFigure.setFill (modelElement.isFill ());
518,518c157,157
<             } {
---
>             } {
519,519c158,158
<                 myFigure.setLineWidth (modelElement.getLineWidth ());
---
>                 myFigure.setLineWidth (modelElement.getLineWidth ());
520,520c159,159
<             } {
---
>             } {
521,521c160,160
<                 myFigure.setLineStyle (getLineStyle (modelElement.getLineKind ()));
---
>                 myFigure.setLineStyle (getLineStyle (modelElement.getLineKind ()));
522,522c161,161
<             } {
---
>             } {
523,523c162,162
<                 myFigure.setFillXOR (modelElement.isXorFill ());
---
>                 myFigure.setFillXOR (modelElement.isXorFill ());
524,524c163,163
<             } {
---
>             } {
525,525c164,164
<                 myFigure.setOutlineXOR (modelElement.isXorOutline ());
---
>                 myFigure.setOutlineXOR (modelElement.isXorOutline ());
526,526c165,165
<             }}
---
>             }}
527,527c166,166
<         return primaryShape = figure;
---
>         return primaryShape = figure;
528,528c167,167
<     }
---
>     }
529,529c168,168
< 
---
> 
530,530c169,169
<     public EllipseFigure getPrimaryShape () {
---
>     public EllipseFigure getPrimaryShape () {
531,531c170,170
<         return (EllipseFigure) primaryShape;
---
>         return (EllipseFigure) primaryShape;
532,532c171,171
<     }
---
>     }
533,533c172,172
< 
---
> 
534,534c173,173
<     protected NodeFigure createNodePlate () {
---
>     protected NodeFigure createNodePlate () {
534a174,176
>         DefaultSizeNodeFigure result = new DefaultSizeNodeFigure (getMapMode ().DPtoLP (0), getMapMode ().DPtoLP (0));
>         myNodeFigure = result;
>         return result;
535,535d173
<         return new DefaultSizeNodeFigure (getMapMode ().DPtoLP (0), getMapMode ().DPtoLP (0));
536,536c177,177
<     }
---
>     }
537,537c178,178
< 
---
> 
538,538c179,179
<     protected NodeFigure createNodeFigure () {
---
>     protected NodeFigure createNodeFigure () {
539,539c180,180
<         NodeFigure figure = createNodePlate ();
---
>         NodeFigure figure = createNodePlate ();
540,540d180
<         myNodeFigure = figure;
541,541c181,181
<         figure.setLayoutManager (new StackLayout ());
---
>         figure.setLayoutManager (new StackLayout ());
542,542c182,182
<         IFigure shape = createNodeShape ();
---
>         IFigure shape = createNodeShape ();
543,543c183,183
<         figure.add (shape);
---
>         figure.add (shape);
544,544c184,184
<         contentPane = setupContentPane (shape);
---
>         contentPane = setupContentPane (shape);
545,545c185,185
<         return figure;
---
>         return figure;
546,546c186,186
<     }
---
>     }
547,547c187,187
< 
---
> 
548,548c188,188
<     protected IFigure setupContentPane (IFigure nodeShape) {
---
>     protected IFigure setupContentPane (IFigure nodeShape) {
549,549c189,189
<         if (nodeShape.getLayoutManager () == null) {
---
>         if (nodeShape.getLayoutManager () == null) {
550,550c190,190
<             nodeShape.setLayoutManager (new FreeformLayout () {
---
>             nodeShape.setLayoutManager (new FreeformLayout () {
551,551c191,191
< 
---
> 
552,552c192,192
<                 public Object getConstraint (IFigure figure) {
---
>                 public Object getConstraint (IFigure figure) {
553,553c193,193
<                     Object result = constraints.get (figure);
---
>                     Object result = constraints.get (figure);
554,554c194,194
<                     if (result == null) {
---
>                     if (result == null) {
555,555c195,195
<                         result = new Rectangle (0, 0, - 1, - 1);
---
>                         result = new Rectangle (0, 0, - 1, - 1);
556,556c196,196
<                     }
---
>                     }
557,557c197,197
<                     return result;
---
>                     return result;
558,558c198,198
<                 }
---
>                 }
559,559c199,199
< 
---
> 
559a200,216
>             }
> 
>             );
>         }
>         return nodeShape;
>     }
> 
>     public IFigure getContentPane () {
>         if (contentPane != null) {
>             return contentPane;
>         }
>         return super.getContentPane ();
>     }
> 
>     private EllipseFigure myFigure;
>     protected Figure myNodeFigure;
> 
561a577,578
>     protected void setFigureLayoutManager (LayoutManager layoutManager) {
>         myFigure.setLayoutManager (layoutManager);
562,564d576
<             );
<         }
<         return nodeShape;
567,569d580
<     public IFigure getContentPane () {
<         if (contentPane != null) {
<             return contentPane;
571,571d588
<         return super.getContentPane ();
597,604d580
<     protected LayoutManager getFigureLayoutManager () {
<         return myFigure.getLayoutManager ();
<     }
< 
<     protected void setFigureLayoutManager (LayoutManager layoutManager) {
<         myFigure.setLayoutManager (layoutManager);
<     }
< 
605,605c581,581
<     protected void refreshBounds () {
---
>     protected void refreshBounds () {
606,606c582,582
<         if (((View) getParent ().getModel ()).getElement () instanceof FigureMarker) {
---
>         if (((View) getParent ().getModel ()).getElement () instanceof FigureMarker) {
607,607c583,583
<             int width = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Width ())).intValue ();
---
>             int width = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Width ())).intValue ();
608,608c584,584
<             int height = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Height ())).intValue ();
---
>             int height = ((Integer) getStructuralFeatureValue (NotationPackage.eINSTANCE.getSize_Height ())).intValue ();
609,609c585,585
<             myNodeFigure.setPreferredSize (new org.eclipse.draw2d.geometry.Dimension (width, height));
---
>             myNodeFigure.setPreferredSize (new org.eclipse.draw2d.geometry.Dimension (width, height));
610,610c586,586
<         } else {
---
>         } else {
611,611c587,587
<             super.refreshBounds ();
---
>             super.refreshBounds ();
612,614d587
<         }
<     }
< 
