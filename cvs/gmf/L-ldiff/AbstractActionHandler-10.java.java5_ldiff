60a61,62
> import org.eclipse.ui.ISelectionService;
> 
249a252,256
>         ISelectionService selectionService = null;
>         if (getWorkbenchPart () != null && getWorkbenchPart ().getSite ().getWorkbenchWindow () != null) {
>             selectionService = getWorkbenchPart ().getSite ().getWorkbenchWindow ().getSelectionService ();
>         }
>         if (selectionService != null) {
250,251d251
<         ISelectionProvider selectionProvider = getWorkbenchPart ().getSite ().getSelectionProvider ();
<         if (selectionProvider != null) {
252,252c257,257
<             selection = selectionProvider.getSelection ();
---
>             selection = selectionService.getSelection ();
257a263,263
>         ISelection selection = getSelection ();
258,265d262
<         IStructuredSelection selection = null;
<         ISelectionProvider selectionProvider = null;
<         if (getWorkbenchPart () != null) {
<             selectionProvider = getWorkbenchPart ().getSite ().getSelectionProvider ();
<         }
<         if (selectionProvider != null && selectionProvider.getSelection () instanceof IStructuredSelection) {
<             selection = (IStructuredSelection) selectionProvider.getSelection ();
<         }
266,266c264,264
<         return (selection != null) ? selection : StructuredSelection.EMPTY;
---
>         return (selection instanceof StructuredSelection) ? (StructuredSelection) selection : StructuredSelection.EMPTY;
