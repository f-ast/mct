16a19,19
> import org.eclipse.gmf.gmfgraph.FigureDescriptor;
17,17d18
< import org.eclipse.gmf.common.codegen.ImportAssistant;
18,18c20,20
< 
---
> 
38,38d43
<     private static final String VAR_OUTPUT_METHODS = "outputAdditionalMethods";
39,39c44,44
<     private static final String VAR_PACKAGE_STMT = "packageStatement";
---
>     private String packageStatement;
42,42d39
<     private static final String SLOT_METHODS = "additionalMethods";
45,46d41
<     private Variable packageStatement;
<     private StringBuilder additionalMethods;
49a46,46
>     public FigureGenerator (String runtimeToken, String packageStmt, boolean asInnerClass) {
50,50d45
<     public FigureGenerator (String runtimeToken, boolean asInnerClass) {
51,51c47,47
<         this (runtimeToken, MapModeCodeGenStrategy.DYNAMIC, "getMapMode().", asInnerClass);
---
>         this (runtimeToken, packageStmt, MapModeCodeGenStrategy.DYNAMIC, "getMapMode().", asInnerClass);
54,54c50,50
<     public FigureGenerator (String runtimeToken, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass) {
---
>     public FigureGenerator (String runtimeToken, String packageStmt, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass) {
55,55c51,51
<         this (runtimeToken, mapModeStrategy, mapModeAccessor, asInnerClass, null);
---
>         this (runtimeToken, packageStmt, mapModeStrategy, mapModeAccessor, asInnerClass, null);
58,58c54,54
<     public FigureGenerator (String runtimeToken, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass, URL [] dynamicTemplates) {
---
>     public FigureGenerator (String runtimeToken, String packageStmt, MapModeCodeGenStrategy mapModeStrategy, String mapModeAccessor, boolean asInnerClass, URL [] dynamicTemplates) {
59a56,56
>         this.packageStatement = packageStmt;
72,83d68
<         packageStatement = new Variable (VAR_PACKAGE_STMT, "");
<         globals.add (packageStatement);
<         additionalMethods = new StringBuilder ();
<         globals.add (new Variable (VAR_OUTPUT_METHODS, "") {
< 
<             public Object getValue () {
<                 return additionalMethods.toString ();
<             }
< 
<         }
< 
<         );
96,96d80
<         slots.put (SLOT_METHODS, additionalMethods);
102a87,97
>     public String getPackageName () {
>         return packageStatement;
>     }
> 
>     public String fqnSwitch (Figure figure) {
>         result.setLength (0);
>         additionalFields.setLength (0);
>         xpandFacade.evaluate ("Runtime::fqn", figure, null);
>         return result.toString ();
>     }
> 
103,103c98,98
<     public String go (Figure figure, ImportAssistant importAssistant) {
---
>     public String go (FigureDescriptor figure) {
105,105d99
<         additionalMethods.setLength (0);
106a101,105
>         if (myIsInnerClassCode) {
>             xpandFacade.evaluate ("top::Descriptor::Inner", figure, null);
>         } else {
>             xpandFacade.evaluate ("top::Descriptor::Top", figure, new Object [] {packageStatement});
>         }
107,111d100
<         StringBuffer ss = new StringBuffer ();
<         importAssistant.emitPackageStatement (ss);
<         packageStatement.setValue (ss.toString ());
<         xpandFacade.evaluate ("top::Figure::FigureClass", figure, new Object [] {myIsInnerClassCode});
<         final String resultString = result.toString ();
112,112c106,106
<         return resultString;
---
>         return result.toString ();
115a110,110
>         if (arguments == null || arguments.length != 1 || false == arguments [0] instanceof FigureDescriptor) {
116,116d109
<         if (arguments == null || arguments.length != 2 || false == arguments [0] instanceof Figure || false == arguments [1] instanceof ImportAssistant) {
117,117c111,111
<             throw new UnexpectedBehaviourException ("(Figure, ImportAssistant) expected as arguments, not " + arguments);
---
>             throw new UnexpectedBehaviourException ("(FigureDescriptor) expected as arguments, not " + arguments);
119,119c113,113
<         return go ((Figure) arguments [0], (ImportAssistant) arguments [1]);
---
>         return go ((FigureDescriptor) arguments [0]);
