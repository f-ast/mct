14a15,16
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
> 
40a43,44
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
> 
57,57c61,61
< import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeModelCommand;
---
> import org.eclipse.gmf.runtime.emf.commands.core.command.CompositeTransactionalCommand;
72,72c76,76
<             ICommand boundsCommand = new SetBoundsCommand (DiagramUIMessages.SetLocationCommand_Label_Resize, new EObjectAdapter ((View) child.getModel ()), rect.getTopLeft ());
---
>             ICommand boundsCommand = new SetBoundsCommand (((ShapeEditPart) child).getEditingDomain (), DiagramUIMessages.SetLocationCommand_Label_Resize, new EObjectAdapter ((View) child.getModel ()), rect.getTopLeft ());
78a83,83
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
85,85c90,90
<                 ChangeGuideCommand cgm = new ChangeGuideCommand (view, true);
---
>                 ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, view, true);
95,95c100,100
<                     ChangeGuideCommand cgm = new ChangeGuideCommand (view, true);
---
>                     ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, view, true);
105,105c110,110
<                 ChangeGuideCommand cgm = new ChangeGuideCommand (view, false);
---
>                 ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, view, false);
115,115c120,120
<                     ChangeGuideCommand cgm = new ChangeGuideCommand (view, false);
---
>                     ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, view, false);
123,123c128,128
<             ChangeGuideCommand cgm = new ChangeGuideCommand (view, true);
---
>             ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, view, true);
130,130c135,135
<             cgm = new ChangeGuideCommand (view, false);
---
>             cgm = new ChangeGuideCommand (editingDomain, view, false);
142a148,148
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
143,143c149,149
<         ICommand boundsCommand = new SetBoundsCommand (DiagramUIMessages.SetLocationCommand_Label_Resize, new EObjectAdapter (shapeView), newBounds);
---
>         ICommand boundsCommand = new SetBoundsCommand (editingDomain, DiagramUIMessages.SetLocationCommand_Label_Resize, new EObjectAdapter (shapeView), newBounds);
158a165,166
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
>         CompositeTransactionalCommand cc = new CompositeTransactionalCommand (editingDomain, DiagramUIMessages.AddCommand_Label);
159,159d164
<         CompositeModelCommand cc = new CompositeModelCommand (DiagramUIMessages.AddCommand_Label);
165,165c172,172
<             cc.compose (new SetBoundsCommand (DiagramUIMessages.SetLocationCommand_Label_Resize, viewDescriptor, rect));
---
>             cc.compose (new SetBoundsCommand (editingDomain, DiagramUIMessages.SetLocationCommand_Label_Resize, viewDescriptor, rect));
167,167c174,174
<         if (cc.unwrap () == null) return null;
---
>         if (cc.reduce () == null) return null;
169,169c176,176
<         return chainGuideAttachmentCommands (request, new EtoolsProxyCommand (cc.unwrap ()));
---
>         return chainGuideAttachmentCommands (request, new EtoolsProxyCommand (cc.reduce ()));
233a241,241
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
241,241c249,249
<                 ChangeGuideCommand cgm = new ChangeGuideCommand (editPartViewer, desc, true);
---
>                 ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, editPartViewer, desc, true);
253,253c261,261
<                 ChangeGuideCommand cgm = new ChangeGuideCommand (editPartViewer, desc, false);
---
>                 ChangeGuideCommand cgm = new ChangeGuideCommand (editingDomain, editPartViewer, desc, false);
