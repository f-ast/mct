2a3,3
> import java.util.ArrayList;
3a16,17
> 
> import org.eclipse.gef.commands.CompoundCommand;
3,3c15,15
< import org.eclipse.gef.commands.Command;
---
> import org.eclipse.gef.commands.Command;
4a5,5
> import java.util.Collection;
4a31,32
> import org.eclipse.gmf.runtime.diagram.ui.requests.EditCommandRequestWrapper;
> 
5a34,34
> 
5,5c33,33
< import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
---
> import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;
6a7,7
> import java.util.Collections;
7,7c37,37
< import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;
7a38,40
> 
> import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
> 
8a9,9
> import java.util.Iterator;
9a24,24
> 
9,9c23,23
< import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;
---
> import org.eclipse.gmf.gmfgraph.FigureHandle;
13,13c13,13
< import org.eclipse.emf.ecore.EAnnotation;
---
> import org.eclipse.gef.EditPart;
14a43,44
> import org.eclipse.gmf.runtime.notation.Edge;
> 
15,15c45,45
< import org.eclipse.gmf.runtime.notation.View;
---
> import org.eclipse.gmf.runtime.notation.View;
15a46,46
> 
22a27,28
> import org.eclipse.gmf.graphdef.editor.edit.parts.Polyline2EditPart;
> 
31a50,51
>         CompoundCommand cc = new CompoundCommand ();
>         Collection allEdges = new ArrayList ();
32,32c62,62
<         return getMSLWrapper (new DestroyElementCommand (req) {
---
>         cc.add (getMSLWrapper (new DestroyElementCommand (req)));
32a63,63
>         return cc;
33,34d62
< 
<             protected EObject getElementToDestroy () {
35a53,60
>         allEdges.addAll (view.getSourceEdges ());
>         allEdges.addAll (view.getTargetEdges ());
>         for (Iterator it = allEdges.iterator ();
>         it.hasNext ();) {
>             Edge nextEdge = (Edge) it.next ();
>             EditPart nextEditPart = (EditPart) getHost ().getViewer ().getEditPartRegistry ().get (nextEdge);
>             EditCommandRequestWrapper editCommandRequest = new EditCommandRequestWrapper (new DestroyElementRequest (((Polyline2EditPart) getHost ()).getEditingDomain (), req.isConfirmationRequired ()), Collections.EMPTY_MAP);
>             cc.add (nextEditPart.getCommand (editCommandRequest));
36,40d52
<                 EAnnotation annotation = view.getEAnnotation ("Shortcut");
<                 if (annotation != null) {
<                     return view;
<                 }
<                 return super.getElementToDestroy ();
42,45d61
< 
<         }
< 
<         );
50,50c68,68
<             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElement_Figure4001Command (req);
---
>             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElementFigure_4001Command (req);
55a74,75
>         EObject sourceEObject = req.getSource ();
>         EObject targetEObject = req.getTarget ();
55,55c73,73
<     protected Command getCreateCompleteIncomingDiagramElement_Figure4001Command (CreateRelationshipRequest req) {
---
>     protected Command getCreateCompleteIncomingDiagramElementFigure_4001Command (CreateRelationshipRequest req) {
56,56c76,76
<         if (! (req.getSource () instanceof DiagramElement)) {
---
>         if (false == sourceEObject instanceof DiagramElement || false == targetEObject instanceof FigureHandle) {
58a79,81
>         DiagramElement source = (DiagramElement) sourceEObject;
>         FigureHandle target = (FigureHandle) targetEObject;
>         if (! GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001 (source, target)) {
59,60d78
<         DiagramElement element = (DiagramElement) req.getSource ();
<         if (element.getFigure () != null) {
63,63c84,84
<         SetRequest setReq = new SetRequest (req.getSource (), GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), req.getTarget ());
---
>         SetRequest setReq = new SetRequest (sourceEObject, GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), target);
