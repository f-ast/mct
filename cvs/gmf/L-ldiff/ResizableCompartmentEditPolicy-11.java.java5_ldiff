15,18d14
< import org.eclipse.emf.common.notify.Notification;
< 
< import org.eclipse.emf.transaction.TransactionalEditingDomain;
< 
27,32d22
< import org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker;
< 
< import org.eclipse.gmf.runtime.diagram.core.listener.NotificationListener;
< 
< import org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart;
< 
45,46d34
< import org.eclipse.gmf.runtime.notation.NotationPackage;
< 
116a105,110
>     public void activate () {
>         super.activate ();
>         if (getHost ().getParent ().getSelected () != EditPart.SELECTED_NONE) setSelectedState ();
> 
>     }
> 
119,119d112
<     private NotificationListener propertyListener;
143,153d135
<         propertyListener = new NotificationListener () {
< 
<             public void notifyChanged (Notification notification) {
<                 if (NotationPackage.eINSTANCE.getView_Visible ().equals (notification.getFeature ())) setSelectedState ();
< 
<             }
< 
<         }
< 
<         ;
<         getDiagramEventBroker ().addNotificationListener (getGraphicalEditPart ().getNotationView (), propertyListener);
157,157d138
<         getDiagramEventBroker ().removeNotificationListener (getGraphicalEditPart ().getNotationView (), propertyListener);
164a146,146
>         if (getGraphicalEditPart ().getTopGraphicEditPart () != null) {
165,165d145
<         if (((GraphicalEditPart) getGraphicalEditPart ()).getTopGraphicEditPart () != null) {
166,166c147,147
<             topState = ((GraphicalEditPart) getGraphicalEditPart ()).getTopGraphicEditPart ().getSelected ();
---
>             topState = getGraphicalEditPart ().getTopGraphicEditPart ().getSelected ();
173a155,155
>     private IGraphicalEditPart getParentGraphicEditPart () {
174,174d154
<     private GraphicalEditPart getParentGraphicEditPart () {
175,175c156,156
<         return (GraphicalEditPart) getGraphicalEditPart ().getParent ();
---
>         return (IGraphicalEditPart) getGraphicalEditPart ().getParent ();
215,222d195
<     private DiagramEventBroker getDiagramEventBroker () {
<         TransactionalEditingDomain theEditingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
<         if (theEditingDomain != null) {
<             return DiagramEventBroker.getInstance (theEditingDomain);
<         }
<         return null;
<     }
< 
