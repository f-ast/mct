32a25,25
> import org.eclipse.gmf.gmfgraph.DiagramElement;
33,33d24
< import org.eclipse.gmf.gmfgraph.FigureHandle;
34,34c26,26
< 
---
> 
38a41,41
> import org.eclipse.gmf.gmfgraph.VisualFacet;
39,39d40
< import org.eclipse.gmf.gmfgraph.Layoutable;
40,40c42,42
< 
---
> 
93a94,94
>         Figure figure = diagramNode.getFigure ().getActualFigure ();
94,97d93
<         FigureHandle figure = diagramNode.getFigure ();
<         if (false == figure instanceof Layoutable) {
<             return;
<         }
98,98c95,95
<         ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType (((Layoutable) figure).getLayout ());
---
>         ViewmapLayoutType type = myLayoutTypeSwitch.getLayoutType (figure.getLayout ());
102,102c99,99
<     protected final void setupStyleAttributes (Viewmap viewmap, FigureHandle handle) {
---
>     protected final void setupStyleAttributes (Viewmap viewmap, Figure figure) {
103,103c100,100
<         if (viewmap == null || false == handle instanceof Figure) {
---
>         if (viewmap == null || figure == null) {
106,106d102
<         Figure figure = (Figure) handle;
127,127c123,123
<         FigureHandle handle = node.getFigure ();
---
>         Figure figure = node.getFigure ().getActualFigure ();
128,129d123
<         if (handle instanceof Figure) {
<             Figure figure = (Figure) handle;
131,131c125,125
<             DefaultSizeFacet facet = (DefaultSizeFacet) node.find (DefaultSizeFacet.class);
---
>         DefaultSizeFacet facet = findVF (node, DefaultSizeFacet.class);
143a138,145
> 
>     protected static < T extends VisualFacet > T findVF (DiagramElement de, Class < T > facetClass) {
>         for (VisualFacet vf : de.getFacets ()) {
>             if (facetClass.isInstance (vf)) {
>                 return facetClass.cast (vf);
>             }
>         }
>         return null;
