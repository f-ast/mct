4a5,6
> import java.io.IOException;
> 
8a11,12
> import java.util.Collections;
> 
20a27,27
> import org.eclipse.emf.ecore.resource.ResourceSet;
21,21c33,33
< import org.eclipse.gmf.runtime.common.core.util.Trace;
---
> import org.eclipse.gmf.runtime.common.core.util.Trace;
22a29,29
> import org.eclipse.emf.ecore.resource.impl.ResourceSetImpl;
23,23c31,31
< import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;
---
> import org.eclipse.gmf.runtime.common.core.util.Log;
25,25c35,35
< import org.eclipse.gmf.runtime.diagram.core.preferences.PreferencesHint;
---
> import org.eclipse.gmf.runtime.diagram.core.preferences.PreferencesHint;
27,27c37,37
< import org.eclipse.gmf.runtime.diagram.core.services.ViewService;
---
> import org.eclipse.gmf.runtime.diagram.core.services.ViewService;
29,29d34
< import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramEditPart;
31,31d36
< import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramWorkbenchPart;
37,37c43,43
< import org.eclipse.gmf.runtime.diagram.ui.resources.editor.internal.ui.parts.FileResourceEditorInput;
---
> import org.eclipse.gmf.runtime.diagram.ui.resources.editor.internal.EditorStatusCodes;
38,41d43
< 
< import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;
< 
< import org.eclipse.gmf.runtime.emf.core.util.ResourceUtil;
50a23,23
> import org.eclipse.emf.common.util.URI;
51,51d22
< import org.eclipse.ui.IEditorPart;
52,52c24,24
< 
---
> 
53,58d24
< import org.eclipse.ui.IWorkbenchPage;
< 
< import org.eclipse.ui.IWorkbenchWindow;
< 
< import org.eclipse.ui.PlatformUI;
< 
61,85d54
<     public static final IFile createAndOpenDiagram (DiagramFileCreator diagramFileCreator, IPath containerPath, String fileName, String diagramId, InputStream initialContents, String kind, IWorkbenchWindow dWindow, IProgressMonitor progressMonitor, boolean openEditor, boolean saveDiagram, PreferencesHint preferencesHint) {
<         IFile newFile = EditorUtil.createNewDiagramFile (diagramFileCreator, containerPath, fileName, initialContents, kind, dWindow.getShell (), progressMonitor, preferencesHint);
<         if (newFile != null && openEditor) {
<             EditorUtil.openDiagram (newFile, dWindow, saveDiagram, progressMonitor, diagramId);
<         }
<         return newFile;
<     }
< 
<     public static final DiagramEditPart openDiagram (IFile file, IWorkbenchWindow dWindow, boolean saveDiagram, IProgressMonitor progressMonitor, String diagramId) {
<         IEditorPart editorPart = null;
<         try {
<             IWorkbenchPage page = dWindow.getActivePage ();
<             if (page != null) {
<                 editorPart = PlatformUI.getWorkbench ().getActiveWorkbenchWindow ().getActivePage ().openEditor (new FileResourceEditorInput (file), diagramId);
<                 if (saveDiagram) editorPart.doSave (progressMonitor);
< 
<             }
<             file.refreshLocal (IResource.DEPTH_ZERO, null);
<             return ((IDiagramWorkbenchPart) editorPart).getDiagramEditPart ();
<         } catch (Exception e) {
<             Trace.catching (EditorPlugin.getInstance (), EditorDebugOptions.EXCEPTIONS_CATCHING, EditorUtil.class, "openDiagram", e);
<         }
<         return null;
<     }
< 
101a71,72
>                 ResourceSet resourceSet = new ResourceSetImpl ();
>                 notationModel = resourceSet.createResource (URI.createFileURI (completeFileName));
102,102d70
<                 notationModel = ResourceUtil.create (completeFileName, null);
110,113d79
<             final Resource notationModel_ = notationModel;
<             MEditingDomainGetter.getMEditingDomain (notationModel_).runAsUnchecked (new MRunnable () {
< 
<                 public Object run () {
116,116c82,82
<                         notationModel_.getContents ().add (view.getDiagram ());
---
>                 notationModel.getContents ().add (view.getDiagram ());
119,121d84
<                     return null;
<                 }
< 
122a86,90
>         try {
>             notationModel.save (Collections.EMPTY_MAP);
>         } catch (IOException e) {
>             Trace.catching (EditorPlugin.getInstance (), EditorDebugOptions.EXCEPTIONS_CATCHING, EditorUtil.class, "createNewDiagramFile", e);
>             Log.error (EditorPlugin.getInstance (), EditorStatusCodes.RESOURCE_FAILURE, e.getLocalizedMessage ());
123,124d85
< 
<             );
