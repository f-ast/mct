2a3,6
> import java.lang.reflect.InvocationTargetException;
> 
> import org.eclipse.core.runtime.IProgressMonitor;
> 
4a9,9
> import org.eclipse.gmf.common.UnexpectedBehaviourException;
5a120,120
> 
5,5c119,119
< import org.eclipse.emf.codegen.jet.JETException;
---
> import org.eclipse.gmf.internal.common.codegen.TextEmitter;
117,117c123,123
< public class FigureGenerator {
---
> public class FigureGenerator implements TextEmitter {
118,118d123
<     private final String packageName;
121a127,127
>     public FigureGenerator (FigureQualifiedNameSwitch figureNameSwitch) {
122,122d126
<     public FigureGenerator (String aPackageName, ImportAssistant importManager, FigureQualifiedNameSwitch figureNameSwitch) {
123,123c128,128
<         this (aPackageName, importManager, figureNameSwitch, new MapModeCodeGenStrategy.RuntimeUnspecifiedMapMode ());
---
>         this (figureNameSwitch, new MapModeCodeGenStrategy.RuntimeUnspecifiedMapMode ());
126,126c131,131
<     public FigureGenerator (String aPackageName, ImportAssistant importManager, FigureQualifiedNameSwitch figureNameSwitch, MapModeCodeGenStrategy mapModeStrategy) {
---
>     public FigureGenerator (FigureQualifiedNameSwitch figureNameSwitch, MapModeCodeGenStrategy mapModeStrategy) {
127,127d131
<         packageName = aPackageName;
145,145c149,149
<         myTopDispatcher = new GraphDefDispatcher (topFactory, keyMap, importManager, figureNameSwitch, mapModeStrategy);
---
>         myTopDispatcher = new GraphDefDispatcher (topFactory, keyMap, figureNameSwitch, mapModeStrategy);
147,147c151,151
<         myInnerDispatcher = new GraphDefDispatcher (innerFactory, keyMap, importManager, figureNameSwitch, mapModeStrategy);
---
>         myInnerDispatcher = new GraphDefDispatcher (innerFactory, keyMap, figureNameSwitch, mapModeStrategy);
148,151d151
<     }
< 
<     public String getPackageStatement () {
<         return packageName;
192a193,200
>     public String generate (IProgressMonitor monitor, Object [] arguments) throws InterruptedException, InvocationTargetException, UnexpectedBehaviourException {
>         if (arguments == null || arguments.length != 2 || false == arguments [0] instanceof Figure || false == arguments [1] instanceof ImportAssistant) {
>             throw new UnexpectedBehaviourException ("Single Figure expected as argument: " + arguments);
>         }
>         return go ((Figure) arguments [0], (ImportAssistant) arguments [1]);
>     }
> 
>     public String go (Figure fig, ImportAssistant importManager) {
193,193d192
<     public String go (Figure fig) throws JETException {
194a202,203
>         myTopDispatcher.setImportManager (importManager);
>         myInnerDispatcher.setImportManager (importManager);
195,195c204,204
<         Object args = new Object [] {fig, myTopDispatcher.getImportManager (), myTopDispatcher.getFQNSwitch (), myInnerDispatcher};
---
>         Object args = new Object [] {fig, importManager, myTopDispatcher.getFQNSwitch (), myInnerDispatcher};
199a209,209
>         return res;
200,200d208
<         return packageName == null ? res : "package " + packageName + ";\n" + res;
