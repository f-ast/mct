37,37c39,39
< import org.eclipse.gmf.codegen.gmfgen.GenLink;
---
> import org.eclipse.gmf.codegen.gmfgen.ValueExpression;
38,40d39
< 
< import org.eclipse.gmf.codegen.gmfgen.GenNode;
< 
43,47d38
< import org.eclipse.gmf.codegen.gmfgen.LinkModelFacet;
< 
< import org.eclipse.gmf.codegen.gmfgen.TypeLinkModelFacet;
< 
< import org.eclipse.gmf.codegen.gmfgen.TypeModelFacet;
158a151,151
>         for (Iterator it = getDiagram ().eAllContents ();
159,170d150
<         for (Iterator it = getDiagram ().getAllNodes ().iterator ();
<         it.hasNext ();) {
<             GenNode nextNode = (GenNode) it.next ();
<             TypeModelFacet modelFacet = nextNode.getModelFacet ();
<             if (modelFacet.getModelElementInitializer () != null) {
<                 requiredIDs.addAll (modelFacet.getModelElementInitializer ().getRequiredPluginIDs ());
<             }
<             if (modelFacet.getModelElementSelector () != null) {
<                 requiredIDs.addAll (modelFacet.getModelElementSelector ().getRequiredPluginIDs ());
<             }
<         }
<         for (Iterator it = getDiagram ().getLinks ().iterator ();
171a153,157
>             Object nextObj = it.next ();
>             if (nextObj instanceof ValueExpression) {
>                 String lang = ((ValueExpression) nextObj).getLanguage ();
>                 if ("ocl".equals (lang)) {
>                     requiredIDs.add ("org.eclipse.emf.query.ocl");
172,180d152
<             GenLink nextLink = (GenLink) it.next ();
<             LinkModelFacet modelFacet = nextLink.getModelFacet ();
<             if (modelFacet instanceof TypeLinkModelFacet) {
<                 TypeLinkModelFacet typeModelFacet = (TypeLinkModelFacet) modelFacet;
<                 if (typeModelFacet.getModelElementInitializer () != null) {
<                     requiredIDs.addAll (typeModelFacet.getModelElementInitializer ().getRequiredPluginIDs ());
<                 }
<                 if (typeModelFacet.getModelElementSelector () != null) {
<                     requiredIDs.addAll (typeModelFacet.getModelElementSelector ().getRequiredPluginIDs ());
