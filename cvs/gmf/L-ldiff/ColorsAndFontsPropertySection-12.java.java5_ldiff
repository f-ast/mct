274,306d273
<     protected RGB changeColor (SelectionEvent event, ToolItem button, String preferenceId, final String propertyId, String commandName, String imageName) {
<         ColorPalettePopup popup = new ColorPalettePopup (button.getParent ().getShell (), preferenceId, IDialogConstants.BUTTON_BAR_HEIGHT);
<         Rectangle r = button.getBounds ();
<         Point location = button.getParent ().toDisplay (r.x, r.y);
<         popup.open (new Point (location.x, location.y + r.height));
<         if (popup.getSelectedColor () != null) {
<             final RGB color = popup.getSelectedColor ();
<             if (color != null) {
<                 List commands = new ArrayList ();
<                 Iterator it = getInputIterator ();
<                 while (it.hasNext ()) {
<                     final IGraphicalEditPart ep = (IGraphicalEditPart) it.next ();
<                     commands.add (createCommand (commandName, ((View) ep.getModel ()).eResource (), new Runnable () {
< 
<                         public void run () {
<                             ENamedElement element = MetaModelUtil.getElement (propertyId);
<                             if (element instanceof EStructuralFeature) ep.setStructuralFeatureValue ((EStructuralFeature) MetaModelUtil.getElement (propertyId), FigureUtilities.RGBToInteger (color));
< 
<                         }
< 
<                     }
< 
<                     ));
<                 }
<                 executeAsCompositeCommand (commandName, commands);
<                 Image overlyedImage = new ColorOverlayImageDescriptor (DiagramUIPropertiesImages.get (imageName).getImageData (), color).createImage ();
<                 button.setImage (overlyedImage);
<             }
<             return color;
<         }
<         return null;
<     }
< 
