3,4d2
< import java.util.ArrayList;
< 
7,18d4
< import java.util.HashMap;
< 
< import java.util.HashSet;
< 
< import java.util.Iterator;
< 
< import java.util.List;
< 
< import java.util.Map;
< 
< import java.util.Set;
< 
23,24d8
< import org.eclipse.emf.common.util.BasicEList;
< 
33,33c21,21
< import org.eclipse.emf.ecore.util.EObjectContainmentWithInverseEList;
---
> import org.eclipse.emf.ecore.util.EObjectWithInverseResolvingEList;
35,35c17,17
< import org.eclipse.emf.ecore.util.EcoreUtil;
---
> import org.eclipse.emf.ecore.impl.EObjectImpl;
35a18,19
> 
> import org.eclipse.emf.ecore.util.EObjectResolvingEList;
43,43c31,31
< import org.eclipse.gmf.codegen.gmfgen.GenAuditRule;
---
> import org.eclipse.gmf.codegen.gmfgen.GenAuditRule;
44,51d31
< 
< import org.eclipse.gmf.codegen.gmfgen.GenDiagramElementTarget;
< 
< import org.eclipse.gmf.codegen.gmfgen.GenExpressionProviderContainer;
< 
< import org.eclipse.gmf.codegen.gmfgen.GenJavaExpressionProvider;
< 
< import org.eclipse.gmf.codegen.gmfgen.GenNotationElementTarget;
53,53c29,29
< import org.eclipse.gmf.codegen.gmfgen.GenRuleTarget;
---
> import org.eclipse.gmf.codegen.gmfgen.GenAuditRoot;
55,55c33,33
< public class GenAuditContainerImpl extends GenRuleContainerBaseImpl implements GenAuditContainer {
---
> public class GenAuditContainerImpl extends EObjectImpl implements GenAuditContainer {
63,63c40,40
<     protected EList childContainers = null;
---
>     protected EList path = null;
72a51,52
>     public GenAuditRoot getRoot () {
>         if (eContainerFeatureID != GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT) return null;
73,73c97,97
<     public EList getAudits () {
---
>     public EList getAudits () {
74,74c98,98
<         if (audits == null) {
---
>         if (audits == null) {
75,75c99,99
<             audits = new EObjectContainmentWithInverseEList (GenAuditRule.class, this, GMFGenPackage.GEN_AUDIT_CONTAINER__AUDITS, GMFGenPackage.GEN_AUDIT_RULE__CONTAINER);
---
>             audits = new EObjectWithInverseResolvingEList (GenAuditRule.class, this, GMFGenPackage.GEN_AUDIT_CONTAINER__AUDITS, GMFGenPackage.GEN_AUDIT_RULE__CATEGORY);
76,78d99
<         }
<         return audits;
<     }
79a54,54
>         return (GenAuditRoot) eContainer ();
80,84d53
<     public EList getChildContainers () {
<         if (childContainers == null) {
<             childContainers = new EObjectContainmentWithInverseEList (GenAuditContainer.class, this, GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS, GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER);
<         }
<         return childContainers;
120,156d89
<     public GenAuditContainer getParentContainer () {
<         if (eContainerFeatureID != GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER) return null;
< 
<         return (GenAuditContainer) eContainer ();
<     }
< 
<     public NotificationChain basicSetParentContainer (GenAuditContainer newParentContainer, NotificationChain msgs) {
<         msgs = eBasicSetContainer ((InternalEObject) newParentContainer, GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER, msgs);
<         return msgs;
<     }
< 
<     public void setParentContainer (GenAuditContainer newParentContainer) {
<         if (newParentContainer != eInternalContainer () || (eContainerFeatureID != GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER && newParentContainer != null)) {
<             if (EcoreUtil.isAncestor (this, newParentContainer)) throw new IllegalArgumentException ("Recursive containment not allowed for " + toString ());
< 
<             NotificationChain msgs = null;
<             if (eInternalContainer () != null) msgs = eBasicRemoveFromContainer (msgs);
< 
<             if (newParentContainer != null) msgs = ((InternalEObject) newParentContainer).eInverseAdd (this, GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS, GenAuditContainer.class, msgs);
< 
<             msgs = basicSetParentContainer (newParentContainer, msgs);
<             if (msgs != null) msgs.dispatch ();
< 
<         } else if (eNotificationRequired ()) eNotify (new ENotificationImpl (this, Notification.SET, GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER, newParentContainer, newParentContainer));
< 
<     }
< 
<     public EList getAllAuditRules () {
<         return getAllRulesInContainer (this, new BasicEList ());
<     }
< 
<     public EList getAllAuditContainers () {
<         EList containerList = new BasicEList ();
<         containerList.add (this);
<         return getAllChildContainers (this, containerList);
<     }
< 
157a91,92
>         if (path == null) {
>             path = new EObjectResolvingEList (GenAuditContainer.class, this, GMFGenPackage.GEN_AUDIT_CONTAINER__PATH);
158,185d90
<         GenAuditContainer parent = this;
<         EList elements = new BasicEList ();
<         while (parent != null) {
<             elements.add (0, parent);
<             parent = parent.getParentContainer ();
<         }
<         return elements;
<     }
< 
<     public Map getAllRulesToTargetContextMap () {
<         HashMap ctx2ruleMap = new HashMap ();
<         EList allRules = getAllAuditRules ();
<         for (Iterator it = allRules.iterator ();
<         it.hasNext ();) {
<             GenAuditRule nextRule = (GenAuditRule) it.next ();
<             String key = (nextRule.getTarget () != null) ? nextRule.getTarget ().getClientContextID () : null;
<             if (key != null) {
<                 List rulesInCtx = null;
<                 if (ctx2ruleMap.containsKey (key)) {
<                     rulesInCtx = (List) ctx2ruleMap.get (key);
<                 } else {
<                     rulesInCtx = new BasicEList ();
<                     ctx2ruleMap.put (key, rulesInCtx);
<                 }
<                 rulesInCtx.add (nextRule);
<             }
<         }
<         return ctx2ruleMap;
186a94,94
>         return path;
187,198d93
< 
<     public EList getAllTargetedModelPackages () {
<         Set packages = new HashSet ();
<         EList allRules = getAllAuditRules ();
<         for (Iterator it = allRules.iterator ();
<         it.hasNext ();) {
<             GenAuditRule nextRule = (GenAuditRule) it.next ();
<             if (nextRule.getTarget () != null && nextRule.getTarget ().getTargetClass () != null) {
<                 packages.add (nextRule.getTarget ().getTargetClass ().getGenPackage ());
<             }
<         }
<         return new BasicEList (packages);
201,254d96
<     public boolean hasDiagramElementRule () {
<         EList rules = getAllAuditRules ();
<         for (Iterator it = rules.iterator ();
<         it.hasNext ();) {
<             GenAuditRule nextRule = (GenAuditRule) it.next ();
<             GenRuleTarget target = nextRule.getTarget ();
<             if (target instanceof GenDiagramElementTarget || target instanceof GenNotationElementTarget) {
<                 return true;
<             }
<         }
<         return false;
<     }
< 
<     public List getAllContextSelectorsLocalClassNames () {
<         HashSet < String > classNames = new HashSet < String > ();
<         EList allRules = getAllAuditRules ();
<         for (Iterator it = allRules.iterator ();
<         it.hasNext ();) {
<             String nextClassName = ((GenAuditRule) it.next ()).getContextSelectorLocalClassName ();
<             if (nextClassName != null) {
<                 classNames.add (nextClassName);
<             }
<         }
<         return new ArrayList < String > (classNames);
<     }
< 
<     public List getAllRequiredConstraintAdaptersLocalClassNames () {
<         HashSet < String > classNames = new HashSet < String > ();
<         EList allRules = getAllAuditRules ();
<         for (Iterator it = allRules.iterator ();
<         it.hasNext ();) {
<             GenAuditRule nextAudit = (GenAuditRule) it.next ();
<             if (nextAudit.isRequiresConstraintAdapter ()) {
<                 String nextClassName = nextAudit.getConstraintAdapterLocalClassName ();
<                 if (nextClassName != null) {
<                     classNames.add (nextClassName);
<                 }
<             }
<         }
<         return new ArrayList < String > (classNames);
<     }
< 
<     public List getAllJavaLangAudits () {
<         List < GenAuditRule > audits = new ArrayList < GenAuditRule > ();
<         if (getEditor () == null || getEditor ().getExpressionProviders () == null) {
<             return audits;
<         }
<         GenExpressionProviderContainer exprProviders = getEditor ().getExpressionProviders ();
<         for (Iterator it = getAllAuditRules ().iterator ();
<         it.hasNext ();) {
<             GenAuditRule nextAudit = (GenAuditRule) it.next ();
<             if (nextAudit.getRule () != null && exprProviders.getProvider (nextAudit.getRule ()) instanceof GenJavaExpressionProvider) {
<                 audits.add (nextAudit);
<             }
261,261c106,106
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT :
264,264c109,109
<                 return basicSetParentContainer ((GenAuditContainer) otherEnd, msgs);
---
>                 return eBasicSetContainer (otherEnd, GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT, msgs);
267,268d111
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
<                 return ((InternalEList) getChildContainers ()).basicAdd (otherEnd, msgs);
275,275c118,118
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT :
276,276c119,119
<                 return basicSetParentContainer (null, msgs);
---
>                 return eBasicSetContainer (null, GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT, msgs);
279,280d121
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
<                 return ((InternalEList) getChildContainers ()).basicRemove (otherEnd, msgs);
286a128,128
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT :
287,287d127
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
288,288c129,129
<                 return eInternalContainer ().eInverseRemove (this, GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS, GenAuditContainer.class, msgs);
---
>                 return eInternalContainer ().eInverseRemove (this, GMFGenPackage.GEN_AUDIT_ROOT__CATEGORIES, GenAuditRoot.class, msgs);
301,301c136,136
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT :
302,302c137,137
<                 return getParentContainer ();
---
>                 return getRoot ();
305,305c144,144
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__PATH :
306,306c145,145
<                 return getChildContainers ();
---
>                 return getPath ();
322,323d162
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
<                 setParentContainer ((GenAuditContainer) newValue);
328a163,164
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__PATH :
>                 getPath ().clear ();
329,330d162
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
<                 getChildContainers ().clear ();
331,331c165,165
<                 getChildContainers ().addAll ((Collection) newValue);
---
>                 getPath ().addAll ((Collection) newValue);
332,332d165
<                 return;
348,349d185
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
<                 setParentContainer ((GenAuditContainer) null);
354,354c186,186
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__PATH :
355,355c187,187
<                 getChildContainers ().clear ();
---
>                 getPath ().clear ();
356,356d187
<                 return;
369,369c198,198
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__PARENT_CONTAINER :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__ROOT :
370,370c199,199
<                 return getParentContainer () != null;
---
>                 return getRoot () != null;
373,373c206,206
<             case GMFGenPackage.GEN_AUDIT_CONTAINER__CHILD_CONTAINERS :
---
>             case GMFGenPackage.GEN_AUDIT_CONTAINER__PATH :
374,374c207,207
<                 return childContainers != null && ! childContainers.isEmpty ();
---
>                 return path != null && ! path.isEmpty ();
393,412d227
<     private static EList getAllRulesInContainer (GenAuditContainer container, EList rules) {
<         rules.addAll (container.getAudits ());
<         for (Iterator it = container.getChildContainers ().iterator ();
<         it.hasNext ();) {
<             GenAuditContainer nextContainer = (GenAuditContainer) it.next ();
<             getAllRulesInContainer (nextContainer, rules);
<         }
<         return rules;
<     }
< 
<     private static EList getAllChildContainers (GenAuditContainer container, EList containers) {
<         containers.addAll (container.getChildContainers ());
<         for (Iterator it = container.getChildContainers ().iterator ();
<         it.hasNext ();) {
<             GenAuditContainer nextContainer = (GenAuditContainer) it.next ();
<             getAllChildContainers (nextContainer, containers);
<         }
<         return containers;
<     }
< 
