50a51,54
> import org.eclipse.emf.transaction.impl.InternalTransaction;
> 
> import org.eclipse.emf.transaction.impl.InternalTransactionalEditingDomain;
> 
90a95,96
> import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramEditPart;
> 
344a351,355
>         Map options = null;
>         EditPart ep = getHost ();
>         while (ep != null && ! (ep instanceof DiagramEditPart)) {
>             ep = ep.getParent ();
>         }
345,345c356,356
<         Map options = Collections.singletonMap (Transaction.OPTION_UNPROTECTED, Boolean.TRUE);
---
>         if (ep == null || (ep != null && ((DiagramEditPart) ep).isActivatingDiagram ()) || ! isWriteTransactionInProgress ()) options = Collections.singletonMap (Transaction.OPTION_UNPROTECTED, Boolean.TRUE);
345a357,357
> 
736a749,762
>     private boolean isWriteTransactionInProgress () {
>         TransactionalEditingDomain theEditingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
>         if (theEditingDomain instanceof InternalTransactionalEditingDomain) {
>             InternalTransactionalEditingDomain internalEditingDomain = (InternalTransactionalEditingDomain) theEditingDomain;
>             InternalTransaction transaction = internalEditingDomain.getActiveTransaction ();
>             if (transaction != null && ! transaction.isReadOnly ()) {
>                 Object unprotectedMode = transaction.getOptions ().get (Transaction.OPTION_UNPROTECTED);
>                 if (unprotectedMode == null || unprotectedMode == Boolean.FALSE) return true;
> 
>             }
>         }
>         return false;
>     }
> 
