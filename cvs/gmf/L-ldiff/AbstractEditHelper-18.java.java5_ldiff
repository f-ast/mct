18a19,20
> import java.util.Set;
> 
60a63,64
> import org.eclipse.gmf.runtime.emf.type.core.internal.requests.RequestCacheEntries;
> 
184a189,189
>         IEditHelperAdvice [] advices = null;
185a191,201
>         Map cacheMaps = (Map) req.getParameter (RequestCacheEntries.Cache_Maps);
>         if (cacheMaps != null) {
>             Map contextMap = (Map) cacheMaps.get (editHelperContext);
>             if (contextMap != null) {
>                 advices = (IEditHelperAdvice []) contextMap.get (RequestCacheEntries.EditHelper_Advice);
>             }
>         }
>         if (advices == null) {
>             advices = ElementTypeRegistry.getInstance ().getEditHelperAdvice (editHelperContext);
>         }
>         return advices;
186,186d190
<         return ElementTypeRegistry.getInstance ().getEditHelperAdvice (editHelperContext);
193a209,209
>                 IStatus status = (_result == null) ? null : _result.getStatus ();
193,193c208,208
<                 CommandResult result = super.getCommandResult ();
---
>                 CommandResult _result = super.getCommandResult ();
194,194d208
<                 IStatus status = result.getStatus ();
195,195c210,210
<                 if (status.getSeverity () == IStatus.OK) {
---
>                 if (status != null && status.getSeverity () == IStatus.OK) {
197,197c212,212
<                     Object returnValue = result.getReturnValue ();
---
>                     Object returnValue = _result.getReturnValue ();
206,206c221,221
<                     result = new CommandResult (status, returnObject);
---
>                     _result = new CommandResult (status, returnObject);
208,208c223,223
<                 return result;
---
>                 return _result;
359a375,383
>         IElementType typeToDestroy = null;
>         Map cacheMaps = (Map) req.getParameter (RequestCacheEntries.Cache_Maps);
>         if (cacheMaps != null) {
>             Map map = (Map) cacheMaps.get (req.getElementToDestroy ());
>             if (map != null) {
>                 typeToDestroy = (IElementType) map.get (RequestCacheEntries.Element_Type);
>             }
>         }
>         if (typeToDestroy == null) {
360,360c384,384
<         IElementType typeToDestroy = ElementTypeRegistry.getInstance ().getElementType (req.getElementToDestroy ());
---
>             typeToDestroy = ElementTypeRegistry.getInstance ().getElementType (req.getElementToDestroy ());
360a385,385
>         }
373a399,409
>         IElementType parentType = null;
>         Map cacheMaps = (Map) req.getParameter (RequestCacheEntries.Cache_Maps);
>         Set checkedElement = null;
>         if (cacheMaps != null) {
>             checkedElement = (Set) cacheMaps.get (RequestCacheEntries.Checked_Elements);
>             checkedElement.add (parent);
>             Map parentMap = (Map) cacheMaps.get (parent);
>             parentType = (IElementType) parentMap.get (RequestCacheEntries.Element_Type);
>         } else {
>             parentType = ElementTypeRegistry.getInstance ().getElementType (parent);
>         }
374,374d398
<         IElementType parentType = ElementTypeRegistry.getInstance ().getElementType (parent);
380,380c415,415
<                 if ((ddr == null) || ! ddr.getDependentElementsToDestroy ().contains (next)) {
---
>                 if ((ddr == null) || ((checkedElement != null) && checkedElement.add (next)) || (! ddr.getDependentElementsToDestroy ().contains (next))) {
