24a85,85
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
25,25d84
< import org.eclipse.emf.edit.domain.EditingDomain;
26,26c86,86
< 
---
> 
78a77,80
> import java.util.Iterator;
> 
> import org.eclipse.emf.ecore.util.EcoreUtil;
> 
86a91,91
>     private URI mySelectedModelElementURI;
87,87d90
<     private EObject mySelectedModelElement;
89,89c93,93
<     private EditingDomain myEditingDomain = GMFEditingDomainFactory.INSTANCE.createEditingDomain ();
---
>     private TransactionalEditingDomain myEditingDomain = GMFEditingDomainFactory.INSTANCE.createEditingDomain ();
132a137,148
>         return mySelectedModelElementURI;
>     }
> 
>     public int open () {
>         int result = super.open ();
>         for (Iterator it = myEditingDomain.getResourceSet ().getResources ().iterator ();
>         it.hasNext ();) {
>             Resource resource = (Resource) it.next ();
>             resource.unload ();
>         }
>         myEditingDomain.dispose ();
>         return result;
133,134d136
<         Resource resource = mySelectedModelElement.eResource ();
<         return resource.getURI ().appendFragment (resource.getURIFragment (mySelectedModelElement));
264a279,279
>                         EObject selectedModelElement = (EObject) selectedElement;
265,265d278
<                         mySelectedModelElement = (EObject) selectedElement;
266,266c280,280
<                         setOkButtonEnabled (ViewService.getInstance ().provides (Node.class, new EObjectAdapter (mySelectedModelElement), myView, null, ViewUtil.APPEND, true, GMFGraphDiagramEditorPlugin.DIAGRAM_PREFERENCES_HINT));
---
>                         setOkButtonEnabled (ViewService.getInstance ().provides (Node.class, new EObjectAdapter (selectedModelElement), myView, null, ViewUtil.APPEND, true, GMFGraphDiagramEditorPlugin.DIAGRAM_PREFERENCES_HINT));
266a281,281
>                         mySelectedModelElementURI = EcoreUtil.getURI (selectedModelElement);
271,271c286,286
<             mySelectedModelElement = null;
---
>             mySelectedModelElementURI = null;
