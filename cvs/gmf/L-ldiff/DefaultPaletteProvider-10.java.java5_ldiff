273,273c273,273
<             PaletteEntry paletteEntry = findPredefinedEntry (predefinedEntries, id);
---
>             PaletteEntry paletteEntry = findPaletteEntry (root, id);
275,280d274
<                 if (path != null && ! remove) {
<                     appendPaletteEntry (root, predefinedEntries, path, paletteEntry);
<                 }
<             } else {
<                 paletteEntry = findPaletteEntry (root, id);
<             }
288a283,294
>             if (paletteEntry == null) {
>                 paletteEntry = findPredefinedEntry (predefinedEntries, id);
>             }
>             if (paletteEntry != null) {
>                 if (path != null) {
>                     appendPaletteEntry (root, predefinedEntries, path, paletteEntry);
>                     if (paletteEntry instanceof PaletteDrawer && expandHelper.expand (content)) {
>                         ((PaletteDrawer) paletteEntry).setInitialState (PaletteDrawer.INITIAL_STATE_OPEN);
>                     }
>                 }
>             }
>         }
