80a81,82
> import org.eclipse.swt.graphics.Image;
> 
362a365,365
>         IFigure fig = getEditPart ().getFigure ();
363,363d364
<         WrapLabel fig = ((TextCompartmentEditPart) this.getEditPart ()).getLabel ();
371a374,394
>         Rectangle iconBounds;
>         Image icon;
>         int textPlacement;
>         String subStringText;
>         String text;
>         IFigure fig = getEditPart ().getFigure ();
>         if (fig instanceof WrapLabel) {
>             WrapLabel label = (WrapLabel) fig;
>             iconBounds = label.getIconBounds ().getCopy ();
>             icon = label.getIcon ();
>             textPlacement = label.getTextPlacement ();
>             subStringText = label.getSubStringText ();
>             text = label.getText ();
>         } else if (fig instanceof Label) {
>             Label label = (Label) fig;
>             iconBounds = label.getIconBounds ().getCopy ();
>             icon = label.getIcon ();
>             textPlacement = label.getTextPlacement ();
>             subStringText = label.getSubStringText ();
>             text = label.getText ();
>         } else {
372,372d373
<         if (! (getEditPart () instanceof TextCompartmentEditPart)) {
375a398,398
> 
376,376d397
<         WrapLabel fig = ((TextCompartmentEditPart) this.getEditPart ()).getLabel ();
386,386d407
<         Rectangle iconBounds = fig.getIconBounds ().getCopy ();
390,390c411,411
<         if (fig.getIcon () != null && fig.getTextPlacement () == PositionConstants.EAST) xWidth -= iconBounds.width;
---
>         if (icon != null && textPlacement == PositionConstants.EAST) xWidth -= iconBounds.width;
395,395c416,416
<         StringTokenizer tokenizer = new StringTokenizer (fig.getSubStringText (), "\n");
---
>         StringTokenizer tokenizer = new StringTokenizer (subStringText, "\n");
400,400c421,421
<                 String newLineCheck = fig.getText ().substring (charCount, charCount + 1);
---
>                 String newLineCheck = text.substring (charCount, charCount + 1);
