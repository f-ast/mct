2a3,4
> import java.util.Iterator;
> 
3,3c5,5
< import org.eclipse.emf.ecore.EObject;
---
> import org.eclipse.emf.ecore.EAnnotation;
9,12d50
< import org.eclipse.gef.commands.UnexecutableCommand;
< 
< import org.eclipse.gmf.gmfgraph.DiagramElement;
< 
13,13c51,51
< import org.eclipse.gmf.gmfgraph.FigureHandle;
---
> import org.eclipse.gmf.runtime.notation.View;
14,14d51
< 
16a13,14
> import org.eclipse.gmf.graphdef.editor.edit.commands.ChildAccessCreateCommand;
> 
17,17c15,15
< import org.eclipse.gmf.graphdef.editor.edit.commands.DiagramElementFigureReorientCommand;
---
> import org.eclipse.gmf.graphdef.editor.edit.commands.ChildAccessReorientCommand;
26a25,26
> import org.eclipse.gmf.graphdef.editor.edit.parts.ChildAccessEditPart;
> 
27,27c27,27
< import org.eclipse.gmf.graphdef.editor.edit.parts.DiagramElementFigureEditPart;
---
> import org.eclipse.gmf.graphdef.editor.edit.parts.EllipseEditPart;
27a28,35
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.PolylineEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.Rectangle2EditPart;
> 
> import org.eclipse.gmf.graphdef.editor.edit.parts.RoundedRectangleEditPart;
> 
> import org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry;
33,34d40
< import org.eclipse.gmf.runtime.emf.type.core.commands.SetValueCommand;
< 
41a48,49
> 
> import org.eclipse.gmf.runtime.notation.Node;
41,41c47,47
< import org.eclipse.gmf.runtime.emf.type.core.requests.ReorientReferenceRelationshipRequest;
---
> import org.eclipse.gmf.runtime.emf.type.core.requests.ReorientRelationshipRequest;
43,43d50
< import org.eclipse.gmf.runtime.emf.type.core.requests.SetRequest;
48,48c56,56
<         if (GMFGraphElementTypes.Rectangle_3002 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Rectangle_3011 == req.getElementType ()) {
50,50c58,58
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
52,52c60,60
<             return getMSLWrapper (new Rectangle2CreateCommand (req));
---
>             return getGEFWrapper (new Rectangle2CreateCommand (req));
54,54c62,62
<         if (GMFGraphElementTypes.Ellipse_3003 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Ellipse_3012 == req.getElementType ()) {
56,56c64,64
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
58,58c66,66
<             return getMSLWrapper (new EllipseCreateCommand (req));
---
>             return getGEFWrapper (new EllipseCreateCommand (req));
60,60c68,68
<         if (GMFGraphElementTypes.RoundedRectangle_3004 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.RoundedRectangle_3013 == req.getElementType ()) {
62,62c70,70
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
64,64c72,72
<             return getMSLWrapper (new RoundedRectangleCreateCommand (req));
---
>             return getGEFWrapper (new RoundedRectangleCreateCommand (req));
66,66c74,74
<         if (GMFGraphElementTypes.Polyline_3005 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.Polyline_3014 == req.getElementType ()) {
68,68c76,76
<                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getFigure_Children ());
---
>                 req.setContainmentFeature (GMFGraphPackage.eINSTANCE.getRealFigure_Children ());
70,70c78,78
<             return getMSLWrapper (new PolylineCreateCommand (req));
---
>             return getGEFWrapper (new PolylineCreateCommand (req));
75a84,86
>         CompoundCommand cc = getDestroyEdgesCommand ();
>         addDestroyChildNodesCommand (cc);
>         addDestroyShortcutsCommand (cc);
76,76d83
<         CompoundCommand cc = getDestroyEdgesCommand (req.isConfirmationRequired ());
77,77c87,87
<         cc.add (getMSLWrapper (new DestroyElementCommand (req)));
---
>         cc.add (getGEFWrapper (new DestroyElementCommand (req)));
80a121,121
> 
80a91,113
>     protected void addDestroyChildNodesCommand (CompoundCommand cmd) {
>         View view = (View) getHost ().getModel ();
>         EAnnotation annotation = view.getEAnnotation ("Shortcut");
>         if (annotation != null) {
>             return;
>         }
>         for (Iterator it = view.getChildren ().iterator ();
>         it.hasNext ();) {
>             Node node = (Node) it.next ();
>             switch (GMFGraphVisualIDRegistry.getVisualID (node)) {
>                 case Rectangle2EditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case EllipseEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case RoundedRectangleEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>                 case PolylineEditPart.VISUAL_ID :
>                     cmd.add (getDestroyElementCommand (node));
>                     break;
>             }
81,81c122,122
<     protected Command getCreateRelationshipCommand (CreateRelationshipRequest req) {
---
>     protected Command getStartCreateRelationshipCommand (CreateRelationshipRequest req) {
82a124,131
>             return null;
>         }
>         return null;
>     }
> 
>     protected Command getCompleteCreateRelationshipCommand (CreateRelationshipRequest req) {
>         if (GMFGraphElementTypes.ChildAccess_4002 == req.getElementType ()) {
>             return getGEFWrapper (new ChildAccessCreateCommand (req, req.getSource (), req.getTarget ()));
82,82c123,123
<         if (GMFGraphElementTypes.DiagramElementFigure_4001 == req.getElementType ()) {
---
>         if (GMFGraphElementTypes.ChildAccess_4002 == req.getElementType ()) {
83,83d123
<             return req.getTarget () == null ? null : getCreateCompleteIncomingDiagramElementFigure_4001Command (req);
85,85c141,141
<         return super.getCreateRelationshipCommand (req);
---
>         return super.getReorientRelationshipCommand (req);
87a117,119
>     protected Command getCreateRelationshipCommand (CreateRelationshipRequest req) {
>         Command command = req.getTarget () == null ? getStartCreateRelationshipCommand (req) : getCompleteCreateRelationshipCommand (req);
>         return command != null ? command : super.getCreateRelationshipCommand (req);
88,92d116
<     protected Command getCreateCompleteIncomingDiagramElementFigure_4001Command (CreateRelationshipRequest req) {
<         EObject sourceEObject = req.getSource ();
<         EObject targetEObject = req.getTarget ();
<         if (false == sourceEObject instanceof DiagramElement || false == targetEObject instanceof FigureHandle) {
<             return UnexecutableCommand.INSTANCE;
94,97d120
<         DiagramElement source = (DiagramElement) sourceEObject;
<         FigureHandle target = (FigureHandle) targetEObject;
<         if (! GMFGraphBaseItemSemanticEditPolicy.LinkConstraints.canCreateDiagramElementFigure_4001 (source, target)) {
<             return UnexecutableCommand.INSTANCE;
98a133,133
>         return null;
99,100d132
<         SetRequest setReq = new SetRequest (sourceEObject, GMFGraphPackage.eINSTANCE.getDiagramElement_Figure (), target);
<         return getMSLWrapper (new SetValueCommand (setReq));
103,103c136,136
<     protected Command getReorientReferenceRelationshipCommand (ReorientReferenceRelationshipRequest req) {
---
>     protected Command getReorientRelationshipCommand (ReorientRelationshipRequest req) {
104a138,138
>             case ChildAccessEditPart.VISUAL_ID :
105,105d137
<             case DiagramElementFigureEditPart.VISUAL_ID :
106,106c139,139
<                 return getMSLWrapper (new DiagramElementFigureReorientCommand (req));
---
>                 return getGEFWrapper (new ChildAccessReorientCommand (req));
108,108d140
<         return super.getReorientReferenceRelationshipCommand (req);
