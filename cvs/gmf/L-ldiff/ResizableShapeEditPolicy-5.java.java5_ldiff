6a7,8
> import org.eclipse.core.commands.ExecutionException;
> 
26a29,30
> import org.eclipse.emf.transaction.TransactionalEditingDomain;
> 
54a59,60
> import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
> 
61,61c67,67
< import org.eclipse.gmf.runtime.emf.commands.core.command.AbstractModelCommand;
---
> import org.eclipse.gmf.runtime.emf.commands.core.command.AbstractTransactionalCommand;
94a101,101
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
95,95c102,102
<         ICommand resizeCommand = new SetBoundsCommand (DiagramUIMessages.SetAutoSizeCommand_Label, new EObjectAdapter ((View) getHost ().getModel ()), new Dimension (- 1, - 1));
---
>         ICommand resizeCommand = new SetBoundsCommand (editingDomain, DiagramUIMessages.SetAutoSizeCommand_Label, new EObjectAdapter ((View) getHost ().getModel ()), new Dimension (- 1, - 1));
100,100c107,107
<         final class SetDeferredPropertyCommand extends AbstractModelCommand {
---
>         final class SetDeferredPropertyCommand extends AbstractTransactionalCommand {
104,104c111,111
<             public SetDeferredPropertyCommand (String label, IAdaptable viewAdapter, IAdaptable newValue) {
---
>             public SetDeferredPropertyCommand (TransactionalEditingDomain editingDomain, String label, IAdaptable viewAdapter, IAdaptable newValue) {
105,105c112,112
<                 super (label, null);
---
>                 super (editingDomain, label, null);
109a117,117
>             protected CommandResult doExecuteWithResult (IProgressMonitor progressMonitor, IAdaptable info) throws ExecutionException {
110,110d116
<             protected CommandResult doExecute (IProgressMonitor progressMonitor) {
111,111c118,118
<                 if (null == viewAdapter || null == newValue) return newCancelledCommandResult ();
---
>                 if (null == viewAdapter || null == newValue) return CommandResult.newCancelledCommandResult ();
119,119c126,126
<                 return newOKCommandResult ();
---
>                 return CommandResult.newOKCommandResult ();
123a131,132
>         View view = (View) getHost ().getModel ();
>         TransactionalEditingDomain editingDomain = ((IGraphicalEditPart) getHost ()).getEditingDomain ();
124,124c133,133
<         SetDeferredPropertyCommand cmd = new SetDeferredPropertyCommand (DiagramUIMessages.ResizableShapeEditPolicy_MoveDeferredCommand_label, new EObjectAdapter ((View) getHost ().getModel ()), request.getLocationAdapter ());
---
>         SetDeferredPropertyCommand cmd = new SetDeferredPropertyCommand (editingDomain, DiagramUIMessages.ResizableShapeEditPolicy_MoveDeferredCommand_label, new EObjectAdapter (view), request.getLocationAdapter ());
