head	1.10;
access;
symbols
	v20081022-1925:1.10
	v20081015-1925:1.10
	v20081008-1925:1.10
	v20081001-1925:1.10
	v20080924-1925:1.10
	v20080917-1925:1.10
	v20080911-1728:1.10
	v20080910-1520:1.10
	v20080903-1520:1.10
	v20080827-1520:1.10
	v20080813-1520:1.10
	v20080806-1520:1.10
	v20070202-0200:1.8
	v20061214-0000:1.9
	v20061120-1300:1.9
	M3_20:1.9
	v20061117-0800:1.9
	v20061027-1200:1.8
	v20061020-1000:1.8
	v20061013-1330:1.8
	v20060919-0800:1.8
	v20060907-1100:1.8
	M1_20:1.8
	v20060904-1500:1.8
	v20060824-1600:1.8
	v20060817-1500:1.8
	v20060728-0500:1.8
	v20060713-1700:1.8
	R1_0_maintenance:1.8.0.2
	R1_0:1.8
	v20060627-1200:1.8
	v20060626-1420:1.8
	v20060620-0400:1.7
	v20060616-1400:1.7
	v20060616-1200:1.7
	v20060609-1400:1.7
	v20060531-1730:1.7
	v20060530-1930:1.7
	v20060526-1200:1.7
	v20060519-1300:1.7
	v20060519-0800:1.7
	v20060512-1000:1.6
	I20060512-1000:1.6
	I20060505-1400:1.6
	I20060428-1300:1.6
	I20060424-0500:1.6
	I20060424-0300:1.6
	M6_10:1.6
	I20060407-1200:1.6
	I20060331-1000:1.5
	I20060324-0300:1.5
	I20060317-1300:1.5
	I20060317-1200:1.5
	I20060316-1300:1.5
	I20060309-1300:1.5
	M5_10:1.4
	S20060303-1600:1.4
	I20060227-1730:1.4
	I20060216-1945:1.4
	I20060210-1715:1.4
	I20060209-1815:1.4
	I20060203-0830:1.2
	I20060202-1415:1.2
	I20060129-1145:1.2
	I20060127-0900:1.2
	I20060120-1530:1.2
	I20060113-1700:1.1
	M4_10:1.1;
locks; strict;
comment	@# @;
expand	@k@;


1.10
date	2006.12.14.19.02.23;	author dstadnik;	state dead;
branches;
next	1.9;
commitid	408e45819fb94567;

1.9
date	2006.10.25.12.10.45;	author dstadnik;	state Exp;
branches;
next	1.8;

1.8
date	2006.06.23.08.52.04;	author dstadnik;	state Exp;
branches;
next	1.7;

1.7
date	2006.05.18.13.58.29;	author atikhomirov;	state Exp;
branches;
next	1.6;

1.6
date	2006.04.05.15.07.40;	author dstadnik;	state Exp;
branches;
next	1.5;

1.5
date	2006.03.07.15.45.28;	author dstadnik;	state Exp;
branches;
next	1.4;

1.4
date	2006.02.08.17.15.50;	author atikhomirov;	state Exp;
branches;
next	1.3;

1.3
date	2006.02.05.22.57.54;	author atikhomirov;	state Exp;
branches;
next	1.2;

1.2
date	2006.01.20.13.07.39;	author dstadnik;	state Exp;
branches;
next	1.1;

1.1
date	2006.01.12.11.43.59;	author dstadnik;	state Exp;
branches;
next	;


desc
@@


1.10
log
@[164935] Use border items infrastructure to support external labels
@
text
@<%@@ jet package="org.eclipse.gmf.codegen.templates.parts" class="DiagramExternalNodeLabelEditPartGenerator"
	imports="org.eclipse.gmf.codegen.gmfgen.* org.eclipse.gmf.common.codegen.*"%>
<%
final GenDiagram genDiagram = (GenDiagram) ((Object[]) argument)[0];
final ImportAssistant importManager = (ImportAssistant) ((Object[]) argument)[1];
%>
<%@@ include file="../copyright4java.jetinc"%>
<%importManager.emitPackageStatement(stringBuffer);%>

import org.eclipse.draw2d.IFigure;
import org.eclipse.draw2d.geometry.Dimension;
import org.eclipse.draw2d.geometry.Point;
import org.eclipse.gef.EditPolicy;
import org.eclipse.gef.GraphicalEditPart;
import org.eclipse.gef.Handle;
import org.eclipse.gef.handles.AbstractHandle;
import org.eclipse.gmf.runtime.diagram.ui.editparts.LabelEditPart;
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.NonResizableLabelEditPolicy;
import org.eclipse.gmf.runtime.diagram.ui.figures.LabelLocator;
import org.eclipse.gmf.runtime.diagram.ui.tools.DragEditPartsTrackerEx;
import org.eclipse.gmf.runtime.notation.NotationPackage;
import org.eclipse.gmf.runtime.notation.View;
<%importManager.markImportLocation(stringBuffer);%>

/**
 * @@generated
 */
public class <%=genDiagram.getBaseExternalNodeLabelEditPartClassName()%> extends LabelEditPart {

	/**
	 * @@generated
	 */
	public <%=genDiagram.getBaseExternalNodeLabelEditPartClassName()%>(View view) {
		super(view);
	}

	/**
	 * @@generated
	 */
	protected void createDefaultEditPolicies() {
		super.createDefaultEditPolicies();
		installEditPolicy(EditPolicy.PRIMARY_DRAG_ROLE, new NonResizableLabelEditPolicy() {

			protected void replaceHandleDragEditPartsTracker(Handle handle) {
				if (handle instanceof AbstractHandle) {
					((AbstractHandle) handle).setDragTracker(new DragEditPartsTrackerEx(getHost()) {

						protected boolean isMove() {
							return true;
						}
					});
				}
			}
		});
	}

	/**
	 * @@generated
	 */
	public void refreshBounds() {
		IFigure refFigure = ((GraphicalEditPart) getParent()).getFigure();
		int dx = ((Integer) getStructuralFeatureValue(NotationPackage.eINSTANCE.getLocation_X())).intValue();
		int dy = ((Integer) getStructuralFeatureValue(NotationPackage.eINSTANCE.getLocation_Y())).intValue();
		Point offset = new Point(dx, dy);
		getFigure().getParent().setConstraint(getFigure(), new LabelLocator(refFigure, offset, getKeyPoint()) {

			public void relocate(IFigure target) {
				Point location = getReferencePoint().getTranslated(getOffset());
				location.translate(-target.getBounds().width / 2, 0);
				target.setLocation(location);
				target.setSize(new Dimension(target.getPreferredSize().width, target.getPreferredSize().height));
			}

			protected Point getReferencePoint() {
				return getLabelLocation(parent);
			}
		});
	}

	/**
	 * @@generated
	 */
	public Point getReferencePoint() {
		return getLabelLocation(((GraphicalEditPart) getParent()).getFigure());
	}

	/**
	 * @@generated
	 */
	protected Point getLabelLocation(IFigure parent) {
		return parent.getBounds().getBottom();
	}
}
<%importManager.emitSortedImports();%>
@


1.9
log
@[162191] Do not create shortcuts on external label move
@
text
@@


1.8
log
@specify bottom offset in view factory
@
text
@d13 1
d15 2
d18 1
d20 1
d40 20
@


1.7
log
@use importAssistant to emit package statement instead of handcoding
@
text
@a27 5
	public static final int BOTTOM_GAP = 5;

	/**
	 * @@generated
	 */
d66 1
a66 1
		return parent.getBounds().getBottom().getTranslated(0, BOTTOM_GAP);
@


1.6
log
@#133328 Refactor code that calculates external node label location
@
text
@d4 2
a5 1
GenDiagram genDiagram = (GenDiagram) ((Object[]) argument)[0];
d8 1
a8 1
package <%=genDiagram.getEditPartsPackageName()%>;
a9 1
<%ImportUtil importManager = new ImportUtil(genDiagram.getEditPartsPackageName());%>
@


1.5
log
@#130100 Allow to specify copyright text in gmfgen model
@
text
@d55 1
a55 1
				return parent.getBounds().getBottom().getTranslated(0, BOTTOM_GAP);
d64 8
a71 1
		return ((GraphicalEditPart) getParent()).getFigure().getBounds().getBottom().getTranslated(0, BOTTOM_GAP);
@


1.4
log
@ImportManager has to know its package anyway, so why not use it to emit appropriate statement?
Besides, package fragment is external to template, template has no control over file placement, thus we'd better pass package name as an argument
@
text
@d6 1
@


1.3
log
@ImportManager moved to oeg.common
@
text
@d4 1
a4 1
GenDiagram genDiagram = (GenDiagram) argument;
@


1.2
log
@#112054 direct edit and correct placement
@
text
@d2 1
a2 1
	imports="org.eclipse.gmf.codegen.gmfgen.* org.eclipse.gmf.codegen.util.*"%>
@


1.1
log
@#122054 support external node labels
@
text
@d27 5
d48 1
a48 1
				location.translate(-1 * target.getBounds().width / 2, -1 * target.getBounds().height / 2);
d52 4
d58 7
@

