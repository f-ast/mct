head	1.4;
access;
symbols
	v20081022-1925:1.4
	v20081015-1925:1.4
	v20081008-1925:1.4
	v20081001-1925:1.4
	v20080924-1925:1.4
	v20080917-1925:1.4
	v20080911-1728:1.4
	v20080910-1520:1.4
	v20080903-1520:1.4
	v20080827-1520:1.4
	v20080813-1520:1.4
	v20080806-1520:1.4;
locks; strict;
comment	@# @;
expand	@k@;


1.4
date	2007.02.01.11.51.44;	author dstadnik;	state dead;
branches;
next	1.3;
commitid	dd445c1d44e4567;

1.3
date	2007.01.25.16.57.54;	author ashatalin;	state Exp;
branches;
next	1.2;
commitid	271945b8e1904567;

1.2
date	2007.01.18.19.17.02;	author ashatalin;	state Exp;
branches;
next	1.1;
commitid	1b245afc7ae4567;

1.1
date	2007.01.17.13.12.34;	author ashatalin;	state Exp;
branches;
next	;
commitid	3d0045ae20c04567;


desc
@@


1.4
log
@editpolicy templates should be located in one folder
@
text
@/*
 * Copyright (c) 2006 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Alexander Shatalin (Borland) - initial API and implementation
 */
 
import "http://www.eclipse.org/gmf/2005/GenModel/2.0";
import "http://www.eclipse.org/emf/2002/GenModel";
import "http://www.eclipse.org/emf/2002/Ecore";

String getContainerVariable(gmfgen::TypeLinkModelFacet modelFacet) :
	null != modelFacet.sourceMetaFeature
		? "container"
		: "source"
;

boolean hasJavaConstraints(gmfgen::GenDiagram diagram) :
	!getAllExpressionProviders(getValidLinkConstraints(diagram), getExpressionProvider(diagram)).typeSelect(gmfgen::GenJavaExpressionProvider).isEmpty()
;

boolean hasOCLConstraints(gmfgen::GenDiagram diagram) :
	!getAllExpressionProviders(getValidLinkConstraints(diagram), getExpressionProvider(diagram)).typeSelect(gmfgen::GenExpressionInterpreter).isEmpty()
;

private gmfgen::GenExpressionProviderContainer getExpressionProvider(gmfgen::GenDiagram diagram) :
	diagram.editorGen.expressionProviders
;

private List[gmfgen::GenExpressionProviderBase] getAllExpressionProviders(List[gmfgen::GenLinkConstraints] constraints, gmfgen::GenExpressionProviderContainer providersContainer) :
	constraints.collect(c | c.sourceEnd).addAll(constraints.collect(c | c.targetEnd)).select(c | null != c).typeSelect(gmfgen::GenConstraint).collect(c | providersContainer.getProvider(c))
;

String getTargetExpressionVarName(gmfgen::GenLink link) :
	link.getUniqueIdentifier() + "_TargetExpression"
;

String getSourceExpressionVarName(gmfgen::GenLink link) :
	link.getUniqueIdentifier() + "_SourceExpression"
;

List[gmfgen::GenLinkConstraints] getValidLinkConstraints(gmfgen::GenDiagram diagram) :
	diagram.links.select(l | null != l.creationConstraints && l.creationConstraints.isValid()).collect(l | l.creationConstraints)
;

List[gmfgen::GenLink] getAllPotentialLinks(gmfgen::GenNode node) :
	selectValidLinks(node.getDiagram().links).select(l | isSelf(l, node) || isOutgoing(l, node) || isIncoming(l, node))
;

private List[gmfgen::GenLink] selectValidLinks(List[gmfgen::GenLink] allLinks) :
	allLinks.select(l | null != l.modelFacet)
		.select(l | l.outgoingCreationAllowed || l.incomingCreationAllowed)
;

boolean createStartLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	createStartOutgoingLinkCommand(link, node) || createStartIncomingLinkCommand(link, node)
;

boolean createStartOutgoingLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	isSelf(link, node) || (isOutgoing(link, node) && link.outgoingCreationAllowed)
;

boolean createStartIncomingLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	isIncoming(link, node) && link.incomingCreationAllowed
;

boolean createCompleteLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	createCompleteIncomingLinkCommand(link, node) || createCompleteOutgoingLinkCommand(link, node)
;

boolean createCompleteIncomingLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	isSelf(link, node) || (isIncoming(link, node) && link.outgoingCreationAllowed)
;

boolean createCompleteOutgoingLinkCommand(gmfgen::GenLink link, gmfgen::GenNode node) :
	isOutgoing(link, node) && link.incomingCreationAllowed
;

private boolean isSelf(gmfgen::GenLink link, gmfgen::GenNode node) :
	canBeSource(link, node) && canBeTarget(link, node)
;

private boolean isOutgoing(gmfgen::GenLink link, gmfgen::GenNode node) :
	canBeSource(link, node) && !isSelf(link, node)
;

private boolean isIncoming(gmfgen::GenLink link, gmfgen::GenNode node) :
	canBeTarget(link, node) && !isSelf(link, node)
;

private boolean canBeSource(gmfgen::GenLink link, gmfgen::GenNode node) :
	null != link.modelFacet.getSourceType() && link.modelFacet.getSourceType().ecoreClass.isSuperTypeOf(getMetaclass(node))
;

private boolean canBeTarget(gmfgen::GenLink link, gmfgen::GenNode node) :
	null != link.modelFacet.getTargetType() && link.modelFacet.getTargetType().ecoreClass.isSuperTypeOf(getMetaclass(node))
;

private ecore::EClass getMetaclass(gmfgen::GenNode node) :
	node.modelFacet.metaClass.ecoreClass
;@


1.3
log
@Revriting BaseItemSemanticEditPolicy to xpand
@
text
@@


1.2
log
@isOrdered() && isUnique() collections are ratehr ordered then unique.

Unit-test created.
@
text
@d17 34
d84 1
a84 1
boolean isSelf(gmfgen::GenLink link, gmfgen::GenNode node) :
d88 1
a88 1
boolean isOutgoing(gmfgen::GenLink link, gmfgen::GenNode node) :
d92 1
a92 1
boolean isIncoming(gmfgen::GenLink link, gmfgen::GenNode node) :
@


1.1
log
@NodeItemSemanticEditPolicy template reimplemented using xpand.
@
text
@d17 1
a17 1
Set[gmfgen::GenLink] getAllPotentialLinks(gmfgen::GenNode node) :
d21 1
a21 1
private Set[gmfgen::GenLink] selectValidLinks(Set[gmfgen::GenLink] allLinks) :
@

