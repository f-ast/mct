head	1.8;
access;
symbols
	v20080813-1520:1.8
	v20080722-1827:1.8
	v20080716-1600:1.8
	v20080716-1642:1.8
	R2_1_maintenance:1.8.0.4
	Root_R2_1_maintenance:1.8
	R2_1_0:1.8
	v20080610-1132:1.8
	v20080528-1052:1.8
	v20080425-1959:1.8
	v20080417-1610:1.8
	v20080322-0000:1.8
	v20080222-1200:1.8
	v20070809-0000:1.8
	R2_0_maintenance:1.8.0.2
	R2_0:1.8
	R4_20:1.8
	v20070621-0000:1.8
	RC3_20:1.7
	v20070614-1400:1.7
	v20070608-1300:1.7
	v20070601-1400:1.7
	v20070520-1200:1.7
	v20070518-1300:1.7
	v20070504-1000:1.7
	v20070427-0600:1.7
	v20070420-1000:1.7
	v20070403-1500:1.6
	v20070330-1300:1.6
	v20060316-0600:1.6
	v20070208-1800:1.6
	M4_20:1.6
	v20061214-0000:1.6
	M3_20:1.6
	v20061117-0800:1.6
	v20061013-1330:1.6;
locks; strict;
comment	@# @;
expand	@k@;


1.8
date	2007.06.21.14.33.16;	author atikhomirov;	state Exp;
branches;
next	1.7;
commitid	3815467a8c2b4567;

1.7
date	2007.04.18.13.10.40;	author atikhomirov;	state Exp;
branches;
next	1.6;
commitid	671b462618cf4567;

1.6
date	2006.09.22.18.31.04;	author dstadnik;	state Exp;
branches;
next	1.5;

1.5
date	2006.09.22.17.20.43;	author dstadnik;	state Exp;
branches;
next	1.4;

1.4
date	2006.09.21.15.51.20;	author dstadnik;	state Exp;
branches;
next	1.3;

1.3
date	2006.09.21.15.28.57;	author dstadnik;	state Exp;
branches;
next	1.2;

1.2
date	2006.09.21.11.40.29;	author dstadnik;	state Exp;
branches;
next	1.1;

1.1
date	2006.09.19.11.44.36;	author dstadnik;	state Exp;
branches;
next	;


desc
@@


1.8
log
@fix copyright years
@
text
@/*
 * Copyright (c) 2006, 2007 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Dmitry Stadnik - initial API and implementation
 */
package org.eclipse.gmf.mappings.presentation;

import java.util.List;

import org.eclipse.emf.common.util.URI;
import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.EPackage;
import org.eclipse.emf.ecore.EcorePackage;
import org.eclipse.emf.ecore.resource.ResourceSet;
import org.eclipse.emf.ecore.resource.impl.ResourceSetImpl;
import org.eclipse.gmf.gmfgraph.Canvas;
import org.eclipse.gmf.gmfgraph.GMFGraphPackage;
import org.eclipse.gmf.gmfgraph.util.Assistant;
import org.eclipse.gmf.internal.common.ui.ComboElementSelectorExtension;
import org.eclipse.gmf.internal.common.ui.CreateNewModelExtension;
import org.eclipse.gmf.internal.common.ui.ElementSelectorExtension;
import org.eclipse.gmf.internal.common.ui.ExtensibleModelSelectionPage;
import org.eclipse.gmf.internal.common.ui.ListElementSelectorExtension;
import org.eclipse.gmf.internal.common.ui.PredefinedModelExtension;
import org.eclipse.gmf.internal.common.ui.ResourceLocationProvider;
import org.eclipse.gmf.mappings.CanvasMapping;
import org.eclipse.gmf.mappings.GMFMapPackage;
import org.eclipse.gmf.mappings.Mapping;
import org.eclipse.gmf.tooldef.GMFToolPackage;
import org.eclipse.gmf.tooldef.Palette;
import org.eclipse.jface.viewers.ISelection;
import org.eclipse.jface.wizard.Wizard;

/**
 * @@author dstadnik
 */
public class MapRefModelPages {

	private final boolean withSelectors;

	private ResourceSet resourceSet;

	private ExtensibleModelSelectionPage domainModelSelectionPage;

	private ExtensibleModelSelectionPage graphModelSelectionPage;

	private ExtensibleModelSelectionPage toolModelSelectionPage;

	public MapRefModelPages(boolean withSelectors, ResourceSet resourceSet) {
		this.withSelectors = withSelectors;
		this.resourceSet = resourceSet;
	}

	protected ResourceSet getResourceSet() {
		if (resourceSet == null) {
			resourceSet = new ResourceSetImpl();
		}
		return resourceSet;
	}

	public ExtensibleModelSelectionPage getDomainModelSelectionPage() {
		return domainModelSelectionPage;
	}

	public ExtensibleModelSelectionPage getGraphModelSelectionPage() {
		return graphModelSelectionPage;
	}

	public ExtensibleModelSelectionPage getToolModelSelectionPage() {
		return toolModelSelectionPage;
	}

	public void addPages(Wizard wizard, ISelection selection) {
		ResourceLocationProvider rloc = new ResourceLocationProvider(selection);
		addDomainPage(wizard, rloc);
		addGraphPage(wizard, rloc);
		addToolPage(wizard, rloc);
	}

	protected void addDomainPage(Wizard wizard, ResourceLocationProvider rloc) {
		domainModelSelectionPage = new ExtensibleModelSelectionPage("domain", rloc, getResourceSet(), "ecore"); //$NON-NLS-1$ //$NON-NLS-2$
		domainModelSelectionPage.setTitle("Select Domain Model");
		domainModelSelectionPage.setDescription("Load domain model and select element for canvas mapping.");
		List<URI> uris = rloc.getSelectedURIs("ecore"); //$NON-NLS-1$
		uris.add(URI.createURI("platform:/plugin/org.eclipse.emf.ecore/model/Ecore.ecore")); //$NON-NLS-1$
		domainModelSelectionPage.addExtension("prem", new PredefinedModelExtension(domainModelSelectionPage, uris)); //$NON-NLS-1$
		if (withSelectors) {
			domainModelSelectionPage.addExtension("domainModel", new ComboElementSelectorExtension() { //$NON-NLS-1$

						protected String getModelElementName() {
							return "Package:";
						}

						protected String getModelElementLabel(EObject modelElement) {
							String name = ((EPackage) modelElement).getName();
							if (name == null || name.trim().length() == 0) {
								name = "<unnamed>";
							}
							return name;
						}

						protected EClass getModelElementClass() {
							return EcorePackage.eINSTANCE.getEPackage();
						}
					});
			domainModelSelectionPage.addExtension("domainElement", new ListElementSelectorExtension() { //$NON-NLS-1$

						protected String getModelElementName() {
							return "Class:";
						}

						protected String getModelElementLabel(EObject modelElement) {
							String name = ((EClass) modelElement).getName();
							if (name == null || name.trim().length() == 0) {
								name = "<unnamed>";
							}
							return name;
						}

						protected EClass getModelElementClass() {
							return EcorePackage.eINSTANCE.getEClass();
						}
					});
		}
		wizard.addPage(domainModelSelectionPage);
	}

	protected void addGraphPage(Wizard wizard, ResourceLocationProvider rloc) {
		graphModelSelectionPage = new ExtensibleModelSelectionPage("graph", rloc, getResourceSet(), "gmfgraph"); //$NON-NLS-1$ //$NON-NLS-2$
		graphModelSelectionPage.setTitle("Select Diagram Canvas");
		graphModelSelectionPage.setDescription("Load graphical definition model and select diagram canvas for canvas mapping.");
		List<URI> uris = rloc.getSelectedURIs("gmfgraph"); //$NON-NLS-1$
		uris.add(Assistant.getBasicGraphDef());
		graphModelSelectionPage.addExtension("prem", new PredefinedModelExtension(graphModelSelectionPage, uris)); //$NON-NLS-1$
		if (withSelectors) {
			graphModelSelectionPage.addExtension("canvas", new ComboElementSelectorExtension() { //$NON-NLS-1$

						protected String getModelElementName() {
							return "Diagram Canvas:";
						}

						protected String getModelElementLabel(EObject modelElement) {
							String name = ((Canvas) modelElement).getName();
							if (name == null || name.trim().length() == 0) {
								name = "<unnamed>";
							}
							return name;
						}

						protected EClass getModelElementClass() {
							return GMFGraphPackage.eINSTANCE.getCanvas();
						}
					});
		}
		wizard.addPage(graphModelSelectionPage);
	}

	protected void addToolPage(Wizard wizard, ResourceLocationProvider rloc) {
		toolModelSelectionPage = new ExtensibleModelSelectionPage("tool", rloc, getResourceSet(), "gmftool") { //$NON-NLS-1$ //$NON-NLS-2$

			public void validatePage() {
				CreateNewModelExtension ext = (CreateNewModelExtension) getExtension("new"); //$NON-NLS-1$
				if (ext != null) {
					ext.validatePage();
				} else {
					super.validatePage();
				}
			}
		};
		toolModelSelectionPage.setTitle("Select Diagram Palette");
		toolModelSelectionPage.setDescription("Load tooling definition model and select diagram palette for canvas mapping.");
		if (withSelectors) {
			toolModelSelectionPage.addExtension("palette", new ComboElementSelectorExtension() { //$NON-NLS-1$

						protected String getModelElementName() {
							return "Diagram Palette:";
						}

						protected String getModelElementLabel(EObject modelElement) {
							String title = ((Palette) modelElement).getTitle();
							if (title == null || title.trim().length() == 0) {
								title = "<untitled>";
							}
							return title;
						}

						protected EClass getModelElementClass() {
							return GMFToolPackage.eINSTANCE.getPalette();
						}
					});
		}
		wizard.addPage(toolModelSelectionPage);
	}

	public void allowNewToolingModel() {
		toolModelSelectionPage.addExtension("new", new CreateNewModelExtension(toolModelSelectionPage)); //$NON-NLS-1$
	}

	public CreateNewModelExtension getCreateNewToolingModelExt() {
		if (toolModelSelectionPage == null) {
			return null;
		}
		return (CreateNewModelExtension) toolModelSelectionPage.getExtension("new"); //$NON-NLS-1$
	}

	public boolean shouldCreateNewToolingModel(boolean defaultValue) {
		CreateNewModelExtension ext = getCreateNewToolingModelExt();
		if (ext == null) {
			return defaultValue;
		}
		return ext.shouldCreateNewModel();
	}

	protected ElementSelectorExtension getElementSelectorExtension(ExtensibleModelSelectionPage page, String selectorId) {
		if (page == null) {
			return null;
		}
		return (ElementSelectorExtension) page.getExtension(selectorId);
	}

	protected EObject getSelectedElement(ExtensibleModelSelectionPage page, String selectorId) {
		ElementSelectorExtension ext = getElementSelectorExtension(page, selectorId);
		if (ext == null) {
			return null;
		}
		return ext.getModelElement();
	}

	public ElementSelectorExtension getDomainModelExt() {
		return getElementSelectorExtension(domainModelSelectionPage, "domainModel"); //$NON-NLS-1$
	}

	public ElementSelectorExtension getDomainElementExt() {
		return getElementSelectorExtension(domainModelSelectionPage, "domainElement"); //$NON-NLS-1$
	}

	public ElementSelectorExtension getCanvasExt() {
		return getElementSelectorExtension(graphModelSelectionPage, "canvas"); //$NON-NLS-1$
	}

	public ElementSelectorExtension getPaletteExt() {
		return getElementSelectorExtension(toolModelSelectionPage, "palette"); //$NON-NLS-1$
	}

	public EPackage getDomainModel() {
		return (EPackage) getSelectedElement(domainModelSelectionPage, "domainModel"); //$NON-NLS-1$
	}

	public EClass getDomainElement() {
		return (EClass) getSelectedElement(domainModelSelectionPage, "domainElement"); //$NON-NLS-1$
	}

	public Canvas getCanvas() {
		return (Canvas) getSelectedElement(graphModelSelectionPage, "canvas"); //$NON-NLS-1$
	}

	public Palette getPalette() {
		return (Palette) getSelectedElement(toolModelSelectionPage, "palette"); //$NON-NLS-1$
	}

	public Mapping createMapping() {
		Mapping mapping = GMFMapPackage.eINSTANCE.getGMFMapFactory().createMapping();
		CanvasMapping canvasMapping = GMFMapPackage.eINSTANCE.getGMFMapFactory().createCanvasMapping();
		mapping.setDiagram(canvasMapping);
		EPackage domainModel = getDomainModel();
		if (domainModel != null) {
			canvasMapping.setDomainModel(domainModel);
		}
		EClass domainElement = getDomainElement();
		if (domainElement != null) {
			canvasMapping.setDomainMetaElement(domainElement);
		}
		Canvas canvas = getCanvas();
		if (canvas != null) {
			canvasMapping.setDiagramCanvas(canvas);
		}
		Palette palette = getPalette();
		if (palette != null) {
			canvasMapping.setPalette(palette);
		}
		return mapping;
	}
}
@


1.7
log
@overriding method to pass constant value is not a good approach
@
text
@d2 1
a2 1
 * Copyright (c) 2006 Eclipse.org
@


1.6
log
@provide page accessors and validate page correctly when blank tool model is selected
@
text
@d88 1
a88 6
		domainModelSelectionPage = new ExtensibleModelSelectionPage("domain", rloc, getResourceSet()) { //$NON-NLS-1$

			protected String getModelFileExtension() {
				return "ecore"; //$NON-NLS-1$
			}
		};
d136 1
a136 6
		graphModelSelectionPage = new ExtensibleModelSelectionPage("graph", rloc, getResourceSet()) { //$NON-NLS-1$

			protected String getModelFileExtension() {
				return "gmfgraph"; //$NON-NLS-1$
			}
		};
d166 1
a166 5
		toolModelSelectionPage = new ExtensibleModelSelectionPage("tool", rloc, getResourceSet()) { //$NON-NLS-1$

			protected String getModelFileExtension() {
				return "gmftool"; //$NON-NLS-1$
			}
@


1.5
log
@add extensions accessors
@
text
@d50 1
a50 1
	protected ExtensibleModelSelectionPage domainModelSelectionPage;
d52 1
a52 1
	protected ExtensibleModelSelectionPage graphModelSelectionPage;
d54 1
a54 1
	protected ExtensibleModelSelectionPage toolModelSelectionPage;
d68 12
d181 9
@


1.4
log
@allow to use shared resultset
@
text
@d199 1
a199 1
	public boolean shouldCreateNewToolingModel(boolean defaultValue) {
d201 1
a201 1
			return defaultValue;
d203 5
a207 1
		CreateNewModelExtension ext = (CreateNewModelExtension) toolModelSelectionPage.getExtension("new"); //$NON-NLS-1$
d214 1
a214 1
	public EObject getSelectedElement(ExtensibleModelSelectionPage page, String selectorId) {
d218 5
a222 1
		ElementSelectorExtension ext = (ElementSelectorExtension) page.getExtension(selectorId);
d229 16
@


1.3
log
@add extension to create new model
@
text
@d21 2
d46 3
a48 1
	protected final boolean withSelectors;
d56 1
a56 1
	public MapRefModelPages(boolean withSelectors) {
d58 8
d76 1
a76 1
		domainModelSelectionPage = new ExtensibleModelSelectionPage("domain", rloc) { //$NON-NLS-1$
d129 1
a129 1
		graphModelSelectionPage = new ExtensibleModelSelectionPage("graph", rloc) { //$NON-NLS-1$
d164 1
a164 1
		toolModelSelectionPage = new ExtensibleModelSelectionPage("tool", rloc) { //$NON-NLS-1$
@


1.2
log
@add predefined models extension
@
text
@d25 1
d183 15
d210 1
a210 1
		return (EPackage) getSelectedElement(domainModelSelectionPage, "domainModel");
d214 1
a214 1
		return (EClass) getSelectedElement(domainModelSelectionPage, "domainElement");
d218 1
a218 1
		return (Canvas) getSelectedElement(graphModelSelectionPage, "canvas");
d222 1
a222 1
		return (Palette) getSelectedElement(toolModelSelectionPage, "palette");
@


1.1
log
@refactor referenced models of mapping model pages
@
text
@d14 3
d23 1
d28 1
d71 3
d124 3
@

