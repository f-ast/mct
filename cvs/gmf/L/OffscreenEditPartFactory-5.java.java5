package org.eclipse.gmf.runtime.diagram.ui;

import org.eclipse.gef.GraphicalViewer;

import org.eclipse.jface.util.Assert;

import org.eclipse.swt.widgets.Shell;

import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramEditPart;

import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramCommandStack;

import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramEditDomain;

import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramGraphicalViewer;

import org.eclipse.gmf.runtime.diagram.ui.services.editpart.EditPartService;

import org.eclipse.gmf.runtime.notation.Diagram;

public class OffscreenEditPartFactory {
    private static OffscreenEditPartFactory INSTANCE = new OffscreenEditPartFactory ();

    public static OffscreenEditPartFactory getInstance () {
        return INSTANCE;
    }

    public DiagramEditPart createDiagramEditPart (Diagram diagram) {
        Shell shell = new Shell ();
        GraphicalViewer customViewer = new DiagramGraphicalViewer ();
        customViewer.createControl (shell);
        DiagramEditDomain editDomain = new DiagramEditDomain (null);
        editDomain.setCommandStack (new DiagramCommandStack (editDomain));
        customViewer.setEditDomain (editDomain);
        customViewer.setRootEditPart (EditPartService.getInstance ().createRootEditPart (diagram));
        customViewer.setEditPartFactory (EditPartService.getInstance ());
        customViewer.setContents (diagram);
        customViewer.flush ();
        Assert.isTrue (customViewer.getContents () instanceof DiagramEditPart);
        return (DiagramEditPart) customViewer.getContents ();
    }

}

