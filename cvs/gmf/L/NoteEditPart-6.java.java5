package org.eclipse.gmf.runtime.diagram.ui.editparts;

import org.eclipse.draw2d.geometry.Insets;

import org.eclipse.gef.EditPart;

import org.eclipse.gef.EditPolicy;

import org.eclipse.gmf.runtime.common.ui.services.parser.CommonParserHint;

import org.eclipse.gmf.runtime.diagram.ui.editpolicies.EditPolicyRoles;

import org.eclipse.gmf.runtime.diagram.ui.editpolicies.OpenDiagramEditPolicy;

import org.eclipse.gmf.runtime.diagram.ui.editpolicies.ViewComponentEditPolicy;

import org.eclipse.gmf.runtime.diagram.ui.figures.NoteFigure;

import org.eclipse.gmf.runtime.diagram.ui.internal.editpolicies.DiagramLinkDragDropEditPolicy;

import org.eclipse.gmf.runtime.diagram.ui.internal.editpolicies.NonSemanticEditPolicy;

import org.eclipse.gmf.runtime.diagram.ui.internal.properties.Properties;

import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;

import org.eclipse.gmf.runtime.gef.ui.figures.NodeFigure;

import org.eclipse.gmf.runtime.notation.View;

public class NoteEditPart extends ShapeNodeEditPart {

    public NoteEditPart (View view) {
        super (view);
    }

    protected NodeFigure createNodeFigure () {
        IMapMode mm = getMapMode ();
        Insets insets = new Insets (mm.DPtoLP (5), mm.DPtoLP (5), mm.DPtoLP (5), mm.DPtoLP (14));
        NoteFigure noteFigure = new NoteFigure (mm.DPtoLP (100), mm.DPtoLP (56), insets);
        Object model = getModel ();
        if (model != null && model instanceof View) {
            View notationView = (View) model;
            if (notationView != null && (notationView.getEAnnotation (Properties.DIAGRAMLINK_ANNOTATION) != null || notationView.getType () == null || notationView.getType ().length () == 0)) noteFigure.setDiagramLinkMode (true);

        }
        return noteFigure;
    }

    protected void createDefaultEditPolicies () {
        super.createDefaultEditPolicies ();
        removeEditPolicy (EditPolicyRoles.SEMANTIC_ROLE);
        installEditPolicy (EditPolicyRoles.SEMANTIC_ROLE, new NonSemanticEditPolicy ());
        installEditPolicy (EditPolicyRoles.DRAG_DROP_ROLE, new DiagramLinkDragDropEditPolicy ());
        installEditPolicy (EditPolicyRoles.OPEN_ROLE, new OpenDiagramEditPolicy ());
        installEditPolicy (EditPolicy.COMPONENT_ROLE, new ViewComponentEditPolicy ());
    }

    public EditPart getPrimaryChildEditPart () {
        return getChildBySemanticHint (CommonParserHint.DESCRIPTION);
    }

}

