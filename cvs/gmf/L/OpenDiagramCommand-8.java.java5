package org.eclipse.gmf.runtime.diagram.ui.commands;

import org.eclipse.core.commands.ExecutionException;

import org.eclipse.core.runtime.IAdaptable;

import org.eclipse.core.runtime.IProgressMonitor;

import org.eclipse.core.runtime.IStatus;

import org.eclipse.core.runtime.Status;

import org.eclipse.emf.ecore.EObject;

import org.eclipse.gmf.runtime.common.core.command.AbstractCommand;

import org.eclipse.gmf.runtime.common.core.command.CommandResult;

import org.eclipse.gmf.runtime.common.core.util.Trace;

import org.eclipse.gmf.runtime.common.ui.services.editor.EditorService;

import org.eclipse.gmf.runtime.diagram.core.internal.util.MEditingDomainGetter;

import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIDebugOptions;

import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIPlugin;

import org.eclipse.gmf.runtime.diagram.ui.internal.DiagramUIStatusCodes;

import org.eclipse.gmf.runtime.diagram.ui.l10n.DiagramUIMessages;

import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramEditorInput;

import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramEditorInput;

import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;

import org.eclipse.gmf.runtime.notation.Diagram;

import org.eclipse.ui.IEditorPart;

public class OpenDiagramCommand extends AbstractCommand {
    private EObject _element = null;

    public OpenDiagramCommand (String label, EObject element) {
        super (label, null);
        setElement (element);
    }

    protected EObject getElement () {
        return _element;
    }

    protected void setElement (EObject element) {
        _element = element;
    }

    public OpenDiagramCommand (EObject element) {
        this (DiagramUIMessages.Command_openDiagram, element);
    }

    public boolean canExecute () {
        return getElement () instanceof Diagram;
    }

    protected CommandResult doExecuteWithResult (IProgressMonitor progressMonitor, IAdaptable info) throws ExecutionException {
        try {
            MEditingDomainGetter.getMEditingDomain (getElement ()).runAsRead (new MRunnable () {

                public Object run () {
                    Diagram diagram = null;
                    if (getElement () instanceof Diagram) {
                        diagram = (Diagram) getElement ();
                    }
                    if (diagram != null) {
                        IDiagramEditorInput diagramInput = new DiagramEditorInput (diagram);
                        IEditorPart editor = null;
                        editor = EditorService.getInstance ().openEditor (diagramInput);
                        if (editor == null) {
                            throw new UnsupportedOperationException ();
                        }
                    }
                    return null;
                }

            }

            );
        } catch (Exception e) {
            Trace.catching (DiagramUIPlugin.getInstance (), DiagramUIDebugOptions.EXCEPTIONS_CATCHING, getClass (), "doExecute()", e);
            return new CommandResult (new Status (IStatus.ERROR, DiagramUIPlugin.getPluginId (), DiagramUIStatusCodes.COMMAND_FAILURE, e.getMessage (), e));
        }
        return CommandResult.newOKCommandResult ();
    }

    public boolean canUndo () {
        return false;
    }

    public boolean canRedo () {
        return false;
    }

    protected CommandResult doRedoWithResult (IProgressMonitor progressMonitor, IAdaptable info) throws ExecutionException {
        return null;
    }

    protected CommandResult doUndoWithResult (IProgressMonitor progressMonitor, IAdaptable info) throws ExecutionException {
        return null;
    }

}

