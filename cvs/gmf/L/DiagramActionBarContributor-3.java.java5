package org.eclipse.gmf.runtime.diagram.ui.parts;

import org.eclipse.gef.ui.actions.ActionBarContributor;

import org.eclipse.ui.IActionBars;

import org.eclipse.gmf.runtime.common.core.util.Trace;

import org.eclipse.gmf.runtime.common.ui.services.action.contributionitem.ContributionItemService;

import org.eclipse.gmf.runtime.common.ui.util.IWorkbenchPartDescriptor;

import org.eclipse.gmf.runtime.common.ui.util.WorkbenchPartDescirptor;

import org.eclipse.gmf.runtime.diagram.ui.DiagramUIDebugOptions;

import org.eclipse.gmf.runtime.diagram.ui.DiagramUIPlugin;

import org.eclipse.gmf.runtime.diagram.ui.internal.util.DiagramMEditingDomainGetter;

import org.eclipse.gmf.runtime.emf.core.edit.MRunnable;

public abstract class DiagramActionBarContributor extends ActionBarContributor {
    private IWorkbenchPartDescriptor descriptor;

    public void init (final IActionBars bars) {
        super.init (bars);
        descriptor = new WorkbenchPartDescirptor (getEditorId (), getEditorClass (), getPage ());
        try {
            DiagramMEditingDomainGetter.getMEditingDomain (getPage ().getActiveEditor ()).runAsRead (new MRunnable () {

                public Object run () {
                    ContributionItemService.getInstance ().contributeToActionBars (bars, descriptor);
                    return null;
                }

            }

            );
        } catch (Exception e) {
            Trace.catching (DiagramUIPlugin.getInstance (), DiagramUIDebugOptions.EXCEPTIONS_CATCHING, getClass (), "init()", e);
        }
        bars.updateActionBars ();
    }

    public void dispose () {
        ContributionItemService.getInstance ().disposeContributions (descriptor);
        descriptor = null;
        super.dispose ();
    }

    protected void buildActions () {
    }

    protected void declareGlobalActionKeys () {
    }

    protected abstract String getEditorId ();

    protected abstract Class getEditorClass ();

}

