package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import org.eclipse.swt.SWT;

import org.eclipse.swt.widgets.Combo;

import org.eclipse.swt.widgets.Composite;

import org.eclipse.swt.widgets.Control;

import org.eclipse.swt.widgets.Event;

import org.eclipse.swt.widgets.Listener;

import org.eclipse.ui.IEditorPart;

import org.eclipse.ui.IWorkbenchPage;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.Messages;

import org.eclipse.gmf.runtime.diagram.ui.internal.properties.Properties;

import org.eclipse.gmf.runtime.diagram.ui.internal.requests.ActionIds;

import org.eclipse.gmf.runtime.diagram.ui.internal.util.FontHelper;

import org.eclipse.gmf.runtime.diagram.ui.internal.util.IUIConstants;

public class FontNameContributionItem extends PropertyChangeContributionItem implements Listener {
    private String lastFontName;

    public FontNameContributionItem (IWorkbenchPage workbenchPage) {
        super (workbenchPage, ActionIds.CUSTOM_FONT_NAME, Properties.ID_FONTNAME, Messages.getString ("PropertyDescriptorFactory.FontName"));
        setLabel (Messages.getString ("FontNameContributionItem.tooltip"));
    }

    protected Control createControl (Composite parent) {
        String [] strings = FontHelper.getFontNames ();
        Combo box = new Combo (parent, SWT.DROP_DOWN | SWT.READ_ONLY);
        box.setVisibleItemCount (IUIConstants.DEFAULT_DROP_DOWN_SIZE);
        box.setItems (strings);
        box.addListener (SWT.Selection, this);
        box.select (0);
        return box;
    }

    protected Object getNewPropertyValue () {
        return lastFontName;
    }

    protected void refreshItem () {
        Combo box = (Combo) getControl ();
        String fontName = (String) getOperationSetPropertyValue (getPropertyId ());
        if (fontName != null) {
            int index = box.indexOf (fontName);
            box.select (index);
        } else {
            box.clearSelection ();
        }
        super.refreshItem ();
    }

    public void handleEvent (Event event) {
        Combo box = (Combo) getControl ();
        lastFontName = box.getItem (box.getSelectionIndex ());
        runWithEvent (event);
    }

    protected boolean isCommandStackListener () {
        return true;
    }

}

