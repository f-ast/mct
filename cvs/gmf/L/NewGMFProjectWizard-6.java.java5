package org.eclipse.gmf.internal.bridge.wizards;

import org.eclipse.emf.codegen.ecore.ui.EmptyProjectWizard;

import org.eclipse.gmf.internal.bridge.ui.Plugin;

import org.eclipse.gmf.internal.bridge.wizards.pages.ShowDashboardPage;

import org.eclipse.ui.IWorkbenchWindow;

import org.eclipse.ui.PartInitException;

import org.eclipse.ui.PlatformUI;

public class NewGMFProjectWizard extends EmptyProjectWizard {
    private static final String SD_PROPERTY = "show_dashboard";
    private boolean showDashboard;
    private ShowDashboardPage sdp;

    public NewGMFProjectWizard () {
        showDashboard = Plugin.getDefault ().getPreferenceStore ().getBoolean (SD_PROPERTY);
    }

    public void addPages () {
        super.addPages ();
        sdp = new ShowDashboardPage ("Show Dashboard", showDashboard);
        sdp.setTitle ("Show Dashboard");
        sdp.setDescription ("Show dashboard view for the created project");
        addPage (sdp);
    }

    public void setShowDashboard (boolean showDashboard) {
        this.showDashboard = showDashboard;
    }

    public boolean performFinish () {
        showDashboard = sdp.isShowDashboard ();
        Plugin.getDefault ().getPreferenceStore ().setValue (SD_PROPERTY, showDashboard);
        boolean created = super.performFinish ();
        if (created && showDashboard) {
            getShell ().getDisplay ().asyncExec (new Runnable () {

                public void run () {
                    openDashboardView ();
                }

            }

            );
        }
        return created;
    }

    protected void openDashboardView () {
        IWorkbenchWindow window = PlatformUI.getWorkbench ().getActiveWorkbenchWindow ();
        if (window != null && window.getActivePage () != null) {
            try {
                window.getActivePage ().showView ("org.eclipse.gmf.bridge.ui.dashboard.DashboardPart");
            } catch (PartInitException e) {
                Plugin.log (e);
            }
        }
    }

}

