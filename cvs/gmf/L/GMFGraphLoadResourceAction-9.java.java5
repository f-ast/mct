package org.eclipse.gmf.graphdef.editor.part;

import org.eclipse.emf.edit.ui.action.LoadResourceAction;

import org.eclipse.gmf.graphdef.editor.edit.parts.CanvasEditPart;

import org.eclipse.jface.action.IAction;

import org.eclipse.jface.viewers.ISelection;

import org.eclipse.jface.viewers.IStructuredSelection;

import org.eclipse.swt.widgets.Shell;

import org.eclipse.ui.IObjectActionDelegate;

import org.eclipse.ui.IWorkbenchPart;

public class GMFGraphLoadResourceAction implements IObjectActionDelegate {
    private CanvasEditPart mySelectedElement;
    private Shell myShell;

    public void setActivePart (IAction action, IWorkbenchPart targetPart) {
        myShell = targetPart.getSite ().getShell ();
    }

    public void run (IAction action) {
        LoadResourceAction.LoadResourceDialog loadResourceDialog = new LoadResourceAction.LoadResourceDialog (myShell, mySelectedElement.getEditingDomain ());
        loadResourceDialog.open ();
    }

    public void selectionChanged (IAction action, ISelection selection) {
        mySelectedElement = null;
        if (selection instanceof IStructuredSelection) {
            IStructuredSelection structuredSelection = (IStructuredSelection) selection;
            if (structuredSelection.size () == 1 && structuredSelection.getFirstElement () instanceof CanvasEditPart) {
                mySelectedElement = (CanvasEditPart) structuredSelection.getFirstElement ();
            }
        }
        action.setEnabled (isEnabled ());
    }

    private boolean isEnabled () {
        return mySelectedElement != null;
    }

}

