package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import org.eclipse.gmf.runtime.diagram.ui.actions.ActionIds;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramUIActionsMessages;

import org.eclipse.gmf.runtime.diagram.ui.internal.properties.Properties;

import org.eclipse.gmf.runtime.diagram.ui.internal.util.FontHelper;

import org.eclipse.gmf.runtime.diagram.ui.internal.util.IUIConstants;

import org.eclipse.swt.SWT;

import org.eclipse.swt.widgets.Combo;

import org.eclipse.swt.widgets.Composite;

import org.eclipse.swt.widgets.Control;

import org.eclipse.swt.widgets.Event;

import org.eclipse.swt.widgets.Listener;

import org.eclipse.ui.IWorkbenchPage;

public class FontSizeContributionItem extends PropertyChangeContributionItem implements Listener {
    private Integer lastFontSize;

    public FontSizeContributionItem (IWorkbenchPage workbenchPage) {
        super (workbenchPage, ActionIds.CUSTOM_FONT_SIZE, Properties.ID_FONTSIZE, DiagramUIActionsMessages.PropertyDescriptorFactory_FontSize);
        setLabel (DiagramUIActionsMessages.FontSizeContributionItem_tooltip);
    }

    protected Control createControl (Composite parent) {
        Combo box = new Combo (parent, SWT.DROP_DOWN | SWT.READ_ONLY);
        box.setVisibleItemCount (IUIConstants.DEFAULT_DROP_DOWN_SIZE);
        box.setItems (FontHelper.getFontSizes ());
        box.addListener (SWT.Selection, this);
        box.select (0);
        return box;
    }

    protected Object getNewPropertyValue () {
        return lastFontSize;
    }

    protected void refreshItem () {
        Combo box = (Combo) getControl ();
        Integer fontSize = (Integer) getOperationSetPropertyValue (getPropertyId ());
        if (fontSize != null) {
            int index = box.indexOf (Integer.toString (fontSize.intValue ()));
            box.select (index);
        } else {
            box.clearSelection ();
        }
        super.refreshItem ();
    }

    public void handleEvent (Event event) {
        Combo box = (Combo) getControl ();
        int selectedSize = Integer.parseInt (box.getItem (box.getSelectionIndex ()));
        lastFontSize = new Integer (selectedSize);
        runWithEvent (event);
    }

    protected boolean isOperationHistoryListener () {
        return true;
    }

}

