package org.eclipse.gmf.runtime.draw2d.ui.internal.graphics;

import org.eclipse.draw2d.Graphics;

import org.eclipse.draw2d.SWTGraphics;

import org.eclipse.draw2d.geometry.Rectangle;

import org.eclipse.draw2d.geometry.Translatable;

import org.eclipse.swt.SWT;

import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;

public class ScalableFreeformLayeredPane extends org.eclipse.draw2d.ScalableFreeformLayeredPane {
    boolean antiAlias = true;

    public void setAntiAlias (boolean antiAliasValue) {
        antiAlias = antiAliasValue;
        super.repaint ();
    }

    protected void paintClientArea (Graphics graphics) {
        if ((graphics instanceof SWTGraphics) && antiAlias) {
            graphics.setAntialias (SWT.ON);
        } else {
            graphics.setAntialias (SWT.OFF);
        }
        MapModeGraphics gMM = createMapModeGraphics (graphics);
        gMM.pushState ();
        if (getChildren ().isEmpty ()) {
            gMM.popState ();
            return;
        }
        if (getScale () == 1.0) {
            super.paintClientArea (gMM);
        } else {
            ScaledGraphics g = createScaledGraphics (gMM);
            boolean optimizeClip = getBorder () == null || getBorder ().isOpaque ();
            if (! optimizeClip) g.clipRect (getBounds ().getCropped (getInsets ()));

            g.scale (getScale ());
            g.pushState ();
            paintChildren (g);
            g.dispose ();
            gMM.restoreState ();
        }
        gMM.popState ();
    }

    protected ScaledGraphics createScaledGraphics (MapModeGraphics gMM) {
        ScaledGraphics g = new ScaledGraphics (gMM);
        return g;
    }

    protected MapModeGraphics createMapModeGraphics (Graphics graphics) {
        MapModeGraphics gMM = new MapModeGraphics (graphics);
        return gMM;
    }

    public Rectangle getClientArea (Rectangle rect) {
        super.getClientArea (rect);
        MapMode.translateToLP (rect);
        return rect;
    }

    public void translateToParent (Translatable t) {
        super.translateToParent (t);
        MapMode.translateToDP (t);
    }

    public void translateFromParent (Translatable t) {
        super.translateFromParent (t);
        MapMode.translateToLP (t);
    }

}

