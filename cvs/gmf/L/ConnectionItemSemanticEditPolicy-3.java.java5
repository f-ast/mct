package org.eclipse.gmf.graphdef.editor.edit.policies;

import org.eclipse.gef.commands.Command;

import org.eclipse.gmf.runtime.emf.type.core.commands.DestroyElementCommand;

import org.eclipse.gmf.runtime.emf.type.core.requests.CreateRelationshipRequest;

import org.eclipse.gmf.runtime.emf.type.core.requests.DestroyElementRequest;

import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.EAnnotation;

import org.eclipse.gmf.runtime.notation.View;

import org.eclipse.gef.commands.UnexecutableCommand;

import org.eclipse.gmf.gmfgraph.DiagramElement;

import org.eclipse.gmf.graphdef.editor.providers.GMFGraphElementTypes;

public class ConnectionItemSemanticEditPolicy extends GMFGraphBaseItemSemanticEditPolicy {

    protected Command getDestroyElementCommand (DestroyElementRequest req) {
        return getMSLWrapper (new DestroyElementCommand (req) {

            protected EObject getElementToDestroy () {
                View view = (View) getHost ().getModel ();
                EAnnotation annotation = view.getEAnnotation ("Shortcut");
                if (annotation != null) {
                    return view;
                }
                return super.getElementToDestroy ();
            }

        }

        );
    }

    protected Command getCreateRelationshipCommand (CreateRelationshipRequest req) {
        if (GMFGraphElementTypes.DiagramElementFigure_4001 == req.getElementType ()) {
            return req.getTarget () == null ? getCreateStartOutgoingDiagramElement_Figure4001Command (req) : null;
        }
        return super.getCreateRelationshipCommand (req);
    }

    protected Command getCreateStartOutgoingDiagramElement_Figure4001Command (CreateRelationshipRequest req) {
        DiagramElement element = (DiagramElement) getSemanticElement ();
        if (element.getFigure () != null) {
            return UnexecutableCommand.INSTANCE;
        }
        return new Command () {
        }

        ;
    }

}

