package org.eclipse.gmf.runtime.diagram.ui.providers.ide.providers;

import java.util.Hashtable;

import org.eclipse.ui.IPartListener;

import org.eclipse.ui.IWorkbenchPart;

import org.eclipse.gmf.runtime.common.ui.services.action.global.AbstractGlobalActionHandlerProvider;

import org.eclipse.gmf.runtime.common.ui.services.action.global.IGlobalActionHandler;

import org.eclipse.gmf.runtime.common.ui.services.action.global.IGlobalActionHandlerContext;

public final class DiagramIDEGlobalActionHandlerProvider extends AbstractGlobalActionHandlerProvider {
    private Hashtable handlerList = new Hashtable ();

    public DiagramIDEGlobalActionHandlerProvider () {
        super ();
    }

    public IGlobalActionHandler getGlobalActionHandler (final IGlobalActionHandlerContext context) {
        if (! getHandlerList ().containsKey (context.getActivePart ())) {
            getHandlerList ().put (context.getActivePart (), new DiagramIDEGlobalActionHandler ());
            context.getActivePart ().getSite ().getPage ().addPartListener (new IPartListener () {
                private IWorkbenchPart localPart = context.getActivePart ();

                public void partActivated (IWorkbenchPart part) {
                }

                public void partBroughtToTop (IWorkbenchPart part) {
                }

                public void partClosed (IWorkbenchPart part) {
                    if (part != null && part == localPart && getHandlerList ().containsKey (part)) {
                        getHandlerList ().remove (part);
                        localPart.getSite ().getPage ().removePartListener (this);
                        localPart = null;
                    }
                }

                public void partDeactivated (IWorkbenchPart part) {
                }

                public void partOpened (IWorkbenchPart part) {
                }

            }

            );
        }
        return (DiagramIDEGlobalActionHandler) getHandlerList ().get (context.getActivePart ());
    }

    private Hashtable getHandlerList () {
        return handlerList;
    }

}

