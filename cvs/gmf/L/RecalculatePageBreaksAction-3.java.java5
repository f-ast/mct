package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import org.eclipse.core.runtime.IProgressMonitor;

import org.eclipse.gef.Request;

import org.eclipse.ui.IWorkbenchPage;

import org.eclipse.ui.IWorkbenchPart;

import org.eclipse.gmf.runtime.diagram.ui.actions.PresentationAction;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramActionsResourceManager;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.Images;

import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramRootEditPart;

import org.eclipse.gmf.runtime.diagram.ui.internal.properties.WorkspaceViewerProperties;

import org.eclipse.gmf.runtime.diagram.ui.internal.requests.ActionIds;

import org.eclipse.gmf.runtime.diagram.ui.internal.requests.RecalculatePageBreaksRequest;

import org.eclipse.gmf.runtime.diagram.ui.parts.DiagramGraphicalViewer;

public class RecalculatePageBreaksAction extends PresentationAction {

    public RecalculatePageBreaksAction (IWorkbenchPage workbenchPage) {
        super (workbenchPage);
    }

    public RecalculatePageBreaksAction (IWorkbenchPart part) {
        super (part);
    }

    public void init () {
        super.init ();
        setText (DiagramActionsResourceManager.getI18NString ("RecalcPageBreaks.textLabel"));
        setId (ActionIds.ACTION_RECALC_PAGEBREAKS);
        setToolTipText (DiagramActionsResourceManager.getI18NString ("RecalcPageBreaks.toolTip"));
        setImageDescriptor (Images.DESC_ACTON_RECALCPAGEBREAKS);
        setDisabledImageDescriptor (Images.DESC_ACTON_RECALCPAGEBREAKS_DISABLED);
    }

    protected Request createTargetRequest () {
        return new RecalculatePageBreaksRequest ();
    }

    protected boolean calculateEnabled () {
        if (getDiagramGraphicalViewer () instanceof DiagramGraphicalViewer) {
            return ((DiagramGraphicalViewer) getDiagramGraphicalViewer ()).getWorkspaceViewerPreferenceStore ().getBoolean (WorkspaceViewerProperties.VIEWPAGEBREAKS);
        }
        return false;
    }

    protected void doRun (IProgressMonitor progressMonitor) {
        ((DiagramRootEditPart) getDiagramEditPart ().getRoot ()).performRequest (getTargetRequest ());
    }

    protected boolean isSelectionListener () {
        return false;
    }

}

