package org.eclipse.gmf.runtime.diagram.ui.printing.actions;

import java.util.Collections;

import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramEditPart;

import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramWorkbenchPart;

import org.eclipse.gmf.runtime.diagram.ui.printing.internal.l10n.DiagramUIPrintingMessages;

import org.eclipse.gmf.runtime.diagram.ui.printing.internal.util.DiagramPrinter;

import org.eclipse.jface.dialogs.MessageDialog;

import org.eclipse.swt.SWT;

import org.eclipse.swt.printing.PrintDialog;

import org.eclipse.swt.printing.Printer;

import org.eclipse.swt.printing.PrinterData;

import org.eclipse.swt.widgets.Display;

import org.eclipse.ui.IEditorPart;

public class DefaultPrintActionHelper {

    public static void doRun (IEditorPart editorPart, DiagramPrinter diagramPrinter) {
        final PrintDialog dialog = new PrintDialog (editorPart.getSite ().getShell (), SWT.NULL);
        final PrinterData data = dialog.open ();
        if (data == null) {
            return;
        }
        boolean isPrintToFit = MessageDialog.openQuestion (null, DiagramUIPrintingMessages.Print_MessageDialogTitle, DiagramUIPrintingMessages.Print_MessageDialogMessage);
        final Printer printer = new Printer (data);
        diagramPrinter.setPrinter (printer);
        diagramPrinter.setDisplayDPI (Display.getDefault ().getDPI ());
        DiagramEditPart dgrmEP = ((IDiagramWorkbenchPart) editorPart).getDiagramEditPart ();
        if (dgrmEP == null) {
            return;
        }
        diagramPrinter.setDiagrams (Collections.singletonList (dgrmEP.getDiagramView ().getDiagram ()));
        if (isPrintToFit) {
            diagramPrinter.setColumns (1);
            diagramPrinter.setRows (1);
        } else {
            diagramPrinter.setScaledPercent (100);
        }
        diagramPrinter.run ();
        printer.dispose ();
    }

    private DefaultPrintActionHelper () {
    }

}

