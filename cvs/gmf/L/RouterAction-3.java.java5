package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import java.util.List;

import java.util.ListIterator;

import org.eclipse.ui.IWorkbenchPage;

import org.eclipse.gmf.runtime.diagram.ui.actions.CheckedPropertyAction;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramActionsResourceManager;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.Images;

import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.Messages;

import org.eclipse.gmf.runtime.diagram.ui.editparts.ITreeBranchEditPart;

import org.eclipse.gmf.runtime.diagram.ui.internal.requests.ActionIds;

import org.eclipse.gmf.runtime.diagram.ui.properties.Properties;

import org.eclipse.gmf.runtime.notation.Routing;

public class RouterAction extends CheckedPropertyAction {

    protected RouterAction (IWorkbenchPage workbenchPage, Routing routerType) {
        super (workbenchPage, Properties.ID_ROUTING, DiagramActionsResourceManager.getI18NString ("ChangeRouterAction.ChangePropertyValueRequest.label"), routerType);
    }

    public static RouterAction createRectilinearRouterAction (IWorkbenchPage workbenchPage) {
        RouterAction action = new RouterAction (workbenchPage, Routing.RECTILINEAR_LITERAL);
        action.setId (ActionIds.ACTION_ROUTER_RECTILINEAR);
        action.setText (Messages.getString ("ChangeRouterAction.Rectilinear.ActionLabelText"));
        action.setToolTipText (Messages.getString ("ChangeRouterAction.Rectilinear.ActionToolTipText"));
        action.setImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_RECTILINEAR);
        action.setDisabledImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_RECTILINEAR_DISABLED);
        action.setHoverImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_RECTILINEAR);
        return action;
    }

    public static RouterAction createObliqueRouterAction (IWorkbenchPage workbenchPage) {
        RouterAction action = new RouterAction (workbenchPage, Routing.MANUAL_LITERAL);
        action.setId (ActionIds.ACTION_ROUTER_OBLIQUE);
        action.setText (Messages.getString ("ChangeRouterAction.Oblique.ActionLabelText"));
        action.setToolTipText (Messages.getString ("ChangeRouterAction.Oblique.ActionToolTipText"));
        action.setImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_OBLIQUE);
        action.setDisabledImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_OBLIQUE_DISABLED);
        action.setHoverImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_OBLIQUE);
        return action;
    }

    public static RouterAction createTreeRouterAction (IWorkbenchPage workbenchPage) {
        RouterAction action = new RouterAction (workbenchPage, Routing.TREE_LITERAL);
        action.setId (ActionIds.ACTION_ROUTER_TREE);
        action.setText (Messages.getString ("ChangeRouterAction.Tree.ActionLabelText"));
        action.setToolTipText (Messages.getString ("ChangeRouterAction.Tree.ActionToolTipText"));
        action.setImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_TREE);
        action.setDisabledImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_TREE_DISABLED);
        action.setHoverImageDescriptor (Images.DESC_ACTION_CHANGEROUTERACTION_TREE);
        return action;
    }

    protected boolean calculateEnabled () {
        if (getId () == ActionIds.ACTION_ROUTER_TREE) {
            List selected = getSelectedObjects ();
            if (selected.size () < 2) return false;

            ListIterator li = selected.listIterator ();
            while (li.hasNext ()) {
                if (! (li.next () instanceof ITreeBranchEditPart)) return false;

            }
        }
        return super.calculateEnabled ();
    }

}

