head	1.7;
access;
symbols
	v20080910-1520:1.7
	v20080722-1827:1.7
	v20080716-1642:1.7
	R2_1_maintenance:1.7.0.2
	Root_R2_1_maintenance:1.7
	R2_1_0:1.7
	v20080507-1326:1.7
	v20080501-1739:1.6
	v20080425-1959:1.6
	v20080322-0000:1.6
	v20071108-0000:1.5
	v20071003-0000:1.5
	v20070921-0000:1.3
	v20070915-0000:1.3
	v20070903-0000:1.4
	v20070809-0000:1.3
	R2_0_maintenance:1.3.0.2
	R2_0:1.3
	R4_20:1.3
	v20070621-0000:1.3
	RC3_20:1.3
	v20070614-1400:1.3
	v20070608-1300:1.3
	v20070601-1400:1.3
	v20070525-1500:1.3
	v20070520-1200:1.3
	v20070518-1300:1.2
	v20070504-1000:1.1
	v20070427-0600:1.1
	v20070420-1000:1.1
	v20070413-1300:1.1
	v20070405-1100:1.1
	v20070403-1500:1.1
	v20070330-1300:1.1
	v20060330-1300:1.1
	v20070322-1100:1.1
	v20060316-0600:1.1
	v20070307-0700:1.1
	v20070228-2000:1.1
	v20070221-1500:1.1
	v20070208-1800:1.1;
locks; strict;
comment	@# @;


1.7
date	2008.05.07.13.55.39;	author atikhomirov;	state Exp;
branches;
next	1.6;
commitid	388c4821b4d44567;

1.6
date	2008.02.26.22.50.33;	author atikhomirov;	state Exp;
branches;
next	1.5;
commitid	405e47c497b74567;

1.5
date	2007.09.18.10.18.54;	author bblajer;	state Exp;
branches;
next	1.4;
commitid	6ac646efa60d4567;

1.4
date	2007.08.31.17.56.39;	author bblajer;	state Exp;
branches;
next	1.3;
commitid	72b646d856574567;

1.3
date	2007.05.18.21.17.26;	author atikhomirov;	state Exp;
branches;
next	1.2;
commitid	25e5464e17e24567;

1.2
date	2007.05.18.10.36.19;	author atikhomirov;	state Exp;
branches;
next	1.1;
commitid	a20464d81a24567;

1.1
date	2007.02.08.16.35.07;	author bblajer;	state Exp;
branches;
next	;
commitid	4b245cb513a4567;


desc
@@


1.7
log
@[228913] updated ValueExpression use in GMFGen to better accomodate codegen needs (items 1,2,3)
@
text
@/*
 * Copyright (c) 2007, 2008 Borland Software Corporation
 * 
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    bblajer (Borland) - initial API and implementation
 */

«IMPORT "http://www.eclipse.org/gmf/2008/GenModel"»
«IMPORT "http://www.eclipse.org/emf/2002/Ecore"»
«IMPORT "http://www.eclipse.org/emf/2002/GenModel"»
«EXTENSION xpt::GenModelUtils»
«EXTENSION xpt::viewfactories::BehaviourUtils»
«EXTENSION xpt::diagram::ViewmapAttributesUtils»

«DEFINE ViewFactory FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::copyright FOR getDiagram().editorGen»
package «getDiagram().notationViewFactoriesPackageName»;

«EXPAND xpt::Common::generatedClassComment»
public class «notationViewFactoryClassName» «EXPAND supertypes» {
«EXPAND instanceDeclaration-»
«EXPAND decorateView-»
«EXPAND predefinedChildren-»
«EXPAND additions-»
}
«ENDDEFINE»

«DEFINE supertypes FOR gmfgen::GenCommonBase»implements org.eclipse.gmf.runtime.lite.services.IViewDecorator«ENDDEFINE»

«DEFINE instanceDeclaration FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public static «notationViewFactoryClassName» INSTANCE = new «notationViewFactoryClassName»();
«ENDDEFINE»

«DEFINE decorateView FOR gmfgen::GenCommonBase-»
«EXPAND xpt::Common::generatedMemberComment»
public void decorateView(org.eclipse.gmf.runtime.notation.View view) {
	if (view.eIsSet(org.eclipse.gmf.runtime.notation.NotationPackage.eINSTANCE.getView_Type())) {
		return;
	}
«EXPAND setViewType-»
«EXPAND initStyles-»
«EXPAND addCustomStyle FOREACH styles-»
«EXPAND instantiatePredefinedChildren-»
«EXPAND createOpenDiagramAnnotation-»
}
«ENDDEFINE»

«DEFINE addCustomStyle FOR genmodel::GenClass-»
view.getStyles().add(«EXPAND MetaModel::NewInstance»);
«ENDDEFINE»

«DEFINE setViewType FOR gmfgen::GenCommonBase-»
view.setType(«getDiagram().getVisualIDRegistryQualifiedClassName()».getType(«getEditPartQualifiedClassName()».VISUAL_ID));
«ENDDEFINE»

«DEFINE setViewType FOR gmfgen::GenDiagram-»
	view.setType(«getDiagram().getEditPartQualifiedClassName()».MODEL_ID);
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenCommonBase-»
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenDiagram-»
	org.eclipse.gmf.runtime.notation.DiagramStyle style = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createDiagramStyle();
	view.getStyles().add(style);
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenNode-»
«IF viewmap.isFixedFont() || viewmap.isFixedForeground() || viewmap.isFixedBackground()-»
	«IF !viewmap.isFixedFont()-»
	org.eclipse.gmf.runtime.notation.FontStyle fontStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFontStyle();
	«EXPAND initFontStyle("fontStyle")-»
	view.getStyles().add(fontStyle);
	«ENDIF-»
	«IF !viewmap.isFixedForeground()-»
	org.eclipse.gmf.runtime.notation.LineStyle lineStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createLineStyle();
	«EXPAND initLineStyle("lineStyle")-»
	view.getStyles().add(lineStyle);
	«ENDIF-»
	«IF !viewmap.isFixedBackground()-»
	org.eclipse.gmf.runtime.notation.FillStyle fillStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFillStyle();
	«EXPAND initFillStyle("fillStyle")-»
	view.getStyles().add(fillStyle);
	«ENDIF-»
«ELSE-»
	org.eclipse.gmf.runtime.notation.ShapeStyle style = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createShapeStyle();
	«EXPAND initFontStyle("style")-»
	«EXPAND initLineStyle("style")-»
	«EXPAND initFillStyle("style")-»
	view.getStyles().add(style);
«ENDIF-»
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenChildLabelNode-»
«IF !viewmap.isFixedFont()-»
	org.eclipse.gmf.runtime.notation.FontStyle style = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFontStyle();
	«EXPAND initFontStyle("style")-»
	view.getStyles().add(style);
«ENDIF-»
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenCompartment-»
	org.eclipse.gmf.runtime.notation.DrawerStyle drawerStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createDrawerStyle();
	view.getStyles().add(drawerStyle);
	org.eclipse.gmf.runtime.notation.TitleStyle titleStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createTitleStyle();
	view.getStyles().add(titleStyle);
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenLink-»
«IF !viewmap.isFixedFont()-»
	org.eclipse.gmf.runtime.notation.FontStyle fontStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFontStyle();
	«EXPAND initFontStyle("fontStyle")-»
	view.getStyles().add(fontStyle);
«ENDIF-»
«IF !viewmap.isFixedForeground()-»
	org.eclipse.gmf.runtime.notation.LineStyle lineStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createLineStyle();
	«EXPAND initLineStyle("lineStyle")-»
	view.getStyles().add(lineStyle);
«ENDIF-»
«IF !viewmap.isFixedBackground()-»
	org.eclipse.gmf.runtime.notation.FillStyle fillStyle = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFillStyle();
	«EXPAND initFillStyle("fillStyle")-»
	view.getStyles().add(fillStyle);
«ENDIF-»
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenLinkLabel-»
«EXPAND initLocation-»
«ENDDEFINE»

«DEFINE initStyles FOR gmfgen::GenExternalNodeLabel-»
«EXPAND initLocation-»
«ENDDEFINE»

«DEFINE initLocation FOR gmfgen::GenLabel-»
		org.eclipse.gmf.runtime.notation.Location location = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createLocation();
«LET viewmap.labelOffsetX(0) AS x-»
«IF x != 0-»
		location.setX(«x»);
«ENDIF»
«ENDLET-»
«LET viewmap.labelOffsetY(0) AS y-»
«IF y != 0-»
		location.setY(«y»);
«ENDIF»
«ENDLET-»
		((org.eclipse.gmf.runtime.notation.Node)view).setLayoutConstraint(location);
«ENDDEFINE»

«DEFINE instantiatePredefinedChildren FOR gmfgen::GenCommonBase-»
«ENDDEFINE»

«DEFINE instantiatePredefinedChildren FOR gmfgen::GenNode-»
«EXPAND instantiatePredefinedChildLabel FOREACH labels-»
«EXPAND instantiatePredefinedChildCompartment FOREACH compartments-»
«ENDDEFINE»

«DEFINE instantiatePredefinedChildCompartment FOR gmfgen::GenCompartment-»
	create«visualID»Compartment(view);
«ENDDEFINE»

«DEFINE instantiatePredefinedChildLabel FOR gmfgen::GenLabel-»
	create«visualID»Label(view);
«ENDDEFINE»

«DEFINE instantiatePredefinedChildren FOR gmfgen::GenChildLabelNode-»
«ENDDEFINE»

«DEFINE instantiatePredefinedChildren FOR gmfgen::GenLink-»
«EXPAND instantiatePredefinedChildLabel FOREACH labels-»
«ENDDEFINE»

«DEFINE predefinedChildren FOR gmfgen::GenCommonBase-»
«ENDDEFINE»

«DEFINE predefinedChildren FOR gmfgen::GenNode-»
«EXPAND predefinedChildLabel FOREACH labels-»
«EXPAND predefinedChildCompartment FOREACH compartments-»
«ENDDEFINE»

«DEFINE predefinedChildren FOR gmfgen::GenChildLabelNode-»
«ENDDEFINE»

«DEFINE predefinedChildCompartment FOR gmfgen::GenCompartment-»
	«EXPAND xpt::Common::generatedMemberComment»
	private void create«visualID»Compartment(org.eclipse.gmf.runtime.notation.View view) {
		org.eclipse.gmf.runtime.notation.Node compartment = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createNode();
		view.getPersistedChildren().add(compartment);
		«getNotationViewFactoryQualifiedClassName()».INSTANCE.decorateView(compartment);
	}
«ENDDEFINE»

«DEFINE predefinedChildLabel FOR gmfgen::GenLabel-»
	«EXPAND xpt::Common::generatedMemberComment»
	private void create«visualID»Label(org.eclipse.gmf.runtime.notation.View view) {
		org.eclipse.gmf.runtime.notation.Node label = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createNode();
		view.getPersistedChildren().add(label);
		«getNotationViewFactoryQualifiedClassName()».INSTANCE.decorateView(label);
	}
«ENDDEFINE»

«DEFINE predefinedChildren FOR gmfgen::GenLink-»
«EXPAND predefinedChildLabel FOREACH labels-»
«ENDDEFINE»

«DEFINE createOpenDiagramAnnotation FOR gmfgen::GenCommonBase-»
«LET openDiagramBehaviours() AS openDiagramBehaviours-»
«IF openDiagramBehaviours.size() == 1-»
	org.eclipse.gmf.runtime.notation.HintedDiagramLinkStyle diagramFacet = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createHintedDiagramLinkStyle();
«IF openDiagramBehaviours.diagramKind.first() != null-»
		diagramFacet.setHint("«openDiagramBehaviours.diagramKind.first()»"); «EXPAND xpt::Common::nonNLS»
«ENDIF-»
		view.getStyles().add(diagramFacet);
«ENDIF-»
«ENDLET-»
«ENDDEFINE»

«DEFINE createOpenDiagramAnnotation FOR gmfgen::GenDiagram-»
«ENDDEFINE»

«DEFINE initFontStyle(String styleVar) FOR gmfgen::GenCommonBase-»
org.eclipse.swt.graphics.FontData defaultFontData = org.eclipse.jface.preference.PreferenceConverter.getFontData(«getDiagram().editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getPreferenceStore(), org.eclipse.gmf.runtime.lite.preferences.IPreferenceConstants.DEFAULT_FONT);
«styleVar».setFontName(defaultFontData.getName());
«styleVar».setFontHeight(defaultFontData.getHeight());
«styleVar».setBold((defaultFontData.getStyle() & org.eclipse.swt.SWT.BOLD) != 0);
«styleVar».setItalic((defaultFontData.getStyle() & org.eclipse.swt.SWT.ITALIC) != 0);
org.eclipse.swt.graphics.RGB defaultFontColor = org.eclipse.jface.preference.PreferenceConverter.getColor(«getDiagram().editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getPreferenceStore(), org.eclipse.gmf.runtime.lite.preferences.IPreferenceConstants.FONT_COLOR);
«styleVar».setFontColor((defaultFontColor.blue << 16) | (defaultFontColor.green << 8) | defaultFontColor.red);
«ENDDEFINE»

«DEFINE initLineStyle(String styleVar) FOR gmfgen::GenCommonBase-»
org.eclipse.swt.graphics.RGB defaultLineColor = org.eclipse.jface.preference.PreferenceConverter.getColor(«getDiagram().editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getPreferenceStore(), org.eclipse.gmf.runtime.lite.preferences.IPreferenceConstants.LINE_COLOR);
«styleVar».setLineColor((defaultLineColor.blue << 16) | (defaultLineColor.green << 8) | defaultLineColor.red);
«ENDDEFINE»

«DEFINE initFillStyle(String styleVar) FOR gmfgen::GenCommonBase-»
org.eclipse.swt.graphics.RGB defaultFillColor = org.eclipse.jface.preference.PreferenceConverter.getColor(«getDiagram().editorGen.plugin.getActivatorQualifiedClassName()».getInstance().getPreferenceStore(), org.eclipse.gmf.runtime.lite.preferences.IPreferenceConstants.FILL_COLOR);
«styleVar».setFillColor((defaultFillColor.blue << 16) | (defaultFillColor.green << 8) | defaultFillColor.red);
«ENDDEFINE»

«DEFINE additions FOR gmfgen::GenCommonBase-»
«ENDDEFINE»
@


1.6
log
@[150177] phase I, refactor existing code: completed - all metamodel access moved to MetaModel template, LiteRT version updated
@
text
@d13 1
a13 1
«IMPORT "http://www.eclipse.org/gmf/2006/GenModel"»
@


1.5
log
@1. Preferences for fonts and colors
2. ResourceManager employed to reuse fonts and colors used for styles
3. Option to check the availability of the font name that is specified in the style
4. Styles are initialized with defaults from preferences
@
text
@d2 1
a2 1
 * Copyright (c) 2007 Borland Software Corporation
d55 1
a55 1
view.getStyles().add(«EXPAND xpt::Common::newInstance»);
@


1.4
log
@[201937]: Provide means to modify fonts and colors of a view in Lite diagrams;
Correct the styles attached to each of the diagram element type (make consistent with the code that refreshes them);
IllegalArgumentException when FontStyle specifies null font family name or a negative font size: default font name/size is now used instead;
Correct test to match the new logic of default color used for links;
Include schema for the oeg.runtime.lite in the builds
@
text
@d77 3
a79 2
	org.eclipse.gmf.runtime.notation.FontStyle style = org.eclipse.gmf.runtime.notation.NotationFactory.eINSTANCE.createFontStyle();
	view.getStyles().add(style);
d83 1
d88 1
d93 3
d103 1
d118 1
d123 1
d128 1
d227 20
@


1.3
log
@switching to nsURI format which uses year to denote model version (same way EMF does)
@
text
@d48 1
d54 4
d75 14
d91 1
d95 4
d108 15
@


1.2
log
@Updated OpenDiagramEditPolicy generation to utilize newly introduced (bug #159479) appropriate diagram styles instead of annotations
@
text
@d13 1
a13 1
«IMPORT "http://www.eclipse.org/gmf/2005/GenModel/2.0"»
@


1.1
log
@Rewritten View factories using xpand;
[173476]: Respect label offset attributes when generating code
@
text
@d166 5
a170 3
	org.eclipse.emf.ecore.EAnnotation diagramFacet = org.eclipse.emf.ecore.EcoreFactory.eINSTANCE.createEAnnotation();
	diagramFacet.setSource(«EXPAND annotationSource FOR (OpenDiagramBehaviour) openDiagramBehaviours.first()»);
	view.getEAnnotations().add(diagramFacet);
a174 2
«DEFINE annotationSource FOR gmfgen::OpenDiagramBehaviour»"uri://eclipse.org/gmf/openDiagramPolicy"«ENDDEFINE»

@

