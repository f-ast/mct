head	1.4;
access;
symbols
	R1_0_maintenance:1.4.0.2
	R1_0:1.4
	I20060203-0830:1.3
	I20060129-1145:1.3
	I20060127-0900:1.3
	I20060120-1530:1.3
	I20060113-1700:1.3
	M4_10:1.3
	I20060107-1100:1.3
	I20060105-1630:1.3
	I20051230-1230:1.3
	I20051223-1100:1.3
	I20051217-0925:1.3
	I20051201-1800:1.3
	I20051124-2000:1.3
	M3_10:1.3
	I20051118-1245:1.3
	I20051111-1800:1.3
	I20051106-0900:1.3
	v20051030:1.3;
locks; strict;
comment	@# @;


1.4
date	2006.02.08.14.52.12;	author ldamus;	state dead;
branches;
next	1.3;

1.3
date	2005.10.28.20.56.07;	author vramaswamy;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.12.21.25.12;	author sshaw;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.30.03.26.50;	author sshaw;	state Exp;
branches;
next	;


desc
@@


1.4
log
@[121508] gmf_head cdamus 060208 Refactor MSL using the new transaction API
@
text
@/******************************************************************************
 * Copyright (c) 2004 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/

package org.eclipse.gmf.runtime.emf.core;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;

import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.core.runtime.IStatus;
import org.eclipse.core.runtime.MultiStatus;
import org.eclipse.core.runtime.NullProgressMonitor;
import org.eclipse.core.runtime.Status;
import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.EReference;
import org.eclipse.emf.ecore.InternalEObject;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.emf.validation.model.EvaluationMode;
import org.eclipse.emf.validation.service.IBatchValidator;
import org.eclipse.emf.validation.service.ModelValidationService;
import org.eclipse.gmf.runtime.emf.core.edit.MEditingDomain;
import org.eclipse.gmf.runtime.emf.core.internal.domain.MSLEditingDomain;
import org.eclipse.gmf.runtime.emf.core.internal.l10n.EMFCoreMessages;
import org.eclipse.gmf.runtime.emf.core.internal.plugin.MSLPlugin;
import org.eclipse.gmf.runtime.emf.core.internal.resources.MResource;
import org.eclipse.gmf.runtime.emf.core.internal.util.ConstraintStatusAdapter;
import org.eclipse.gmf.runtime.emf.core.internal.util.MSLUtil;
import org.eclipse.gmf.runtime.emf.core.util.EObjectUtil;
import org.eclipse.gmf.runtime.emf.core.util.ProxyUtil;

/**
 * The implementation of the <code>IEObjectHelper</code> interface.
 * 
 * @@canBeSeenBy %partners
 */
public class EObjectHelper
	implements IEObjectHelper {

	private static final IStatus OK_STATUS = new Status(IStatus.OK, MSLPlugin
		.getPluginId(), 0, EMFCoreMessages.validation_none,
		null);

	/**
	 * The <code>EditingDomain</code> that owns the elements managed by the
	 * helper
	 */
	private MEditingDomain editingDomain;

	private IBatchValidator validator;
	
	/**
	 * Constructor
	 * 
	 * @@param editingDomainIn
	 *            The <code>EditingDomain</code> owning the elements
	 */
	public EObjectHelper(MEditingDomain editingDomainIn) {
		editingDomain = editingDomainIn;
	}

	/**
	 * Returns the <code>editingDomain</code>
	 * 
	 * @@return The <code>EditingDomain</code>
	 */
	private MEditingDomain getEditingDomain() {
		return editingDomain;
	}

	/*
	 * Object Utilities
	 */

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#destroy(org.eclipse.emf.ecore.EObject)
	 */
	public void destroy(EObject eObject) {

		EObject container = eObject.eContainer();

		if (container != null) {

			Resource resource = container.eResource();

			if (resource instanceof MResource)
				((MResource) resource).getHelper().destroy(getEditingDomain(),
					eObject);
			else
				MSLUtil.destroy((MSLEditingDomain) getEditingDomain(), eObject,
					0);
		}
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getID(org.eclipse.emf.ecore.EObject)
	 */
	public String getID(EObject eObject) {
		return EObjectUtil.getID(eObject);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getName(org.eclipse.emf.ecore.EObject)
	 */
	public String getName(EObject eObject) {
		return EObjectUtil.getName(eObject);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#setName(org.eclipse.emf.ecore.EObject,
	 *      java.lang.String)
	 */
	public boolean setName(EObject eObject, String name) {
		return EObjectUtil.setName(eObject, name);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getQName(org.eclipse.emf.ecore.EObject,
	 *      boolean)
	 */
	public String getQName(EObject eObject, boolean formatted) {
		return EObjectUtil.getQName(eObject, formatted);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getReferencers(org.eclipse.emf.ecore.EObject,
	 *      org.eclipse.emf.ecore.EReference[])
	 */
	public Collection getReferencers(EObject eObject, EReference[] features) {

		return EObjectUtil.getReferencers(eObject, features);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#validate(java.util.Collection,
	 *      org.eclipse.core.runtime.IProgressMonitor)
	 */
	public IStatus validate(Collection objects, IProgressMonitor monitor) {

		if (null == objects) {
			throw new NullPointerException("Argument 'objects' is null"); //$NON-NLS-1$
		}
		
		Collection statuses = new ArrayList();
		
		// let clients be uninterested in progress
		if (monitor == null) {
			monitor = new NullProgressMonitor();
		}
		
		// We will now call upon the EMF Validation service
		//  to validate this action and return the status of
		//  that validation.
		statuses.add(ConstraintStatusAdapter
			.wrapStatus(getValidator().validate(objects,monitor)));
		
		return combineValidationResults(statuses);
	}
	
	private IBatchValidator getValidator() {
		if (validator == null) {
			validator = (IBatchValidator) ModelValidationService
				.getInstance().newValidator(EvaluationMode.BATCH);
			
			validator.setIncludeLiveConstraints(true);
			validator.setReportSuccesses(false);
			validator.putClientData("editingDomain", getEditingDomain()); //$NON-NLS-1$
		}
		
		return validator;
	}
	
	/**
	 * Combines a collection of {@@link IStatus} results coming
	 *  from various validations into a single status.
	 * 
	 * @@param statuses a collection of {@@link IStatus}es
	 * @@return a single, all-encompassing, status object
	 */
	private static IStatus combineValidationResults(Collection statuses) {
		List result = new java.util.ArrayList();

		for (Iterator iter = statuses.iterator(); iter.hasNext();) {
			IStatus next = (IStatus) iter.next();
			if( next != null ) {
				if (next.isMultiStatus()) {
					IStatus[] children = next.getChildren();
					for (int i = 0; i < children.length; i++) {
						result.add(children[i]);
					}
				} else {
					result.add(next);
				}
			}
		}

		if (result.isEmpty()) {
			return OK_STATUS;
		} else if (result.size() == 1) {
			return (IStatus) result.get(0);
		} else {
			return new MultiStatus(MSLPlugin.getPluginId(), 0,
				(IStatus[]) result.toArray(new IStatus[result.size()]),
				EMFCoreMessages.validation_multi, null);
		}
	}

	/*
	 * Proxy Utilities
	 */

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getProxyName(org.eclipse.emf.ecore.InternalEObject)
	 */
	public String getProxyName(InternalEObject eObject) {
		return ProxyUtil.getProxyName(eObject);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getProxyQName(org.eclipse.emf.ecore.InternalEObject)
	 */
	public String getProxyQName(InternalEObject eObject) {
		return ProxyUtil.getProxyQName(eObject);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getProxyID(org.eclipse.emf.ecore.InternalEObject)
	 */
	public String getProxyID(InternalEObject eObject) {
		return ProxyUtil.getProxyID(eObject);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @@see org.eclipse.gmf.runtime.emf.core.IEObjectHelper#getProxyClass(org.eclipse.emf.ecore.InternalEObject)
	 */
	public EClass getProxyClass(InternalEObject eObject) {
		return ProxyUtil.getProxyClass(eObject);
	}
}@


1.3
log
@Bugzilla 114008 gmf_head cvogt 051028 - Sweep emf plugin message bundles
@
text
@@


1.2
log
@Bugzilla 108765 gmf_head tmacdoug 050912 - Update copyrights of GMF and EMFT plugins content to Eclipse copyright (EPL)
@
text
@d29 3
a31 1

d34 1
a34 1
import org.eclipse.gmf.runtime.emf.core.internal.l10n.ResourceManager;
a40 3
import org.eclipse.emf.validation.model.EvaluationMode;
import org.eclipse.emf.validation.service.IBatchValidator;
import org.eclipse.emf.validation.service.ModelValidationService;
d49 1
a49 7
	
	/** Localized message key for the "multiple violations" message. */
	private static final String MULTI_VIOLATIONS_KEY = "validation.multi"; //$NON-NLS-1$
	
	/** Localized message key for the "no validation required" message. */
	private static final String NO_VALIDATION_KEY = "validation.none"; //$NON-NLS-1$
	
d51 1
a51 1
		.getPluginId(), 0, ResourceManager.getI18NString(NO_VALIDATION_KEY),
d228 1
a228 1
				ResourceManager.getI18NString(MULTI_VIOLATIONS_KEY), null);
@


1.1
log
@Refactoring of the IBM gmf runtime contribution to the org.eclipse.gmf.runtime namespace.
@
text
@d1 11
a11 9
/*
 *+------------------------------------------------------------------------+
 *| Licensed Materials - Property of IBM                                   |
 *| (C) Copyright IBM Corp. 2004.  All Rights Reserved.                    |
 *|                                                                        |
 *| US Government Users Restricted Rights - Use, duplication or disclosure |
 *| restricted by GSA ADP Schedule Contract with IBM Corp.                 |
 *+------------------------------------------------------------------------+
 */
@

