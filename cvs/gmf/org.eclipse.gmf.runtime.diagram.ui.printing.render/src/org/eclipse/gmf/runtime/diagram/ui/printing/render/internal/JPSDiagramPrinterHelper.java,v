head	1.3;
access;
symbols
	v20081020-0700:1.3
	v20080924-1925:1.3
	v20080916-2008:1.3
	v20080827-1510:1.3
	v20080820-2230:1.3
	v20080722-1827:1.3
	R2_1_maintenance:1.3.0.2
	Root_R2_1_maintenance:1.3
	R2_1_0:1.3
	v20080425-1959:1.3
	v20080407-0930:1.2
	v20080404-1111:1.2
	v20080331-1625:1.2
	v20080328-1605:1.1
	v20080322-0000:1.1;
locks; strict;
comment	@# @;


1.3
date	2008.04.24.14.45.41;	author ahunter;	state Exp;
branches;
next	1.2;
commitid	6ee148109d144567;

1.2
date	2008.03.31.15.00.56;	author crevells;	state Exp;
branches;
next	1.1;
commitid	3a5247f0fca74567;

1.1
date	2008.03.07.16.51.29;	author ahunter;	state Exp;
branches;
next	;
commitid	29b447d1728f4567;


desc
@@


1.3
log
@[227373] gmf-head jbruck 080424 [Printing] Combined commit for Bug 228057 , Bug 227796 , Bug 227006 and Bug 227373
@
text
@/******************************************************************************
 * Copyright (c) 2008 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/
package org.eclipse.gmf.runtime.diagram.ui.printing.render.internal;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Map;

import org.eclipse.gmf.runtime.common.core.util.Log;
import org.eclipse.gmf.runtime.common.core.util.Trace;
import org.eclipse.gmf.runtime.common.ui.printing.IPrintHelper;
import org.eclipse.gmf.runtime.diagram.ui.editparts.DiagramEditPart;
import org.eclipse.gmf.runtime.diagram.ui.parts.IDiagramWorkbenchPart;
import org.eclipse.gmf.runtime.diagram.ui.printing.internal.DiagramPrintingDebugOptions;
import org.eclipse.gmf.runtime.diagram.ui.printing.internal.DiagramPrintingPlugin;
import org.eclipse.gmf.runtime.diagram.ui.printing.internal.DiagramPrintingStatusCodes;
import org.eclipse.gmf.runtime.diagram.ui.printing.internal.l10n.DiagramUIPrintingMessages;
import org.eclipse.gmf.runtime.diagram.ui.printing.internal.util.DiagramPrinterHelper;
import org.eclipse.gmf.runtime.diagram.ui.printing.render.util.PrintHelper;
import org.eclipse.gmf.runtime.diagram.ui.printing.util.DiagramPrinterUtil;
import org.eclipse.gmf.runtime.notation.Diagram;
import org.eclipse.jface.dialogs.MessageDialog;
import org.eclipse.swt.printing.PrinterData;
import org.eclipse.swt.widgets.Display;
import org.eclipse.ui.IEditorPart;

/**
 * Utility for using the DiagramPrinter to print diagrams after displaying
 * a print dialog box to the user.  Diagrams are printed using the
 * DiagramPrinter and respect the settings chosen by the user in the print
 * dialog. 
 * 
 * This class uses the java print service API to accomplish its task.
 * This class was derived from @@see org.eclipse.gmf.runtime.diagram.ui.printing.util.DiagramPrinterUtil
 * 
 * 
 * @@author James Bruck (jbruck)
 */
public class JPSDiagramPrinterHelper extends DiagramPrinterHelper {

	private static JPSDiagramPrinterHelper jpsDiagramPrinterHelper;

	public static JPSDiagramPrinterHelper getDiagramPrinterHelper() {
		if(jpsDiagramPrinterHelper == null){
			jpsDiagramPrinterHelper = new JPSDiagramPrinterHelper();
		}
		return jpsDiagramPrinterHelper;
	}

	/**
	 * Prevent instantiation.
	 */
	private JPSDiagramPrinterHelper() {
		super();
	}

	/**
	 * Opens up the print diagrams dialog, allows the user to choose the
	 * settings, and prints.
	 * 
	 * @@param editorPart
	 *            current editor part
	 * @@param diagramMap
	 *            map of String names to Diagram objects. Should be initialized
	 *            by caller of this method. String names will show up in the
	 *            print dialog that allows the user to choose which diagrams to
	 *            print from a list.
	 * @@param jpsDiagramPrinter
	 *            the diagram printer that does the work of actually printing the diagrams
	 */
	public void printWithSettings(IEditorPart editorPart,
			Map<String, Diagram> diagramMap, JPSDiagramPrinter jpsDiagramPrinter) {

		try {
			IPrintHelper helper = new PrintHelper();
			List<String> diagramNames = new ArrayList<String>(diagramMap
					.keySet());

			PrinterData printerData = collectPrintInformation(
					jpsDiagramPrinter, helper, diagramNames, editorPart,
					diagramMap);

			if (printerData != null) {
		
				jpsDiagramPrinter.setPrinter(printerData.name);
				jpsDiagramPrinter.setDisplayDPI(Display.getDefault().getDPI());
				jpsDiagramPrinter.setPrintHelper(helper);

				if (helper.getDlgDiagramPrintRangeCurrent()) {
					DiagramEditPart dgrmEP = ((IDiagramWorkbenchPart) editorPart)
							.getDiagramEditPart();
					assert dgrmEP != null;
					jpsDiagramPrinter
							.setDiagrams(Collections.singletonList(dgrmEP
									.getDiagramView().getDiagram()));
				} else if (helper.getDlgDiagramPrintRangeAll()) {
					jpsDiagramPrinter.setDiagrams(diagramMap.values());
				} else if (helper.getDlgDiagramPrintRangeSelection()) {
					Object obj;
					List<Diagram> list = new ArrayList<Diagram>();
					for (int i = 0; i < diagramNames.size(); i++) {
						if (helper.isDlgDiagramSelected(i)) {
							obj = diagramMap.get(diagramNames.get(i));
							if (obj instanceof Diagram) {
								list.add((Diagram) obj);
							}
						}
					}
					jpsDiagramPrinter.setDiagrams(list);
				}
				printDiagrams(jpsDiagramPrinter, helper);
			}
		} catch (Throwable e) {

			Trace.catching(DiagramPrintingPlugin.getInstance(),
					DiagramPrintingDebugOptions.EXCEPTIONS_CATCHING,
					DiagramPrinterUtil.class, e.getMessage(), e);
			Log.warning(DiagramPrintingPlugin.getInstance(),
					DiagramPrintingStatusCodes.RESOURCE_FAILURE,
					e.getMessage(), e);

			MessageDialog
					.openError(
							Display.getDefault().getActiveShell(),
							DiagramUIPrintingMessages.JPSDiagramPrinterUtil_ErrorTitle,
							DiagramUIPrintingMessages.JPSDiagramPrinterUtil_ErrorMessage);
		}
	}
}
@


1.2
log
@[224387] gmf-head jbruck 080331 [Printing] Enahncements to multi-platform printing
@
text
@a44 1
 * This class is subject to change/removal during phase 2 of printing enhancements
@


1.1
log
@[196834] gmf-head jbruck 080307 [Printing] Multi-platform Diagram Printing
@
text
@a31 1
import org.eclipse.swt.printing.Printer;
d64 1
d94 1
a94 3

				//final Printer printer = new Printer(printerData);
				
@

