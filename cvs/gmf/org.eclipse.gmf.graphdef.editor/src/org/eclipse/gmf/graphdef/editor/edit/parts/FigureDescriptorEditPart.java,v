head	1.8;
access;
symbols
	v20080722-1827:1.8
	v20080718-1700:1.8
	v20080718-1731:1.8
	v20080716-1642:1.8
	R2_1_maintenance:1.8.0.2
	Root_R2_1_maintenance:1.8
	R2_1_0:1.8
	v20080610-1132:1.8
	v20080603-1553:1.8
	v20080528-1052:1.8
	v20080521:1.7
	v20080516-1143:1.7
	v20080512-1200:1.6
	v20080510-0100:1.5
	v20080507-1326:1.5
	v20080501-1739:1.5
	v20080425-1959:1.5
	v20080411-0411:1.5
	v20080404-1111:1.5
	v20080322-0000:1.5
	v20080114-2222:1.1
	v20071214-1111:1.1
	v20070809-0000:1.1
	R2_0_maintenance:1.1.0.2
	R2_0:1.1
	R4_20:1.1
	v20070621-0000:1.1
	RC3_20:1.1
	v20070605-1400:1.1
	v20070601-1400:1.1;
locks; strict;
comment	@# @;
expand	@k@;


1.8
date	2008.05.23.14.30.31;	author ashatalin;	state Exp;
branches;
next	1.7;
commitid	1aec4836d5014567;

1.7
date	2008.05.14.11.16.58;	author ashatalin;	state Exp;
branches;
next	1.6;
commitid	377e482aca274567;

1.6
date	2008.05.12.17.40.17;	author ashatalin;	state Exp;
branches;
next	1.5;
commitid	a53482880fd4567;

1.5
date	2008.03.07.16.33.27;	author ashatalin;	state Exp;
branches;
next	1.4;
commitid	695c47d16e564567;

1.4
date	2008.03.07.13.32.03;	author ashatalin;	state Exp;
branches;
next	1.3;
commitid	382747d143d24567;

1.3
date	2008.03.07.12.50.34;	author ashatalin;	state Exp;
branches;
next	1.2;
commitid	179447d13a164567;

1.2
date	2008.02.22.13.07.59;	author ashatalin;	state Exp;
branches;
next	1.1;
commitid	4c5647bec9294567;

1.1
date	2007.05.31.15.52.31;	author ashatalin;	state Exp;
branches;
next	;
commitid	49f1465eef2c4567;


desc
@@


1.8
log
@[233205] - Support Polyline figure in .gmfgraph editor
@
text
@/*
 *  Copyright (c) 2006, 2007 Borland Software Corporation and others.
 *  All rights reserved. This program and the accompanying materials
 *  are made available under the terms of the Eclipse Public License v1.0
 *  which accompanies this distribution, and is available at
 *  http://www.eclipse.org/legal/epl-v10.html
 * 
 *  Contributors:
 *      Borland Software Corporation - initial API and implementation
 */
package org.eclipse.gmf.graphdef.editor.edit.parts;

import org.eclipse.draw2d.BorderLayout;
import org.eclipse.draw2d.Graphics;
import org.eclipse.draw2d.IFigure;
import org.eclipse.draw2d.RectangleFigure;
import org.eclipse.draw2d.RoundedRectangle;
import org.eclipse.draw2d.StackLayout;
import org.eclipse.draw2d.geometry.Dimension;
import org.eclipse.gef.EditPart;
import org.eclipse.gef.EditPolicy;
import org.eclipse.gef.Request;
import org.eclipse.gef.commands.Command;
import org.eclipse.gef.editpolicies.LayoutEditPolicy;
import org.eclipse.gef.editpolicies.NonResizableEditPolicy;
import org.eclipse.gef.requests.CreateRequest;
import org.eclipse.gmf.graphdef.editor.edit.policies.FigureDescriptorCanonicalEditPolicy;
import org.eclipse.gmf.graphdef.editor.edit.policies.FigureDescriptorItemSemanticEditPolicy;
import org.eclipse.gmf.graphdef.editor.part.GMFGraphVisualIDRegistry;
import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
import org.eclipse.gmf.runtime.diagram.ui.editparts.ShapeNodeEditPart;
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.CreationEditPolicy;
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.DragDropEditPolicy;
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.EditPolicyRoles;
import org.eclipse.gmf.runtime.draw2d.ui.figures.ConstrainedToolbarLayout;
import org.eclipse.gmf.runtime.draw2d.ui.figures.WrappingLabel;
import org.eclipse.gmf.runtime.gef.ui.figures.DefaultSizeNodeFigure;
import org.eclipse.gmf.runtime.gef.ui.figures.NodeFigure;
import org.eclipse.gmf.runtime.notation.View;

/**
 * @@generated
 */
public class FigureDescriptorEditPart extends ShapeNodeEditPart {

	/**
	 * @@generated
	 */
	public static final int VISUAL_ID = 3009;

	/**
	 * @@generated
	 */
	protected IFigure contentPane;

	/**
	 * @@generated
	 */
	protected IFigure primaryShape;

	/**
	 * @@generated
	 */
	public FigureDescriptorEditPart(View view) {
		super(view);
	}

	/**
	 * @@generated
	 */
	protected void createDefaultEditPolicies() {
		installEditPolicy(EditPolicyRoles.CREATION_ROLE, new CreationEditPolicy());
		super.createDefaultEditPolicies();
		installEditPolicy(EditPolicyRoles.SEMANTIC_ROLE, new FigureDescriptorItemSemanticEditPolicy());
		installEditPolicy(EditPolicyRoles.DRAG_DROP_ROLE, new DragDropEditPolicy());
		installEditPolicy(EditPolicyRoles.CANONICAL_ROLE, new FigureDescriptorCanonicalEditPolicy());
		installEditPolicy(EditPolicy.LAYOUT_ROLE, createLayoutEditPolicy());
		// XXX need an SCR to runtime to have another abstract superclass that would let children add reasonable editpolicies
		// removeEditPolicy(org.eclipse.gmf.runtime.diagram.ui.editpolicies.EditPolicyRoles.CONNECTION_HANDLES_ROLE);
	}

	/**
	 * @@generated
	 */
	protected LayoutEditPolicy createLayoutEditPolicy() {
		LayoutEditPolicy lep = new LayoutEditPolicy() {

			protected EditPolicy createChildEditPolicy(EditPart child) {
				EditPolicy result = child.getEditPolicy(EditPolicy.PRIMARY_DRAG_ROLE);
				if (result == null) {
					result = new NonResizableEditPolicy();
				}
				return result;
			}

			protected Command getMoveChildrenCommand(Request request) {
				return null;
			}

			protected Command getCreateCommand(CreateRequest request) {
				return null;
			}
		};
		return lep;

	}

	/**
	 * @@generated
	 */
	protected IFigure createNodeShape() {
		FigureDescriptorFigure figure = new FigureDescriptorFigure();
		return primaryShape = figure;
	}

	/**
	 * @@generated
	 */
	public FigureDescriptorFigure getPrimaryShape() {
		return (FigureDescriptorFigure) primaryShape;
	}

	/**
	 * @@generated
	 */
	protected boolean addFixedChild(EditPart childEditPart) {
		if (childEditPart instanceof FigureDescriptorNameEditPart) {
			((FigureDescriptorNameEditPart) childEditPart).setLabel(getPrimaryShape().getFigureFigureDescriptorFigure_NameLabel());
			return true;
		}
		return false;
	}

	/**
	 * @@generated
	 */
	protected boolean removeFixedChild(EditPart childEditPart) {

		return false;
	}

	/**
	 * @@generated
	 */
	protected void addChildVisual(EditPart childEditPart, int index) {
		if (addFixedChild(childEditPart)) {
			return;
		}
		super.addChildVisual(childEditPart, -1);
	}

	/**
	 * @@generated
	 */
	protected void removeChildVisual(EditPart childEditPart) {
		if (removeFixedChild(childEditPart)) {
			return;
		}
		super.removeChildVisual(childEditPart);
	}

	/**
	 * @@generated
	 */
	protected IFigure getContentPaneFor(IGraphicalEditPart editPart) {

		return super.getContentPaneFor(editPart);
	}

	/**
	 * @@generated
	 */
	protected NodeFigure createNodePlate() {
		DefaultSizeNodeFigure result = new DefaultSizeNodeFigure(getMapMode().DPtoLP(40), getMapMode().DPtoLP(40));
		return result;
	}

	/**
	 * Creates figure for this edit part.
	 * 
	 * Body of this method does not depend on settings in generation model
	 * so you may safely remove <i>generated</i> tag and modify it.
	 * 
	 * @@generated
	 */
	protected NodeFigure createNodeFigure() {
		NodeFigure figure = createNodePlate();
		figure.setLayoutManager(new StackLayout());
		IFigure shape = createNodeShape();
		figure.add(shape);
		contentPane = setupContentPane(shape);
		return figure;
	}

	/**
	 * Default implementation treats passed figure as content pane.
	 * Respects layout one may have set for generated figure.
	 * @@param nodeShape instance of generated figure class
	 * @@generated NOT
	 */
	protected IFigure setupContentPane(IFigure nodeShape) {
		FigureDescriptorFigure fdFigure = (FigureDescriptorFigure) nodeShape;
		IFigure contentPane = fdFigure.getFigureFigureDescriptorFigure_ChildContainer();
		if (contentPane.getLayoutManager() == null) {
			ConstrainedToolbarLayout layout = new ConstrainedToolbarLayout();
			layout.setSpacing(getMapMode().DPtoLP(5));
			contentPane.setLayoutManager(layout);
		}
		return contentPane; // use nodeShape itself as contentPane
	}

	/**
	 * @@generated
	 */
	public IFigure getContentPane() {
		if (contentPane != null) {
			return contentPane;
		}
		return super.getContentPane();
	}

	/**
	 * @@generated
	 */
	public EditPart getPrimaryChildEditPart() {
		return getChildBySemanticHint(GMFGraphVisualIDRegistry.getType(FigureDescriptorNameEditPart.VISUAL_ID));
	}

	/**
	 * @@generated
	 */
	public class FigureDescriptorFigure extends RoundedRectangle {

		/**
		 * @@generated
		 */
		private WrappingLabel fFigureFigureDescriptorFigure_NameLabel;

		/**
		 * @@generated
		 */
		private RectangleFigure fFigureFigureDescriptorFigure_ChildContainer;

		/**
		 * @@generated
		 */
		public FigureDescriptorFigure() {

			BorderLayout layoutThis = new BorderLayout();
			this.setLayoutManager(layoutThis);

			this.setCornerDimensions(new Dimension(getMapMode().DPtoLP(8), getMapMode().DPtoLP(8)));
			this.setLineStyle(Graphics.LINE_DOT);
			createContents();
		}

		/**
		 * @@generated
		 */
		private void createContents() {

			fFigureFigureDescriptorFigure_NameLabel = new WrappingLabel();
			fFigureFigureDescriptorFigure_NameLabel.setText("");

			this.add(fFigureFigureDescriptorFigure_NameLabel, BorderLayout.TOP);

			fFigureFigureDescriptorFigure_ChildContainer = new RectangleFigure();
			fFigureFigureDescriptorFigure_ChildContainer.setFill(false);
			fFigureFigureDescriptorFigure_ChildContainer.setOutline(false);

			this.add(fFigureFigureDescriptorFigure_ChildContainer, BorderLayout.CENTER);
			fFigureFigureDescriptorFigure_ChildContainer.setLayoutManager(new StackLayout());

		}

		/**
		 * @@generated
		 */
		private boolean myUseLocalCoordinates = false;

		/**
		 * @@generated
		 */
		protected boolean useLocalCoordinates() {
			return myUseLocalCoordinates;
		}

		/**
		 * @@generated
		 */
		protected void setUseLocalCoordinates(boolean useLocalCoordinates) {
			myUseLocalCoordinates = useLocalCoordinates;
		}

		/**
		 * @@generated
		 */
		public WrappingLabel getFigureFigureDescriptorFigure_NameLabel() {
			return fFigureFigureDescriptorFigure_NameLabel;
		}

		/**
		 * @@generated
		 */
		public RectangleFigure getFigureFigureDescriptorFigure_ChildContainer() {
			return fFigureFigureDescriptorFigure_ChildContainer;
		}

	}

}
@


1.7
log
@- Migrating to new .gmfgen model
- Using (0,0) as a minimum size for DefaultNode to make resize feedback minimum size == (0,0)
@
text
@a271 1

@


1.6
log
@[230191] - Start using FeatureTracker/AttachAdapter for listening model changes in org.eclipse.gmf.graphdef.editor
@
text
@a174 1

@


1.5
log
@Filling FigureGallery/Figure descriptor with proper layout.
@
text
@a85 1

d175 1
@


1.4
log
@Rollback of FigureDescriptor diagram element.
@
text
@d13 1
d16 1
a18 1
import org.eclipse.draw2d.ToolbarLayout;
a28 1
import org.eclipse.gmf.graphdef.editor.edit.policies.GMFGraphTextSelectionEditPolicy;
a30 1
import org.eclipse.gmf.runtime.diagram.ui.editparts.ITextAwareEditPart;
a31 1
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.ConstrainedToolbarLayoutEditPolicy;
d200 1
a200 1
	 * @@generated
d203 3
a205 1
		if (nodeShape.getLayoutManager() == null) {
d208 1
a208 1
			nodeShape.setLayoutManager(layout);
d210 1
a210 1
		return nodeShape; // use nodeShape itself as contentPane
d243 5
d249 4
d266 9
a274 1
			this.add(fFigureFigureDescriptorFigure_NameLabel);
d304 7
@


1.3
log
@Updating with new figures code + setting proper layout for diahram elements
@
text
@d89 1
a89 1
		ConstrainedToolbarLayoutEditPolicy lep = new ConstrainedToolbarLayoutEditPolicy() {
d92 3
a94 4
				if (child.getEditPolicy(EditPolicy.PRIMARY_DRAG_ROLE) == null) {
					if (child instanceof ITextAwareEditPart) {
						return new GMFGraphTextSelectionEditPolicy();
					}
d96 9
a104 1
				return super.createChildEditPolicy(child);
a243 10

			ToolbarLayout layoutThis = new ToolbarLayout();
			layoutThis.setStretchMinorAxis(true);
			layoutThis.setMinorAlignment(ToolbarLayout.ALIGN_CENTER);

			layoutThis.setSpacing(0);
			layoutThis.setVertical(true);

			this.setLayoutManager(layoutThis);

@


1.2
log
@Updating gmfgaph editor:
- Setting default size of all graphical elements to 0,0
- updating aspect templates to reflect latest changes
- regenerating code
@
text
@d17 1
d28 1
d31 1
d33 1
d38 1
a38 1
import org.eclipse.gmf.runtime.draw2d.ui.figures.WrapLabel;
d89 1
a89 1
		LayoutEditPolicy lep = new LayoutEditPolicy() {
d92 4
a95 3
				EditPolicy result = child.getEditPolicy(EditPolicy.PRIMARY_DRAG_ROLE);
				if (result == null) {
					result = new NonResizableEditPolicy();
d97 1
a97 9
				return result;
			}

			protected Command getMoveChildrenCommand(Request request) {
				return null;
			}

			protected Command getCreateCommand(CreateRequest request) {
				return null;
d231 1
a231 1
		private WrapLabel fFigureDescriptorFigure_NameLabel;
d237 10
d257 2
a258 2
			WrapLabel figureDescriptorFigure_NameLabel0 = new WrapLabel();
			figureDescriptorFigure_NameLabel0.setText("");
d260 1
a260 2
			this.add(figureDescriptorFigure_NameLabel0);
			fFigureDescriptorFigure_NameLabel = figureDescriptorFigure_NameLabel0;
d286 2
a287 2
		public WrapLabel getFigureFigureDescriptorFigure_NameLabel() {
			return fFigureDescriptorFigure_NameLabel;
@


1.1
log
@[190196] akarjakina - Adjust GMFGraph Editor according recent gmfgraph metamodel with support for FigureDescriptor introduced
@
text
@a70 1

@

