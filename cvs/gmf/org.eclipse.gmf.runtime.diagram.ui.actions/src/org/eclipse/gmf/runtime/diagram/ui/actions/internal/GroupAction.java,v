head	1.2;
access;
symbols
	v20081020-0700:1.2
	v20080917-1925:1.2
	v20080916-2008:1.2
	v20080722-1827:1.2
	v20080718-1700:1.2
	v20080718-1731:1.2
	R2_1_maintenance:1.2.0.2
	Root_R2_1_maintenance:1.2
	R2_1_0:1.2
	v20080603-1553:1.2
	v20080503-1740:1.2
	v20080425-1959:1.2
	v20080409-1326:1.2
	v20080407-2250:1.2
	v20080328-1605:1.2
	v20080222-1200:1.2
	v20080201-2010:1.2
	v20071130-1111:1.2
	bugzilla111892_group_support:1.1.0.2;
locks; strict;
comment	@# @;
expand	@k@;


1.2
date	2007.11.21.17.57.22;	author crevells;	state Exp;
branches;
next	1.1;
commitid	49a2474471824567;

1.1
date	2007.05.18.17.36.38;	author crevells;	state dead;
branches
	1.1.2.1;
next	;
commitid	1849464de4254567;

1.1.2.1
date	2007.05.18.17.36.38;	author crevells;	state Exp;
branches;
next	;
commitid	1849464de4254567;


desc
@@


1.2
log
@[111892] gmf_head crevells 071121 Group/Ungroup support
@
text
@/******************************************************************************
 * Copyright (c) 2007 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/

package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import java.util.Collections;
import java.util.List;

import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.gef.EditPart;
import org.eclipse.gef.Request;
import org.eclipse.gef.commands.Command;
import org.eclipse.gef.commands.UnexecutableCommand;
import org.eclipse.gef.requests.GroupRequest;
import org.eclipse.gef.tools.ToolUtilities;
import org.eclipse.gmf.runtime.diagram.ui.actions.ActionIds;
import org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction;
import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramUIActionsMessages;
import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramUIActionsPluginImages;
import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
import org.eclipse.gmf.runtime.notation.View;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.swt.widgets.Display;
import org.eclipse.ui.IWorkbenchPage;

/**
 * An action to group shapes together.
 * 
 * @@author mmostafa, crevells
 */
public class GroupAction
    extends DiagramAction {

    /**
     * Creates a new instance.
     * 
     * @@param workbenchPage
     */
    public GroupAction(IWorkbenchPage workbenchPage) {
        super(workbenchPage);
        setId(ActionIds.ACTION_GROUP);
        setText(DiagramUIActionsMessages.GroupAction_Group_ActionLabelText);
        setToolTipText(DiagramUIActionsMessages.GroupAction_Group_ActionToolTipText);
        setImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP);
        setDisabledImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP_DISABLED);
        setHoverImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP);
    }

    protected Request createTargetRequest() {
        return new GroupRequest(getId());
    }

    protected void updateTargetRequest() {
        GroupRequest request = (GroupRequest) getTargetRequest();
        request.setEditParts(getOperationSet());
    }

    protected Command getCommand() {
        if (getOperationSet().size() > 1) {
            EditPart parent = ((EditPart) getOperationSet().get(0)).getParent();
            return parent.getCommand(getTargetRequest());
        }
        return UnexecutableCommand.INSTANCE;
    }

    protected List createOperationSet() {
        List selection = getSelectedObjects();
        if (selection.size() <= 1
            || !(selection.get(0) instanceof IGraphicalEditPart))
            return Collections.EMPTY_LIST;

        return ToolUtilities.getSelectionWithoutDependants(selection);
    }

    protected boolean isSelectionListener() {
        return true;
    }

    protected void doRun(IProgressMonitor progressMonitor) {

        super.doRun(progressMonitor);

        // now select the new group
        Object model = ((EditPart) ((GroupRequest) getTargetRequest())
            .getEditParts().get(0)).getModel();
        if (model instanceof View) {
            Object groupView = ((View) model).eContainer();
            final Object groupEP = getDiagramGraphicalViewer().getEditPartRegistry()
                .get(groupView);
            if (groupEP != null) {
                getDiagramGraphicalViewer().setSelection(
                    new StructuredSelection(groupEP));
                getDiagramGraphicalViewer().reveal((EditPart) groupEP);
            }
        }
    }

}
@


1.1
log
@file GroupAction.java was initially added on branch bugzilla111892_group_support.
@
text
@d1 106
@


1.1.2.1
log
@[111892] gmf_head crevells 070518 First milestone of group/ungroup support (painting issues when grouping shapes with border items)
@
text
@a0 103
/******************************************************************************
 * Copyright (c) 2007 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/

package org.eclipse.gmf.runtime.diagram.ui.actions.internal;

import java.util.Collections;
import java.util.List;

import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.gef.EditPart;
import org.eclipse.gef.Request;
import org.eclipse.gef.commands.Command;
import org.eclipse.gef.commands.UnexecutableCommand;
import org.eclipse.gef.requests.GroupRequest;
import org.eclipse.gef.tools.ToolUtilities;
import org.eclipse.gmf.runtime.diagram.ui.actions.ActionIds;
import org.eclipse.gmf.runtime.diagram.ui.actions.DiagramAction;
import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramUIActionsMessages;
import org.eclipse.gmf.runtime.diagram.ui.actions.internal.l10n.DiagramUIActionsPluginImages;
import org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart;
import org.eclipse.gmf.runtime.notation.View;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.ui.IWorkbenchPage;

/**
 * An action to group shapes together.
 * 
 * @@author mmostafa, crevells
 */
public class GroupAction
    extends DiagramAction {

    /**
     * Creates a new instance.
     * 
     * @@param workbenchPage
     */
    public GroupAction(IWorkbenchPage workbenchPage) {
        super(workbenchPage);
        setId(ActionIds.ACTION_GROUP);
        setText(DiagramUIActionsMessages.GroupAction_Group_ActionLabelText);
        setToolTipText(DiagramUIActionsMessages.GroupAction_Group_ActionToolTipText);
        setImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP);
        setDisabledImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP_DISABLED);
        setHoverImageDescriptor(DiagramUIActionsPluginImages.DESC_GROUP);
    }

    protected Request createTargetRequest() {
        return new GroupRequest(getId());
    }

    protected void updateTargetRequest() {
        GroupRequest request = (GroupRequest) getTargetRequest();
        request.setEditParts(getOperationSet());
    }

    protected Command getCommand() {
        if (getOperationSet().size() > 1) {
            EditPart parent = ((EditPart) getOperationSet().get(0)).getParent();
            return parent.getCommand(getTargetRequest());
        }
        return UnexecutableCommand.INSTANCE;
    }

    protected List createOperationSet() {
        List selection = getSelectedObjects();
        if (selection.size() <= 1
            || !(selection.get(0) instanceof IGraphicalEditPart))
            return Collections.EMPTY_LIST;

        return ToolUtilities.getSelectionWithoutDependants(selection);
    }

    protected boolean isSelectionListener() {
        return true;
    }

    protected void doRun(IProgressMonitor progressMonitor) {

        super.doRun(progressMonitor);

        Object model = ((EditPart) ((GroupRequest) getTargetRequest())
            .getEditParts().get(0)).getModel();
        if (model instanceof View) {
            Object groupView = ((View) model).eContainer();
            Object groupEP = getDiagramGraphicalViewer().getEditPartRegistry()
                .get(groupView);
            if (groupEP != null) {
                getDiagramGraphicalViewer().setSelection(
                    new StructuredSelection(groupEP));
            }
        }
    }

}
@

