head	1.8;
access;
symbols
	v20081022-1925:1.8
	v20080917-1925:1.8
	v20080911-1728:1.8
	v20080910-1520:1.8
	v20080903-1520:1.8
	v20080731-1520:1.8
	v20080723-2246:1.8
	R1_0_maintenance:1.8.0.2
	R1_0:1.8
	I20051124-2000:1.7
	M3_10:1.7
	I20051118-1245:1.7
	I20051111-1800:1.7
	I20051106-0900:1.7
	v20051030:1.5;
locks; strict;
comment	@# @;


1.8
date	2005.11.25.19.38.13;	author cmahoney;	state dead;
branches;
next	1.7;

1.7
date	2005.11.04.21.27.48;	author sshaw;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.02.23.30.15;	author sshaw;	state Exp;
branches;
next	1.5;

1.5
date	2005.10.14.20.58.50;	author mmostafa;	state Exp;
branches;
next	1.4;

1.4
date	2005.09.22.15.42.19;	author sshaw;	state Exp;
branches;
next	1.3;

1.3
date	2005.09.12.21.29.05;	author sshaw;	state Exp;
branches;
next	1.2;

1.2
date	2005.08.30.18.49.21;	author sshaw;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.30.03.18.36;	author sshaw;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Bugzilla#113812 gmf_head cmahoney 051125 Deprecating DiagramResourceManager
@
text
@/******************************************************************************
 * Copyright (c) 2005 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/
/*
 * Created on Jun 21, 2004
 *
 * Extends a ListItemCompartmentEditPart so that it can contain 
 * containng children
 */
package org.eclipse.gmf.runtime.diagram.ui.editparts;

import java.util.Collections;
import java.util.List;

import org.eclipse.draw2d.IFigure;
import org.eclipse.draw2d.MarginBorder;
import org.eclipse.draw2d.PositionConstants;
import org.eclipse.emf.common.notify.Notification;
import org.eclipse.gef.EditPolicy;
import org.eclipse.gef.ExposeHelper;
import org.eclipse.gef.editparts.ViewportExposeHelper;
import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
import org.eclipse.gmf.runtime.diagram.ui.editpolicies.ResizableCompartmentEditPolicy;
import org.eclipse.gmf.runtime.diagram.ui.figures.ResizableCompartmentFigure;
import org.eclipse.gmf.runtime.diagram.ui.internal.figures.NestedResizableCompartmentFigure;
import org.eclipse.gmf.runtime.diagram.ui.internal.properties.Properties;
import org.eclipse.gmf.runtime.draw2d.ui.figures.ConstrainedToolbarLayout;
import org.eclipse.gmf.runtime.draw2d.ui.figures.WrapLabel;
import org.eclipse.gmf.runtime.draw2d.ui.mapmode.IMapMode;
import org.eclipse.gmf.runtime.notation.DrawerStyle;
import org.eclipse.gmf.runtime.notation.Node;
import org.eclipse.gmf.runtime.notation.NotationPackage;
import org.eclipse.gmf.runtime.notation.Ratio;
import org.eclipse.gmf.runtime.notation.Style;
import org.eclipse.gmf.runtime.notation.View;


/**
 * Extends ListItemCompartmentEditPart to support nesting of list compartments.  
 * This edit part supports a TextCompartmentView  that contains children.  Should be used if you have a TextCompartment that
 * contains other children such as a list compartment.
 * 
 * @@author choang
 * @@deprecated Renamed to {@@link org.eclipse.gmf.runtime.diagram.ui.editparts.NestableListItemEditPart}
 *
 */
public class NesteableListItemCompartmentEditPart
	extends ListItemCompartmentEditPart implements IResizableCompartmentEditPart{

	final static int IS_RESIZABLE_FLAG = MAX_FLAG << 5;
	
	/**
	 * @@param view
	 */
	public NesteableListItemCompartmentEditPart(View view) {
		super(view);
		
		setFlag(IS_RESIZABLE_FLAG, false);
		Object model = getModel();
		if (model instanceof Node){
			Node node = (Node)model;
			Style style = node.getStyle(NotationPackage.eINSTANCE.getDrawerStyle());
			if (style != null)
				setFlag(IS_RESIZABLE_FLAG, true);
		}
	}
	
	WrapLabel textLabel = null;
	
	/**
	 * @@return Returns the textLabel.
	 */
	public WrapLabel getLabel() {
		
		if (isResizable()) {
			if (textLabel == null) {
				textLabel = createWrapLabel();
			}
			return textLabel;
		} else {
			return super.getLabel();
		}
	}
	
	/**
	 * Override to create a figure that will create
	 * a figure that contains a text compartment and a pane
	 * to store the child figures of the text compartment.
	 */
	protected IFigure createFigure() {
		
		if (isResizable()){
			ResizableCompartmentFigure compartmentFigure = new NestedResizableCompartmentFigure(getMapMode().DPtoLP(11));
			ConstrainedToolbarLayout layout = new ConstrainedToolbarLayout();
			layout.setStretchMajorAxis(false);
			layout.setStretchMinorAxis(false);
			layout.setMinorAlignment(ConstrainedToolbarLayout.ALIGN_TOPLEFT);
			compartmentFigure.getContentPane().setLayoutManager(layout);

			compartmentFigure.getTextPane().add(getLabel());

			// if the compartment is resizeable then we need to put a border
			// around the text compartment so that we have enough room for the
			// collpase handle.
			IMapMode mm = getMapMode();
			int one = mm.DPtoLP(1);

			// indent to make room for collapse handle for each nested list item
			compartmentFigure.getTextPane().setBorder(
				new MarginBorder(one, mm.DPtoLP(15) / 2, one, mm.DPtoLP(15) / 2));
			// indent for visual appearance
			compartmentFigure.getContentPane().setBorder(
				new MarginBorder(one, mm.DPtoLP(15), one, mm.DPtoLP(15) / 2));

			WrapLabel label = getLabel();
			label.setLabelAlignment(PositionConstants.LEFT);
			label.setVisible(true);
			return compartmentFigure;
		} else {
			return super.createFigure();
		}
		
	}

	/** 
	 * Adds additional edit policy EditPolicy.PRIMARY_DRAG_ROLE
	 * to provide collapsiblity for list compartments
	 * @@see org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart#createDefaultEditPolicies()
	 */
	protected void createDefaultEditPolicies() {
		
		super.createDefaultEditPolicies();
		if (isResizable()){
			installEditPolicy(
				EditPolicy.PRIMARY_DRAG_ROLE,
				new ResizableCompartmentEditPolicy());
		}
	}
	
	/**
	 * This edit part can support either being ListItemListCompartmentEditPart
	 * or ListItemListCompartmentEditPart that is nested with children and hence
	 * is resizable.  This helper method will help us determine which behavior we want.
	 * @@return true iff the TextCompartment is mean to support children.
	 */
	final protected boolean isResizable(){
		return getFlag(IS_RESIZABLE_FLAG);
	}
	
	/*
	 * @@return getView()).getChildren() this editpart supports having children.
	 */
	protected List getModelChildren() {
		
		if (getModel() instanceof View){
			return ((View)getModel()).getChildren();
		}

		return Collections.EMPTY_LIST;
	}

	/**
	 * This method helps in children navigation by scrolling the compartment
	 * until the child is visible in the viewport
	 * 
	 * @@see org.eclipse.core.runtime.IAdaptable#getAdapter(java.lang.Class)
	 */
	public Object getAdapter(Class key) {
		
		if (key == ExposeHelper.class) {
			ViewportExposeHelper helper = new ViewportExposeHelper(this);
			return helper;
		}
		return super.getAdapter(key);
	}

	/**
	 * @@see org.eclipse.gef.editparts.AbstractEditPart#refreshVisuals()
	 */
	protected void refreshVisuals() {
		super.refreshVisuals();
		
		if (isResizable()){
			refreshCollapsed();
			refreshRatio();
		}
	}


	/**
	 * @@return The compartment's figure if isResizable() else return null;
	 */
	private ResizableCompartmentFigure getCompartmentFigure() {
		if (isResizable()){
			return (ResizableCompartmentFigure) getFigure();
		} else {
			return null;
		}
	}

	/**
	 * @@see org.eclipse.gef.GraphicalEditPart#getContentPane()
	 */
	public IFigure getContentPane() {
		if (getCompartmentFigure()!=null){
					
			return getCompartmentFigure().getContentPane();
		} else {
			return super.getContentPane();
		}
	}

	/**
	 * Handles the following properties: <BR>
	 * <UL>
	 * <LI>{@@link Properties#ID_RATIO} calls {@@link #refreshRatio()}
	 * <LI>{@@link Properties#ID_COLLAPSED} calls {@@link #refreshCollapsed()}
	 * <UL>
	 * <BR>
	 * All other properties are forwarded to the parent class for processing.
	 * @@param evt a property change event.
	 * @@see org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart#handlePropertyChangeEvent(java.beans.PropertyChangeEvent)
	 */
	protected void handleNotificationEvent(Notification evt) {
		Object feature = evt.getFeature();
		if (NotationPackage.eINSTANCE.getRatio_Value().equals(feature) 
				|| evt.getOldValue() instanceof Ratio
				|| evt.getNewValue() instanceof Ratio)
			refreshRatio();
		else if (NotationPackage.eINSTANCE.getDrawerStyle_Collapsed().equals(feature)){		
			setCollapsed(((Boolean) evt.getNewValue()).booleanValue(), true);
			this.getFigure().revalidate();
		}
		else
			super.handleNotificationEvent(evt);
	}

	/**
	 * Refreshes the compartment ratio property
	 */
	protected void refreshRatio() {
		if (ViewUtil.isPropertySupported((View)getModel(), Properties.ID_RATIO))
			setRatio((Double) ViewUtil.getStructuralFeatureValue((View)getModel(), NotationPackage.eINSTANCE.getRatio_Value()));
		else
			setRatio(new Double(-1));
	}

	/**
	 * Refreshes the compartment collapse state
	 */
	protected void refreshCollapsed() {
		DrawerStyle style = (DrawerStyle) ((View)getModel()).getStyle(NotationPackage.eINSTANCE.getDrawerStyle());
		if (style != null)
			setCollapsed(style.isCollapsed(), false);
	}
	
	/**
	 * Sets the collapse state of the compartment figure, considering the passed
	 * animate flag while doing so 
	 * @@param collapsed the collapsed state 
	 * @@param animate the animate flag
	 */
	protected void setCollapsed(boolean collapsed, boolean animate) {
		if (getCompartmentFigure()!=null) {
			if (collapsed) {
				if (animate)
					getCompartmentFigure().collapse();
				else
					getCompartmentFigure().setCollapsed();
			}
			else {
				if (animate)
					getCompartmentFigure().expand();
				else
					getCompartmentFigure().setExpanded();
			}
		}
	}

	/**
	 * Sets the ratio of the resizable compartment
	 * @@param ratio
	 */
	protected void setRatio(Double ratio) {
		((IGraphicalEditPart) getParent()).setLayoutConstraint(
			this,
			getFigure(),
			ratio);
	}

	/**
	 * Sets the visibility of the compartment title
	 * @@param showCompartmentTitle
	 */
	protected void setShowCompartmentTitle(boolean showCompartmentTitle) {
		if (getCompartmentFigure()!=null)
			getCompartmentFigure().setTitleVisibility(showCompartmentTitle);
	}
	
}
@


1.7
log
@bugzilla 112788 gmf-head sshaw 051104 API: Encapsulate MapMode / HiMetric coordinate system from clients
@
text
@@


1.6
log
@Bugzilla#113157 gmf_head cmahoney 051102 GMF Diagram Layer Public API Name Changes
@
text
@d36 1
a36 1
import org.eclipse.gmf.runtime.draw2d.ui.mapmode.MapMode;
d100 1
a100 1
			ResizableCompartmentFigure compartmentFigure = new NestedResizableCompartmentFigure();
d112 2
a113 1
			int one = MapMode.DPtoLP(1);
d117 1
a117 2
				new MarginBorder(one, MapMode.DPtoLP(15) / 2, one, MapMode
					.DPtoLP(15) / 2));
d120 1
a120 2
				new MarginBorder(one, MapMode.DPtoLP(15), one, MapMode
					.DPtoLP(15) / 2));
@


1.5
log
@bugzilla 110316 gmf-head mmostafa 051014 Compiler warning count should be 0 - runtime diagram layer components
@
text
@d51 1
@


1.4
log
@Bugzilla 109092: gmf_head sshaw 050922 : API Analysis: Diagram layer API.  Determine if all API is needed and/or has appropriate signatures
Contributed by Mohammed Mostafa
@
text
@d250 1
a250 1
			setRatio((Double) ViewUtil.getPropertyValue((View)getModel(), Properties.ID_RATIO));
@


1.3
log
@Bugzilla 108765 gmf_head tmacdoug 050912 - Update copyrights of GMF and EMFT plugins content to Eclipse copyright (EPL)
@
text
@a18 1
import java.beans.PropertyChangeEvent;
d25 1
d29 1
a29 1

d33 1
a33 2
import org.eclipse.gmf.runtime.diagram.ui.properties.Properties;
import org.eclipse.gmf.runtime.diagram.core.util.ViewUtil;
a219 1

d231 3
a233 2
	protected void handlePropertyChangeEvent(PropertyChangeEvent evt) {
		if (evt.getPropertyName().equals(Properties.ID_RATIO) 
d237 1
a237 1
		else if (evt.getPropertyName().equals(Properties.ID_COLLAPSED)){		
d242 1
a242 1
			super.handlePropertyChangeEvent(evt);
@


1.2
log
@Refactoring of the IBM gmf runtime contribution to the org.eclipse.gmf.runtime namespace.
@
text
@d1 10
@


1.1
log
@Refactoring of the IBM gmf runtime contribution to the org.eclipse.gmf.runtime namespace.
@
text
@d28 6
a33 6
import com.ibm.xtools.notation.DrawerStyle;
import com.ibm.xtools.notation.Node;
import com.ibm.xtools.notation.NotationPackage;
import com.ibm.xtools.notation.Ratio;
import com.ibm.xtools.notation.Style;
import com.ibm.xtools.notation.View;
@

