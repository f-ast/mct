head	1.11;
access;
symbols
	v20081023-2107:1.11
	v20081022-1925:1.11
	v20081022-1005:1.11
	v20081020-0700:1.11
	v20080917-1925:1.11
	v20080916-2008:1.11
	v20080911-1728:1.11
	v20080911-1506:1.11
	v20080910-1520:1.11
	v20080910-1510:1.11
	v20080903-1520:1.11
	v20080903-1510:1.11
	v20080813-1510:1.11
	v20080811-1546:1.11
	v20080731-1520:1.11
	v20080725-1738:1.11
	v20080723-2246:1.11
	v20080723-2232:1.11
	v20080723-1700:1.11
	v20080722-1827:1.11
	v20080718-1700:1.11
	v20080718-1731:1.11
	v20080716-1600:1.11
	v20080716-1642:1.11
	R2_1_maintenance:1.11.0.2
	Root_R2_1_maintenance:1.11
	R2_1_0:1.11
	v20080610-1132:1.11
	v20080603-1553:1.11
	v20080527-1255:1.11
	v20080527-1151:1.9.2.1
	v20080516-1748:1.11
	v20080516-1143:1.11
	v20080512-1200:1.11
	v20080503-1740:1.11
	v20080501-2127:1.9.2.1
	v20080501-1739:1.11
	m20080429-1543:1.9.2.1
	v20080425-1959:1.11
	v20080417-1610:1.11
	v20080407-2250:1.11
	v20080407-0930:1.11
	v20080404-1111:1.11
	v20080328-1605:1.11
	v20080322-0000:1.11
	v20080222-1200:1.10
	v20080201-2010:1.10
	v20080201-0201:1.9.2.1
	v20080118-1129:1.9.2.1
	v20080114-2222:1.9
	v20080114-1111:1.9
	v20080107-1111:1.9
	v20071222-1111:1.9
	v20071214-1111:1.9
	v20071130-1111:1.9
	v20071124-0000:1.9
	v20071112-0000:1.9
	v20071108-0000:1.9
	v20071003-0000:1.9
	v20070915-0000:1.9
	v20070903-0000:1.9
	v20070809-0000:1.9
	R2_0_maintenance:1.9.0.2
	R2_0:1.9
	R4_20:1.9
	v20070621-0000:1.9
	RC3_20:1.9
	v20070614-1400:1.9
	v20070608-1300:1.9
	v20070605-1400:1.7
	v20070601-1400:1.7
	v20070525-1500:1.7
	v20070518-1300:1.7
	bugzilla111892_group_support:1.7.0.2
	Root_bugzilla111892_group_support:1.7
	v20070504-1000:1.7
	v20070420-1000:1.7
	v20070413-1300:1.7
	v20070330-1300:1.7
	v20060330-1300:1.7
	v20070322-1100:1.7
	v20060316-0600:1.7
	v20070221-1500:1.7
	v20070208-1800:1.7
	v20070202-0200:1.6.2.2
	v20070119-1200:1.6.2.2
	v20070111-0800:1.6.2.2
	v20070105-1200:1.6.2.2
	v20070103-0300:1.7
	M4_20:1.7
	v20061218-1500:1.6.2.2
	v20061218-1200:1.7
	v20061214-0000:1.7
	M3_20:1.7
	v20061117-0800:1.7
	v20061027-1200:1.6.2.2
	v20061013-1330:1.7
	v20061012-1100:1.6.2.2
	v20060925-1700:1.6.2.2
	v20060919-0800:1.6.2.2
	v20060907-1100:1.6.2.1
	M1_20:1.6
	v20060831-1500:1.6.2.1
	v20060824-1600:1.6.2.1
	v20060817-1500:1.6.2.1
	v20060810-1700:1.6.2.1
	v20060803-1200:1.6.2.1
	v20060728-0500:1.6.2.1
	v20060721-1130:1.6.2.1
	v20060713-1700:1.6.2.1
	R1_0_maintenance:1.6.0.2
	R1_0:1.6
	v20060627-1200:1.6
	v20060616-1400:1.6
	v20060616-1200:1.6
	v20060609-1400:1.6
	v20060531-1730:1.6
	v20060530-1930:1.6
	v20060526-1200:1.6
	v20060519-0800:1.6
	v20060512-1000:1.5
	I20060512-1000:1.5
	I20060505-1400:1.5
	I20060428-1300:1.5
	I20060424-0500:1.5
	I20060424-0300:1.5
	M6_10:1.5
	I20060407-1200:1.5
	I20060331-1000:1.5
	I20060324-0300:1.5
	I20060317-1300:1.5
	I20060317-1200:1.5
	I20060316-1300:1.5
	I20060309-1300:1.5
	M5_10:1.5
	S20060303-1600:1.5
	I20060227-1730:1.5
	I20060216-1945:1.5
	I20060210-1715:1.5
	I20060209-1815:1.5
	I20060203-0830:1.5
	I20060202-1415:1.5
	I20060129-1145:1.5
	I20060127-0900:1.5
	I20060120-1530:1.4
	I20060113-1700:1.4
	M4_10:1.4
	I20060107-1100:1.4
	I20060105-1630:1.4
	I20051230-1230:1.4
	I20051223-1100:1.4
	I20051217-0925:1.4
	I20051208-2000:1.4
	I20051201-1800:1.4
	I20051124-2000:1.4
	M3_10:1.2
	I20051118-1245:1.2
	I20051111-1800:1.2
	I20051106-0900:1.2
	v20051030:1.2;
locks; strict;
comment	@# @;


1.11
date	2008.03.07.16.51.40;	author ahunter;	state Exp;
branches;
next	1.10;
commitid	2a3d47d1729a4567;

1.10
date	2008.01.16.21.07.43;	author ahunter;	state Exp;
branches;
next	1.9;
commitid	fac478e721f4567;

1.9
date	2007.06.07.13.04.22;	author ahunter;	state Exp;
branches
	1.9.2.1;
next	1.8;
commitid	5b0f466802564567;

1.8
date	2007.06.07.13.03.57;	author ahunter;	state Exp;
branches;
next	1.7;
commitid	5a064668023d4567;

1.7
date	2006.10.03.15.02.04;	author ahunter;	state Exp;
branches;
next	1.6;

1.6
date	2006.05.17.20.36.52;	author cmahoney;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2006.01.26.15.37.24;	author ahunter;	state Exp;
branches;
next	1.4;

1.4
date	2005.11.24.19.36.51;	author ahunter;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.22.03.51.39;	author ahunter;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.12.21.29.10;	author sshaw;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.30.03.18.37;	author sshaw;	state Exp;
branches;
next	;

1.6.2.1
date	2006.07.11.18.27.05;	author cmahoney;	state Exp;
branches;
next	1.6.2.2;

1.6.2.2
date	2006.09.12.20.27.15;	author cmahoney;	state Exp;
branches;
next	;

1.9.2.1
date	2008.01.16.21.12.10;	author ahunter;	state Exp;
branches;
next	;
commitid	73b4478e73294567;


desc
@@


1.11
log
@[196834] gmf-head jbruck 080307 [Printing] Multi-platform Diagram Printing
@
text
@/******************************************************************************
 * Copyright (c) 2002, 2008 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    IBM Corporation - initial API and implementation 
 ****************************************************************************/

package org.eclipse.gmf.runtime.diagram.ui.internal.dialogs;


import java.awt.print.PageFormat;
import java.awt.print.Paper;
import java.awt.print.PrinterJob;
import java.text.ParseException;
import java.util.ArrayList;

import org.eclipse.draw2d.geometry.PrecisionPoint;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.DefaultValues;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.ILabels;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.PageSetupPageType;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.PageSetupWidgetFactory;
import org.eclipse.gmf.runtime.diagram.ui.internal.properties.WorkspaceViewerProperties;
import org.eclipse.gmf.runtime.diagram.ui.preferences.PrintingPreferencePage;
import org.eclipse.jface.preference.IPreferenceStore;
import org.eclipse.swt.SWT;
import org.eclipse.swt.events.FocusEvent;
import org.eclipse.swt.events.FocusListener;
import org.eclipse.swt.events.ModifyEvent;
import org.eclipse.swt.events.ModifyListener;
import org.eclipse.swt.events.SelectionEvent;
import org.eclipse.swt.events.SelectionListener;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Button;
import org.eclipse.swt.widgets.Combo;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Control;
import org.eclipse.swt.widgets.Group;
import org.eclipse.swt.widgets.Label;
import org.eclipse.swt.widgets.TabFolder;
import org.eclipse.swt.widgets.TabItem;
import org.eclipse.swt.widgets.Text;

import com.ibm.icu.text.NumberFormat;

/**
 * PSConfigurationBlock implements part of PSDialog allowing the user to configure
 * the following printing preferences:
 * 
 * 1. Measurement units
 * 2. Page orientation
 * 3. Page size
 * 4. Page margins
 * 
 * PSConfiguration Block is also used by PSPreferencePage.
 * 
 * @@author etworkow
 * @@canBeSeenBy org.eclipse.gmf.runtime.diagram.ui.*
 */
public class PageSetupConfigBlock implements ILabels {
	
	private Button 
		fButtonPortrait, 
		fButtonLandscape, 
		fButtonInches, 
		fButtonMillimetres;
	
	private Label
		fLabelSize,
		fLabelWidth,
		fLabelUnitWidth,
		fLabelHeight,
		fLabelMarginTop,
		fLabelUnitMarginTop,
		fLabelMarginBottom,
		fLabelMarginLeft,
		fLabelUnitMarginLeft,
		fLabelMarginRight;
	
	private Combo 
		fComboSize;
	
	private Text
		fTextWidth,
		fTextHeight,
		fTextMarginTop,
		fTextMarginBottom,
		fTextMarginLeft,
		fTextMarginRight;
	
	private Initializer fInitialier;
	private Persistor fPersistor;
	private Convertor fConvertor;
	
	private PageSetupDialog fParentDialog;
	private PrintingPreferencePage fPreferencePage;
	
	private ArrayList fControls = new ArrayList();
	private IPreferenceStore fStore;
	private String fCurrentUnit;
	private NumberFormat fNumberFormat;
	
	/**
	 * Creates an instance of PageSetupConfigBlock.
	 * 
	 * @@param store Preference store for storing and reading preferences.
	 */
	public PageSetupConfigBlock(IPreferenceStore store) {
		fInitialier = new Initializer(this);
		fPersistor = new Persistor(this);
		fConvertor = new Convertor(this);
		fStore = store;
		fNumberFormat = NumberFormat.getNumberInstance();
	}
	
	/**
	 * Creates an instance of PageSetupConfigBlock.
	 * 
	 * @@param store Preference store for storing and reading preferences.
	 * @@param parentDialog Dialog containing this Page Setup Configuration Block.
	 */
	public PageSetupConfigBlock(IPreferenceStore store, PageSetupDialog parentDialog) {
		this(store);
		fParentDialog = parentDialog;
	}
	
	/**
	 * Creates an instance of PageSetupConfigBlock.
	 * 
	 * @@param store Preference store for storing and reading preferences.
	 */
	public PageSetupConfigBlock(IPreferenceStore store, PrintingPreferencePage preferencePage) {
		this(store);
		fPreferencePage = preferencePage;
	}
	
	/**
	 * Add page setup tab to Page Setup Dialog composite.
	 * 
	 * @@param parent Composite which will hold Page Setup Tab.
	 * @@return Control Page Setup Folder
	 */
	public Control createContents(Composite parent) {
		TabFolder folder = new TabFolder(parent, SWT.NONE);
		//folder.setLayout(new TabFolderLayout());	
		folder.setLayoutData(new GridData(GridData.FILL_BOTH));
		
		Composite pageSetupComposite = createPageSetupTabContent(folder);
	
		TabItem item = new TabItem(folder, SWT.NONE);
		item.setText(LABEL_TITLE_PAGE_SETUP_TAB_ITEM);
		item.setControl(pageSetupComposite);
			
		fInitialier.initPrintControls();
		
		return folder;
	}
	
	/**
	 * Saves Page Setup preferences.  This method is called after user presses 'Ok' button in
	 * Page Setup Dialog or 'Apply' button in Printing preference page.
	 */
	public void save() {
		fPersistor.saveConfigBlockControlValues();
	}
			
	/** 
	 * Restores Page Setup Defaults.  This method is called after user presses 'Restore Defaults'
	 * button in printing preference page.
	 */
	public void performDefaults() {

		fButtonInches.setSelection(DefaultValues.DEFAULT_INCHES);
		fButtonInches.setEnabled(true);
		fButtonMillimetres.setSelection(DefaultValues.DEFAULT_MILLIM);
		fButtonMillimetres.setEnabled(true);
		
		fButtonPortrait.setSelection(DefaultValues.DEFAULT_PORTRAIT);
		fButtonLandscape.setSelection(DefaultValues.DEFAULT_LANDSCAPE);
		
		fComboSize.select(DefaultValues.getLocaleSpecificPageType().getIndex());
		fTextWidth.setText(fNumberFormat.format(DefaultValues.getLocaleSpecificPageType().getWidth()));
		fTextHeight.setText(fNumberFormat.format(DefaultValues.getLocaleSpecificPageType().getHeight()));
		
		fTextMarginTop.setText(fNumberFormat.format(DefaultValues.DEFAULT_MARGIN_TOP));
		fTextMarginBottom.setText(fNumberFormat.format(DefaultValues.DEFAULT_MARGIN_BOTTOM));
		fTextMarginLeft.setText(fNumberFormat.format(DefaultValues.DEFAULT_MARGIN_LEFT));
		fTextMarginRight.setText(fNumberFormat.format(DefaultValues.DEFAULT_MARGIN_RIGHT));
        
		fPreferencePage.setErrorMessage(null);
	}
	
	/** 
	 * Create Page Setup tab allowing the user to choose print page preferences.
	 */
	private Composite createPageSetupTabContent(Composite folder) {
		
		Composite composite = new Composite(folder, SWT.NULL);
		composite.setLayout(new GridLayout(2, false));
		
		createGroupPageOrientation(composite);
		createGroupUnits(composite);
		createGroupPaperSize(composite);
		createGroupMargin(composite);
		
		return composite;
	}
	
	/**
	 * Create part of PSDialog allowing the user to choose page orientation. 
	 */
	private void createGroupPageOrientation(Composite composite) {
		Group group = PageSetupWidgetFactory.createGroup(composite, LABEL_TITLE_GROUP_ORIENTATION);
		
		// Add two radio buttons to the group
		fButtonPortrait = PageSetupWidgetFactory.createRadioButton(group, LABEL_BUTTON_PORTRAIT);
		fButtonLandscape  = PageSetupWidgetFactory.createRadioButton(group, LABEL_BUTTON_LANDSCAPE);
	
		fControls.add(fButtonPortrait);
		fControls.add(fButtonLandscape);
	}
	
	/** 
	 * Create part of PSDialog allowing the user to choose measurement units. 
	 */
	private void createGroupUnits(Composite composite) {
		Group group = PageSetupWidgetFactory.createGroup(composite, LABEL_TITLE_GROUP_UNITS);
		
		fButtonInches = PageSetupWidgetFactory.createRadioButtonInches(group, LABEL_BUTTON_INCHES);
		fButtonMillimetres  = PageSetupWidgetFactory.createRadioButtonMillim(group, LABEL_BUTTON_MILLIMETRES);
	
		fButtonInches.addSelectionListener(new InchesSelectionListener(LABEL_INCHES));
		fButtonMillimetres.addSelectionListener(new MillimetresSelectionListener(LABEL_MILLIMETRES));
		
		fControls.add(fButtonInches);
		fControls.add(fButtonMillimetres);
	}
	
	/** 
	 * Create part of PSDialog allowing the user to specify page size, width and height. 
	 */
	private void createGroupPaperSize(Composite composite) {
		Group group = PageSetupWidgetFactory.createGroupPaperSize(composite, LABEL_TITLE_GROUP_PAPER_SIZE);
			
		fLabelSize = PageSetupWidgetFactory.createLabel(group, LABEL_PAGE_SIZE);
		fComboSize = PageSetupWidgetFactory.createComboSize(group);
        
		fLabelWidth = PageSetupWidgetFactory.createLabel(group, LABEL_PAGE_WIDTH_INCHES);
		fTextWidth = PageSetupWidgetFactory.createTextWidth(group);
		fLabelUnitWidth = PageSetupWidgetFactory.createLabelFiller(group);
		
		fLabelHeight = PageSetupWidgetFactory.createLabel(group, LABEL_PAGE_HEIGHT_INCHES);
		fTextHeight = PageSetupWidgetFactory.createTextHeight(group);
		
		fComboSize.addSelectionListener(new SelectionListener() {

			public void widgetSelected(SelectionEvent e) {
				
				int index = fComboSize.getSelectionIndex();
				
				if (isConversionNeeded()) {
					fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getHeight())));
					fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getWidth())));
				} else {
					fTextHeight.setText(fNumberFormat.format(PageSetupPageType.pages[index].getHeight()));
					fTextWidth.setText(fNumberFormat.format(PageSetupPageType.pages[index].getWidth()));
				}
			}

			public void widgetDefaultSelected(SelectionEvent e) {
				// TODO Auto-generated method stub
			}
		});
		
		fTextWidth.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextWidth.isFocusControl()) {
					fComboSize.select(PageSetupPageType.USER_DEFINED.getIndex());
					setOkButtonEnableStatus();
				} else if (fComboSize.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
		});
		
		fTextHeight.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextHeight.isFocusControl()) {
					fComboSize.select(PageSetupPageType.USER_DEFINED.getIndex());
					setOkButtonEnableStatus();
				} else if (fComboSize.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
		});
		
		fControls.add(fLabelSize);
		fControls.add(fComboSize);
		fControls.add(fLabelWidth);
		fControls.add(fTextWidth);
		fControls.add(fLabelUnitWidth);
		fControls.add(fLabelHeight);
		fControls.add(fTextHeight);
	}
    
    
    /**
     * Converts a given string into double format 
     * @@param strNum the string containing the number (should contain only numbers)
     * @@return double value
     */
    private double getDblFromString(String strNum) {
        try {
            Number num = null;
            num = fNumberFormat.parse(strNum);
            return num.doubleValue();
            
        }
        catch (ParseException e) {
            e.printStackTrace();
        }
        return -1;
    }

	
	/**
	 * Sets the status of the OK button.  If the user input is invalid, OK button's
	 * status will be set to disabled.  Otherwise, it will be set to 'enabled'.
	 */
	public void setOkButtonEnableStatus() {
		// Verify all margin and page size text fields contain valid values
		boolean allValid = 
			StringValidator.isValid(fTextWidth.getText()) &&
			StringValidator.isValid(fTextHeight.getText()) &&
		
			StringValidator.isValid(fTextMarginTop.getText()) &&
			StringValidator.isValid(fTextMarginBottom.getText()) &&
			StringValidator.isValid(fTextMarginLeft.getText()) &&
			StringValidator.isValid(fTextMarginRight.getText());
        
        boolean marginsValid = false;
        
        if (allValid) {
            
            //check to see if the right and left margins together are not greater than the page width
            //(same goes for top and bottom margins as compared to the page height).
            //Note: since width and height are swapped when in landscape, we check the other way around 
            //when landscape is selected.
            
            if (fButtonPortrait.getSelection())
                marginsValid = 
                    ((getDblFromString(fTextMarginTop.getText()) + getDblFromString(fTextMarginBottom.getText())) 
                            < getDblFromString(fTextHeight.getText())) && 
                    ((getDblFromString(fTextMarginLeft.getText()) + getDblFromString(fTextMarginRight.getText())) 
                            < getDblFromString(fTextWidth.getText()));
            else
                marginsValid = 
                    ((getDblFromString(fTextMarginTop.getText()) + getDblFromString(fTextMarginBottom.getText())) 
                            < getDblFromString(fTextWidth.getText())) && 
                    ((getDblFromString(fTextMarginLeft.getText()) + getDblFromString(fTextMarginRight.getText())) 
                            < getDblFromString(fTextHeight.getText()));
        }
		
		// Set the status of the OK button
		if (null == fPreferencePage) {
			if (allValid && marginsValid) {
                fParentDialog.getOkButton().setEnabled(true);
                fButtonInches.setEnabled(true);
                fButtonMillimetres.setEnabled(true);
			}
			else {
				fParentDialog.getOkButton().setEnabled(false);
				fButtonInches.setEnabled(false);
				fButtonMillimetres.setEnabled(false);
			}
		} else {
			if (allValid && marginsValid) {
                fPreferencePage.setValid(true);
                fPreferencePage.setErrorMessage(null);
                fButtonInches.setEnabled(true);
                fButtonMillimetres.setEnabled(true);
			}
			else {
				fPreferencePage.setValid(false);
				fPreferencePage.setErrorMessage(LABEL_PRINT_PREFERENCE_PAGE_ERROR_MSG);
				fButtonInches.setEnabled(false);
				fButtonMillimetres.setEnabled(false);
			}
		}
		
	}
	
	/**
	 * Determine if the current set of units are in inches.
	 *  	
	 * @@return true if the current units are in inches.
	 */
	private boolean isUnitsInInch() {
		return (fCurrentUnit.startsWith("inc")); //$NON-NLS-1$
	}
	
	/** 
	 * Create part of PSDialog allowing the user to specify page margin values. 
	 */
	private void createGroupMargin(Composite composite) {
		Group group = PageSetupWidgetFactory.createGroupMargin(composite, LABEL_TITLE_GROUP_MARGIN);
        
		fLabelMarginTop = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_TOP_INCHES);
		fTextMarginTop = PageSetupWidgetFactory.createTextMargin(group);
		fLabelUnitMarginTop = PageSetupWidgetFactory.createLabelFiller(group);
		
		fLabelMarginBottom = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_BOTTOM_INCHES);
		fTextMarginBottom = PageSetupWidgetFactory.createTextMargin(group);
        
		fLabelMarginLeft = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_LEFT_INCHES);
		fTextMarginLeft = PageSetupWidgetFactory.createTextMargin(group);
		fLabelUnitMarginLeft = PageSetupWidgetFactory.createLabelFiller(group);
		
		fLabelMarginRight = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_RIGHT_INCHES);
		fTextMarginRight = PageSetupWidgetFactory.createTextMargin(group);
        
		
		fTextMarginTop.addFocusListener(new FocusListener() {

			public void focusGained(FocusEvent e) {
				// do nothing.
			}

			public void focusLost(FocusEvent e) {
				double marginTop = getDblFromString(fTextMarginTop.getText());
				double minimumTop = DefaultValues.MINIMUM_MARGIN_TOP;
				if (!isUnitsInInch()) {
					marginTop = fConvertor.convertMilimToInches(marginTop);
					minimumTop = fConvertor.convertInchesToMilim(minimumTop);
				}
				if (marginTop < DefaultValues.MINIMUM_MARGIN_TOP) {
					fTextMarginTop.setText(fNumberFormat.format(minimumTop));
				}
			}
		});
		fTextMarginTop.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextMarginTop.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
			
		});
				
		fTextMarginBottom.addFocusListener(new FocusListener() {
			public void focusGained(FocusEvent e) {
				// do nothing.
			}
			/**
			 * Ensure we have minimum margins set.
			 */
			public void focusLost(FocusEvent e) {
				double marginBottom = getDblFromString(fTextMarginBottom.getText());
				double minimumBottom = DefaultValues.MINIMUM_MARGIN_BOTTOM;
				if (!isUnitsInInch()) {
					marginBottom = fConvertor.convertMilimToInches(marginBottom);
					minimumBottom = fConvertor.convertInchesToMilim(minimumBottom);
				}
				if (marginBottom < DefaultValues.MINIMUM_MARGIN_BOTTOM) {
					fTextMarginBottom.setText(fNumberFormat.format(minimumBottom));
				}
			}
		});
		fTextMarginBottom.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextMarginBottom.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
		});
		

		fTextMarginLeft.addFocusListener(new FocusListener() {
			public void focusGained(FocusEvent e) {
				// do nothing.
			}
			/**
			 * Ensure we have minimum margins set.
			 */
			public void focusLost(FocusEvent e) {
				double marginLeft = getDblFromString(fTextMarginLeft.getText());
				double minimumLeft = DefaultValues.MINIMUM_MARGIN_LEFT;
				if (!isUnitsInInch()) {
					marginLeft = fConvertor.convertMilimToInches(marginLeft);
					minimumLeft = fConvertor.convertInchesToMilim(minimumLeft);
				}
				if (marginLeft < DefaultValues.MINIMUM_MARGIN_LEFT) {
					fTextMarginLeft.setText(fNumberFormat.format(minimumLeft));
				}
			}
		});
		fTextMarginLeft.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextMarginLeft.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
		});
		
		fTextMarginRight.addFocusListener(new FocusListener() {
			public void focusGained(FocusEvent e) {
				// do nothing.
			}
			/**
			 * Ensure we have minimum margins set.
			 */
			public void focusLost(FocusEvent e) {
				double marginRight = getDblFromString(fTextMarginRight.getText());
				double minimumRight = DefaultValues.MINIMUM_MARGIN_RIGHT;
				if (!isUnitsInInch()) {
					marginRight = fConvertor.convertMilimToInches(marginRight);
					minimumRight = fConvertor.convertInchesToMilim(minimumRight);
				}
				if (marginRight < DefaultValues.MINIMUM_MARGIN_RIGHT) {
					fTextMarginRight.setText(fNumberFormat.format(minimumRight));
				}
			}
		});
		fTextMarginRight.addModifyListener(new ModifyListener() {
			public void modifyText(ModifyEvent e) {
				if (fTextMarginRight.isFocusControl()) {
					setOkButtonEnableStatus();
				}
			}
		});
		fControls.add(fLabelMarginTop);
		fControls.add(fTextMarginTop);
		fControls.add(fLabelUnitMarginTop);
		
		fControls.add(fLabelMarginBottom);
		fControls.add(fTextMarginBottom);
		
		fControls.add(fLabelMarginLeft);
		fControls.add(fTextMarginLeft);
		fControls.add(fLabelUnitMarginLeft);
		
		fControls.add(fLabelMarginRight);
		fControls.add(fTextMarginRight);
	}
	
	/**
	 * Returns a specified control.
	 * 
	 * @@param controlType type of control
	 * @@return Control control matchin specified controlType
	 */
	public Control getControl(PageSetupControlType controlType) {
		if (controlType.equals(PageSetupControlType.BUTTON_USE_INCHES))
			return fButtonInches;
		else if (controlType.equals(PageSetupControlType.BUTTON_USE_MILLIM))
			return fButtonMillimetres;	
		
		else if (controlType.equals(PageSetupControlType.BUTTON_USE_PORTRAIT))
			return fButtonPortrait;
		else if (controlType.equals(PageSetupControlType.BUTTON_USE_LANDSCAPE))
			return fButtonLandscape;
		
		else if (controlType.equals(PageSetupControlType.COMBO_PAGE_SIZE))
			return fComboSize;
		else if (controlType.equals(PageSetupControlType.TEXT_PAGE_HEIGHT))
			return fTextHeight;
		else if (controlType.equals(PageSetupControlType.TEXT_PAGE_WIDTH))
			return fTextWidth;
		
		else if (controlType.equals(PageSetupControlType.TEXT_MARGIN_TOP))
			return fTextMarginTop;
		else if (controlType.equals(PageSetupControlType.TEXT_MARGIN_BOTTOM))
			return fTextMarginBottom;
		else if (controlType.equals(PageSetupControlType.TEXT_MARGIN_LEFT))
			return fTextMarginLeft;
		else if (controlType.equals(PageSetupControlType.TEXT_MARGIN_RIGHT))
			return fTextMarginRight;
		
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_PAGE_HEIGHT))
			return fLabelUnitWidth;
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_MARGIN_TOP))
			return fLabelUnitMarginTop;
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_MARGIN_LEFT))
			return fLabelUnitMarginLeft;
		else
			return null;
	}
	
	/**
	 * After calling this method, all controls will appear as disabled.
	 */
	public void disableAllControls() {
		Control control;
		for (int i = 0; i < fControls.size(); i++) {
			control = (Control) fControls.get(i);
			control.setEnabled(false);
		}
	}
	
	/**
	 * After calling this method, all controls will appear as enabled.
	 */
	public void enableAllControls() {
		Control control;
		for (int i = 0; i < fControls.size(); i++) {
			control = (Control) fControls.get(i);
			control.setEnabled(true);
		}
	}
	
	// INITIALIZER
	private class Initializer {

		private PageSetupConfigBlock fBlockPrint;
		
		public Initializer(PageSetupConfigBlock configBlock) {
			fBlockPrint = configBlock;
		}
		
		public void initPrintControls() {
			initValuesForUnitGroup();
			initValuesForOrientationGroup();
			initValuesForSizeGroup();
			initValuesForMarginGroup();
			initUnitLabels();
		}
		
		private void initValuesForUnitGroup() {
			initRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_INCHES, WorkspaceViewerProperties.PREF_USE_INCHES);
			initRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_MILLIM, WorkspaceViewerProperties.PREF_USE_MILLIM);
		}
		
		private void initValuesForOrientationGroup() {
			initRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_PORTRAIT, WorkspaceViewerProperties.PREF_USE_PORTRAIT);
			initRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_LANDSCAPE, WorkspaceViewerProperties.PREF_USE_LANDSCAPE);
		}
		
		private void initValuesForSizeGroup() {
			initCombo(fBlockPrint, PageSetupControlType.COMBO_PAGE_SIZE, WorkspaceViewerProperties.PREF_PAGE_SIZE);
			initText(fBlockPrint, PageSetupControlType.TEXT_PAGE_HEIGHT, WorkspaceViewerProperties.PREF_PAGE_HEIGHT);
			initText(fBlockPrint, PageSetupControlType.TEXT_PAGE_WIDTH, WorkspaceViewerProperties.PREF_PAGE_WIDTH);
		}
		
		private void initValuesForMarginGroup() {
			initText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_TOP, WorkspaceViewerProperties.PREF_MARGIN_TOP);
			initText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_BOTTOM, WorkspaceViewerProperties.PREF_MARGIN_BOTTOM);
			initText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_LEFT, WorkspaceViewerProperties.PREF_MARGIN_LEFT);
			initText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_RIGHT, WorkspaceViewerProperties.PREF_MARGIN_RIGHT);
		}
		
		private void initUnitLabels() {
			if (fButtonInches.getSelection()) {
                fLabelHeight.setText(LABEL_PAGE_HEIGHT_INCHES);
                fLabelWidth.setText(LABEL_PAGE_WIDTH_INCHES);
                fLabelMarginBottom.setText(LABEL_MARGIN_BOTTOM_INCHES);
                fLabelMarginLeft.setText(LABEL_MARGIN_LEFT_INCHES);
                fLabelMarginRight.setText(LABEL_MARGIN_RIGHT_INCHES);
                fLabelMarginTop.setText(LABEL_MARGIN_TOP_INCHES);
                
				fCurrentUnit = "inc"; //$NON-NLS-1$
			}
			else {
                fLabelHeight.setText(LABEL_PAGE_HEIGHT_MM);
                fLabelWidth.setText(LABEL_PAGE_WIDTH_MM);
                fLabelMarginBottom.setText(LABEL_MARGIN_BOTTOM_MM);
                fLabelMarginLeft.setText(LABEL_MARGIN_LEFT_MM);
                fLabelMarginRight.setText(LABEL_MARGIN_RIGHT_MM);
                fLabelMarginTop.setText(LABEL_MARGIN_TOP_MM);
                
				fCurrentUnit = "mil"; //$NON-NLS-1$
			}
		}
			
		private void initRadioButton(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			Button button = (Button) block.getControl(controlType);
			button.setSelection(fStore.getBoolean(key));
		}
		
		private void initText(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			Text text = (Text) block.getControl(controlType);
			
			double value = fStore.getDouble(key);
			text.setText(fNumberFormat.format(value));
			
            
            if (isConversionNeeded()) {
                //get the values directly from the hardcoded values if the option is not user defined (more accurate)
                
                if (fBlockPrint.fComboSize.getSelectionIndex() != PageSetupPageType.USER_DEFINED.getIndex()) {
                    
                    if (text == fBlockPrint.fTextHeight) 
                        fBlockPrint.fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                            PageSetupPageType.pages[fBlockPrint.fComboSize.getSelectionIndex()].getHeight())));
                    
                    else if (text == fBlockPrint.fTextWidth)
                        fBlockPrint.fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                            PageSetupPageType.pages[fBlockPrint.fComboSize.getSelectionIndex()].getWidth())));                
                    else
                        text.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(value)));
                }
                else
                    text.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(value)));
            }
		}
	
		private void initCombo(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			Combo combo = (Combo) block.getControl(controlType);
			String pageSize = fStore.getString(key);
			String item;
	
			for (int i = 0; i < combo.getItemCount(); i++) {
				item = combo.getItem(i);
				if (item.startsWith(pageSize)) combo.select(i);
			}
		}
	}

	// PERSISTOR
	private class Persistor {

		private PageSetupConfigBlock fBlockPrint;
		
		public Persistor(PageSetupConfigBlock configBlock) {
			fBlockPrint = configBlock;
		}
		
		public void saveConfigBlockControlValues() {	
			saveValuesFromUnitGroup();
			saveValuesFromOrientationGroup();
			saveValuesFromSizeGroup();
			saveValuesFromMarginGroup();
			
			emptyControlList();
		}
		
		private void saveValuesFromUnitGroup() {
			saveRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_INCHES, WorkspaceViewerProperties.PREF_USE_INCHES);
			saveRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_MILLIM, WorkspaceViewerProperties.PREF_USE_MILLIM);	
		}
		
		private void saveValuesFromOrientationGroup() {
			saveRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_PORTRAIT, WorkspaceViewerProperties.PREF_USE_PORTRAIT);
			saveRadioButton(fBlockPrint, PageSetupControlType.BUTTON_USE_LANDSCAPE, WorkspaceViewerProperties.PREF_USE_LANDSCAPE);
		}
		
		private void saveValuesFromSizeGroup() {
			saveCombo(fBlockPrint, PageSetupControlType.COMBO_PAGE_SIZE, WorkspaceViewerProperties.PREF_PAGE_SIZE);
			saveText(fBlockPrint, PageSetupControlType.TEXT_PAGE_HEIGHT, WorkspaceViewerProperties.PREF_PAGE_HEIGHT);
			saveText(fBlockPrint, PageSetupControlType.TEXT_PAGE_WIDTH, WorkspaceViewerProperties.PREF_PAGE_WIDTH);
		}
		
		private void saveValuesFromMarginGroup() {
			saveText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_TOP, WorkspaceViewerProperties.PREF_MARGIN_TOP);
			saveText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_BOTTOM, WorkspaceViewerProperties.PREF_MARGIN_BOTTOM);
			saveText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_LEFT, WorkspaceViewerProperties.PREF_MARGIN_LEFT);
			saveText(fBlockPrint, PageSetupControlType.TEXT_MARGIN_RIGHT, WorkspaceViewerProperties.PREF_MARGIN_RIGHT);
		}
			
		private void saveText(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			if (isConversionNeeded()) 
				fStore.setValue(key, fConvertor.convertToInches(controlType));
				
			else {
				Text text = (Text) block.getControl(controlType);
				fStore.setValue(key, getDblFromString(text.getText()));
			}
		}
		
		private void saveRadioButton(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			Button button = (Button) block.getControl(controlType);
			fStore.setValue(key, button.getSelection());
		}
		
		private void saveCombo(PageSetupConfigBlock block, PageSetupControlType controlType, String key) {
			Combo combo = (Combo) block.getControl(controlType);
			int index = combo.getSelectionIndex();
			fStore.setValue(key, combo.getItem(index));
		}
		
		private void emptyControlList() {
			for (int i = 0; i < fControls.size(); i++) {
				fControls.remove(i);
			}
		}
	}

	// CONVERTOR
	private class Convertor {

		PageSetupConfigBlock fBlockPrint;
		
		public Convertor(PageSetupConfigBlock configBlock) {
			fBlockPrint = configBlock;
		}
		
		public double convertToInches(PageSetupControlType type) { 
			Text text = (Text) fBlockPrint.getControl(type);
			
			Number num = null;
			try {
				num = fNumberFormat.parse(text.getText());
				double valueInMillimetres = num.doubleValue();
				double valueInInches = convertMilimToInches(valueInMillimetres);
				return valueInInches;	
			} catch (ParseException e) {
				e.printStackTrace();
			}
			return -1;
		}
		
		public double convertToMillimetres(PageSetupControlType type) { 
			Text text = (Text) fBlockPrint.getControl(type);
			
			Number num = null;
			try {
				num = fNumberFormat.parse(text.getText());
				double valueInInches = num.doubleValue();
				double valueInMillimetres = convertInchesToMilim(valueInInches);
				return valueInMillimetres;
			} catch (ParseException e) {
				e.printStackTrace();
			}
			return -1;
					
		}
		
		public double convertInchesToMilim(double inches) {
			return inches * 25.4d; 
		}
		
		public double convertMilimToInches(double milim) {
			return milim / 25.4d;
		}
	}
	
	// LISTENERS
	private class UnitSelectionListener implements SelectionListener {

		private String fLabel;
		
		public UnitSelectionListener(String label) {
			fLabel = label;
		}
		/* (non-Javadoc)
		 * @@see org.eclipse.swt.events.SelectionListener#widgetSelected(org.eclipse.swt.events.SelectionEvent)
		 */
		public void widgetSelected(SelectionEvent e) {
			updateLabels();
		}

		/* (non-Javadoc)
		 * @@see org.eclipse.swt.events.SelectionListener#widgetDefaultSelected(org.eclipse.swt.events.SelectionEvent)
		 */
		public void widgetDefaultSelected(SelectionEvent e) { 
			// empty 
		}
		
		private void updateLabels() {
            if (fLabel.equals(LABEL_MILLIMETRES)) {
                fLabelHeight.setText(LABEL_PAGE_HEIGHT_MM);
                fLabelWidth.setText(LABEL_PAGE_WIDTH_MM);
                fLabelMarginBottom.setText(LABEL_MARGIN_BOTTOM_MM);
                fLabelMarginLeft.setText(LABEL_MARGIN_LEFT_MM);
                fLabelMarginRight.setText(LABEL_MARGIN_RIGHT_MM);
                fLabelMarginTop.setText(LABEL_MARGIN_TOP_MM);
            }
            else {
                fLabelHeight.setText(LABEL_PAGE_HEIGHT_INCHES);
                fLabelWidth.setText(LABEL_PAGE_WIDTH_INCHES);
                fLabelMarginBottom.setText(LABEL_MARGIN_BOTTOM_INCHES);
                fLabelMarginLeft.setText(LABEL_MARGIN_LEFT_INCHES);
                fLabelMarginRight.setText(LABEL_MARGIN_RIGHT_INCHES);
                fLabelMarginTop.setText(LABEL_MARGIN_TOP_INCHES);
            }

            fLabelHeight.getParent().layout(true);
            fLabelMarginBottom.getParent().layout(true);
            fLabelHeight.getShell().pack(true);
		}	
	}
	
	private class InchesSelectionListener extends UnitSelectionListener {

		public InchesSelectionListener(String label) {
			super(label);
		}
		
		public void widgetSelected(SelectionEvent e) {
			Button b = (Button) e.getSource();
			if (b.getSelection()) {
				super.widgetSelected(e);
				if (fCurrentUnit.startsWith("mil")) { //$NON-NLS-1$
					convertValuesToInches();
					fCurrentUnit = "inc"; //$NON-NLS-1$
				}
			}
		}
		
		private void convertValuesToInches() {
			fTextWidth.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_PAGE_WIDTH)));
			fTextHeight.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_PAGE_HEIGHT)));
			fTextMarginTop.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_TOP)));
			fTextMarginBottom.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_BOTTOM)));
			fTextMarginLeft.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_LEFT)));
			fTextMarginRight.setText(fNumberFormat.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_RIGHT)));
		}
	}
	
	private class MillimetresSelectionListener extends UnitSelectionListener {

		public MillimetresSelectionListener(String label) {
			super(label);
		}
		
		public void widgetSelected(SelectionEvent e) {
			Button b = (Button) e.getSource();
			if (b.getSelection()) { 
				super.widgetSelected(e);
				if (isUnitsInInch()) { 
					convertValuesToMillimetres();
					fCurrentUnit = "mil"; //$NON-NLS-1$
				}
			}
		}
		
		private void convertValuesToMillimetres() {
            //get the values directly from the hardcoded values if the option is not user defined (more accurate)
            
            if (fComboSize.getSelectionIndex() == PageSetupPageType.USER_DEFINED.getIndex()) {
    			fTextWidth.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_WIDTH)));
    			fTextHeight.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_HEIGHT)));
            }
            else {
                fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                    PageSetupPageType.pages[fComboSize.getSelectionIndex()].getWidth())));
                fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                    PageSetupPageType.pages[fComboSize.getSelectionIndex()].getHeight())));
            }
			fTextMarginTop.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_TOP)));
			fTextMarginBottom.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_BOTTOM)));
			fTextMarginLeft.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_LEFT)));
			fTextMarginRight.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_RIGHT)));
		}
	}

	private boolean isConversionNeeded() {
		if (fButtonInches.getSelection())
			return false;
		return true;
	}
}

@


1.10
log
@[215565] gmf-head ahunter 080116 [Printing] Error message still remains even if the invalid value is changed.
@
text
@d15 3
d21 7
d30 2
a47 7
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.DefaultValues;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.ILabels;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.PageSetupPageType;
import org.eclipse.gmf.runtime.diagram.ui.internal.pagesetup.PageSetupWidgetFactory;
import org.eclipse.gmf.runtime.diagram.ui.internal.properties.WorkspaceViewerProperties;
import org.eclipse.gmf.runtime.diagram.ui.preferences.PrintingPreferencePage;

d396 10
a405 1
		
d426 19
d451 21
a472 1
		
d481 20
d509 19
d923 1
a923 1
				if (fCurrentUnit.startsWith("inc")) { //$NON-NLS-1$
@


1.9
log
@[188177] gmf-head ahunter 070607 TVT33:TCT343: cs : Functional:Truncation caused by an incorrect behavior of Preferences-Printing
@
text
@d2 1
a2 1
 * Copyright (c) 2002, 2007 IBM Corporation and others.
d279 2
d290 2
@


1.9.2.1
log
@[215565] gmf-R2_0_maintenance ahunter 080116 [Printing] Error message still remains even if the invalid value is changed.
@
text
@d2 1
a2 1
 * Copyright (c) 2002, 2008 IBM Corporation and others.
a278 2
				} else if (fComboSize.isFocusControl()) {
					setOkButtonEnableStatus();
a287 2
				} else if (fComboSize.isFocusControl()) {
					setOkButtonEnableStatus();
@


1.8
log
@[188177] gmf-head ahunter 070607 TVT33:TCT343: cs : Functional:Truncation caused by an incorrect behavior of Preferences-Printing
@
text
@d2 1
a2 1
 * Copyright (c) 2002, 2005, 2006 IBM Corporation and others.
@


1.7
log
@gmf_head ahunter 061003 Merge 1.0.1 Runtime to HEAD 2.0
@
text
@d784 3
a786 1
            fLabelHeight.getShell().pack();
@


1.6
log
@Bugzilla#141449 gmf_head cmahoney 060517 ACC: Page Setup Dialog has fields that are not properly read by a screen reader
Contributed by: Syed
@
text
@d262 1
a262 1
					fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getWidth())));
d300 20
d335 23
d361 4
a364 4
			if (allValid) {
				fParentDialog.getOkButton().setEnabled(true);
				fButtonInches.setEnabled(true);
				fButtonMillimetres.setEnabled(true);
d372 5
a376 5
			if (allValid) {
				fPreferencePage.setValid(true);
				fPreferencePage.setErrorMessage(null);
				fButtonInches.setEnabled(true);
				fButtonMillimetres.setEnabled(true);
d590 2
a591 9
			String value = fStore.getString(key);
			try {
				Number num = fNumberFormat.parse(value);
				
				//text.setText(numberFormatter.format(Double.parseDouble(fStore.getString(key))));
				text.setText(fNumberFormat.format(num.doubleValue()));
			} catch (ParseException e) {
				e.printStackTrace();
			}
d593 19
a611 2
			if (isConversionNeeded()) 
				text.setText(fNumberFormat.format(fConvertor.convertToMillimetres(controlType)));
d673 1
a673 1
				fStore.setValue(key, text.getText());
d736 1
a736 1
			return inches / 0.0394; 
d739 2
a740 2
		private double convertMilimToInches(double milim) {
			return milim * 0.0394;
d833 12
a844 2
			fTextWidth.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_WIDTH)));
			fTextHeight.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_HEIGHT)));
@


1.6.2.1
log
@Bugzilla#146529 gmf_R1_0_maintenance cmahoney 060711 page setup for A4 shows initially strange numbers
Contributed by: Syed Atif Ali
@
text
@d262 1
a262 1
					fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getWidth())));
a299 20
    
    
    /**
     * Converts a given string into double format 
     * @@param strNum the string containing the number (should contain only numbers)
     * @@return double value
     */
    private double getDblFromString(String strNum) {
        try {
            Number num = null;
            num = fNumberFormat.parse(strNum);
            return num.doubleValue();
            
        }
        catch (ParseException e) {
            e.printStackTrace();
        }
        return -1;
    }

a314 23
        
        boolean marginsValid = false;
        
        if (allValid) {
            
            //check to see if the right and left margins together are not greater than the page width
            //(same goes for top and bottom margins as compared to the page height).
            //Note: since width and height are swapped when in landscape, we check the other way around 
            //when landscape is selected.
            
            if (fButtonPortrait.getSelection())
                marginsValid = 
                    ((getDblFromString(fTextMarginTop.getText()) + getDblFromString(fTextMarginBottom.getText())) 
                            < getDblFromString(fTextHeight.getText())) && 
                    ((getDblFromString(fTextMarginLeft.getText()) + getDblFromString(fTextMarginRight.getText())) 
                            < getDblFromString(fTextWidth.getText()));
            else
                marginsValid = 
                    ((getDblFromString(fTextMarginTop.getText()) + getDblFromString(fTextMarginBottom.getText())) 
                            < getDblFromString(fTextWidth.getText())) && 
                    ((getDblFromString(fTextMarginLeft.getText()) + getDblFromString(fTextMarginRight.getText())) 
                            < getDblFromString(fTextHeight.getText()));
        }
d318 4
a321 4
			if (allValid && marginsValid) {
                fParentDialog.getOkButton().setEnabled(true);
                fButtonInches.setEnabled(true);
                fButtonMillimetres.setEnabled(true);
d329 5
a333 5
			if (allValid && marginsValid) {
                fPreferencePage.setValid(true);
                fPreferencePage.setErrorMessage(null);
                fButtonInches.setEnabled(true);
                fButtonMillimetres.setEnabled(true);
d547 9
a555 2
			double value = fStore.getDouble(key);
			text.setText(fNumberFormat.format(value));
d557 2
a558 19
            
            if (isConversionNeeded()) {
                //get the values directly from the hardcoded values if the option is not user defined (more accurate)
                
                if (fBlockPrint.fComboSize.getSelectionIndex() != PageSetupPageType.USER_DEFINED.getIndex()) {
                    
                    if (text == fBlockPrint.fTextHeight) 
                        fBlockPrint.fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                            PageSetupPageType.pages[fBlockPrint.fComboSize.getSelectionIndex()].getHeight())));
                    
                    else if (text == fBlockPrint.fTextWidth)
                        fBlockPrint.fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                            PageSetupPageType.pages[fBlockPrint.fComboSize.getSelectionIndex()].getWidth())));                
                    else
                        text.setText(fNumberFormat.format(fConvertor.convertToMillimetres(controlType)));
                }
                else
                    text.setText(fNumberFormat.format(fConvertor.convertToMillimetres(controlType)));
            }
d620 1
a620 1
				fStore.setValue(key, getDblFromString(text.getText()));
d683 1
a683 1
			return inches * 25.4d; 
d686 2
a687 2
		public double convertMilimToInches(double milim) {
			return milim / 25.4d;
d780 2
a781 12
            //get the values directly from the hardcoded values if the option is not user defined (more accurate)
            
            if (fComboSize.getSelectionIndex() == PageSetupPageType.USER_DEFINED.getIndex()) {
    			fTextWidth.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_WIDTH)));
    			fTextHeight.setText(fNumberFormat.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_HEIGHT)));
            }
            else {
                fTextWidth.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                    PageSetupPageType.pages[fComboSize.getSelectionIndex()].getWidth())));
                fTextHeight.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(
                    PageSetupPageType.pages[fComboSize.getSelectionIndex()].getHeight())));
            }
@


1.6.2.2
log
@Bugzilla#146529 gmf_R1_0_maintenance cmahoney 060912 page setup for A4 shows initially strange numbers
Contributed by: Syed Atif Ali
@
text
@d607 1
a607 1
                        text.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(value)));
d610 1
a610 1
                    text.setText(fNumberFormat.format(fConvertor.convertInchesToMilim(value)));
@


1.5
log
@[112794] gmf_head etworkowska 060126 Adopt ICU4J as part of Eclipse 3.2
@
text
@d2 1
a2 1
 * Copyright (c) 2002, 2005 IBM Corporation and others.
a71 1
		fLabelUnitHeight,
a74 1
		fLabelUnitMarginBottom,
d77 1
a77 2
		fLabelMarginRight,
		fLabelUnitMarginRight;
d188 1
a188 8
		
		fLabelUnitHeight.setText(LABEL_INCHES);
		fLabelUnitWidth.setText(LABEL_INCHES);
		fLabelUnitMarginTop.setText(LABEL_INCHES);
		fLabelUnitMarginBottom.setText(LABEL_INCHES);
		fLabelUnitMarginLeft.setText(LABEL_INCHES);
		fLabelUnitMarginRight.setText(LABEL_INCHES);	
		
d246 2
a247 2
		
		fLabelWidth = PageSetupWidgetFactory.createLabel(group, LABEL_PAGE_WIDTH);
d249 1
a249 1
		fLabelUnitWidth = PageSetupWidgetFactory.createLabelUnit(group);
d251 1
a251 1
		fLabelHeight = PageSetupWidgetFactory.createLabel(group, LABEL_PAGE_HEIGHT);
a252 1
		fLabelUnitHeight = PageSetupWidgetFactory.createLabelUnit(group);
a298 1
		fControls.add(fLabelUnitHeight);
d350 2
a351 2
		
		fLabelMarginTop = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_TOP);
d353 1
a353 1
		fLabelUnitMarginTop = PageSetupWidgetFactory.createLabelUnitMargin(group);
d355 1
a355 1
		fLabelMarginBottom = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_BOTTOM);
d357 2
a358 3
		fLabelUnitMarginBottom = PageSetupWidgetFactory.createLabelUnitMargin(group);
		
		fLabelMarginLeft = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_LEFT);
d360 1
a360 1
		fLabelUnitMarginLeft = PageSetupWidgetFactory.createLabelUnitMargin(group);
d362 1
a362 1
		fLabelMarginRight = PageSetupWidgetFactory.createLabel(group, LABEL_MARGIN_RIGHT);
d364 1
a364 2
		fLabelUnitMarginRight = PageSetupWidgetFactory.createLabelUnitMargin(group);
		
a401 1
		fControls.add(fLabelUnitMarginBottom);
a408 1
		fControls.add(fLabelUnitMarginRight);
a445 2
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_PAGE_WIDTH))
			return fLabelUnitHeight;
a447 2
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_MARGIN_BOTTOM))
			return fLabelUnitMarginBottom;
a449 2
		else if (controlType.equals(PageSetupControlType.LABEL_UNIT_MARGIN_RIGHT))
			return fLabelUnitMarginRight;
a516 2
			String label;
			
d518 7
a524 1
				label = LABEL_INCHES;
d528 7
a534 1
				label = LABEL_MILLIMETRES;
a536 7
			
			fLabelUnitWidth.setText(label);
			fLabelUnitHeight.setText(label);
			fLabelUnitMarginTop.setText(label);
			fLabelUnitMarginBottom.setText(label);
			fLabelUnitMarginLeft.setText(label);
			fLabelUnitMarginRight.setText(label);
d714 18
a731 6
			fLabelUnitWidth.setText(fLabel);
			fLabelUnitHeight.setText(fLabel);
			fLabelUnitMarginTop.setText(fLabel);
			fLabelUnitMarginBottom.setText(fLabel);
			fLabelUnitMarginLeft.setText(fLabel);
			fLabelUnitMarginRight.setText(fLabel);
@


1.4
log
@[113084] gmf_head etworkow 051124 Page Setup: Margins value change when switching between inches and millimeters
@
text
@d14 1
a14 1
import java.text.NumberFormat;
d43 2
@


1.3
log
@[112940] gmf_head etworkow 051121 Page Setup Dialog usability enhancements
@
text
@d101 1
d113 1
d172 1
a172 2
		NumberFormat nf = NumberFormat.getNumberInstance();
		
d182 2
a183 2
		fTextWidth.setText(nf.format(DefaultValues.getLocaleSpecificPageType().getWidth()));
		fTextHeight.setText(nf.format(DefaultValues.getLocaleSpecificPageType().getHeight()));
d185 4
a188 4
		fTextMarginTop.setText(nf.format(DefaultValues.DEFAULT_MARGIN_TOP));
		fTextMarginBottom.setText(nf.format(DefaultValues.DEFAULT_MARGIN_BOTTOM));
		fTextMarginLeft.setText(nf.format(DefaultValues.DEFAULT_MARGIN_LEFT));
		fTextMarginRight.setText(nf.format(DefaultValues.DEFAULT_MARGIN_RIGHT));
d266 1
a266 2
				NumberFormat numberFormatter = NumberFormat.getNumberInstance();
		
d270 2
a271 2
					fTextHeight.setText(numberFormatter.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getHeight())));
					fTextHeight.setText(numberFormatter.format(fConvertor.convertInchesToMilim(PageSetupPageType.pages[index].getWidth())));
d273 2
a274 2
					fTextHeight.setText(numberFormatter.format(PageSetupPageType.pages[index].getHeight()));
					fTextWidth.setText(numberFormatter.format(PageSetupPageType.pages[index].getWidth()));
d563 1
a563 1
			NumberFormat numberFormatter = NumberFormat.getNumberInstance();
d566 1
a566 1
				Number num = numberFormatter.parse(value);
d569 1
a569 1
				text.setText(numberFormatter.format(num.doubleValue()));
d575 1
a575 1
				text.setText(numberFormatter.format(fConvertor.convertToMillimetres(controlType)));
a661 1
		private double fConversionFactor = 25.4;
d670 1
a670 1
			NumberFormat ft = NumberFormat.getInstance();;
d673 1
a673 1
				num = ft.parse(text.getText());
d685 1
a685 1
			NumberFormat ft = NumberFormat.getInstance();;
d688 1
a688 1
				num = ft.parse(text.getText());
d700 1
a700 1
			return inches * fConversionFactor; 
d704 1
a704 1
			return milim / fConversionFactor;
d758 6
a763 8
			NumberFormat numberFormatter = NumberFormat.getNumberInstance();
			
			fTextWidth.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_PAGE_WIDTH)));
			fTextHeight.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_PAGE_HEIGHT)));
			fTextMarginTop.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_TOP)));
			fTextMarginBottom.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_BOTTOM)));
			fTextMarginLeft.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_LEFT)));
			fTextMarginRight.setText(numberFormatter.format(fConvertor.convertToInches(PageSetupControlType.TEXT_MARGIN_RIGHT)));
d785 6
a790 8
			NumberFormat numberFormatter = NumberFormat.getNumberInstance();
			
			fTextWidth.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_WIDTH)));
			fTextHeight.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_PAGE_HEIGHT)));
			fTextMarginTop.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_TOP)));
			fTextMarginBottom.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_BOTTOM)));
			fTextMarginLeft.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_LEFT)));
			fTextMarginRight.setText(numberFormatter.format(fConvertor.convertToMillimetres(PageSetupControlType.TEXT_MARGIN_RIGHT)));
@


1.2
log
@Bugzilla 108765 gmf_head tmacdoug 050912 - Update copyrights of GMF and EMFT plugins content to Eclipse copyright (EPL)
@
text
@d149 1
a149 1
		item.setText(LABEL_TITLE_PAGE_SETUP_TAB_ITEM); //$NON-NLS-1$
d207 1
a208 1
		createGroupPageOrientation(composite);
d347 1
a347 1
				fPreferencePage.setErrorMessage(LABEL_PRINT_PREFERENCE_PAGE_ERROR_MSG); //$NON-NLS-1$;
d749 1
a749 1
			if (b.getSelection()) { //$NON-NLS-1$
@


1.1
log
@Refactoring of the IBM gmf runtime contribution to the org.eclipse.gmf.runtime namespace.
@
text
@d1 11
a11 9
/*
 *+------------------------------------------------------------------------+
 *| Licensed Materials - Property of IBM                                   |
 *| (C) Copyright IBM Corp. 2002, 2005.  All Rights Reserved.              |
 *|                                                                        |
 *| US Government Users Restricted Rights - Use, duplication or disclosure |
 *| restricted by GSA ADP Schedule Contract with IBM Corp.                 |
 *+------------------------------------------------------------------------+
 */
@

