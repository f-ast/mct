71,71c71,71
< assign {cts, dsr, ri, dcd} = loopback ? {mcr [`UART_MC_DTR], mcr [`UART_MC_RTS], mcr [`UART_MC_OUT1], mcr [`UART_MC_OUT2]} : ~ {cts_pad_i, dsr_pad_i, ri_pad_i, dcd_pad_i};
---
> assign {cts, dsr, ri, dcd} = ~ {cts_pad_i, dsr_pad_i, ri_pad_i, dcd_pad_i};
90a91,93
> wire thre_set_en;
> reg [7 : 0] block_cnt;
> reg [7 : 0] block_value;
251a255,255
> assign lsr5 = (tf_count == 5?b0 && thre_set_en);
252,252d254
< assign lsr5 = (tf_count == 5?b0);
253,253c256,256
< assign lsr6 = (tf_count == 5?b0 && (tstate == 0));
---
> assign lsr6 = (tf_count == 5?b0 && thre_set_en && (tstate == 0));
364a368,390
> always @ (lcr) case (lcr [3 : 0]) 4?b0000 : block_value = 95;
> 4?b0100 : block_value = 103;
> 4?b0001, 4?b1000 : block_value = 111;
> 4?b1100 : block_value = 119;
> 4?b0010, 4?b0101, 4?b1001 : block_value = 127;
> 4?b0011, 4?b0110, 4?b1010, 4?b1101 : block_value = 143;
> 4?b0111, 4?b1011, 4?b1110 : block_value = 159;
> 4?b1111 : block_value = 175;
> endcase
> 
> always @ (posedge clk or posedge wb_rst_i) begin
>     if (wb_rst_i)
>         block_cnt <= # 1 8?d0;
>     else
>         if (lsr5r & fifo_write)
>             block_cnt <= # 1 block_value;
>         else
>             if (enable & block_cnt != 8?b0)
>                 block_cnt <= # 1 block_cnt - 1;
> 
> end
> 
> assign thre_set_en = ~ (| block_cnt);
